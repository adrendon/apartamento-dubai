"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[7391],{73943:(e,t,s)=>{s.d(t,{a:()=>r});var n=s(96540),i=s(98236),o=s(77201);const a=(0,i.v_)(o.zH);function r(){const e=a(),[t,s]=(0,n.useState)(e?e.phase:null);return(0,n.useEffect)((()=>{if(!e)return()=>{};const t=e.onPropertyChanged("phase",s);return s(e.phase),()=>t.cancel()}),[e]),t}},86e3:(e,t,s)=>{s.d(t,{F:()=>o});var n=s(87805),i=s(77201);const o=(0,n.u)(i.zH,"application",i.lg.UNKNOWN)},3801:(e,t,s)=>{s.r(t),s.d(t,{default:()=>r});var n=s(20916),i=s(84217),o=s(77201),a=s(97800);class r extends o.nV{constructor(){super(...arguments),this.name="app-phase",this.data=new o.zH(o.Jj.UNINITIALIZED)}async init(e,t){var s;this.broadcast=t.broadcast.bind(t),this.tasks=e.tasks,this.data.phase=o.Jj.UNINITIALIZED,this.data.phaseTimes[o.Jj.UNINITIALIZED]=Date.now(),this.data.application=null!==(s=e.initialApp)&&void 0!==s?s:o.lg.SHOWCASE,this.data.editMode=e.initialEditMode||!1,t.market.register(o.zH,this.data),this.watchTasks(this.data.phase),this.watchErrors(),this.updateAppHeaders(),this.bindings.push(this.data.onPropertyChanged("application",(()=>this.updateAppHeaders())))}async watchTasks(e){if(e>=o.Jj.PLAYING)return;const t=e+1;try{await Promise.all(this.tasks[t])}catch(e){this.error(e)}t===o.Jj.PLAYING&&this.broadcast(new o.Fj(this.data.application)),this.data.phase!==o.Jj.ERROR&&e!==o.Jj.ERROR&&(this.updateCurrentPhase(t),this.watchTasks(t))}async watchErrors(){try{await Promise.all(this.tasks[o.Jj.ERROR]),this.updateCurrentPhase(o.Jj.ERROR)}catch(e){this.error(e)}}updateCurrentPhase(e){a.Vy.for(this).devInfo(`Entering "${o.Jj[e]}" for "${this.data.application}"`),this.data.phase=e,this.data.phaseTimes[e]=Date.now(),a.Vy.for(this).debug(this.data.toString()),this.data.commit(),this.broadcast(new o.uv(e,this.data.application))}error(e){this.data.error=e,this.data.commit()}updateActiveApp(e){this.data.application=e,this.data.commit(),this.broadcast(new o.E5(e))}updateAppHeaders(){a.Vy.for(this).debug(`updating application headers ${this.data.application}`),(0,n.x)(this.data.getName()),(0,i._)(this.data.getVersion())}}},90082:(e,t,s)=>{s.d(t,{S1:()=>i,WJ:()=>n,ZF:()=>o});const n="IAppPhaseModule",i="Sdk",o="ISettingsModule"},39018:(e,t,s)=>{var n;s.d(t,{a:()=>n}),function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(n||(n={}))},25773:(e,t,s)=>{s.d(t,{d:()=>i});var n=s(77201);class i extends n.B_{constructor(){super(...arguments),this.name="sdk",this.applicationKeys=new n.XD}}},11889:(e,t,s)=>{s.r(t),s.d(t,{CommunicationMethod:()=>i.a,Sdk:()=>n.pd,default:()=>n.Bp});var n=s(41834),i=s(39018)},78671:(e,t,s)=>{s.d(t,{I:()=>n});const n="spaces.sdk.qa"},41834:(e,t,s)=>{s.d(t,{pd:()=>J,Bp:()=>z});var n,i=s(97084),o=s(77778),a=s(86867),r=s(10833),c=s(48059),d=s(71687),l=s(77201),h=s(97800),u=s(25773);!function(e){e.CONNECTION="sdk.connection",e.DISCONNECT="sdk.disconnect",e.MESSAGED="sdk.messaged",e.SUBSCRIBED="sdk.subscribed",e.UNSUBSCRIBED="sdk.unsubscribed",e.OBSERVABLE_SUB="sdk.obs.subscribe",e.OBSERVABLE_UNSUB="sdk.obs.unsubscribe",e.COLLECTION_SUB="sdk.coll.subscribe",e.COLLECTION_UNSUB="sdk.coll.unsubscribe"}(n||(n={}));class g{constructor(e){this.analytics=e,this.trackedEvents=new o.kc}track(e,t,s){this.trackedEvents.has(e,t)||(this.trackedEvents.add(e,t),this.analytics.track(e,Object.assign({},s)))}alwaysTrack(e,t,s){this.trackedEvents.add(e,t),this.analytics.track(e,Object.assign({},s))}setOptions(e){this.analytics.setOptions(e)}}class p{constructor(e){this.analytics=e,this.messageType="client call"}onMessage(e,t){const{namespace:s,name:n}=e,i={applicationKey:t.applicationKey,namespace:s,name:n,method:t.communicationMethod,provider:t.context.provider,sdkType:t.context.sdkType};this.analytics.track("sdk_call",s+n,i)}}class b{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}var f=s(21713),m=s(69991),v=s(33049),y=s(39018),C=s(75986),I=s(14895),S=s(15690),k=s(52294);class w{constructor(e,t,s,n,i){this.hostWindow=e,this.hostId=t,this.applicationKey=s,this.idGenerator=n,this.connectionReceiver=i,this.inFlightClients=new Set,this.connectionHandler=new f.Z(t,new m.m(window)),this.connectionHandler.addObserver(new C.o({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){var s,n;if(this.inFlightClients.has(t.id))return;e=e||{},this.inFlightClients.add(t.id);const i=e&&e.bootstrapVersion?this.idGenerator.generate():t.id,o=this.hostId,a=t.source,r=this.hostWindow,c=new v.Y(o,r,i,a).createMessenger();this.connectionReceiver.onConnectionReceived(t.origin,e.options,{applicationKey:e.applicationKey||this.applicationKey,id:i,messenger:c,communicationMethod:y.a.POSTMESSAGE,context:{provider:(null===(s=e.options)||void 0===s?void 0:s.provider)||"",sdkType:(null===(n=e.options)||void 0===n?void 0:n.sdkType)||"",bootstrap:{version:e.bootstrapVersion,providedAppKey:!!e.applicationKey}}},{accept(e,t){c.send(new I.g(e,t,i,o,window.location.origin))},handshake(){c.send(new S.R)},reject(e){c.send(new k.v(e)),c.dispose()}})}}var O,T=s(93527),E=s(80279),_=s(55723),K=s(82655),M=s(30530),P=s(72173);!function(e){e.CONNECT_PLUGIN="connect.plugin"}(O||(O={}));class R{constructor(e,t,s,n){this.type=O.CONNECT_PLUGIN,this.payload={bootstrapVersion:e,applicationKey:s,pluginId:n,options:{auth:t.auth,provider:t.provider,sdkType:t.sdkType}}}}class U{constructor(e){this.receiver=e,this.messageType=O.CONNECT_PLUGIN}notify(e,t){this.receiver.onConnectionReceived(e,t)}}function G(e){return(0,c.G)(e)&&void 0!==e.pluginId}class j{constructor(e,t,s){this.idGenerator=t,this.connectionReceiver=s,this.host={id:e,node:new T.F(window.location.origin)},this.connectionHandler=new f.Z(e,new E.d(this.host.node)),this.connectionHandler.addObserver(new U({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){B(e,this.host,{info:t,applicationKey:e.applicationKey},this.connectionReceiver,{pluginId:e.pluginId})}connect(e){const t={id:this.idGenerator.generate(),node:new T.F(origin)};return N(this.host,t,(t=>t.send(new R("plugin",{sdkType:J.Type.PLUGIN},e.applicationKey,e.pluginId))))}}class x{constructor(e,t,s,n){this.applicationKey=t,this.idGenerator=s,this.connectionReceiver=n,this.host={id:e,node:new T.F(window.location.origin)},this.connectionHandler=new f.Z(e,new E.d(this.host.node)),this.connectionHandler.addObserver(new C.o({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){B(e,this.host,{info:t,applicationKey:this.applicationKey},this.connectionReceiver)}connect(e,t={}){const s={id:this.idGenerator.generate(),node:new T.F(e)};return N(this.host,s,(e=>e.send(new K.S("direct",t))))}}function N(e,t,s){const{id:n,node:i}=e,{id:o,node:a}=t,r=new _.Z(o,a,n,i);return new Promise(((e,t)=>{const c=new _.Z(o,a,n,i).createMessenger();c.init();const d=new class{accept(t,s,n,i){e({targetOrigin:origin,sourceId:t,targetId:i,scriptUrl:s,serializedInterface:n,messengerFactory:r}),c.dispose()}reject(e){t(e),c.dispose()}};c.addObserver(new M.F(d)),c.addObserver(new P.a(d)),s(c)}))}function B(e,t,s,n,i){var o,a;const{id:r,node:c}=t,{id:d,source:l,source:{origin:h}}=s.info,u=new _.Z(r,c,d,l).createMessenger();n.onConnectionReceived(h,e.options,{id:d,applicationKey:s.applicationKey,messenger:u,communicationMethod:y.a.DIRECT,context:{provider:(null===(o=e.options)||void 0===o?void 0:o.provider)||"",sdkType:(null===(a=e.options)||void 0===a?void 0:a.sdkType)||"",pluginId:G(i)?i.pluginId:void 0,bootstrap:{version:G(i)?"plugin":"direct",providedAppKey:!!e.applicationKey}}},{accept(e,t){u.send(new I.g(e,t,d,r,h))},handshake(){u.send(new S.R)},reject(e){u.send(new k.v(e)),u.dispose()}})}var A=s(7691),H=s(77331),L=s(45493),D=s(20751);class F{constructor(){this.dirty=!1}dispose(){}}const q=new h.Vy("FactAnalytics");class V{constructor(e){this.proxy=e}track(e,t,s){const n={};let i=0,o=0,a=0;if(null==s?void 0:s.records)for(const e in s.records){const t=s.records[e];let r="",c=!1;if("number"==typeof t){const e=t.toString();Number.isInteger(t)&&!e.includes(".")?i<3&&(r="integer"+i++,c=!0):o<3&&(r="float"+o++,c=!0)}else"string"==typeof t&&a<3&&(r="string"+a++,c=!0);c?n[r]={name:e,value:t}:q.info(`Omitting key: ${r} value: ${t} from fact`)}const r={applicationKey:e.client.applicationKey,pluginId:e.client.pluginId,fact:Object.assign({name:t,version:(null==s?void 0:s.version)||1},n)};(null==s?void 0:s.alwaysTrack)?this.proxy.alwaysTrack("sdk_fact",t,r):this.proxy.track("sdk_fact",t,r)}}const $=new h.Vy("sdk");class z extends l.nV{constructor(){super(...arguments),this.name="sdk",this.hostId=Math.floor(1e6*Math.random()),this.connectionHandlers=[],this.clientInterface=(0,h.A4)(Object.assign({},z.emptyInterface)),this.perOriginInterfaces=new o.kG((()=>(0,h.A4)(Object.assign({},z.emptyInterface)))),this.perSdkTypeInterfaces=new o.kG((()=>(0,h.A4)(Object.assign({},z.emptyInterface)))),this.pendingClients=new l.Es,this.clientConnections=new Map,this.eventToClientSubMap=new o.kc,this.clientToEventSubMap=new o.kc,this.observableToClientSubMap=new o.kc,this.clientToObservableSubMap=new Map,this.collectionToClientSubMap=new o.kc,this.clientToCollectionSubMap=new Map,this.privateMessageHandlers=new o.kc,this.valueToClientInterface={},this.commandCreators={},this.commands={},this.asyncCommands={},this.observables={},this.collections={},this.commandExecutionOrder=0,this.firstTimeCollectionSubs=new o.kc,this.sdkTypeByBuild=J.Type.EMBED}async init(e,t){this.config=e,this.validationUrl=e.validationUrl,this.facade=new z.MessengerHostFacade(this),this.clientIdGenerator=new b,this.postmessageConnectHandler=new w(window,this.hostId,e.applicationKey,this.clientIdGenerator,this.facade),this.directConnectHandler=new x(this.hostId,e.applicationKey,this.clientIdGenerator,this.facade),this.pluginConnectHandler=new j(this.hostId,this.clientIdGenerator,this.facade),this.connectionHandlers.push(this.postmessageConnectHandler,this.directConnectHandler,this.pluginConnectHandler),this.sdkTypeByBuild=J.Type.EMBED,this.analytics=new g(await t.getModuleBySymbol(d.aF)),this.factAnalytics=new V(this.analytics),this.clientFilter=e.clientFilter||(()=>!0),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),this.getSdkConfig=e.getSdkConfig,this.requestQueue=e.queue,this.data=new u.d,t.market.register(u.d,this.data),this.addPrivateMessageHandler(new p(this.analytics)),this.enableHandshaking()}dispose(){for(const e of this.connectionHandlers)e.dispose();this.clearInterface()}connect(e,t){try{new URL(e)}catch(e){return Promise.reject(e)}return this.directConnectHandler.connect(e,t)}connectPlugin(e,t){return this.pluginConnectHandler.connect({applicationKey:e,pluginId:t})}getClientAuth(e){const t=this.pendingClients.get(e);return t?Promise.resolve(t):new Promise((t=>{const s=this.pendingClients.onElementChanged({onAdded(n,i){i===e&&(t(n),s.cancel())}})}))}enableHandshaking(){for(const e of this.connectionHandlers)e.init()}async setupInterface(){return this.interfaceLoading||(this.interfaceLoading=this.config.setupExternalSdk(this)),this.interfaceLoading}clearInterface(){this.clientInterface.functions={},this.clientInterface.commands={},this.clientInterface.enums={},this.clientInterface.observables={},this.clientInterface.collections={},this.commandCreators={}}onUpdate(){for(const[e,t]of this.clientToObservableSubMap)for(const[s,[n,i]]of t)if(n.dirty){try{this.notifyObservableUpdate(s,i.getData(),e)}catch(t){$.error(`Error notifying client ${e} of observable ${s} update:`,t)}n.dirty=!1}for(const[e,t]of this.clientToCollectionSubMap)for(const[s,[,n]]of t)if(n.dirty)try{this.notifyCollectionUpdates(s,n.readDiff(),e)}catch(t){$.error(`Error notifying client ${e} of collection ${s} update:`,t)}}addCommandCreator(e,t){const s=Q(e);if(this.clientInterface.functions.hasOwnProperty(s)&&$.debugInfo(`Overwriting ${s} function in sdk interface`),e.sdkTypes)for(const t of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(t);n.functions[s]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,n)}if(e.origins)for(const t of e.origins){const n=this.perOriginInterfaces.get(t);n.functions[s]=Object.assign({},e),this.perOriginInterfaces.set(t,n)}this.clientInterface.functions[s]=e,this.commandCreators[s]=t}addEnumToInterface(e){const t=Q(e);if(this.clientInterface.enums.hasOwnProperty(t)&&$.debugInfo(`Overwriting ${t} enum in sdk interface`),e.sdkTypes)for(const s of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(s);n.enums[t]=Object.assign({},e),this.perSdkTypeInterfaces.set(s,n)}if(e.origins)for(const s of e.origins){const n=this.perOriginInterfaces.get(s);n.enums[t]=Object.assign({},e),this.perOriginInterfaces.set(s,n)}if(this.clientInterface.enums[t]=Object.assign(Object.assign({},e),{values:Object.assign({},e.values)}),"Event"===e.name){const t=Object.keys(e.values);for(const s in t){this.valueToClientInterface;const n=e.values[t[s]];this.valueToClientInterface.hasOwnProperty(n)?$.warn(`Duplicate event detected for ${JSON.stringify(e)}`):this.valueToClientInterface[n]=e}}}addCommandToInterface(e,t){this.addCommand(e,t)}addAsyncCommandToInterface(e,t){this.addCommand(e,t,{canQueue:!0})}addCommandUnlisted(e,t,s=!1){this.addCommand(e,t,{canQueue:s,unlisted:!0})}addCommand(e,t,s={canQueue:!1,unlisted:!1}){s.unlisted?this.registerUnlistedCommand(e):this.registerCommandInInterface(e);const n=Q(e),i=s.canQueue?this.asyncCommands:this.commands;if(s.canQueue)return i[n]=t,{dispose(){delete i[n]}};const o=t.then((e=>i[n]=e));return{dispose(){o.then((()=>delete i[n]))}}}registerUnlistedCommand(e){const t=Q(e);this.clientInterface.unlistedCmds.hasOwnProperty(t)&&$.debugInfo(`Overwriting ${t} unlisted command in sdk interface`),this.clientInterface.unlistedCmds[t]=Object.assign({},e)}registerCommandInInterface(e){const t=Q(e);if(this.clientInterface.commands.hasOwnProperty(t)&&$.debugInfo(`Overwriting ${t} command in sdk interface`),e.sdkTypes)for(const s of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(s);n.commands[t]=Object.assign({},e),this.perSdkTypeInterfaces.set(s,n)}if(e.origins)for(const s of e.origins){const n=this.perOriginInterfaces.get(s);n.commands[t]=Object.assign({},e),this.perOriginInterfaces.set(s,n)}this.clientInterface.commands[t]=e}addObservableToInterface(e,t){const s=Q(e);if(this.addObservable(s,t),e.sdkTypes)for(const t of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(t);n.observables[s]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,n)}if(e.origins)for(const t of e.origins){const n=this.perOriginInterfaces.get(t);n.observables[s]=Object.assign({},e),this.perOriginInterfaces.set(t,n)}this.clientInterface.observables[s]=Object.assign({},e)}addObservable(e,t){this.clientInterface.observables.hasOwnProperty(e)&&$.debugInfo(`Overwriting ${e} observable in sdk interface`),this.observables[e]=t;const s=this;return{dispose(){s.removeObservable(e)}}}removeObservable(e){var t;delete this.observables[e];for(const s of this.observableToClientSubMap.getValuesAtKey(e))null===(t=this.clientToObservableSubMap.get(s.id))||void 0===t||t.delete(e);this.observableToClientSubMap.removeKey(e)}addCollectionToInterface(e,t){const s=Q(e);if(this.addCollection(s,t),e.sdkTypes)for(const t of e.sdkTypes){const n=this.perSdkTypeInterfaces.get(t);n.collections[s]=Object.assign({},e),this.perSdkTypeInterfaces.set(t,n)}if(e.origins)for(const t of e.origins){const n=this.perOriginInterfaces.get(t);n.collections[s]=Object.assign({},e),this.perOriginInterfaces.set(t,n)}this.clientInterface.collections[s]=Object.assign({},e)}addCollection(e,t){this.clientInterface.collections.hasOwnProperty(e)&&$.debugInfo(`Overwriting ${e} collection in sdk interface`),this.collections[e]=t;const s=this;return{dispose(){s.removeCollection(e)}}}removeCollection(e){var t;delete this.collections[e];for(const s of this.collectionToClientSubMap.getValuesAtKey(e))null===(t=this.clientToCollectionSubMap.get(s.id))||void 0===t||t.delete(e);this.collectionToClientSubMap.removeKey(e)}addPrivateMessageHandler(e){const{privateMessageHandlers:t}=this;return t.add(e.messageType,e),{dispose(){t.remove(e.messageType,e)}}}sendPrivateMessage(e,t,s){for(const[,n]of this.clientConnections)void 0!==s&&n.executing.id!==s||n.messaging.messenger.send(new D.x$(e,t))}broadcast(e,t,s){for(const[,n]of this.clientConnections)if(t){const i=t(s);n.messaging.messenger.send(new D.WN(e,i||[]))}else n.messaging.messenger.send(new D.WN(e,[]))}notifyObservableUpdate(e,t,s){for(const n of this.observableToClientSubMap.getValuesAtKey(e))n.id===s&&n.messenger.send(new D.mS(e,t))}notifyCollectionUpdates(e,t,s){const{added:n,removed:i,updated:o}=t,a=n.size>0,r=i.size>0,c=o.size>0,d=this.clientConnections.get(s);if(d){const t=d.messaging,s=t.id;if(a)for(const[s,i]of n)t.messenger.send(new D.L0(D.CF.ITEM_ADDED,e,s,i));if(r)for(const[s]of i)t.messenger.send(new D.Vm(D.CF.ITEM_REMOVED,e,s));if(c)for(const[s,n]of o)t.messenger.send(new D.ET(D.CF.ITEM_UPDATED,e,s,n));(a||r||c||this.firstTimeCollectionSubs.has(s,e))&&(t.messenger.send(new D.Bb(D.CF.COLL_UPDATED,e)),this.firstTimeCollectionSubs.remove(s,e))}}verifyConnection(e,t){const s={cache:!1,headers:{"X-Matterport-Application-Key":t,"X-Matterport-Referrer":e},priority:i.QK.HIGH};return this.requestQueue.get(this.validationUrl,s)}async onConnectionReceived(e,t={},s,n){if(!this.clientFilter(e))return n.reject(new A.L);t&&(0,a.U)(J.Type,t.sdkType)?s.context.sdkType=t.sdkType:s.context.sdkType=this.sdkTypeByBuild;const i=new W(t.auth,t.provider);if(!G(s.context))try{await this.verifyConnection(e,s.applicationKey),this.pendingClients.set(s.applicationKey,i)}catch(t){return i.reject(),n.reject(new H.d(`${s.applicationKey}@${e} - Key/referrer mismatch`))}const o=()=>{const t=new URL(e).hostname,n=this.perOriginInterfaces.get(t.toLowerCase()),i=this.perSdkTypeInterfaces.get(s.communicationMethod),o={enums:{},functions:{},unlistedFcns:{},observables:{},collections:{}},a=function(e,t,s,n){const i=e[t].sdkTypes,o=e[t].origins;if(!i&&!o)return!0;const a=i&&o&&(null==s?void 0:s[t])&&(null==n?void 0:n[t]),r=i&&!o&&(null==s?void 0:s[t]),c=!i&&o&&(null==n?void 0:n[t]);return a||r||c};for(const e in this.clientInterface.enums)a(this.clientInterface.enums,e,null==i?void 0:i.enums,null==n?void 0:n.enums)&&(o.enums[e]=this.clientInterface.enums[e]);for(const e in this.clientInterface.observables)a(this.clientInterface.observables,e,null==i?void 0:i.observables,null==n?void 0:n.observables)&&(o.observables[e]=this.clientInterface.observables[e]);for(const e in this.clientInterface.collections)a(this.clientInterface.collections,e,null==i?void 0:i.collections,null==n?void 0:n.collections)&&(o.collections[e]=this.clientInterface.collections[e]);for(const e in this.clientInterface.functions)a(this.clientInterface.functions,e,null==i?void 0:i.functions,null==n?void 0:n.functions)&&(o.functions[e]=this.clientInterface.functions[e]);for(const e in this.clientInterface.commands)a(this.clientInterface.commands,e,null==i?void 0:i.commands,null==n?void 0:n.commands)&&(o.functions[e]=this.clientInterface.commands[e]);for(const e in this.clientInterface.unlistedCmds)o.unlistedFcns[e]=this.clientInterface.unlistedCmds[e];return o};n.handshake();try{if(!G(s.context)){if(!await this.config.validateProvider(t.provider))throw i.reject(),new L.d}i.accept(),await this.setupInterface();const a=o();this.onConnectionAccepted(e,s,t);const r=new URL((await this.getSdkConfig).client);r.searchParams.append("applicationKey",s.applicationKey),n.accept(r.href,a),this.data.atomic((()=>{this.data.applicationKeys.push({key:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType}),this.data.commit()}))}catch(e){n.reject(e)}}onConnectionAccepted(e,t,s){const n=t.id,i=t.messenger,o={messaging:Object.assign(Object.assign({},t),{origin:e}),executing:{get id(){return t.context.pluginId||String(n)},applicationKey:t.applicationKey,pluginId:t.context.pluginId}};this.clientConnections.set(n,o);const a=this.facade;i.addObserver(new D.CP(a,o.messaging)),i.addObserver(new D.co(a,o.messaging)),i.addObserver(new D.V_(a,o.messaging)),i.addObserver(new D.dP(a,o.messaging)),i.addObserver(new D.O0(a,o.messaging)),i.addObserver(new D.Gj(a,o.messaging)),i.addObserver(new D.r9(a,o.messaging)),i.addObserver(new D.Pv(a,o.messaging)),i.init(),this.trackSdkConnect(o.messaging,s)}onDisconnectReceived(e,t){const s=t.messaging,n=this.clientToEventSubMap.getValuesAtKey(s.id),i=this.clientToObservableSubMap.get(s.id)||[],o=this.clientToCollectionSubMap.get(s.id)||[];for(const e of n)this.eventToClientSubMap.remove(e,s);for(const[e]of i)this.observableToClientSubMap.remove(e,s);for(const[e]of o)this.collectionToClientSubMap.remove(e,s);this.clientToEventSubMap.removeKey(s.id),this.clientToObservableSubMap.delete(s.id),this.clientToCollectionSubMap.delete(s.id);const a=this.data.applicationKeys.indexOf({key:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType});a>-1&&this.data.applicationKeys.splice(a,1)}onActionReceived(e,t){if(this.tryActionThroughCommand(e,t))return;const s=this.commandCreators[e.targetFunction];if(s){this.trackSdkCall(e,t.messaging.id);try{this.issueCommand(s(e.params,t.executing)).then((s=>t.messaging.messenger.send(new D.d_(e.uid,s,!0,"")))).catch((s=>t.messaging.messenger.send(new D.d_(e.uid,{},!1,s.message||s))))}catch(s){$.debug(s),t.messaging.messenger.send(new D.d_(e.uid,{},!1,s.message))}}else t.messaging.messenger.send(new D.d_(e.uid,{},!1,`${e.targetFunction} is not a valid command`))}tryActionThroughCommand(e,t){if(this.tryActionThroughAsyncCommand(e,t))return!0;const s=this.commands[e.targetFunction];if(!s)return!!this.clientInterface.commands.hasOwnProperty(e.targetFunction)&&(t.messaging.messenger.send(new D.d_(e.uid,{},!1,`${e.targetFunction} is not ready to be called`)),!0);this.trackSdkCall(e,t.messaging.id);try{s.exec(e.params,Object.assign(Object.assign({},e.context),{client:t.executing,key:e.targetFunction,executionId:this.commandExecutionOrder++})).then((s=>{t.messaging.messenger.send(new D.d_(e.uid,s,!0,""))})).catch((s=>{t.messaging.messenger.send(new D.d_(e.uid,{},!1,s.message||s))}))}catch(s){$.debug(s),t.messaging.messenger.send(new D.d_(e.uid,{},!1,s.message))}return!0}tryActionThroughAsyncCommand(e,t){const s=this.asyncCommands[e.targetFunction];return!!s&&(s.then((s=>{this.trackSdkCall(e,t.messaging.id);try{s.exec(e.params,Object.assign(Object.assign({},e.context),{client:t.executing,key:e.targetFunction,executionId:this.commandExecutionOrder++})).then((s=>{t.messaging.messenger.send(new D.d_(e.uid,s,!0,""))})).catch((s=>{t.messaging.messenger.send(new D.d_(e.uid,{},!1,s.message||s))}))}catch(s){$.debug(s),t.messaging.messenger.send(new D.d_(e.uid,{},!1,s.message))}})),!0)}onEventSubReceived(e,t){const s=t.messaging;this.eventToClientSubMap.add(e.subscription,s),this.trackSdkEvent(n.SUBSCRIBED,e,s)}onEventUnsubReceived(e,t){const s=t.messaging;this.eventToClientSubMap.remove(e.subscription,s),this.trackSdkEvent(n.UNSUBSCRIBED,e,s)}async onObservableSubReceived(e,t){const s=t.messaging,i=e.observableKey,o=this.observables[i];if(o){const t=await o;if(!this.observables[i])return;if(!this.observableToClientSubMap.has(i,s)){const o=new F,a=t.subscribe(o);this.observableToClientSubMap.add(i,s);const r=this.clientToObservableSubMap.get(s.id)||new Map;r.set(i,[o,t,a]),this.clientToObservableSubMap.set(s.id,r),this.trackClientObservableSub(n.OBSERVABLE_SUB,e,s)}}else $.error(i,"is not a valid, registered observable")}onObservableUnsubReceived(e,t){const s=t.messaging,i=e.observableKey;this.observableToClientSubMap.remove(i,s);const o=this.clientToObservableSubMap.get(s.id);if(o){const t=o.get(i);if(t){const[,,a]=t;a.cancel(),o.delete(i),this.trackClientObservableSub(n.OBSERVABLE_UNSUB,e,s)}}}async onCollectionSubReceived(e,t){const s=t.messaging,i=e.collectionKey,o=this.collections[i];if(o){const t=await o;if(!this.collections[i])return;if(!this.collectionToClientSubMap.has(i,s)){const o=t.subscribe(s),a=[t,o];this.collectionToClientSubMap.add(i,s);const r=this.clientToCollectionSubMap.get(s.id)||new Map;r.set(i,a),this.clientToCollectionSubMap.set(s.id,r),this.firstTimeCollectionSubs.add(s.id,i),this.trackClientCollectionSub(n.COLLECTION_SUB,e,s)}}else $.error(i,"is not a valid, registered collection")}onCollectionUnsubReceived(e,t){const s=t.messaging,i=e.collectionKey;this.collectionToClientSubMap.remove(i,s);const o=this.clientToCollectionSubMap.get(s.id);if(o){const t=o.get(i);if(t){const[,a]=t;a.cancel(),o.delete(i),this.trackClientCollectionSub(n.COLLECTION_UNSUB,e,s)}}}onPrivateMessageReceived(e,t){const{messageType:s,messagePayload:n}=e;for(const e of this.privateMessageHandlers.getValuesAtKey(s))(e.clientId||e.clientId===t.executing.id)&&e.onMessage(n,t.messaging)}trackSdkConnect(e,t){if(!this.analytics)return;const s="string"==typeof(null==t?void 0:t.auth),n={origin:e.origin,applicationKey:e.applicationKey,provider:e.context.provider,method:e.communicationMethod,sdkType:e.context.sdkType,pluginId:e.context.pluginId,authTokenProvided:s,bootstrapVersion:e.context.bootstrap.version,bootstrapProvidedAppKey:e.context.bootstrap.providedAppKey};this.analytics.setOptions({authTokenProvided:s}),this.analytics.alwaysTrack("sdk_connect","connect",n)}trackSdkEvent(e,t,s){if(!this.analytics)return;const i=e===n.SUBSCRIBED?"on":"off",o=this.valueToClientInterface[t.subscription];if(!o)return;const a=Object.keys(o.values),r=a.find(((e,s)=>{const n=a[s];return o.values[n]===t.subscription}));if(!r)return;const c={origin:s.origin,applicationKey:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType,name:i,namespace:o.namespace,eventType:r,count:this.eventToClientSubMap.valuesPerKey(t.subscription),method:s.communicationMethod,pluginId:s.context.pluginId};this.analytics.track("sdk_event",t.subscription,c)}trackSdkCall(e,t){const s=this.clientConnections.get(t);if(!s)return;const n=this.clientInterface.functions[e.targetFunction]||this.clientInterface.commands[e.targetFunction],i=s.messaging,o=Object.assign(Object.assign({origin:i.origin,applicationKey:i.applicationKey,provider:i.context.provider,sdkType:i.context.sdkType},n),{method:i.communicationMethod,pluginId:i.context.pluginId});if(this.analytics.track("sdk_call",e.targetFunction,o),n&&"Settings"===n.namespace&&"update"===n.name){const{key:t,value:s}=e.params;(0,r.K)(t)&&this.analytics.track("sdk_settings",t,{origin:i.origin,applicationKey:i.applicationKey,provider:i.context.provider,sdkType:i.context.sdkType,pluginId:i.context.pluginId,settingKey:t,settingValue:(0,c.G)(s)?{}.toString():(0,r.K)(s)?s:JSON.stringify(s)})}}trackClientObservableSub(e,t,s){const i=e===n.OBSERVABLE_SUB,o=this.clientInterface.observables[t.observableKey],a=Object.assign(Object.assign({origin:s.origin,applicationKey:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType},o),{is_collection:!1,action:i?"subscribe":"cancel",method:s.communicationMethod,pluginId:s.context.pluginId});this.analytics.track("sdk_subscribe",t.observableKey,a)}trackClientCollectionSub(e,t,s){const i=e===n.COLLECTION_SUB,o=this.clientInterface.collections[t.collectionKey],a=Object.assign(Object.assign({origin:s.origin,applicationKey:s.applicationKey,provider:s.context.provider,sdkType:s.context.sdkType},o),{is_collection:!0,action:i?"subscribe":"cancel",method:s.communicationMethod,pluginId:s.context.pluginId});this.analytics.track("sdk_subscribe",t.collectionKey,a)}track(e,t,s){e.client.pluginId&&this.factAnalytics.track(e,t,s)}}var J;z.emptyInterface={functions:{},commands:{},unlistedCmds:{},enums:{},observables:{},collections:{}},z.MessengerHostFacade=class{constructor(e){this.messageHandler=e}onConnectionReceived(e,t,s,n){this.messageHandler.onConnectionReceived(e,t,s,n)}onDisconnectReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onDisconnectReceived(e,s)}onActionReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onActionReceived(e,s)}onEventSubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onEventSubReceived(e,s)}onEventUnsubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onEventUnsubReceived(e,s)}onObservableSubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onObservableSubReceived(e,s)}onObservableUnsubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onObservableUnsubReceived(e,s)}onCollectionSubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onCollectionSubReceived(e,s)}onCollectionUnsubReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onCollectionUnsubReceived(e,s)}onPrivateMessageReceived(e,t){const s=this.messageHandler.clientConnections.get(t.id);s&&this.messageHandler.onPrivateMessageReceived(e,s)}},function(e){let t;e.name="sdk",function(e){e.EMBED="sdk.embed",e.BUNDLE="sdk.bundle",e.PLUGIN="sdk.plugin",e.NPM_SDK="npm.embed",e.NPM_WEB_COMPONENT="npm.webcomponent",e.NPM_R3F="npm.r3f"}(t=e.Type||(e.Type={}))}(J||(J={}));class W{constructor(e,t){this.token=e,this.provider=t,this.isAccepted=new l.Lj(null)}get accepted(){if(null!==this.isAccepted.value){if(this.isAccepted.value)return Promise.resolve();if(!this.isAccepted.value)return Promise.reject()}return new Promise(((e,t)=>{if(null===this.isAccepted.value){const s=this.isAccepted.onChanged((n=>{n?e():t(),s.cancel()}))}}))}accept(){this.isAccepted.value=!0}reject(){this.isAccepted.value=!1}}function Q(e){let t=`${e.name}`;return e.namespace&&(t=`${e.namespace}.${t}`),t}},87965:(e,t,s)=>{var n;s.d(t,{Y:()=>n}),function(e){e.BlursAddNudgeSeen="user_preference/blurs_add_nudge",e.DefurnishNudgeSeen="user_preference/defurnish_nudge",e.DefurnishRated="user_preference/defurnish_rated",e.DollhouseUserNudgeSeen="user_preference/dollhouse_nudge",e.FloorplanRoomsUserNudgeSeen="user_preference/floorplan_rooms_nudge",e.HighlightReelSettingsTab="user_preference/highlight_reel_settings_tab",e.LastRatingPromptTime="user_preference/model_rating_last_prompt_time",e.MeasurementContinuousLines="user_preference/measurement_continuous",e.MeasurementSnapping="user_preference/measurement_snapping",e.MeasurementUserNudgeSeen="user_preference/measurement_nudge",e.NotesAddNudgeSeen="user_preference/notes_add_nudge",e.NotesModeNudgeSeen="user_preference/notes_mode_nudge",e.SubscriberPromptDismissed="user_preference/subscriber_prompt_dismissed",e.TagsAddNudgeSeen="user_preference/tags_add_nudge",e.TourMobileNavigationPromptSeen="user_preference/tour_mobile_nav_prompt_seen",e.TourTextNudgeDismissed="user_preference/tour_text_nudge_dismissed",e.UnitType="user_preference/unit_type",e.AutoToursRated="user_preference/auto_tours_rated"}(n||(n={}))},49523:(e,t,s)=>{s.d(t,{y:()=>i});var n=s(77201);class i extends n.uB{constructor(e){super(),this.payload={key:e}}}i.id="SETTING_GET"},5146:(e,t,s)=>{s.d(t,{h:()=>i});var n=s(77201);class i extends n.uB{constructor(e,t){super(),this.payload={key:e,value:t}}}i.id="SETTING_UPDATE"},81459:(e,t,s)=>{s.d(t,{U:()=>n});class n{constructor(e,t){this.settingsData=e,this.settings=t,this.cache={},this.toggle=e=>{e?this.apply():this.reset()}}apply(){Object.keys(this.cache).length>0&&this.reset(),this.cache={};for(const e of Object.keys(this.settings)){const t=this.settingsData.tryGetSetting(e,void 0);t!==this.settings[e]&&(this.cache[e]=t,this.settingsData.setSetting(e,this.settings[e]))}}reset(){for(const e of Object.keys(this.cache)){const t=this.cache[e];this.settingsData.setSetting(e,void 0!==t&&t)}this.cache={}}}},25316:(e,t,s)=>{s.d(t,{o:()=>o});var n=s(77201),i=s(97800);class o extends n.B_{constructor(e={}){super(),this.overrideParams=e,this.name="settings",this.settings=(0,n.y3)(),this.listeners=new Map}setSetting(e,t){const s=this.settings.get(e);if(null==t||s!==t){this.settings.set(e,t);const s=this.listeners.get(e);s&&s.triggerCb(t)}}setLocalStorageSetting(e,t){(0,i.lk)(e,t),this.setSetting(e,t)}hasSetting(e){return this.settings.has(e)}tryGetSetting(e,t){return this.hasSetting(e)?this.settings.get(e):t}getSetting(e){if(this.hasSetting(e))return this.settings.get(e);throw new Error("SettingsData: "+e+" not found")}onSettingChanged(e,t){let s=this.listeners.get(e);return s||(s=new n.m0,this.listeners.set(e,s)),s.add(t)}getOverrideParam(e,t=null,s=typeof t){var n;return(0,i.R5)(null!==(n=this.overrideParams[e])&&void 0!==n?n:null,t,s)}iterate(e){for(const t of this.settings.keys)e(t,this.getSetting(t))}}},50747:(e,t,s)=>{s.d(t,{F:()=>o});var n=s(77570),i=s(96540);const o=()=>(0,i.useContext)(n.B).settings},92352:(e,t,s)=>{s.r(t),s.d(t,{SettingPersistence:()=>l.u,default:()=>h});var n,i=s(77201),o=s(97800);!function(e){e[e.Init=0]="Init",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded"}(n||(n={}));class a{constructor(e,t){this.queryScope=e,this.onChange=t,this.settings={},this.helperObject={colors:{},vectors:{},quaternions:{}},this.initPromise=new i.iB,this.loadState=n.Init,this.uninitError="ControlKit not yet initialized",this.lastKeys=[],this.lastKeysBufferLength=0,this.controlKit=void 0,this.updateRequired=!1,this.panels=[],this.onToggleCallbacks={},this.onKeyDown=e=>{this.lastKeys.unshift(e.keyCode),this.lastKeys.length>this.lastKeysBufferLength&&this.lastKeys.pop();for(let e=0;e<this.panels.length;e++){const t=this.panels[e].activationSequence;c(this.lastKeys,t)&&this.toggle(e)}},this.getPanelId=e=>{for(const t of this.panels)if(e===t.header)return t.index;return-1},this.getSubGroup=(e,t)=>{const s=this.panels[e];s.guiPanel||(s.guiPanel=s.makeGuiPanel()),s.allowSubGroups||(t="");let n=s.subGroups.get(t||"");if(!n){s.guiPanel.addSubGroup({label:t,enable:!s.allowSubGroups});const e=s.guiPanel._groups[s.guiPanel._groups.length-1],i=e._subGroups[e._subGroups.length-1];n=new r(s.guiPanel,e,i),s.subGroups.set(t||"",n)}return n},this.addColor=(e,t,s,n)=>{const i=this.key(t,s);this.updateHelperObject(i,n),e.addColor(this.helperObject.colors,i,{label:s,colorMode:"hex",onChange:e=>{this.settings[i].setHex(parseInt(e.substring(1),16));const t={};t[s]=this.settings[i],this.onChange(t)}})},this.addVector3=(e,t,s,n)=>{const i=this.key(e,s);this.updateHelperObject(i,n);const o=this.getSubGroup(e,`${t}: ${s}`),a=["x","y","z"];for(const e in a)o.addNumberInput(this.helperObject.vectors[i],a[e],{label:a[e],onChange:()=>{this.settings[i].set(this.helperObject.vectors[s].x,this.helperObject.vectors[s].y,this.helperObject.vectors[s].z);const e={};e[s]=this.settings[i],this.onChange(e)}})},this.addQuaternion=(e,t,s,n)=>{const i=this.key(e,s);this.updateHelperObject(i,n);const o=this.getSubGroup(e,`${t}: ${s}`),a=["x","y","z","w"];for(const e in a)o.addNumberInput(this.helperObject.quaternions[i],a[e],{label:a[e],onChange:()=>{this.settings[i].set(this.helperObject.quaternions[i].x,this.helperObject.quaternions[i].y,this.helperObject.quaternions[i].z,this.helperObject.quaternions[i].w);const e={};e[s]=this.settings[i],this.onChange(e)}})}}init(){}async loadGuiPackage(){return this.loadState===n.Init&&(s.e(9553).then(s.t.bind(s,73430,23)).then((async e=>{const t=this.queryScope.getElementById("control-kit-wrapper")||document.body,{default:i}=await s.e(9553).then(s.t.bind(s,2770,23));i.getNodeById=e=>(new i).setElement(this.queryScope.getElementById(e));const{default:o}=await s.e(9553).then(s.t.bind(s,21,23)),a=document.createElement("style");a.innerText=o.string,t.appendChild(a);const r=document.createElement("div");r.id="controlKitElement",t.appendChild(r);const c=e=>e.stopPropagation();r.addEventListener("keydown",c),r.addEventListener("keyup",c),r.addEventListener("keypress",c),r.addEventListener("mouseover",(e=>{for(let t=e.target;t;t=t.parentNode)if(t instanceof HTMLElement&&t.classList.contains("label")&&t.scrollWidth>t.clientWidth)return void(t.title=t.textContent||"")})),this.controlKit=new e.default({opacity:.9,enable:!1,parentDomElementId:"controlKitElement",useExternalStyle:!0}),this.controlKit.setShortcutEnable(""),this.controlKit.enable(),this.initPromise.resolve(),this.loadState=n.Loaded})),this.loadState=n.Loading),this.loadPromise}get loadPromise(){return this.initPromise.nativePromise()}get isLoaded(){return void 0!==this.controlKit}addPanel(e,t,s={}){for(void 0===s.width&&(s.width=250),void 0===s.allowSubGroups&&(s.allowSubGroups=!0),void 0===s.ratio&&(s.ratio=60),this.lastKeysBufferLength=Math.max(this.lastKeysBufferLength,t.length);this.lastKeysBufferLength>this.lastKeys.length;)this.lastKeys.unshift(-1);return this.panels.push({index:this.panels.length,header:e,guiPanel:null,makeGuiPanel:()=>this.controlKit.addPanel({label:e,align:"right",ratio:s.ratio,width:s.width}),subGroups:new Map,allowSubGroups:s.allowSubGroups,activationSequence:t.reverse()}),this.panels.length-1}isVisible(e){if(!this.controlKit)throw new Error(this.uninitError);return this.panels[e].guiPanel._enabled}toggle(e){this.controlKit?this.toggleVisibility(e):this.loadGuiPackage().then((()=>{this.toggleVisibility(e)}))}onToggle(e,t){this.onToggleCallbacks[e]||(this.onToggleCallbacks[e]=[]),this.onToggleCallbacks[e].push(t)}toggleVisibility(e){if(!this.controlKit)throw new Error(this.uninitError);const t=this.panels[e].guiPanel._enabled;if(t?this.panels[e].guiPanel.disable():this.panels[e].guiPanel.enable(),this.onToggleCallbacks[e])for(const s of this.onToggleCallbacks[e])s(!t)}dispose(){const e=this.queryScope.getElementById("controlKit");e&&e.remove(),this.controlKit=void 0}activate(e){this.queryScope.addEventListener("keydown",this.onKeyDown)}deactivate(e){this.controlKit&&this.controlKit.disable(),this.queryScope.removeEventListener("keydown",this.onKeyDown)}render(){this.controlKit&&this.updateRequired&&(this.updateRequired=!1,this.controlKit.update())}updateSetting(e,t,s){if(!this.controlKit)throw new Error(this.uninitError);const n=e+t,i=this.settings[n];s&&"function"==typeof s.equals&&"function"==typeof s.copy&&i&&"function"==typeof i.equals&&"function"==typeof i.copy?s.equals(this.settings[n])||(this.settings[n].copy(s),this.updateHelperObject(n,s),this.updateRequired=!0):s!==this.settings[n]&&(this.settings[n]=s,this.updateRequired=!0)}key(e,t){return`${e}${t}`}getSetting(e,t){const s=this.key(e,t);return this.settings[s]}isRegistered(e,t){return void 0!==this.getSetting(e,t)}addControl(e,t,s,n,i,o=2,a){if(!this.controlKit)throw new Error(this.uninitError);const r=this.key(e,s);this.settings[r]=n;let c=typeof n;("string"===c&&"true"===n||"false"===n)&&(c="boolean");const d="object"===c;if(d&&(null==n?void 0:n.isColor))this.addColor(this.getSubGroup(e,t),e,s,n);else if(d&&(null==n?void 0:n.isVector3))this.addVector3(e,t,s,n);else if(d&&(null==n?void 0:n.isQuaternion))this.addQuaternion(e,t,s,n);else{const d=this.getSubGroup(e,t);switch(c){case"string":Array.isArray(a)?(this.settings[r]={options:a,selected:n},d.addSelect(this.settings[r],"options",{target:"selected",label:s,onChange:e=>{const t={[s]:a[e]};this.onChange(t)}})):d.addStringInput(this.settings,r,{label:s,onChange:e=>{const t={};this.settings[r]=e,t[s]=this.settings[r],this.onChange(t)}});break;case"number":this.settings[`${r}_range`]=i||[0,10],d.addSlider(this.settings,r,`${r}_range`,{label:s,onChange:()=>{const e={};e[s]=this.settings[r],this.onChange(e)},dp:o});break;case"boolean":d.addCheckbox(this.settings,r,{label:s,ratio:10,onChange:()=>{const e={};e[s]=this.settings[r],this.onChange(e)}});break;default:d.addStringOutput(this.settings,r,{label:s})}}}addButton(e,t,s,n){if(!this.controlKit)throw new Error(this.uninitError);this.getSubGroup(e,t).addButton(s,n,{label:"none",ratio:100})}addSlider(e,t,s,n,i,o,a){if(!this.controlKit)throw new Error(this.uninitError);const r=this.getSubGroup(e,t),c=this.key(e,s);this.settings[c]=n,this.settings[c+"_range"]=[i,o],r.addSlider(this.settings,c,c+"_range",{label:s,dp:a,onChange:()=>{const e={};e[s]=this.settings[c],this.onChange(e)}})}updateHelperObject(e,t){const s="object"==typeof t;s&&(null==t?void 0:t.isColor)?this.helperObject.colors[e]="#"+t.getHexString():s&&(null==t?void 0:t.isVector3)?(this.helperObject.vectors[e]={},this.helperObject.vectors[e].x=t.x,this.helperObject.vectors[e].y=t.y,this.helperObject.vectors[e].z=t.z):s&&(null==t?void 0:t.isQuaternion)&&(this.helperObject.quaternions[e]={},this.helperObject.quaternions[e].x=t.x,this.helperObject.quaternions[e].y=t.y,this.helperObject.quaternions[e].z=t.z,this.helperObject.quaternions[e].w=t.w)}}class r{constructor(e,t,s){this.panel=e,this.group=t,this.subGroup=s}addButton(...e){this.invoke("addButton",e)}addSlider(...e){this.invoke("addSlider",e)}addSelect(...e){this.invoke("addSelect",e)}addCheckbox(...e){this.invoke("addCheckbox",e)}addColor(...e){this.invoke("addColor",e)}addStringInput(...e){this.invoke("addStringInput",e)}addStringOutput(...e){this.invoke("addStringOutput",e)}addNumberInput(...e){this.invoke("addNumberInput",e)}invoke(e,t){const s=this.panel._groups,n=this.group._subGroups,i=s.indexOf(this.group),o=n.indexOf(this.subGroup);s.splice(i,1),s.push(this.group),n.splice(o,1),n.push(this.subGroup);try{this.panel[e](...t)}finally{s.splice(i,0,s.pop()),n.splice(o,0,n.pop())}}}const c=function(e,t){const s=Math.min(e.length,t.length);for(let n=0;n<s;n++)if(e[n]!==t[n])return!1;return!0};var d=s(25316),l=s(26072);class h extends i.nV{constructor(){super(...arguments),this.name="settings",this.queuedControls=[],this.queuedButtons=[],this.secretWord=[38,38,40,40,37,39,37,39,66,65,72],this.panelID=-1,this.addPanel=(e,t,s)=>{const n=this.getPanelId(e);return-1===n?this.settingsGUI.addPanel(e,t,s):n},this.getPanelId=e=>this.settingsGUI.getPanelId(e)}async init(e,t){var s;this.engine=t,this.settings=new d.o(e.overrideParams),this.engine.market.register(d.o,this.settings),e.useGUI&&(this.settingsGUI=new a(null!==(s=e.queryScope)&&void 0!==s?s:document,(e=>{this.updateSettings(e)})),t.addComponent(this,this.settingsGUI),this.panelID=this.settingsGUI.addPanel("26.1.1_webgl-90-g894b4d3f55",this.secretWord)),e.initialSettings&&this.updateSettings(e.initialSettings),e.useGUI&&this.settingsGUI.loadPromise.then((()=>{for(const e of this.queuedControls)this.settingsGUI.addControl(e.panelId,e.group,e.settingName,e.value,e.range,e.rangePrecision,e.options);for(const e of this.queuedButtons)this.settingsGUI.addButton(e.panelId,e.group,e.buttonName,e.callback);this.settingsGUI.toggle(this.panelID)}))}get settingsData(){return this.settings}get loadPromise(){return this.settingsGUI.loadPromise}getSettingsGui(){return this.settingsGUI}getMainPanelId(){return this.panelID}updateSetting(e,t,s=this.panelID){t&&t.clone&&"function"==typeof t.clone?this.settings.setSetting(e,t.clone()):this.settings.setSetting(e,t),this.settingsGUI&&this.settingsGUI.isLoaded&&this.settingsGUI.updateSetting(s,e,t)}updateSettings(e){for(const t in e)this.updateSetting(t,e[t])}registerSetting(e,t,s,n=!0,i=l.u.NONE,a,r=this.panelID,c=2,d){if(this.settingsGUI&&this.settingsGUI.isRegistered(r,t))return void o.Vy.for(this).warn(`Duplicate setting ${t} registered. Is a module being used twice?`);let h;h=s&&s.clone&&"function"==typeof s.clone?s.clone():s,this.settingsGUI&&n&&(this.settingsGUI.isLoaded?this.settingsGUI.addControl(r,e,t,h,a,c,d):this.queuedControls.push({panelId:r,group:e,settingName:t,value:s,range:a,rangePrecision:c,options:d}));const u=i===l.u.LOCAL_STORAGE?(0,o.zM)(t,s):s;this.updateSetting(t,u)}registerMenuEntry(e){const{header:t,setting:s,initialValue:n,persist:i,displayInUi:a,range:r,panel:c,onChange:d,rangePrecision:l,options:h,urlParam:u}=e;let g=n();const p=encodeURIComponent(s);if(u){const e=(0,o.P3)(p,null);null!==e&&(g="true"===e||"false"!==e&&function(e){if(""===e)return e;const t=+e;return isNaN(t)?e:t}(e))}if(this.registerSetting(t,s,g,a,i,r,c,l,h),!d&&!u)return null;if(d&&d(g),u){const e=n(),t=t=>{const s=(0,o.DE)();s.has(p)&&t===e?s.delete(p):s.set(p,t),(0,o.SS)(s.toString(),!0),d&&d(t)};return this.settings.onSettingChanged(s,t)}return d?this.settings.onSettingChanged(s,d):null}registerMenuButton(e){const{header:t,buttonName:s,panel:n,callback:i}=e;this.registerButton(t,s,i,n)}registerButton(e,t,s,n=this.panelID){this.settingsGUI&&(this.settingsGUI.isLoaded?this.settingsGUI.addButton(n,e,t,s):this.queuedButtons.push({panelId:n,group:e,buttonName:t,callback:s}))}hasSetting(e){return this.settings.hasSetting(e)}getSetting(e){return this.settings.getSetting(e)}tryGetSetting(e,t){return this.settings.tryGetSetting(e,t)}toggleMenu(){this.settingsGUI&&this.settingsGUI.toggle(0)}disposeGui(){this.settingsGUI.dispose()}}},26072:(e,t,s)=>{var n;s.d(t,{u:()=>n}),function(e){e[e.NONE=0]="NONE",e[e.LOCAL_STORAGE=1]="LOCAL_STORAGE"}(n||(n={}))}}]);