(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[5385],{10055:(e,t,i)=>{var n={"./apartments-logo-white-r.svg":[84132,4132],"./homes-logo-white-r.svg":[34843,4843],"./loopnet-logo-white-r.svg":[85378,5378],"./matterport-logo-white-r.svg":[58249,8249]};function a(e){if(!i.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],a=t[0];return i.e(t[1]).then((()=>i.t(a,17)))}a.keys=()=>Object.keys(n),a.id=10055,e.exports=a},74945:function(e,t){var i="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=i.DOMException}return e.prototype=i,new e}();!function(e){!function(t){var i="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,a="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in e,s="ArrayBuffer"in e;if(s)var r=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(e){return e&&r.indexOf(Object.prototype.toString.call(e))>-1};function l(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function m(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,i){e.onload=function(){t(e.result)},e.onerror=function(){i(e.error)}}))}function v(e){var t=new FileReader,i=p(t);return t.readAsArrayBuffer(e),i}function f(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:a&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:i&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&a&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=f(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||d(e))?this._bodyArrayBuffer=f(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=m(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?m(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(v)}),this.text=function(){var e,t,i,n=m(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,i=p(t),t.readAsText(e),i;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),i=new Array(t.length),n=0;n<t.length;n++)i[n]=String.fromCharCode(t[n]);return i.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=l(e),t=c(t);var i=this.map[e];this.map[e]=i?i+", "+t:t},h.prototype.delete=function(e){delete this.map[l(e)]},h.prototype.get=function(e){return e=l(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(l(e))},h.prototype.set=function(e,t){this.map[l(e)]=c(t)},h.prototype.forEach=function(e,t){for(var i in this.map)this.map.hasOwnProperty(i)&&e.call(t,this.map[i],i,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,i){e.push(i)})),u(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),u(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,i){e.push([i,t])})),u(e)},n&&(h.prototype[Symbol.iterator]=h.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function w(e,t){var i,n,a=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,a||null==e._bodyInit||(a=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(i=t.method||this.method||"GET",n=i.toUpperCase(),y.indexOf(n)>-1?n:i),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&a)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(a)}function b(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var i=e.split("="),n=i.shift().replace(/\+/g," "),a=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(a))}})),t}function k(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},g.call(w.prototype),g.call(k.prototype),k.prototype.clone=function(){return new k(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},k.error=function(){var e=new k(null,{status:0,statusText:""});return e.type="error",e};var S=[301,302,303,307,308];k.redirect=function(e,t){if(-1===S.indexOf(t))throw new RangeError("Invalid status code");return new k(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var i=Error(e);this.stack=i.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function T(e,i){return new Promise((function(n,o){var s=new w(e,i);if(s.signal&&s.signal.aborted)return o(new t.DOMException("Aborted","AbortError"));var r=new XMLHttpRequest;function d(){r.abort()}r.onload=function(){var e,t,i={status:r.status,statusText:r.statusText,headers:(e=r.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var i=e.split(":"),n=i.shift().trim();if(n){var a=i.join(":").trim();t.append(n,a)}})),t)};i.url="responseURL"in r?r.responseURL:i.headers.get("X-Request-URL");var a="response"in r?r.response:r.responseText;n(new k(a,i))},r.onerror=function(){o(new TypeError("Network request failed"))},r.ontimeout=function(){o(new TypeError("Network request failed"))},r.onabort=function(){o(new t.DOMException("Aborted","AbortError"))},r.open(s.method,s.url,!0),"include"===s.credentials?r.withCredentials=!0:"omit"===s.credentials&&(r.withCredentials=!1),"responseType"in r&&a&&(r.responseType="blob"),s.headers.forEach((function(e,t){r.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",d),r.onreadystatechange=function(){4===r.readyState&&s.signal.removeEventListener("abort",d)}),r.send(void 0===s._bodyInit?null:s._bodyInit)}))}T.polyfill=!0,e.fetch||(e.fetch=T,e.Headers=h,e.Request=w,e.Response=k),t.Headers=h,t.Request=w,t.Response=k,t.fetch=T,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var a=n;(t=a.fetch).default=a.fetch,t.fetch=a.fetch,t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response,e.exports=t},33012:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetCompositeViews"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CompositeViewsFragment"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetCompositeView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"compositeViewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"view"},name:{kind:"Name",value:"compositeView"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"compositeViewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CompositeViewFragment"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UpdateCompositeViewMode"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mode"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CompositeViewMode"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"view"},name:{kind:"Name",value:"compositeView"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateMode"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mode"},value:{kind:"Variable",name:{kind:"Name",value:"mode"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CompositeViewFragment"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddCompositeView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"name"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mode"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CompositeViewMode"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"view"},name:{kind:"Name",value:"addCompositeView"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"name"},value:{kind:"Variable",name:{kind:"Name",value:"name"}}},{kind:"Argument",name:{kind:"Name",value:"mode"},value:{kind:"Variable",name:{kind:"Name",value:"mode"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddConnection"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"compositeViewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sourceModelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"IModelPosition"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sequence"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locked"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visible"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"view"},name:{kind:"Name",value:"compositeView"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"compositeViewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"connection"},name:{kind:"Name",value:"addConnection"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"sourceModelId"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}},{kind:"Argument",name:{kind:"Name",value:"sequence"},value:{kind:"Variable",name:{kind:"Name",value:"sequence"}}},{kind:"Argument",name:{kind:"Name",value:"locked"},value:{kind:"Variable",name:{kind:"Name",value:"locked"}}},{kind:"Argument",name:{kind:"Name",value:"visible"},value:{kind:"Variable",name:{kind:"Name",value:"visible"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchConnection"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"compositeViewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sourceModelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"IModelPosition"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sequence"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locked"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visible"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"view"},name:{kind:"Name",value:"compositeView"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"compositeViewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"connection"},name:{kind:"Name",value:"patchConnection"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"sourceModelId"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}},{kind:"Argument",name:{kind:"Name",value:"sequence"},value:{kind:"Variable",name:{kind:"Name",value:"sequence"}}},{kind:"Argument",name:{kind:"Name",value:"locked"},value:{kind:"Variable",name:{kind:"Name",value:"locked"}}},{kind:"Argument",name:{kind:"Name",value:"visible"},value:{kind:"Variable",name:{kind:"Name",value:"visible"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelConnectionFragment"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteConnection"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"compositeViewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sourceModelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"view"},name:{kind:"Name",value:"compositeView"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"compositeViewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"deleted"},name:{kind:"Name",value:"deleteConnection"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"sourceModelId"}}}],directives:[]}]}}]}}],loc:{start:0,end:1821}};n.loc.source={body:'#import "./model-fragments.gql"\n#import "./model-options-fragments.gql"\n#import "./photo-fragments.gql"\n#import "./overlay-fragments.gql"\n#import "./compositeModelFragments.gql"\n\nquery GetCompositeViews($modelId: ID!) {\n  model(id: $modelId) {\n    ...CompositeViewsFragment\n  }\n}\n\nquery GetCompositeView($compositeViewId: ID!) {\n  view: compositeView(id: $compositeViewId) {\n    ... CompositeViewFragment\n  }\n}\n\nmutation UpdateCompositeViewMode(\n    $viewId: ID!\n    $mode: CompositeViewMode!\n) {\n    view: compositeView(id: $viewId) {\n        updateMode(mode: $mode) {\n            ... CompositeViewFragment\n        }\n    }\n}\n\nmutation AddCompositeView($modelId: ID!, $name: String, $mode: CompositeViewMode!) {\n  view: addCompositeView(id: $modelId, name: $name, mode: $mode) {\n    id\n  }\n}\n\nmutation AddConnection(\n  $compositeViewId: ID!,\n  $sourceModelId: ID!,\n  $position: IModelPosition!,\n  $sequence: Int,\n  $locked: Boolean,\n  $visible: Boolean\n) {\n  view: compositeView(id: $compositeViewId) {\n    connection: addConnection(\n      modelId: $sourceModelId\n      position: $position\n      sequence: $sequence\n      locked: $locked\n      visible: $visible\n    ) {\n      id\n    }\n  }\n}\n\nmutation PatchConnection(\n  $compositeViewId: ID!,\n  $sourceModelId: ID!,\n  $position: IModelPosition!,\n  $sequence: Int,\n  $locked: Boolean,\n  $visible: Boolean\n) {\n  view: compositeView(id: $compositeViewId) {\n    connection: patchConnection(\n      modelId: $sourceModelId\n      position: $position\n      sequence: $sequence\n      locked: $locked\n      visible: $visible\n    ) {\n      ... ModelConnectionFragment\n    }\n  }\n}\n\nmutation DeleteConnection(\n  $compositeViewId: ID!,\n  $sourceModelId: ID!,\n) {\n  view: compositeView(id: $compositeViewId) {\n    deleted: deleteConnection(\n        modelId: $sourceModelId\n    )\n  }\n}\n\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};function o(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!a[t]&&(a[t]=!0,!0)}))}function s(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){s(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){s(e,t)})),e.definitions&&e.definitions.forEach((function(e){s(e,t)}))}n.definitions=n.definitions.concat(o(i(14991).definitions)),n.definitions=n.definitions.concat(o(i(82038).definitions)),n.definitions=n.definitions.concat(o(i(10600).definitions)),n.definitions=n.definitions.concat(o(i(25e3).definitions)),n.definitions=n.definitions.concat(o(i(40343).definitions));var r={};function d(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function l(e,t){var i={kind:e.kind,definitions:[d(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=r[t]||new Set,a=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var s=o;o=new Set,s.forEach((function(e){a.has(e)||(a.add(e),(r[e]||new Set).forEach((function(e){o.add(e)})))}))}return a.forEach((function(t){var n=d(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;s(e,t),r[e.name.value]=t}})),e.exports=n,e.exports.GetCompositeViews=l(n,"GetCompositeViews"),e.exports.GetCompositeView=l(n,"GetCompositeView"),e.exports.UpdateCompositeViewMode=l(n,"UpdateCompositeViewMode"),e.exports.AddCompositeView=l(n,"AddCompositeView"),e.exports.AddConnection=l(n,"AddConnection"),e.exports.PatchConnection=l(n,"PatchConnection"),e.exports.DeleteConnection=l(n,"DeleteConnection")},7:e=>{var t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ViewLayerDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelViewLayer"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layer"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visible"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"LayerDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelLayer"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]}]}}],loc:{start:0,end:191}};t.loc.source={body:"fragment ViewLayerDetails on ModelViewLayer {\n  layer {\n    ...LayerDetails\n  }\n  position\n  visible\n}\n\nfragment LayerDetails on ModelLayer {\n  id\n  created\n  modified\n  type\n  name\n  label\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,s=new Set,r=new Set;for(o.forEach((function(e){r.add(e)}));r.size>0;){var d=r;r=new Set,d.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.ViewLayerDetails=o(t,"ViewLayerDetails"),e.exports.LayerDetails=o(t,"LayerDetails")},92646:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetLayers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"layers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ViewLayerDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetAllLayers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"types"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},defaultValue:{kind:"ListValue",values:[]},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeUnassociated"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"layers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"Variable",name:{kind:"Name",value:"types"}}},{kind:"Argument",name:{kind:"Name",value:"includeUnassociated"},value:{kind:"Variable",name:{kind:"Name",value:"includeUnassociated"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"views"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ViewLayerDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CopyInput"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"generateIds"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"layer"},name:{kind:"Name",value:"addLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}},{kind:"Argument",name:{kind:"Name",value:"copyDataFrom"},value:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}}},{kind:"Argument",name:{kind:"Name",value:"generateIds"},value:{kind:"Variable",name:{kind:"Name",value:"generateIds"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddCommonLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"layer"},name:{kind:"Name",value:"addCommonLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}},{kind:"Argument",name:{kind:"Name",value:"viewTypes"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"matterport.model.default",block:!1},{kind:"StringValue",value:"matterport.model.layered",block:!1},{kind:"StringValue",value:"matterport.user.view",block:!1},{kind:"StringValue",value:"matterport.model.defurnished",block:!1}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchLayerViews"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"views"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ViewLayerPatch"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchLayerViews"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}},{kind:"Argument",name:{kind:"Name",value:"views"},value:{kind:"Variable",name:{kind:"Name",value:"views"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerLabel"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visible"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"layerLabel"}}},{kind:"Argument",name:{kind:"Name",value:"visible"},value:{kind:"Variable",name:{kind:"Name",value:"visible"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ConvertToCommonLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visible"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"position"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convertToCommonLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}},{kind:"Argument",name:{kind:"Name",value:"visible"},value:{kind:"Variable",name:{kind:"Name",value:"visible"}}},{kind:"Argument",name:{kind:"Name",value:"position"},value:{kind:"Variable",name:{kind:"Name",value:"position"}}},{kind:"Argument",name:{kind:"Name",value:"viewTypes"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"matterport.model.default",block:!1},{kind:"StringValue",value:"matterport.model.layered",block:!1},{kind:"StringValue",value:"matterport.user.view",block:!1},{kind:"StringValue",value:"matterport.model.defurnished",block:!1}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ConvertToDedicatedLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convertToDedicatedLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RemoveLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deleteIfOrphaned"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}},{kind:"Argument",name:{kind:"Name",value:"deleteIfOrphaned"},value:{kind:"Variable",name:{kind:"Name",value:"deleteIfOrphaned"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DuplicateLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"visible"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CopyInput"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"translation"}},type:{kind:"NamedType",name:{kind:"Name",value:"IPoint3D"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"rotation"}},type:{kind:"NamedType",name:{kind:"Name",value:"IQuaternion"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"layer"},name:{kind:"Name",value:"addLayer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"visible"},value:{kind:"Variable",name:{kind:"Name",value:"visible"}}},{kind:"Argument",name:{kind:"Name",value:"copyDataFrom"},value:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}}},{kind:"Argument",name:{kind:"Name",value:"generateIds"},value:{kind:"BooleanValue",value:!0}},{kind:"Argument",name:{kind:"Name",value:"translation"},value:{kind:"Variable",name:{kind:"Name",value:"translation"}}},{kind:"Argument",name:{kind:"Name",value:"rotation"},value:{kind:"Variable",name:{kind:"Name",value:"rotation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LayerDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CopyViewDataToLayer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"layerId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CopyInput"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"translation"}},type:{kind:"NamedType",name:{kind:"Name",value:"IPoint3D"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"rotation"}},type:{kind:"NamedType",name:{kind:"Name",value:"IQuaternion"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"copyViewData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}},{kind:"Argument",name:{kind:"Name",value:"layerId"},value:{kind:"Variable",name:{kind:"Name",value:"layerId"}}},{kind:"Argument",name:{kind:"Name",value:"copyDataFrom"},value:{kind:"Variable",name:{kind:"Name",value:"copyDataFrom"}}},{kind:"Argument",name:{kind:"Name",value:"generateIds"},value:{kind:"BooleanValue",value:!0}},{kind:"Argument",name:{kind:"Name",value:"translation"},value:{kind:"Variable",name:{kind:"Name",value:"translation"}}},{kind:"Argument",name:{kind:"Name",value:"rotation"},value:{kind:"Variable",name:{kind:"Name",value:"rotation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ConvertToProxiedLayering"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convertModelRoomDataToProxiedLayering"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[]}]}}],loc:{start:0,end:3181}};n.loc.source={body:'#import "./layer-fragments.gql"\n\nquery GetLayers($viewId: ID!) {\n  view(id: $viewId) {\n    id\n    layers {\n      ...ViewLayerDetails\n    }\n  }\n}\n\nquery GetAllLayers($modelId: ID!, $types: [String!] = [], $includeUnassociated: Boolean = false) {\n  model(id: $modelId) {\n    id\n    layers(types: $types, includeUnassociated: $includeUnassociated) {\n      id\n      type\n      views {\n        ...ViewLayerDetails\n      }\n    }\n  }\n}\n\nmutation AddLayer($viewId: ID!, $label: String, $position: Int, $copyDataFrom: [CopyInput!], $generateIds: Boolean) {\n  layer: addLayer(id: $viewId, label: $label, position: $position, copyDataFrom: $copyDataFrom, generateIds: $generateIds) {\n    ...LayerDetails\n  }\n}\n\nmutation AddCommonLayer($viewId: ID!, $label: String, $position: Int) {\n  layer: addCommonLayer(\n    id: $viewId,\n    label: $label,\n    position: $position,\n    viewTypes: [\n      "matterport.model.default",\n      "matterport.model.layered",\n      "matterport.user.view",\n      "matterport.model.defurnished",\n    ],\n  ) {\n    ...LayerDetails\n  }\n}\n\n# Used for patching a layer across views\nmutation PatchLayerViews($viewId: ID!, $layerId: ID!, $views: [ViewLayerPatch!]) {\n  patchLayerViews(id: $viewId, layerId: $layerId, views: $views) {\n    ...LayerDetails\n  }\n}\n\nmutation PatchLayer($viewId: ID!, $layerId: ID!, $layerLabel: String, $visible: Boolean, $position: Int) {\n  patchLayer(id: $viewId, layerId: $layerId, label: $layerLabel, visible: $visible, position: $position) {\n    ...LayerDetails\n  }\n}\n\nmutation ConvertToCommonLayer($viewId: ID!, $layerId: ID!, $visible: Boolean, $position: Int) {\n  convertToCommonLayer(\n    id: $viewId,\n    layerId: $layerId,\n    visible: $visible,\n    position: $position,\n    viewTypes: [\n      "matterport.model.default",\n      "matterport.model.layered",\n      "matterport.user.view",\n      "matterport.model.defurnished",\n    ],\n  ) {\n    ...LayerDetails\n  }\n}\n\nmutation ConvertToDedicatedLayer($viewId: ID!, $layerId: ID!) {\n  convertToDedicatedLayer(\n    id: $viewId,\n    layerId: $layerId,\n  ) {\n    ...LayerDetails\n  }\n}\n\nmutation RemoveLayer($viewId: ID!, $layerId: ID!, $deleteIfOrphaned: Boolean = false) {\n  removeLayer(id: $viewId, layerId: $layerId, deleteIfOrphaned: $deleteIfOrphaned)\n}\n\nmutation DeleteLayer($viewId: ID!, $layerId: ID!) {\n  deleteLayer(id:$viewId, layerId: $layerId)\n}\n\nmutation DuplicateLayer($viewId: ID!, $label: String!, $visible: Boolean, $copyDataFrom: [CopyInput!], $translation: IPoint3D, $rotation: IQuaternion) {\n  layer: addLayer(\n    id: $viewId\n    label: $label\n    visible: $visible\n    copyDataFrom: $copyDataFrom\n    generateIds: true,\n    translation: $translation,\n    rotation: $rotation,\n  ) {\n    ...LayerDetails\n  }\n}\n\n# This returns a view id\nmutation CopyViewDataToLayer($viewId: ID!, $layerId: ID, $copyDataFrom: [CopyInput!], $translation: IPoint3D, $rotation: IQuaternion) {\n  copyViewData(\n    id: $viewId\n    layerId: $layerId\n    copyDataFrom: $copyDataFrom\n    generateIds: true\n    translation: $translation,\n    rotation: $rotation,\n  ) {\n    id\n  }\n}\n\nmutation ConvertToProxiedLayering($modelId: ID!) {\n  convertModelRoomDataToProxiedLayering(\n    id: $modelId\n  )\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(i(7).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!a[t]&&(a[t]=!0,!0)})));var s={};function r(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function d(e,t){var i={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=s[t]||new Set,a=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var d=o;o=new Set,d.forEach((function(e){a.has(e)||(a.add(e),(s[e]||new Set).forEach((function(e){o.add(e)})))}))}return a.forEach((function(t){var n=r(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),s[e.name.value]=t}})),e.exports=n,e.exports.GetLayers=d(n,"GetLayers"),e.exports.GetAllLayers=d(n,"GetAllLayers"),e.exports.AddLayer=d(n,"AddLayer"),e.exports.AddCommonLayer=d(n,"AddCommonLayer"),e.exports.PatchLayerViews=d(n,"PatchLayerViews"),e.exports.PatchLayer=d(n,"PatchLayer"),e.exports.ConvertToCommonLayer=d(n,"ConvertToCommonLayer"),e.exports.ConvertToDedicatedLayer=d(n,"ConvertToDedicatedLayer"),e.exports.RemoveLayer=d(n,"RemoveLayer"),e.exports.DeleteLayer=d(n,"DeleteLayer"),e.exports.DuplicateLayer=d(n,"DuplicateLayer"),e.exports.CopyViewDataToLayer=d(n,"CopyViewDataToLayer"),e.exports.ConvertToProxiedLayering=d(n,"ConvertToProxiedLayering")},58619:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshots"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rootModelId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"Field",alias:{kind:"Name",value:"defurnishedViews"},name:{kind:"Name",value:"views"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"StringValue",value:"matterport.model.defurnished",block:!1}}],directives:[{kind:"Directive",name:{kind:"Name",value:"onError"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"StringValue",value:"not.found",block:!1}},{kind:"Argument",name:{kind:"Name",value:"null"},value:{kind:"BooleanValue",value:!0}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshotsForView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},defaultValue:{kind:"NullValue"},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"Variable",name:{kind:"Name",value:"viewType"}}},{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchPhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchPhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeletePhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletePhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadHighlightReelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadHighlightReelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PhotoType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadModelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}},{kind:"Argument",name:{kind:"Name",value:"photoType"},value:{kind:"Variable",name:{kind:"Name",value:"photoType"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}],loc:{start:0,end:1684}};n.loc.source={body:'#import "./photo-fragments.gql"\n\n# Get photo snapshot details.\n# This query is run as anonymous in Showcase, so it must only contain public fields.\nquery GetSnapshots($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    rootModelId\n    assets {\n      photos { ...PhotoDetails }\n    }\n    defurnishedViews: views(types: "matterport.model.defurnished") @onError(id: "not.found", null: true) {\n      model {\n        id\n        assets {\n          photos {\n            ...PhotoDetails\n          }\n        }\n      }\n    }\n  }\n}\n\nquery GetSnapshotsForView($modelId: ID!, $viewType: ID!, $viewId: ID = null) {\n  model(id: $modelId) {\n    id\n    view(type: $viewType, id: $viewId) {\n      model {\n        assets {\n          photos {\n            ...PhotoDetails\n          }\n        }\n      }\n    }\n  }\n}\n\nmutation PatchPhoto($modelId: ID!, $photoId: ID!, $label: String!) {\n  patchPhoto(modelId: $modelId, photoId: $photoId, label: $label) {\n    ...PhotoDetails\n  }\n}\n\nmutation DeletePhoto($modelId: ID!, $photoId: ID!) {\n  deletePhoto(modelId: $modelId, photoId: $photoId)\n}\n\nmutation UploadHighlightReelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!) {\n  snapshot: uploadHighlightReelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation) {\n    ...PhotoDetails\n  }\n}\n\nmutation UploadModelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!, $photoType: PhotoType!) {\n  snapshot: uploadModelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation, photoType: $photoType) {\n    ...PhotoDetails\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(i(10600).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!a[t]&&(a[t]=!0,!0)})));var s={};function r(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function d(e,t){var i={kind:e.kind,definitions:[r(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=s[t]||new Set,a=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var d=o;o=new Set,d.forEach((function(e){a.has(e)||(a.add(e),(s[e]||new Set).forEach((function(e){o.add(e)})))}))}return a.forEach((function(t){var n=r(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),s[e.name.value]=t}})),e.exports=n,e.exports.GetSnapshots=d(n,"GetSnapshots"),e.exports.GetSnapshotsForView=d(n,"GetSnapshotsForView"),e.exports.PatchPhoto=d(n,"PatchPhoto"),e.exports.DeletePhoto=d(n,"DeletePhoto"),e.exports.UploadHighlightReelSnapshot=d(n,"UploadHighlightReelSnapshot"),e.exports.UploadModelSnapshot=d(n,"UploadModelSnapshot")},9026:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelViewPrefetch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeLayers"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewLookup"}},type:{kind:"NamedType",name:{kind:"Name",value:"ViewLookupMode"}},defaultValue:{kind:"EnumValue",value:"self"},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"view"},value:{kind:"Variable",name:{kind:"Name",value:"viewLookup"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MattertagDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"orderedLists"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"ListValue",values:[]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"OrderedListDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeasurementDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"activeHighlightReel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"HighlightReelDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layers"},arguments:[],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeLayers"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ViewLayerDetails"},directives:[]}]}}]}}]}}],loc:{start:0,end:1052}};n.loc.source={body:'# Prefetch all data that changes for a view in one go.  Allows us to do an atomic view change and know that the data\n# is good.\n\n#import "./layer-fragments.gql"\n#import "./mattertags.gql"\n#import "./lists.gql"\n#import "./labels.gql"\n#import "./measurements.gql"\n#import "./notes.gql"\n#import "./highlights.gql"\n#import "./photo-fragments.gql"\n\nquery GetModelViewPrefetch($modelId: ID!, $includeDisabled: Boolean!, $includeLayers: Boolean!, $viewLookup: ViewLookupMode = self) {\n  model(id: $modelId, view: $viewLookup) {\n    id\n    mattertags(includeDisabled: $includeDisabled) {\n      ...MattertagDetails\n    }\n    orderedLists(ids: []) {\n      ...OrderedListDetails\n    }\n    labels(includeDisabled: $includeDisabled) {\n      ...LabelDetails\n    }\n    measurementPaths(includeDisabled: $includeDisabled) {\n      ...MeasurementDetails\n    }\n    activeHighlightReel {\n      ...HighlightReelDetails\n    }\n    image {\n      ...PhotoDetails\n    }\n  }\n  view (id: $modelId) {\n    layers @include(if: $includeLayers) {\n      ...ViewLayerDetails\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};function o(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!a[t]&&(a[t]=!0,!0)}))}function s(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){s(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){s(e,t)})),e.definitions&&e.definitions.forEach((function(e){s(e,t)}))}n.definitions=n.definitions.concat(o(i(7).definitions)),n.definitions=n.definitions.concat(o(i(27140).definitions)),n.definitions=n.definitions.concat(o(i(92711).definitions)),n.definitions=n.definitions.concat(o(i(96069).definitions)),n.definitions=n.definitions.concat(o(i(64639).definitions)),n.definitions=n.definitions.concat(o(i(44919).definitions)),n.definitions=n.definitions.concat(o(i(93327).definitions)),n.definitions=n.definitions.concat(o(i(10600).definitions));var r={};function d(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}n.definitions.forEach((function(e){if(e.name){var t=new Set;s(e,t),r[e.name.value]=t}})),e.exports=n,e.exports.GetModelViewPrefetch=function(e,t){var i={kind:e.kind,definitions:[d(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=r[t]||new Set,a=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var s=o;o=new Set,s.forEach((function(e){a.has(e)||(a.add(e),(r[e]||new Set).forEach((function(e){o.add(e)})))}))}return a.forEach((function(t){var n=d(e,t);n&&i.definitions.push(n)})),i}(n,"GetModelViewPrefetch")},89383:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sweepTags"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"sweepIds"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},defaultValue:{kind:"NullValue"},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"OverlayLayerExists"},directives:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"OverlayViewIds"},directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"tags"},value:{kind:"Variable",name:{kind:"Name",value:"sweepTags"}}},{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"sweepIds"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}}],loc:{start:0,end:326}};n.loc.source={body:'#import "./overlay-fragments.gql"\n#import "./sweeps-fragments.gql"\n\nquery GetSweeps($modelId: ID!, $sweepTags: [String!], $sweepIds: [String!] = null) {\n  model(id: $modelId) {\n    id,\n    ...OverlayLayerExists\n    ...OverlayViewIds\n    locations(tags: $sweepTags, ids: $sweepIds) {\n      ...AnchorLocationDetails\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var a={};function o(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!a[t]&&(a[t]=!0,!0)}))}function s(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){s(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){s(e,t)})),e.definitions&&e.definitions.forEach((function(e){s(e,t)}))}n.definitions=n.definitions.concat(o(i(25e3).definitions)),n.definitions=n.definitions.concat(o(i(77583).definitions));var r={};function d(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}n.definitions.forEach((function(e){if(e.name){var t=new Set;s(e,t),r[e.name.value]=t}})),e.exports=n,e.exports.GetSweeps=function(e,t){var i={kind:e.kind,definitions:[d(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=r[t]||new Set,a=new Set,o=new Set;for(n.forEach((function(e){o.add(e)}));o.size>0;){var s=o;o=new Set,s.forEach((function(e){a.has(e)||(a.add(e),(r[e]||new Set).forEach((function(e){o.add(e)})))}))}return a.forEach((function(t){var n=d(e,t);n&&i.definitions.push(n)})),i}(n,"GetSweeps")},46240:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetCurrentUserModelAccess"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"demo"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"ListValue",values:[{kind:"Variable",name:{kind:"Name",value:"userId"}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"search"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emails"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"search"},value:{kind:"Variable",name:{kind:"Name",value:"search"}}},{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}},{kind:"Argument",name:{kind:"Name",value:"emails"},value:{kind:"Variable",name:{kind:"Name",value:"emails"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddOrUpdateModelShareAccess"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"email"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"roleId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"message"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addOrUpdateModelShareAccess"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"email"},value:{kind:"Variable",name:{kind:"Name",value:"email"}}},{kind:"Argument",name:{kind:"Name",value:"roleId"},value:{kind:"Variable",name:{kind:"Name",value:"roleId"}}},{kind:"Argument",name:{kind:"Name",value:"invitationMessage"},value:{kind:"Variable",name:{kind:"Name",value:"message"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"modelShareAccessLevel"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetAssignableRoles"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"assignableRoles"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:1128}};t.loc.source={body:"# get access for the current user\nquery GetCurrentUserModelAccess($modelId: ID!, $userId: ID!) {\n  model(id: $modelId) {\n    id\n    organization\n    demo\n    created\n    users(ids: [$userId]) {\n      results {\n        modelAccess\n      }\n    }\n  }\n}\n\n# get users with access to the specified model\nquery GetUsers($modelId: ID!, $search: String, $ids: [ID!], $emails: [String!]) {\n  model(id: $modelId) {\n    users(search: $search, ids: $ids, emails: $emails) {\n      results {\n        id\n        email\n        firstName\n        lastName\n        modelAccess\n      }\n    }\n  }\n}\n\n# Add model share access by email\nmutation AddOrUpdateModelShareAccess($modelId:ID!, $email:String!, $roleId:ID!, $message:String) {\n  addOrUpdateModelShareAccess(\n    modelId:$modelId\n    email:$email\n    roleId:$roleId\n    invitationMessage:$message\n  ) {\n    user {\n      id\n      email\n      firstName\n      lastName\n    }\n    modelShareAccessLevel {\n      id\n      name\n    }\n  }\n}\n\n# Get roles that can be assigned to a model\nquery GetAssignableRoles($modelId:ID!) {\n  model(id:$modelId) {\n    assignableRoles {\n      id\n      name\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function o(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var o=n[t]||new Set,s=new Set,r=new Set;for(o.forEach((function(e){r.add(e)}));r.size>0;){var d=r;r=new Set,d.forEach((function(e){s.has(e)||(s.add(e),(n[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetCurrentUserModelAccess=o(t,"GetCurrentUserModelAccess"),e.exports.GetUsers=o(t,"GetUsers"),e.exports.AddOrUpdateModelShareAccess=o(t,"AddOrUpdateModelShareAccess"),e.exports.GetAssignableRoles=o(t,"GetAssignableRoles")},32994:e=>{function t(e,t){this._elements=new Array(e||50),this._first=0,this._last=0,this._size=0,this._evictedCb=t}e.exports=t,t.prototype.capacity=function(){return this._elements.length},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.isFull=function(){return this.size()===this.capacity()},t.prototype.peek=function(){if(this.isEmpty())throw new Error("RingBuffer is empty");return this._elements[this._first]},t.prototype.peekN=function(e){if(e>this._size)throw new Error("Not enough elements in RingBuffer");var t=Math.min(this._first+e,this.capacity()),i=this._elements.slice(this._first,t);if(t<this.capacity())return i;var n=this._elements.slice(0,e-i.length);return i.concat(n)},t.prototype.deq=function(){var e=this.peek();return this._size--,this._first=(this._first+1)%this.capacity(),e},t.prototype.deqN=function(e){var t=this.peekN(e);return this._size-=e,this._first=(this._first+e)%this.capacity(),t},t.prototype.enq=function(e){this._end=(this._first+this.size())%this.capacity();var t=this.isFull();return t&&this._evictedCb&&this._evictedCb(this._elements[this._end]),this._elements[this._end]=e,t?this._first=(this._first+1)%this.capacity():this._size++,this.size()},t.prototype.size=function(){return this._size}},77873:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Ie});var n,a=i(74848),o=i(8660);!function(e){e.DEFAULT="https://support.matterport.com/",e.MODEL_ARCHIVED="https://support.matterport.com/s/article/What-is-an-Active-or-Archived-Space",e.MODEL_COMPLIANCE="https://support.matterport.com/s/article/Matterport-IP-restrictions",e.MODEL_FAILED="https://support.matterport.com/s/article/Why-did-my-model-fail-in-processing",e.MODEL_NOT_AVAILABLE="https://support.matterport.com/s/article/Oops-Model-Not-Available",e.MODEL_PENDING="https://support.matterport.com/s/article/How-to-Upload-Your-Model?parentCategoryLabel=#pending",e.MODEL_PROCESSING="https://support.matterport.com/s/article/How-long-does-a-model-take-to-process",e.MODEL_DELETED="https://support.matterport.com/s/article/Restoring-a-Deleted-Space",e.SYSTEM_REQUIREMENTS="https://support.matterport.com/s/article/Workshop-System-Requirements"}(n||(n={}));const s=i.p+"images/logo-white-r.svg";var r=i(71224),d=i(56147),l=i(96540);const c={errorCode:r.b.GENERIC,t:e=>e},u=(0,l.createContext)(c);var h=i(32485),m=i.n(h),p=i(79138),v=i(62607),f=i(33697),g=i(35863);const y="error-cffd64ab56c5e566d681",w="error__content-ee53096b5ddb248c68f3",b="error__title-d38293f14c11891e9972",k="error__icon-dccb7fca8dd30844e1c0",S="error--with-icon-bdc9af4a206f6eb22f28",T={delay:p,"process-data":v,twinmaker:f,"compliance-training":g};function I({brandIcon:e,children:t,title:i}){return(0,a.jsxs)("div",{"data-testid":"error_message",className:m()(y,{[S]:!!e}),children:[e&&(0,a.jsx)("img",{src:T[e],alt:e.replace("-"," "),className:k,width:"160",height:"160"}),(0,a.jsxs)("div",{className:w,children:[(0,a.jsx)("header",{children:(0,a.jsx)("h1",{"data-testid":"error_title",className:b,children:i})}),t]})]})}const D=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsx)(I,{title:e(d.A.OOPS.MODEL_ARCHIVED_TITLE),brandIcon:"twinmaker",children:(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_ARCHIVED_HELPTEXT,{url:n.MODEL_ARCHIVED})}})})},N=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsx)(I,{title:e(d.A.OOPS.MODEL_COMPLIANCE_TITLE),brandIcon:"compliance-training",children:(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_COMPLIANCE_HELPTEXT,{url:n.MODEL_COMPLIANCE})}})})},E=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsx)(I,{title:e(d.A.OOPS.MODEL_DELETED_TITLE),children:(0,a.jsxs)("p",{"data-testid":"error_helptext",children:[(0,a.jsx)("a",{href:n.MODEL_DELETED,target:"_blank",children:e(d.A.LEARN_MORE)}),"."]})})},P=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsx)(I,{title:e(d.A.OOPS.MODEL_FAILED_TITLE),children:(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_FAILED_HELPTEXT,{url:n.MODEL_FAILED})}})})},_=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsx)(I,{title:e(d.A.OOPS.MODEL_PENDING_TITLE),brandIcon:"delay",children:(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_PENDING_HELPTEXT,{url:n.MODEL_PENDING})}})})},C=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsx)(I,{title:e(d.A.OOPS.MODEL_PROCESSING_TITLE),brandIcon:"process-data",children:(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.MODEL_PROCESSING_HELPTEXT,{url:n.MODEL_PROCESSING})}})})},A=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsx)(I,{title:e(d.A.OOPS.WEBGL_CONTEXT_LOST_TITLE),children:(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.WEBGL_CONTEXT_LOST_HELPTEXT,{url:n.DEFAULT})}})})};var x=i(97800);const V=i.p+"images/chrome.png",M=i.p+"images/edge.png",O=i.p+"images/firefox.png",L=i.p+"images/safari.png",R="browser-list-c03119e606ee50c9ffdf",F="browser-list__icon-cded388232d11ca64aab",B=()=>(0,a.jsxs)("ul",{className:R,"data-testid":"browser_list",children:[(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"https://www.google.com/chrome/browser/",target:"_blank",children:(0,a.jsx)("div",{className:"tile",children:(0,a.jsx)("img",{src:V,alt:"Chrome",width:"35",height:"35",className:F})})})}),(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"https://www.mozilla.org/en-US/firefox/new/",target:"_blank",children:(0,a.jsx)("div",{className:"tile",children:(0,a.jsx)("img",{src:O,alt:"Firefox",width:"35",height:"35",className:F})})})}),(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"https://www.microsoft.com/en-us/edge",target:"_blank",children:(0,a.jsx)("div",{className:"tile",children:(0,a.jsx)("img",{src:M,alt:"Edge",width:"35",height:"35",className:F})})})}),(0,x.cX)()&&(0,a.jsx)("li",{children:(0,a.jsx)("a",{href:"https://support.apple.com/en-us/HT204416",target:"_blank",children:(0,a.jsx)("div",{className:"tile",children:(0,a.jsx)("img",{src:L,alt:"Safari",width:"35",height:"35",className:F})})})})]}),U=()=>{const{t:e}=(0,l.useContext)(u),t=!(0,x.Fr)(),i=e(d.A.OOPS.WEBGL_GENERIC_HELPTEXT,{url:n.DEFAULT});return(0,a.jsxs)(I,{title:e(d.A.OOPS.WEBGL_GENERIC_TITLE),children:[(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:i}}),t&&(0,a.jsx)(B,{})]})},$=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsxs)(I,{title:e(d.A.OOPS.WEBGL_UNSUPPORTED_TITLE),children:[(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.WEBGL_UNSUPPORTED_HELPTEXT,{url:n.SYSTEM_REQUIREMENTS})}}),(0,a.jsx)(B,{})]})},j=()=>{const{t:e}=(0,l.useContext)(u);return(0,a.jsx)(I,{title:e(d.A.OOPS.GENERIC_TITLE),children:(0,a.jsx)("p",{"data-testid":"error_helptext",dangerouslySetInnerHTML:{__html:e(d.A.OOPS.GENERIC_HELPTEXT,{url:n.MODEL_NOT_AVAILABLE})}})})},G=({errorCode:e})=>e===r.b.MODEL_ARCHIVED?(0,a.jsx)(D,{}):e===r.b.MODEL_COMPLIANCE?(0,a.jsx)(N,{}):e===r.b.MODEL_DELETED?(0,a.jsx)(E,{}):e===r.b.MODEL_FAILED?(0,a.jsx)(P,{}):e===r.b.MODEL_PENDING?(0,a.jsx)(_,{}):e===r.b.MODEL_PROCESSING?(0,a.jsx)(C,{}):e===r.b.WEBGL_CONTEXT_LOST?(0,a.jsx)(A,{}):e===r.b.WEBGL_GENERIC?(0,a.jsx)(U,{}):e===r.b.WEBGL_UNSUPPORTED?(0,a.jsx)($,{}):(0,a.jsx)(j,{}),z=JSON;var H=i(20150),q=i(11751);const W=e=>{let t;const i=e.definitions.filter((e=>"OperationDefinition"===e.kind));return 1===i.length&&(t=i[0]?.name?.value),t},K=e=>{if("string"==typeof e){let t;try{const i=(0,H.qg)(e);t=W(i)}catch(e){}return{query:e,operationName:t}}const t=W(e);return{query:(0,q.y)(e),operationName:t}};class X extends Error{constructor(e,t){super(`${X.extractMessage(e)}: ${JSON.stringify({response:e,request:t})}`),Object.setPrototypeOf(this,X.prototype),this.response=e,this.request=t,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,X)}static extractMessage(e){return e.errors?.[0]?.message??`GraphQL Error (Code: ${e.status})`}}var Y=i(74945),Q=i.t(Y,2);const J=e=>{let t={};return e&&("undefined"!=typeof Headers&&e instanceof Headers||Q&&Y.Headers&&e instanceof Y.Headers?t=(e=>{const t={};return e.forEach(((e,i)=>{t[i]=e})),t})(e):Array.isArray(e)?e.forEach((([e,i])=>{e&&void 0!==i&&(t[e]=i)})):t=e),t},Z=e=>e.replace(/([\s,]|#[^\n\r]+)+/g," ").trim(),ee=e=>async t=>{const{url:i,query:n,variables:a,operationName:o,fetch:s,fetchOptions:r,middleware:d}=t,l={...t.headers};let c,u="";"POST"===e?(c=ae(n,a,o,r.jsonSerializer),"string"==typeof c&&(l["Content-Type"]="application/json")):u=(e=>{if(!Array.isArray(e.query)){const t=e,i=[`query=${encodeURIComponent(Z(t.query))}`];return e.variables&&i.push(`variables=${encodeURIComponent(t.jsonSerializer.stringify(t.variables))}`),t.operationName&&i.push(`operationName=${encodeURIComponent(t.operationName)}`),i.join("&")}if(void 0!==e.variables&&!Array.isArray(e.variables))throw new Error("Cannot create query with given variable type, array expected");const t=e,i=e.query.reduce(((e,i,n)=>(e.push({query:Z(i),variables:t.variables?t.jsonSerializer.stringify(t.variables[n]):void 0}),e)),[]);return`query=${encodeURIComponent(t.jsonSerializer.stringify(i))}`})({query:n,variables:a,operationName:o,jsonSerializer:r.jsonSerializer??z});const h={method:e,headers:l,body:c,...r};let m=i,p=h;if(d){const e=await Promise.resolve(d({...h,url:i,operationName:o,variables:a})),{url:t,...n}=e;m=t,p=n}return u&&(m=`${m}?${u}`),await s(m,p)};class te{constructor(e,t={}){this.url=e,this.requestConfig=t,this.rawRequest=async(...e)=>{const[t,i,n]=e,a=((e,t,i)=>e.query?e:{query:e,variables:t,requestHeaders:i,signal:void 0})(t,i,n),{headers:o,fetch:s=Y,method:r="POST",requestMiddleware:d,responseMiddleware:l,...c}=this.requestConfig,{url:u}=this;void 0!==a.signal&&(c.signal=a.signal);const{operationName:h}=K(a.query);return ie({url:u,query:a.query,variables:a.variables,headers:{...J(se(o)),...J(a.requestHeaders)},operationName:h,fetch:s,method:r,fetchOptions:c,middleware:d}).then((e=>(l&&l(e),e))).catch((e=>{throw l&&l(e),e}))}}async request(e,...t){const[i,n]=t,a=((e,t,i)=>e.document?e:{document:e,variables:t,requestHeaders:i,signal:void 0})(e,i,n),{headers:o,fetch:s=Y,method:r="POST",requestMiddleware:d,responseMiddleware:l,...c}=this.requestConfig,{url:u}=this;void 0!==a.signal&&(c.signal=a.signal);const{query:h,operationName:m}=K(a.document);return ie({url:u,query:h,variables:a.variables,headers:{...J(se(o)),...J(a.requestHeaders)},operationName:m,fetch:s,method:r,fetchOptions:c,middleware:d}).then((e=>(l&&l(e),e.data))).catch((e=>{throw l&&l(e),e}))}batchRequests(e,t){const i=((e,t)=>e.documents?e:{documents:e,requestHeaders:t,signal:void 0})(e,t),{headers:n,...a}=this.requestConfig;void 0!==i.signal&&(a.signal=i.signal);const o=i.documents.map((({document:e})=>K(e).query)),s=i.documents.map((({variables:e})=>e));return ie({url:this.url,query:o,variables:s,headers:{...J(se(n)),...J(i.requestHeaders)},operationName:void 0,fetch:this.requestConfig.fetch??Y,method:this.requestConfig.method||"POST",fetchOptions:a,middleware:this.requestConfig.requestMiddleware}).then((e=>(this.requestConfig.responseMiddleware&&this.requestConfig.responseMiddleware(e),e.data))).catch((e=>{throw this.requestConfig.responseMiddleware&&this.requestConfig.responseMiddleware(e),e}))}setHeaders(e){return this.requestConfig.headers=e,this}setHeader(e,t){const{headers:i}=this.requestConfig;return i?i[e]=t:this.requestConfig.headers={[e]:t},this}setEndpoint(e){return this.url=e,this}}const ie=async e=>{const{query:t,variables:i,fetchOptions:n}=e,a=ee((e.method??"post").toUpperCase());const o=Array.isArray(e.query),s=await a(e),r=await oe(s,n.jsonSerializer??z),d=Array.isArray(r)?!r.some((({data:e})=>!e)):Boolean(r.data),l=Array.isArray(r)||!r.errors||Array.isArray(r.errors)&&!r.errors.length||"all"===n.errorPolicy||"ignore"===n.errorPolicy;if(s.ok&&l&&d){const{errors:e,...t}=(Array.isArray(r),r),i="ignore"===n.errorPolicy?t:r;return{...o?{data:i}:i,headers:s.headers,status:s.status}}throw new X({..."string"==typeof r?{error:r}:r,status:s.status,headers:s.headers},{query:t,variables:i})};async function ne(e,t,...i){const n=((e,t,...i)=>{const[n,a]=i;return e.document?e:{url:e,document:t,variables:n,requestHeaders:a,signal:void 0}})(e,t,...i);return new te(n.url).request({...n})}const ae=(e,t,i,n)=>{const a=n??z;if(!Array.isArray(e))return a.stringify({query:e,variables:t,operationName:i});if(void 0!==t&&!Array.isArray(t))throw new Error("Cannot create request body with given variable type, array expected");const o=e.reduce(((e,i,n)=>(e.push({query:i,variables:t?t[n]:void 0}),e)),[]);return a.stringify(o)},oe=async(e,t)=>{let i;return e.headers.forEach(((e,t)=>{"content-type"===t.toLowerCase()&&(i=e)})),i&&(i.toLowerCase().startsWith("application/json")||i.toLowerCase().startsWith("application/graphql+json")||i.toLowerCase().startsWith("application/graphql-response+json"))?t.parse(await e.text()):e.text()},se=e=>"function"==typeof e?e():e,re=((e,...t)=>e.reduce(((e,i,n)=>`${e}${i}${n in t?String(t[n]):""}`),""))`
  query GetCurrentUser {
    currentSession {
      currentUser {
        id
        email
        firstName
        lastName
      }
    }
  }
`,de=async({apiHost:e})=>{var t;const i=`${e}/api/mp/accounts/graph`,n=await ne(i,re),a=null===(t=null==n?void 0:n.currentSession)||void 0===t?void 0:t.currentUser;if(null==a?void 0:a.id)return{id:a.id,email:a.email||"",firstName:a.firstName||"",lastName:a.lastName||""}},le="user-info-ad336d34e0e42bf24df6",ce="user-pill-a15513395bce869b46a7",ue="avatar-f8b8402c9be2621228c7",he=({firstName:e,lastName:t,email:i})=>{const n=`${(null==e?void 0:e[0])||""}${(null==t?void 0:t[0])||""}`;return(0,a.jsxs)("div",{"data-testid":"user_pill",className:ce,children:[(0,a.jsx)("span",{"data-testid":"user_avatar",className:ue,children:n}),(0,a.jsx)("span",{children:i})]})},me=()=>{const{t:e}=(0,l.useContext)(u),{user:t}=(()=>{const{apiHost:e}=(0,l.useContext)(u),{isLoading:t,error:i,data:n}=(0,o.Ay)(["CurrentUser"],(()=>de({apiHost:e})));return{isAuthenticated:!!n&&!i,isLoading:t,user:n}})();return t?(0,a.jsxs)("div",{"data-testid":"user_info",className:le,children:[e(d.A.OOPS.SIGNED_IN_AS),(0,a.jsx)(he,{firstName:t.firstName,lastName:t.lastName,email:t.email})]}):null},pe="error-page-f4c23b7d151d5477e038",ve="error-page__content-ea4e5636c6830fc62e5d",fe="error-page__footer-f3713a4f0c62d833ba5e",ge="error-page__logo-c349a544089477e75aee",ye=({errorCode:e})=>(0,a.jsxs)("section",{"data-testid":"error_page",className:pe,children:[(0,a.jsx)("div",{className:ve,children:(0,a.jsx)(G,{errorCode:e})}),(0,a.jsxs)("footer",{className:fe,children:[(0,a.jsx)("a",{href:"https://matterport.com",target:"_blank",children:(0,a.jsx)("img",{src:s,alt:"Matterport logo",width:"178",height:"30",className:ge})}),(0,a.jsx)(me,{})]})]});function we({apiHost:e,errorCode:t=r.b.GENERIC,t:i=e=>e}){const n={apiHost:e,errorCode:t,t:i};return(0,a.jsx)(o.BE,{children:(0,a.jsx)(u.Provider,{value:n,children:(0,a.jsx)(ye,{errorCode:t})})})}var be=i(77201),ke=i(71687),Se=i(5338);const Te="error-gui-c5f0b16c74f79289f8d4";class Ie extends be.nV{constructor(){super(...arguments),this.name="error-gui",this.errorCode=null}async init({container:e,apiHost:t},i){this.apiHost=t,this.container=e,this.localeModule=await i.getModuleBySymbol(ke.gS),this.reactContainer=document.createElement("div"),this.reactContainer.id="error-container",this.reactContainer.dataset.testid="error-gui",this.reactContainer.classList.add(Te),this.reactRoot=(0,Se.createRoot)(this.reactContainer)}get currentErrorCode(){return this.errorCode}showError(e){this.errorCode=e;const t=this.localeModule.t.bind(this.localeModule);this.container.appendChild(this.reactContainer),this.reactRoot.render((0,l.createElement)(we,{errorCode:e,t,apiHost:this.apiHost}))}hideError(){this.errorCode=null,this.container.removeChild(this.reactContainer),this.reactRoot.unmount()}}},76435:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Me});var n=i(51983),a=i(85935),o=i(75742),s=i(40409);class r{constructor(){this.handlers=[{msgType:s.v,func:(e,t,i)=>{const{blockType:n}=t.block;if(n===o.n.TEXT)return;let a=t.block.text;n===o.n.LINK&&(a=t.block.value||""),n===o.n.USER&&(a=t.block.id||""),e.track("annotation_block_clicked",{block_type:n,block_value:a,annotation_type:t.annotationType,annotation_id:t.id})}}]}}var d,l=i(90834),c=i(34184),u=i(47004),h=i(21875),m=i(50018);function p(e,t){if(t===m.EO.MANUAL)return 3;switch(e){case m.c$.ALIGNED:return 1;case m.c$.UNALIGNED:return 2}return 0}!function(e){e.USER="self-guided",e.TOUR="tour"}(d||(d={}));class v{constructor(){this.startLoadTime=Date.now(),this.endLoadTime=Date.now(),this.panosViewed=0,this.handlers=[{msgType:c.A,func:(e,t,i)=>{this.onMoveToSweepBegin(t.timestamp)}},{msgType:u.A,func:(e,t,i)=>{const n=i.tryGetData(l.O),a=i.tryGetData(h.R);this.endLoadTime=Date.now();const o=this.endLoadTime-this.startLoadTime;e.track("pano_viewed",{pano_id:t.toSweep,pano_view_count:++this.panosViewed,alignment_type:p(t.alignmentType,t.placementType),navigation_source:a&&a.tourPlaying?d.TOUR:d.USER,interaction_source:n?n.source:l.O.defaultSource,interaction_mode:n?n.mode:l.O.defaultMode,load_time:o/1e3})}}]}onMoveToSweepBegin(e){this.startLoadTime=e}}var f=i(51313),g=i(77201);class y extends g.QB{constructor(e,t,i){super(),this.sweep=e,this.from=t,this.to=i}}var w=i(58229);const b=(e,t)=>{const i=t.tryGetData(w.q);if(!e||!i)return-1;return i.getFloor(e).index};class k{constructor(){this.handlers=[{msgType:f.P,func:(e,t,i)=>{const n=i.tryGetData(l.O);e.track("floor_changed",{floor_id:t.floorName,interaction_source:n?n.source:l.O.defaultSource,interaction_mode:n?n.mode:l.O.defaultMode})}},{msgType:y,func:(e,t,i)=>{const n=i.tryGetData(l.O);e.track("sweep_floor_fixup",{sweep_index:t.sweep.index,sweep_alignment:t.sweep.alignmentType,sweep_placement:t.sweep.placementType,sweep_floor_from:b(t.from,i),sweep_floor_to:b(t.to,i),interaction_source:n?n.source:l.O.defaultSource,interaction_mode:n?n.mode:l.O.defaultMode})}}]}}var S=i(72354);class T{constructor(){this.handlers=[{msgType:S.b,func:(e,t,i)=>{const n=i.tryGetData(l.O);n&&e.track("interaction_mode_changed",{interaction_mode_prev:t.fromMode,interaction_mode:t.mode,interaction_source:n.source})}}]}}class I{constructor(){this.handlers=[]}}var D=i(25903),N=i(41837),E=i(39209);const P=(e,t)=>{const i=t.tryGetData(E.X);if(!i)return-1;return(e?i.floors.getFloor(e):i.getHighestVisibleFloor()).index};class _{constructor(){this.handlers=[{msgType:N.hR,func:(e,t,i)=>{const n={measure_sid:t.data.sid,start_position:t.data.startPosition,end_position:t.data.endPosition,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:P(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_segment_add",n)}},{msgType:N.QZ,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:P(t.data.floorId,i),feature_type:t.data.featureType,measure_type:t.data.type,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_add",n)}},{msgType:N.kC,func:(e,t)=>{const i={measure_sid:t.sid,measure_text:t.text};e.track("measure_add_title",i)}},{msgType:N.wx,func:(e,t)=>{const i={measure_sid:t.sid,measure_old_text:t.oldText,measure_new_text:t.newText};e.track("measure_update_title",i)}},{msgType:N.To,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:P(t.data.floorId,i),measure_count:t.data.count,continuous:t.data.continuous};e.track("measure_remove",n)}},{msgType:N.bV,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:P(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_update",n)}},{msgType:N.z,func:(e,t)=>{const i=t.opened?"measure_mode_enter":"measure_mode_exit",n={viewmode:t.viewmode,measure_count:t.count};e.track(i,n)}},{msgType:N.sN,func:(e,t)=>{e.track("measure_cancelled",{})}}]}}var C=i(95522);const A=e=>e.sort(((e,t)=>e.localeCompare(t)));class x{constructor(){this.handlers=[{msgType:C.N,func:(e,t)=>{const{happiness:i,quality:n,navigation:a,feedback:o}=t.rating,s={};i&&(s.happiness=+i),(a&&a.length>0||n&&n.length>0)&&(s.issue_types=function(e=[],t=[]){const i=[];return A(t).forEach((e=>i.push(`navigation-${e.trim()}`))),A(e).forEach((e=>i.push(`quality-${e.trim()}`))),i.join(",")}(n||[],a||[])),o&&o.length>0&&(s.feedback=o),Object.keys(s).length>0&&e.track("model_rated",s)}}]}}var V,M=i(25434),O=i(63846),L=i(46793);!function(e){e.USER="self-guided",e.TOUR="tour"}(V||(V={}));class R{constructor(){this.handlers=[{msgType:O.h,func:(e,t,i)=>{const n=i.tryGetData(l.O),a=i.tryGetData(h.R),o={room_id:t.roomId,room_index:t.meshSubgroup,room_type:t.roomType,viewmode:t.viewmode?L.De[t.viewmode]:t.viewmode,room_visit_count:t.visitCount,room_count:t.roomCount,navigation_source:a&&a.tourPlaying?V.TOUR:V.USER,interaction_source:n?n.source:l.O.defaultSource,interaction_mode:n?n.mode:l.O.defaultMode,room_source:t.roomSource?t.roomSource:"vision",room_classification_ids:t.roomClassificationIds?t.roomClassificationIds:null};e.track("room_visited",o)}}]}}var F=i(50178),B=i(97800);const U=[1e3,3e3,5e3,15e3];class ${constructor(){this.currSpinnerSessionId=null,this.currSpinnerSessionStartTime=null,this.currIntervalIdx=0,this.pingTimeout=null,this.handlers=[{msgType:F.XR,func:(e,t)=>{t.isOpen?this.startPinging(e):this.stopPinging(e)}}]}startPinging(e){null==this.currSpinnerSessionId&&(this.currSpinnerSessionId=(0,B.eJ)(),this.currSpinnerSessionStartTime=Date.now(),this.currIntervalIdx=0,this.pingTimeout=window.setTimeout((()=>this.pingAnalytics(e)),U[this.currIntervalIdx]))}stopPinging(e){if(this.currSpinnerSessionId&&this.currSpinnerSessionStartTime){const t=Date.now()-this.currSpinnerSessionStartTime;e.track("pano_tile_loading",{session_id:this.currSpinnerSessionId,duration:t,final_duration:t}),this.pingTimeout&&(window.clearTimeout(this.pingTimeout),this.pingTimeout=null),this.currSpinnerSessionId=null}}pingAnalytics(e){this.currSpinnerSessionId&&this.currSpinnerSessionStartTime&&(e.track("pano_tile_loading",{session_id:this.currSpinnerSessionId,duration:Date.now()-this.currSpinnerSessionStartTime,final_duration:null}),this.currIntervalIdx=Math.min(this.currIntervalIdx+1,U.length-1),this.pingTimeout=window.setTimeout((()=>this.pingAnalytics(e)),U[this.currIntervalIdx]))}}var j=i(49155);class G{constructor(){this.handlers=[],this.send=(e,t,i)=>{const n=i.tryGetData(l.O),a=i.tryGetData(g.zH),o={view_mode:t.toMode,app_phase:a&&g.Jj[a.phase]?g.Jj[a.phase].toLowerCase():null};n&&(o.interaction_source=n.source,o.interaction_mode=n.mode),e.track("mode_changed",o)},this.handlers.push({msgType:j.A,func:(e,t,i)=>{this.send(e,t,i)}})}}var z=i(71687),H=i(98309),q=i(48539),W=i(2993),K=i(99583),X=i(79388);const Y=new B.Vy("/index.js");class Q{constructor(e){this.engine=e,this.trackTime=0,this.trackTimeThreshold=1/0,this.currentPhase=null,this.currentAppPhase=null,this.pixelRatio=window.devicePixelRatio||1,this.recordedPhases={},this.deltas=new B.CZ(1e3),this.memoryReadings=new B.CZ(1e3),this.handlers=[{msgType:H.A,func:(e,t,i)=>{this.currentAppPhase!==g.Jj.STARTING&&this.currentAppPhase!==g.Jj.PLAYING||this.startRecording(e,W.N3[t.toMode],1e4)}},{msgType:g.uv,func:async(e,t,i)=>{const n=i.tryGetData(K.X);t.phase===g.Jj.LOADING?this.startRecording(e,"Loading",6e4):t.phase===g.Jj.STARTING?(this.renderer=await this.engine.getModuleBySymbol(z.M7),this.startRecording(e,"Starting",6e4)):t.phase===g.Jj.PLAYING&&n&&n.currentMode&&this.startRecording(e,W.N3[n.currentMode],1e4),this.currentAppPhase=t.phase}},{msgType:X.lo,func:(e,t,i)=>{this.pixelRatio=t.pixelRatio}}],this.resetRecording=()=>{this.currentPhase=null,this.deltas.clear(),this.memoryReadings.clear(),this.trackTime=0}}onUpdate(e,t){var i,n;if(!this.currentPhase)return;this.deltas.push(t);const a=null!==(n=null===(i=this.renderer)||void 0===i?void 0:i.estimatedGPUMemoryAllocated())&&void 0!==n?n:-1;a>-1&&this.memoryReadings.push(a),this.trackTime+=t,this.trackTime>=this.trackTimeThreshold&&(this.sendRecord(e),this.resetRecording())}startRecording(e,t,i){t!==this.currentPhase&&(this.currentPhase&&(this.sendRecord(e),this.resetRecording()),this.recordedPhases[t]||(this.currentPhase=t,this.trackTimeThreshold=i,this.recordedPhases[this.currentPhase]=!0))}sendRecord(e){if(0===this.deltas.count)return;const t=this.deltas.getList(),i=this.memoryReadings.getList();try{const n=this.calcPerformance(t,i);e.track("performance",n)}catch(e){Y.warn("Could not send performance metrics",e)}}calcPerformance(e,t){let i=0,n=0,a=0,o=0,s=0,r=0;for(const t of e)i+=t,t<0||(t<=16.7?n+=t:t<=33.3?a+=t:t<=100?o+=t:t<=1e3?s+=t:r+=t);if(i<=0)throw Error("No positive timings, cannot calculate performance data");const d=i/e.length;n/=i,a/=i,o/=i,s/=i,r/=i;let l=e.slice();const c=(0,q.Ym)(l,50),u=(0,q.Ym)(l,95,!1),h=l[l.length-1];let m,p,v,f,g;return t.length&&(l=t.slice(),f=(0,q.Ym)(l,50,!0),g=(0,q.Ym)(l,95,!1),v=Math.round((0,q.G8)(t)),m=l[0],p=l[l.length-1]),{phase:this.currentPhase,frame_delta:d,frame_delta_avg:d,frame_delta_median:c,frame_delta_95th:u,frame_delta_max:h,duration:i,time_60_fps:n,time_60_30_fps:a,time_30_10_fps:o,time_10_1_fps:s,time_1_0_fps:r,gpu_memory_min:m,gpu_memory_max:p,gpu_memory_avg:v,gpu_memory_median:f,gpu_memory_95th:g,pixel_ratio:this.pixelRatio}}}var J=i(32994),Z=i.n(J);const ee=1/30*1e3;var te;!function(e){e.DAM_MESH="dam_mesh",e.TILED_MESH="tiled_mesh",e.PANO_TILE="pano_tile",e.DAM_TEXTURE="dam_texture",e.TILED_TEXTURE="tiled_texture",e.STATIC="static",e.GRAPH="graph"}(te||(te={}));class ie{constructor(){this.lastFlushTimestamp=null,this.lastSendTimestamp=null,this.isRecording=!1,this.isSending=!1,this.stats={[te.DAM_MESH]:{sum:0,count:0},[te.TILED_MESH]:{sum:0,count:0},[te.PANO_TILE]:{sum:0,count:0},[te.DAM_TEXTURE]:{sum:0,count:0},[te.TILED_TEXTURE]:{sum:0,count:0},[te.STATIC]:{sum:0,count:0},[te.GRAPH]:{sum:0,count:0}},this.totalStatsCount=0,this.handlers=[{msgType:g.uv,func:(e,t)=>{t.phase===g.Jj.STARTING?this.isRecording=!0:t.phase===g.Jj.PLAYING&&(this.isSending=!0)}}]}get dataBuffer(){return null==this._dataBuffer?(this._dataBuffer=new(Z())(300),this._dataBuffer):this._dataBuffer}onUpdate(e,t){this.isRecording&&(this.flushTimingDataThrottled(),this.updateStats(t),this.isSending&&this.sendAnalyticsThrottled(e))}flushTimingDataThrottled(){if(null==this.lastFlushTimestamp||performance.now()-this.lastFlushTimestamp>5e3){const e=performance.getEntriesByType("resource");for(const t of e)t.transferSize>0&&this.dataBuffer.enq(t);performance.clearResourceTimings(),this.lastFlushTimestamp=performance.now()}}sendAnalyticsThrottled(e){if((null==this.lastSendTimestamp||performance.now()-this.lastSendTimestamp>5e3)&&this.totalStatsCount>10){const t={};for(const e in this.stats){const i=e,n=this.stats[i];n.count>0&&(t[i]=0|Math.round(n.sum/n.count),n.sum=0,n.count=0)}e.track("resource_timing",t),this.totalStatsCount=0,this.lastSendTimestamp=performance.now()}}updateStats(e){if(e<ee){let e=0;for(;e<30&&!this.dataBuffer.isEmpty();){const t=this.dataBuffer.deq(),i=ne(t);i&&(this.stats[i].sum+=t.duration,this.stats[i].count+=1,this.totalStatsCount+=1),e+=1}}}}const ne=e=>{const t=new URL(e.name),i=t.hostname,n=t.pathname.split("/"),a=n[n.length-1];return i.includes("static")?te.STATIC:"graph"===a?te.GRAPH:n.includes("mesh_tiles")&&a.includes(".glb")?te.TILED_MESH:n.includes("mesh_tiles")&&(a.includes(".ktx2")||a.includes(".jpg"))?te.TILED_TEXTURE:a.includes(".dam")?te.DAM_MESH:n.includes("tiles")?te.PANO_TILE:n[n.length-2].includes("_texture_")?te.DAM_TEXTURE:null};var ae,oe=i(6909),se=i(31002),re=i(94790),de=i(60043),le=i(78079),ce=i(20014),ue=i(1197),he=i(22937),me=i(5544),pe=i(55057),ve=i(44481);!function(e){e.UNINITIALIZED="uninitialized",e.INACTIVE="inactive",e.ACTIVE="active"}(ae||(ae={}));class fe{constructor(){this.name="activity-analytics",this._state=ae.UNINITIALIZED,this.activeModeMap=new Map,this.totalTilesDownloaded=0,this.onTileDownloaded=()=>{this.totalTilesDownloaded++}}async init(e,t,i){this.engine=e,this.requestQueue=i,[this.input,this.viewmodeData,this.applicationData,this.modelData,this.toursViewData]=await Promise.all([await e.getModuleBySymbol(z.mL),await e.market.waitForData(K.X),await e.market.waitForData(g.zH),await e.market.waitForData(pe.q),await e.market.waitForData(ve.F)]);const n=[],a=[se.rX,re.jF,de.k,le.CD,ce.l],o=()=>this.active=!0;this.applicationData.phase===g.Jj.PLAYING?this._state=ae.INACTIVE:n.push(e.subscribe(g.uv,(()=>{this.applicationData.phase===g.Jj.PLAYING&&(this._state=ae.INACTIVE)})));let s,r=this.modelData.getModelAssets();n.push(this.modelData.onPropertyChanged("activeAssetsId",(()=>{const e=this.modelData.getModelAssets(),t=r.overlayActive,i=e.overlayActive;r=e,i?this.activeModeMap.has("overlay")?this.updateActivityTimeForMode("overlay",!0):this.activeModeMap.set("overlay",{previousTime:Date.now(),totalTimeinMS:0}):t&&this.updateActivityTimeForMode("overlay")}))),n.push(...(()=>{const e=[];return a.forEach((t=>{e.push(this.input.registerUnfilteredHandler(t,o))})),e})()),n.push(e.subscribe(ue.A,(e=>{const t=e.fromMode,i=e.toMode;t&&t!==W.N3.Transition&&this.applicationData.phase===g.Jj.PLAYING&&this.handleViewmodeChange(t,i)}))),n.push(e.subscribe(me.f,this.onTileDownloaded));const d=()=>{s&&(window.clearTimeout(s),s=void 0)};n.push(e.subscribe(he.zM,(()=>{d(),this.activeModeMap.has("tour")?this.updateActivityTimeForMode("tour",!0):this.activeModeMap.set("tour",{previousTime:Date.now(),totalTimeinMS:0}),s=window.setTimeout((()=>{this.updateActivityTimeForMode("tour"),this._state=ae.ACTIVE,this.notifyActivityAnalytic()}),fe.ACTIVITY_INTERVAL)})),e.subscribe(he.pT,(({willResume:e})=>{e||(d(),this.updateActivityTimeForMode("tour"),this._state=ae.ACTIVE,this.notifyActivityAnalytic())}))),t(n)}get active(){return this._state===ae.ACTIVE}set active(e){this._state!==ae.UNINITIALIZED&&(e&&this._state===ae.INACTIVE&&this.startActivityTimeout(),this._state=e?ae.ACTIVE:ae.INACTIVE)}handleViewmodeChange(e,t){this.activeModeMap.has(t)?this.updateActivityTimeForMode(t,!0):this.activeModeMap.set(t,{previousTime:Date.now(),totalTimeinMS:0}),this.updateActivityTimeForMode(e)}updateActivityTimeForMode(e,t){const i=this.activeModeMap.get(e);if(void 0===i)return;const{previousTime:n,totalTimeinMS:a}=i;t?this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:a}):this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:a+(Date.now()-n)})}startActivityTimeout(){this.activeModeMap.set(W.N3.Dollhouse,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(W.N3.Floorplan,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(W.N3.Panorama,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set("overlay",{previousTime:Date.now(),totalTimeinMS:0}),window.setTimeout(this.notifyActivityAnalytic.bind(this),fe.ACTIVITY_INTERVAL)}notifyActivityAnalytic(){if(this.modelData.getModelAssets().overlayActive&&this.updateActivityTimeForMode("overlay"),this.viewmodeData.currentMode&&this.viewmodeData.currentMode!==W.N3.Transition&&this.updateActivityTimeForMode(this.viewmodeData.currentMode),this.active){let e=0,t=W.N3.Panorama;this.activeModeMap.forEach(((i,n)=>{i.totalTimeinMS>e&&"overlay"!==n&&"tour"!==n&&(t=n,e=i.totalTimeinMS)})),this.active=!1;const[i,n,a,o,s]=[this.activeModeMap.get(W.N3.Dollhouse),this.activeModeMap.get(W.N3.Floorplan),this.activeModeMap.get(W.N3.Panorama),this.activeModeMap.get("overlay"),this.activeModeMap.get("tour")].map((e=>e?Math.max(Math.min(fe.ACTIVITY_INTERVAL,e.totalTimeinMS),0):0));this.engine.broadcast(new oe.h(i,n,a,o,L.De[t],this.requestQueue.totalBytesDownloaded,this.totalTilesDownloaded,s,this.toursViewData.currentTourMode))}}}fe.ACTIVITY_INTERVAL=15e3;const ge=fe;class ye{constructor(){this.handlers=[{msgType:oe.h,func:(e,t)=>{const i=Math.min(t.durationDollhouse+t.durationFloorplan+t.durationInside,ge.ACTIVITY_INTERVAL),n={duration_dollhouse:t.durationDollhouse,duration_floorplan:t.durationFloorplan,duration_inside:t.durationInside,duration_overlay:t.durationOverlay,duration:i,main_mode:t.mainMode,bytes_downloaded:t.totalBytesDownloaded,tiles_downloaded:t.tilesDownloaded,duration_tour:t.durationTour,tour_mode:t.tourMode};e.track("activity_ping",n)}}]}}class we extends g.B_{constructor(){super(...arguments),this.name="timing",this.modelLoadingStartTime=0,this.waitingStartTime=0,this.appPlayingTime=0,this.appStartedTime=0}get totalTimeToAppStarting(){let e=this.appStartedTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}get totalTimeToAppPlaying(){let e=this.appPlayingTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}}var be=i(56208),ke=i(80610);const Se=new B.Vy("showcase-session"),Te=new we;class Ie{constructor(e,t){this.analytics=e,this.engine=t,this.handlers=[{msgType:g.uv,func:async(e,t,i)=>{var n,a;switch(t.phase){case g.Jj.WAITING:Te.waitingStartTime=Date.now(),Te.commit(),e.track("impression",{url_params:B.yJ(),visible:!0});break;case g.Jj.LOADING:Te.modelLoadingStartTime=Date.now(),Te.commit();break;case g.Jj.STARTING:{Te.appStartedTime=Date.now(),Te.commit(),Se.info("First render, model loaded "+Te.totalTimeToAppStarting/1e3);const t=this.engine.market.tryGetData(be.EY);this.renderer=await this.engine.getModuleBySymbol(z.M7);const i=this.renderer.getCapabilities(),n=await this.engine.getModuleBySymbol(z.XQ),a=!t||t.options.highlight_reel,o={has_hlr:a,has_tour:a&&n.hasTour,duration:Date.now()-Te.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gl_v2:i.gl_v2,gl_max_textures:i.gl_max_textures,gl_max_texture_size:i.gl_max_texture_size,gl_max_cubemap_size:i.gl_max_cubemap_size,gl_instancing:i.gl_instancing,gl_oes_texture_float:i.gl_oes_texture_float,gl_oes_texture_half_float:i.gl_oes_texture_half_float,gl_depth_texture:i.gl_depth_texture,gl_draw_buffers:i.gl_draw_buffers,gl_oes_fbo_render_mip_map:i.gl_oes_fbo_render_mip_map,gl_shader_texture_lod:i.gl_shader_texture_lod,gl_oes_vertex_array_obj:i.gl_oes_vertex_array_obj,gl_ovr_multi_view:i.gl_ovr_multi_view,gl_color_buffer_float:i.gl_color_buffer_float,gl_astc_supported:i.gl_astc_supported,gl_etc1_supported:i.gl_etc1_supported,gl_etc2_supported:i.gl_etc2_supported,gl_dxt_supported:i.gl_dxt_supported,gl_bptc_supported:i.gl_bptc_supported,gl_pvrtc_supported:i.gl_pvrtc_supported};e.track("model_loaded",o);break}case g.Jj.PLAYING:Te.appPlayingTime=Date.now(),Te.commit(),Se.info("Playing, session started "+Te.totalTimeToAppPlaying/1e3),e.track("session_started"),window.addEventListener("unload",this.sessionEnded),e.track("load_times",{time_to_app_start:Te.totalTimeToAppStarting,time_to_app_playing:Te.totalTimeToAppPlaying});break;case g.Jj.ERROR:{const t=await i.waitForData(g.zH),{error:o}=t,s=o&&o.name?o.name:o&&o.constructor?o.constructor.name:null,r=o?o.message:null,d=o&&o.stack?o.stack.split("\n"):[],l=d.length>=2?d[1].match(/\s+at\s+([^\s]+)/):null,c=(0,ke.E2)(o),u=!!(0,B.P3)("oops",""),h=null!==(a=null===(n=this.renderer)||void 0===n?void 0:n.estimatedGPUMemoryAllocated())&&void 0!==a?a:-1,m={error_dialog:"oops",error_type:s||"",exception:{message:`${s}: ${r}`,function:l?l[1]:null,stack:d.slice(1,5).join("\n")},duration:Te.modelLoadingStartTime>0?Date.now()-Te.modelLoadingStartTime:void 0,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gpu_memory:h<0?void 0:h,mock_error:u};c&&(m.error_code=c),e.track("error_displayed",m);break}}}}],this.sessionEnded=()=>{this.analytics.trackAsync("session_ended",{duration:Date.now()-Te.appPlayingTime})}}dispose(){window.removeEventListener("unload",this.sessionEnded)}}var De=i(31285),Ne=i(12837);class Ee{constructor(){this.firstZoom=!0,this.fromZoom=1,this.toZoom=1,this.handlers=[{msgType:De.A,func:(e,t,i)=>{this.analytics||(this.analytics=e);const n=i.tryGetData(Ne.A);n&&n.state.currentSweep!==this.currentPano&&(this.firstZoom=!0,this.currentPano=n.state.currentSweep,this.fromZoom=1),this.toZoom=t.zoomLevel,clearTimeout(this.sendTimeout),this.sendTimeout=window.setTimeout(this.trackZoomEvent.bind(this),150)}}]}trackZoomEvent(){const e=this.firstZoom?"initial":"followup";this.analytics.track("zoom_"+e,{from:this.fromZoom,to:this.toZoom,pano:this.currentPano}),this.firstZoom=!1,this.fromZoom=this.toZoom}}var Pe=i(99622),_e=i(70400);class Ce{constructor(){this.backlinkShown=!1,this.handlers=[{msgType:_e.$j,func:(e,t)=>{e.track("showcase_gui",{gui_action:"brand_logo",data:t.brand})}},{msgType:_e.cq,func:(e,t)=>{this.backlinkShown||(e.track("showcase_gui",{gui_action:"brand_link_shown",data:t.backLink}),this.backlinkShown=!0)}},{msgType:_e.Or,func:(e,t)=>{e.track("brand_cookie_set",{homes_property_key:t.homesPropertyKey,listing_type:t.listingType,listing_id:t.listingId})}}]}}var Ae=i(12866),xe=i(8694);class Ve{constructor(){this.isPlaying=!1,this.isTransitioning=!1,this.lastRoomId=null,this.playbackDuration=0,this.playbackDelta=null,this.roomsVisitedTotal=0,this.roomsVisitedUnique=new Set,this.tourStopsVisitedTotal=0,this.tourStopsVisitedUnique=new Set,this.transitionDurationTotal=0,this.transitionStarted=null,this.handlers=[{msgType:he.n1,func:(e,t,i)=>{var n;const a=t.index;if(this.tourStopsVisitedTotal+=1,this.tourStopsVisitedUnique.add(a),this.playbackDelta){const e=new Date,t=e.getTime()-this.playbackDelta.getTime();this.playbackDuration+=t,this.playbackDelta=this.isPlaying?e:null}this.isTransitioning&&this.transitionStarted&&(this.transitionDurationTotal+=(new Date).getTime()-this.transitionStarted.getTime(),this.isTransitioning=!1,this.transitionStarted=null);const o=i.tryGetData(h.R),s=null==o?void 0:o.getHighlightsCount(),r=null!==(n=null==o?void 0:o.isLooping())&&void 0!==n&&n,d=Math.max(...this.tourStopsVisitedUnique),l=i.tryGetData(Ae.A),c=i.tryGetData(xe.y),u=null==c?void 0:c.currentRoom,m=u?null==l?void 0:l.getRoomLabel(u.id,"Unknown"):void 0;u&&this.lastRoomId!==u.id?(this.lastRoomId=u.id,this.roomsVisitedTotal+=1,this.roomsVisitedUnique.add(u.id)):this.lastRoomId=null;const p=i.tryGetData(K.X),v=(null==p?void 0:p.currentMode)?(0,W.Te)(p.currentMode):void 0;e.track("tour_stop_visited",{rooms_visited_total:this.roomsVisitedTotal,rooms_visited_unique:this.roomsVisitedUnique.size,room_count:null==l?void 0:l.rooms.size,room_label:m,time_playing:this.playbackDuration,time_transitioning:this.transitionDurationTotal,tour_index_current:a,tour_index_max:d,tour_is_looping:r,tour_is_playing:this.isPlaying,tour_length:s,tour_stops_visited_total:this.tourStopsVisitedTotal,tour_stops_visited_unique:this.tourStopsVisitedUnique.size,viewmode:v})}},{msgType:he.zM,func:(e,t,i)=>{this.playbackDelta=new Date,this.isPlaying=!0}},{msgType:he.pT,func:(e,t,i)=>{if(!t.willResume){if(this.playbackDelta){const e=(new Date).getTime()-this.playbackDelta.getTime();this.playbackDuration+=e,this.playbackDelta=null}this.isPlaying=!1,this.isTransitioning=!1}}},{msgType:he.zb,func:(e,t,i)=>{this.transitionStarted=new Date,this.isTransitioning=!0}},{msgType:he.YH,func:(e,t,i)=>{const n=i.tryGetData(h.R),a=null==n?void 0:n.getHighlightsCount();e.track("tour_completed",{rooms_visited_total:this.roomsVisitedTotal,rooms_visited_unique:this.roomsVisitedUnique.size,time_playing:this.playbackDuration,time_transitioning:this.transitionDurationTotal,tour_length:a,tour_stops_visited_total:this.tourStopsVisitedTotal,tour_stops_visited_unique:this.tourStopsVisitedUnique.size})}}]}}class Me extends n.H{constructor(){super(...arguments),this.name="showcase-analytics"}async init(e,t){await super.init(e,t),this.activityTracking=new ge,this.activityTracking.init(t,(e=>this.bindings.push(...e)),e.apiQueue)}trackGuiEvent(e,t={}){const{tool:i,interactionSource:n,panoId:a,data:o,event:s}=t,r=Object.assign({gui_action:e},this.getGuiEventFromDomEvent(s));i&&Object.assign(r,{tool:i}),n&&Object.assign(r,{interaction_source:n}),a&&Object.assign(r,{pano_id:a}),o&&Object.assign(r,{data:o}),this.track("showcase_gui",r)}addMessageHandlers(e,t){this.addMessageHandler(new Ie(e,t),t),this.addMessageHandler(new G,t),this.addMessageHandler(new v,t),this.addMessageHandler(new T,t),this.addMessageHandler(new k,t),this.addMessageHandler(new D.A,t),this.addMessageHandler(new Ee,t),this.addMessageHandler(new _,t),this.addMessageHandler(new Q(t),t),this.addMessageHandler(new ye,t),this.addMessageHandler(new R,t),this.addMessageHandler(new I,t),this.addMessageHandler(new x,t),this.addMessageHandler(new r,t),this.addMessageHandler(new $,t),this.addMessageHandler(new ie,t),this.addMessageHandler(new M.Z,t),this.addMessageHandler(new Pe.q,t),this.addMessageHandler(new Ce,t),this.addMessageHandler(new Ve,t)}getOptions(e){return Object.assign({mds_enabled:!0},(0,a.$E)(e))}}},64408:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>P});var n=i(71687),a=i(96540),o=i(5338),s=i(77201),r=i(97800),d=i(55066),l=i(30716),c=i(12786),u=i(77570),h=i(74771),m=i(74848),p=i(32485),v=i.n(p),f=i(56147);const g=i.p+"images/matterport-logo-white-r.svg";class y extends a.Component{render(){const{attributionLinkText:e,attributionLinkUrl:t}=this.props,{locale:i}=this.context;return(0,m.jsxs)("div",{className:"powered-by",children:[(0,m.jsx)("p",{className:"powered-by-label",children:i.t(f.A.POWERED_BY)}),(0,m.jsx)("img",{className:"powered-by-logo",alt:"Matterport",src:g,width:"150",height:"32"}),t&&(0,m.jsx)("a",{href:t,className:"powered-by-link",children:e||t})]})}}y.contextType=u.B;const w=y,b=i.p+"images/showcase-password-background.jpg";var k=i(52018);class S extends k.t{constructor(e="Invalid password"){super(e),this.name="InvalidPassword"}}class T extends k.t{constructor(e="Too many attempts, please try again in a few minutes"){super(e),this.name="TooManyAttempts"}}const I=new r.Vy("showcase-password");class D extends a.Component{constructor(e){super(e),this.isUnmounting=!1,this.onInputChange=e=>{const{name:t,value:i}=e.target;"password"===t&&this.setState({password:i,hasError:!1})},this.onSubmit=async e=>{e.preventDefault(),this.setState({formEnabled:!1}),await this.authenticate(),this.isUnmounting||this.setState({formEnabled:!0})},this.state={formEnabled:!0,hasError:!1,tooManyAttempts:!1,password:""}}componentWillUnmount(){this.isUnmounting=!0}async authenticate(){const{authenticate:e}=this.props,{password:t}=this.state;I.debug("Validating password input...");const i=await e(t).catch((e=>(e instanceof T&&this.setState({hasError:!0,tooManyAttempts:!0}),!1)));this.isUnmounting||this.setState({hasError:!i})}stopPropagation(e){e.stopPropagation()}renderLockout(){const{locale:e}=this.context;return(0,m.jsxs)("div",{className:"sc-password-modal sc-password-lockout",children:[(0,m.jsx)("header",{className:"modal-header",children:(0,m.jsx)("h1",{className:"modal-title",children:e.t(f.A.SC_LOCKOUT_TITLE)})}),(0,m.jsx)("p",{className:"modal-body",children:e.t(f.A.SC_LOCKOUT_MESSAGE)})]})}renderLoginForm(){const{hasError:e,password:t,formEnabled:i}=this.state,{locale:n}=this.context;return(0,m.jsxs)("div",{className:"sc-password-modal sc-password-login",children:[(0,m.jsx)("header",{className:"modal-header",children:(0,m.jsx)("h1",{className:"modal-title",children:n.t(f.A.SC_PASSWORD_TITLE)})}),(0,m.jsxs)("div",{className:"modal-body",children:[(0,m.jsxs)("form",{onSubmit:this.onSubmit,className:"sc-password-form",children:[(0,m.jsx)("input",{type:"password",name:"password",placeholder:n.t(f.A.SC_PASSWORD_PLACEHOLDER),onInput:this.onInputChange,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,disabled:!i,value:t,className:v()("sc-password-input",{error:e}),autoComplete:"on"}),(0,m.jsx)("button",{type:"submit",disabled:!i,className:"sc-password-submit",children:n.t(f.A.SC_PASSWORD_SUBMIT)})]}),e&&(0,m.jsxs)("p",{className:"help-text error",children:[(0,m.jsx)("span",{className:"icon icon-error"}),n.t(f.A.SC_PASSWORD_INVALID)]}),!e&&(0,m.jsx)("p",{className:"help-text"})]})]})}render(){const{hasError:e,tooManyAttempts:t}=this.state,i=e&&t?this.renderLockout():this.renderLoginForm();return(0,m.jsxs)("div",{className:"sc-password-ui",style:{backgroundImage:`url(${b})`},children:[(0,m.jsx)("div",{className:"sc-password-content",children:i}),(0,m.jsx)("footer",{className:"sc-password-footer",children:(0,m.jsx)(w,{})})]})}}D.contextType=u.B;const N=D;var E=i(65256);class P extends s.nV{constructor(){super(...arguments),this.name="showcase-password",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t;const i=e.baseUrl||window.location.origin;this.auth=new d.l(i)}showPasswordScreen(){this.loadUi()}hidePasswordScreen(){this.unloadUi()}async loadUi(){const{container:e}=this.config,t=await this.engine.getModuleBySymbol(n.gS),i=Object.assign(Object.assign({},c.T),{locale:t}),s={locale:i.locale};this.reactContainer=document.createElement("div"),this.reactContainer.id="showcase-password-container",e.appendChild(this.reactContainer),this.reactRoot=(0,o.createRoot)(this.reactContainer),this.reactRoot.render((0,a.createElement)(u.B.Provider,{value:i},[(0,a.createElement)(h.U6.Provider,{key:"showcase-password-locale",value:s},[(0,a.createElement)(N,{key:"showcase-password",authenticate:e=>this.authenticate(e)})])]))}async unloadUi(){var e;return!!this.reactRoot&&(this.reactRoot.unmount(),null===(e=this.reactContainer)||void 0===e||e.remove(),delete this.reactContainer,!0)}async authenticate(e){const{modelId:t}=this.config;if(!await this.auth.authenticate(t,e)){switch(this.engine.broadcast(new E.G(this.auth.errorType)),this.auth.errorType){case l.L.INVALID_CREDENTIALS:throw new S;case l.L.TOO_MANY_ATTEMPTS:throw new T}return!1}return r.Vy.for(this).debug("Password authentication was successful"),this.engine.broadcast(new E.l),!0}}},15318:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var n=i(71224),a=i(77201),o=i(71687),s=i(79388),r=i(88090);class d extends a.nV{constructor(){super(...arguments),this.name="showcase-webgl-context-loss",this.contextLostEvent=null,this.framesWithLostContext=0}async init(e,t){this.config=e,this.engine=t,this.bindings.push(t.subscribe(s.ul,(e=>{this.contextLostEvent=e.event})),t.subscribe(s.aF,(()=>{this.contextLostEvent=null,this.framesWithLostContext=0,t.getModuleBySymbol(r.bW).then((e=>{e.currentErrorCode===n.b.WEBGL_CONTEXT_LOST&&e.hideError()}))})))}onUpdate(e){const{contextLostEvent:t}=this;if(t){++this.framesWithLostContext===this.config.notificationDelayFrames&&(this.engine.getModuleBySymbol(r.bW).then((e=>{e.currentErrorCode||e.showError(n.b.WEBGL_CONTEXT_LOST)})),this.engine.getModuleBySymbol(o.aF).then((e=>{!function(e,t){e.track("error_displayed",{error_dialog:"oops",error_type:"WebGLContextLost",exception:{message:`WebGL context lost: ${t.statusMessage||"no status given"}`},mock_error:!1})}(e,t)})))}}}},15934:(e,t,i)=>{"use strict";var n;i.d(t,{A:()=>a}),function(e){e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_X=0]="GL_TEXTURE_CUBE_MAP_POSITIVE_X",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=1]="GL_TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=2]="GL_TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=3]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=4]="GL_TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=5]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Z"}(n||(n={}));const a=n},51983:(e,t,i)=>{"use strict";i.d(t,{H:()=>w});var n=i(77201),a=i(97800);const o=new a.Vy("log-analytics");class s{init(e,t){return o.debug("logging analytics to console",{options:e,context:t}),Promise.resolve()}identify(e){o.debug("identify as",e)}track(e,t,i){o.debug({eventName:e,data:t,intercom:i})}trackAsync(e,t,i){o.debug({eventName:e,data:t,intercom:i})}setOptions(e){o.debug("set options",e)}}var r=i(83772);const d=new a.Vy("mp-analytics"),l="ajs_anonymous_id",c="sc_anonymous_id";class u{constructor(e,t,i){this.token=e,this.url=t,this.queue=i,this.options={},this.segmentStylePayload=(e,t,i)=>({timestamp:(new Date).toISOString(),integrations:{Intercom:!!i},context:this.segmentStyleContext(this.context),properties:t,event:e,messageId:(0,a.eJ)(),anonymousId:this.anonymousId,type:"track",userId:this.user?this.user.id:null,sentAt:(new Date).toISOString()}),this.segmentStyleContext=e=>{const t={page:{path:window.location.pathname,referrer:(0,r.G2)(),search:window.location.search,title:window.document.title,url:window.location.href},userAgent:navigator.userAgent,library:{name:"showcase",version:"1"},campaign:{}};return Object.assign(Object.assign({},e),t)};const n=(0,a.zM)(c);if(n)this.anonymousId=n;else{const e=(0,a.GY)(l);this.anonymousId=e&&"string"==typeof e?e.replace(/%22/g,""):(0,a.eJ)(),(0,a.lk)(c,this.anonymousId)}this.headers={"X-API-Key":this.token,"Content-Type":"application/json",Accept:"application/json"}}init(e,t){return this.setOptions(e),this.context=t,d.debug("init",{options:this.options,context:this.segmentStyleContext(this.context)}),Promise.resolve()}identify(e){d.debug("identify as",e),this.user=e}track(e,t,i){a.Vy.level>=3&&d.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);const n=this.segmentStylePayload(e,t,i);this.queue.post(`${this.url}?ev=${e}`,{body:n,headers:this.headers})}trackAsync(e,t,i){if(t=Object.assign(t||{},this.options),navigator.sendBeacon)try{const n=this.segmentStylePayload(e,t,i);navigator.sendBeacon(`${this.url}?api_key=${this.token}`,JSON.stringify(n))}catch(e){d.error("Failed to sendBeacon analytics request")}}setOptions(e){Object.assign(this.options,e)}}const h=new a.Vy("segment");class m{constructor(e){this.token=e,this.options={}}init(e,t){return this.setOptions(e),this.context=t,this.token?(window.analytics&&window.analytics.initialize&&(window.analytics=null),window.analytics||function(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware"],e.factory=function(t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(t),e.push(i),e}};for(var t=0;t<e.methods.length;t++){var i=e.methods[t];e[i]=e.factory(i)}e.load=function(t,i){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a),e._loadOptions=i},e.SNIPPET_VERSION="4.15.2"}}(),window.analytics.load(this.token),new Promise(((e,t)=>{window.analytics.ready(e)}))):Promise.resolve()}identify(e){window.analytics.identify(e.id,{first_name:e.firstName,last_name:e.lastName,email:e.email,org_id:e.orgId})}track(e,t,i){a.Vy.level>=3&&h.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);const n=this.context.integrations?Object.assign({},this.context.integrations):{};n.Intercom=!!i;try{window.analytics.track(e,t,Object.assign(Object.assign({},this.context),{integrations:n}))}catch(t){h.error(`Failed to send data to segment for ${e}`)}}trackAsync(e,t,i){if(t=t||{},navigator.sendBeacon)try{navigator.sendBeacon("https://api.segment.io/v1/t",JSON.stringify({event:e,anonymousId:window.analytics.user().anonymousId(),properties:Object.assign({data:t},this.options),integrations:{Intercom:!!i},writeKey:this.token,sentAt:Date.now(),type:"track",context:this.context}))}catch(e){h.error("Failed to send async segment request")}}setOptions(e){Object.assign(this.options,e)}}const p={logging:async()=>new s,segment:async(e,t)=>{const i=await t.getAppKey(e,"segment_key");return new m(null!=i?i:void 0)},mp:async(e,t,i)=>{const n=await t.getAppKey(e,"analytics_mp_key"),a=await t.getAppKey(e,"analytics_mp_url");return n&&a?new u(n,a,i):null}};var v=i(37518),f=i(85935),g=i(71687),y=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(i[n[a]]=e[n[a]])}return i};class w extends n.nV{constructor(){super(...arguments),this.name="base-app-analytics",this.loaded=!1,this.handlers=[]}async init(e,t){this.analyticsQueue=e.analyticsQueue,this.analytics=await t.getModuleBySymbol(g.aF),this.apiClient=(await t.getModuleBySymbol(g.qL)).getApi(),this.addMessageHandlers(this.analytics,t),this.context=(0,f.BX)(e.apiQueue,"",e.appName),this.options=this.getOptions(e.overrideParams);const i=await this.createEndpoints(e);this.context.orgId=e.orgId,this.analytics.load(i,this.options,this.context).then((()=>{this.loaded=!0,this.apiClient.user.then((t=>{this.analytics.setUser(Object.assign(Object.assign({},t),{orgId:e.orgId}))}))})),t.getModuleBySymbol(g.gS).then((e=>{this.context.locale=e.languageCode}))}onUpdate(e){if(this.loaded)for(const t of this.handlers)t.onUpdate&&t.onUpdate(this.analytics,e)}dispose(e){super.dispose(e);for(const e of this.handlers)e.dispose&&e.dispose();this.handlers=[]}track(e,t,i){this.analytics.track(e,t,i)}trackGuiEvent(e,t={}){const{event:i}=t,n=y(t,["event"]);this.track("gui_action",Object.assign(Object.assign({guiAction:e},this.getGuiEventFromDomEvent(i)),n))}trackToolGuiEvent(e,t,i={}){this.trackGuiEvent(t,Object.assign({tool:e},i))}getSessionId(){return this.options.session_id||""}async createEndpoint(e,t){var i;return null===(i=p[e])||void 0===i?void 0:i.call(p,t,this.apiClient,this.analyticsQueue)}async createEndpoints(e){const t=(0,f.oA)(e.appName),i=void 0!==e.provider?e.provider:await this.apiClient.getAppKey(t,v.q),n=[];if(!i)return n;const o=i.split(",");for(const e of o){const i=await this.createEndpoint(e,t);null!==i?n.push(i):a.Vy.for(this).warn(`Failed to set up ${e}, token/url required but not found in config`)}return n.length<1&&n.push(await this.createEndpoint("logging",t)),n}addMessageHandlers(e,t){}addMessageHandler(e,t){this.handlers.push(e),e.handlers.forEach(((e,i)=>{this.bindings.push(t.subscribe(e.msgType,(i=>{e.func(this.analytics,i,t.market)})))}))}getOptions(e){var t;return{language_tag:null!==(t=e.lang)&&void 0!==t?t:null,is_mobile:(0,a.Fr)(),session_id:(0,a.eJ)(),platform:(0,f.uo)()}}getGuiEventFromDomEvent(e){const t=null==e?void 0:e.currentTarget,i=e instanceof MouseEvent||"click"===(null==e?void 0:e.type)?"mouse":e instanceof KeyboardEvent||["keydown","keyup","keypress"].includes((null==e?void 0:e.type)||"")?"key":void 0,n=(null==t?void 0:t.dataset.testId)||(null==t?void 0:t.dataset.testid)||void 0;let a=(null==t?void 0:t.getAttribute("aria-label"))||(null==t?void 0:t.textContent)||void 0;return a&&a.length>125&&(a=`${a.slice(0,125)} [...]`),{interaction_source:i,test_id:n,label:a}}}},33183:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Analytics:()=>o,BaseAppAnalyticsModule:()=>r.H,default:()=>d,useAnalytics:()=>s.s});var n=i(77201),a=i(97800);class o extends n.nV{constructor(){super(...arguments),this.name="analytics",this.endpoints=[],this.loaded=!1,this.bufferedData=[],this.options={}}async load(e,t,i){this.loaded=!1,Object.assign(this.options,t);for(const t of e)await t.init(this.options,i),this.endpoints.push(t),this.loaded=!0;return this.loaded&&this.flushBufferedData(),this.loaded}setOptions(e){Object.assign(this.options,e),this.endpoints.forEach((t=>{t.setOptions(e)}))}setUser(e){if(e&&e.loggedIn)for(const t of this.endpoints)t.identify(e)}track(e,t,i){return this.loaded?(0,a.cb)(0).then((()=>{this.endpoints.forEach((n=>{n.track(e,t,i)}))})):(this.bufferedData.push({event:e,data:t}),Promise.resolve())}trackAsync(e,t,i){this.loaded?this.endpoints.forEach((n=>{n.trackAsync(e,t,i)})):this.bufferedData.push({event:e,data:t})}trackFeatures(...e){this.options.ab_tests||(this.options.ab_tests=[]);const t=this.options.ab_tests;t.push(...e);const i=new Map(t.map((e=>e.split(":")))),n={ab_tests:Array.from(i,(([e,t])=>`${e}:${t}`))};this.endpoints.forEach((e=>{e.setOptions(n)}))}flushBufferedData(){for(const e of this.bufferedData)this.endpoints.forEach((t=>{t.track(e.event,e.data,e.intercom)}));this.bufferedData.length=0}}var s=i(68375),r=i(51983);const d=o},40409:(e,t,i)=>{"use strict";i.d(t,{v:()=>o,z:()=>a});var n=i(77201);class a extends n.QB{constructor(e,t,i){super(),this.annotationType=e,this.id=t,this.attachmentId=i}}class o extends n.QB{constructor(e,t,i){super(),this.block=i,this.id=t,this.annotationType=e}}},60379:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>x});var n=i(97800),a=i(97084),o=i(52678),s=i(20563);class r{constructor(e){this.blurEnabled=!1,e&&Object.assign(this,e)}}var d,l=i(54882);!function(e){e.USER="user",e.ADMIN="admin"}(d||(d={}));class c{constructor(e){this.loggedIn=!1,this.flags=new Set,this.memberships=[],e&&this.set(e)}set(e){Object.assign(this,e)}getFlags(e=""){if(this.memberships){const e=(0,n.P3)("organization","");for(const t of this.memberships)if(""===e||t.organizationId===e)for(const e of t.flags)this.flags.add(e)}const t=new Set;return this.flags.forEach((i=>{if(0===i.indexOf(e)){const n=i.replace(e,"");t.add(n)}})),t}hasFlag(e,t="showcase"){return this.getFlags().has(`${t}/${e}`)}isOrganizationAdmin(e){const t=this.getMembership(e);return!!(null==t?void 0:t.roles.includes(d.ADMIN))}getMembershipFlags(e){const t=this.getMembership(e);return t?t.flags:[]}getMembership(e){return this.memberships.find((t=>t.organizationId===e))}hasMembershipFlag(e,t){return this.getMembershipFlags(e).includes(t)}getMembershipFeature(e,t){const i=this.getMembership(e);return(null==i?void 0:i.features[t])||!1}hasMembership(e){return this.memberships.some((t=>t.organizationId===e))}}class u{constructor(e){this.features={},e&&Object.assign(this,e)}}var h=i(83375);const m=new n.Vy("user.serializers");function p(e){if(!e)return new c;const t=(e.memberships||[]).map((t=>new u({userId:e.user_sid,organizationId:t.organization_sid,name:t.name,flags:v(t.flags||[]),roles:t.roles||[],features:t.features||{}})));return new c({id:e.user_sid,firstName:e.first_name,lastName:e.last_name,email:e.email,loggedIn:e.is_authenticated,flags:new Set(v(e.flags)),memberships:t})}function v(e,t="26.1.1_webgl-90-g894b4d3f55"){const i=[];for(let n of e){const e=n.match(/^.*\-(\d+(?:\.\d+)*)$/);if(e&&e[1]){if(n=n.replace(/-(\d+(?:\.\d+)*)$/,""),h.h.lt(t,e[1])){m.debug(`Dropping feature flag ${n}, version >= ${e[1]} required`);continue}m.debug(`Enabled versioned feature flag ${n}`)}i.push(n)}return i}var f=i(50380);const g=new n.Vy("ImageBitmapSupport"),y=(0,n.P3)("imageBitmap",null);let w=null;function b(){return"1"===y||(null===w&&function(){if(w=!1,(0,n.gm)()){const e=(0,n.aZ)();e.major<=95&&(g.error(`Firefox/${e.major} issue, Disabling ImageBitmap support, upgrade to 96 for better performance.`),w=!0)}}(),!w&&("createImageBitmap"in window?"0"!==y:"1"===y))}var k=i(68137),S=i(99625),T=i(48086),I=i(3718);class D{constructor(e,t,i,n){this.query=e,this.variables=t,this.response=i,this.anonymous=n}read(e,t,i){return e!==this.query||!!(null==i?void 0:i.anonymous)!=!!this.anonymous||(0,n.E7)(t,this.variables)?Promise.resolve(void 0):Promise.resolve(this.response)}}var N=i(74381),E=i(71224),P=i(95386);const _=new n.Vy("api");const C=class{constructor(e=new a.L3,t=new a.L3,i=window.location.origin,n){this.apiQueue=e,this.storeQueue=t,this.baseUrl=i,this.mdsContext=n,this._configCache={},this._userCache={},this._organizationCache={}}async init(e){this.user=this.getUser(),e&&await this.getConfigs(e)}getOnStoreQueue(e,t={}){return this.get(e,t,this.storeQueue)}get(e,t={},i=this.apiQueue){const{headers:n={}}=t;return t.headers=(0,f.v)(e,n,void 0),i.get(e,t).then((e=>{if(null===e)throw Error("Data from get was null, possibly unparsable JSON");return e}))}getImage(e,t){return this.get(e,Object.assign(Object.assign({},t),{responseType:"image"}))}async getImageBitmap(e,t,i,n={}){if(b()){const a=-1!==e.indexOf("?"),o=e+(a?"&":"?")+"imgopt=1",s=await this.get(o,Object.assign(Object.assign({},n),{responseType:"blob"}));return createImageBitmap(s,0,0,t,i,{imageOrientation:n.flipY?"flipY":"none"})}return this.getImage(e,n)}async getConfigs(e){if(e=e.toLowerCase(),this._configCache[e])return this._configCache[e];let t=P.P.config;if(!t){const i=this.baseUrl+`/api/v2/config/${e}`;try{t=await this.get(i,{responseType:"json"})}catch(e){_.warn(`Failed to load config from ${i}, ignoring`)}}return this._configCache[e]=t||{},t||{}}async getAppKey(e,t){if(""===e||""===t)return null;const i=await this.getConfigs(e);return i.hasOwnProperty(t)?i[t]:null}async getGeoIpLocation(){return(0,l.A)(this.apiQueue)}async modelExists(e,t={ignorePrefetch:!1}){var i,n,a,r,d,l,c;const{ignorePrefetch:u}=t;if(!u){const t=P.P.getQuery("GetModelPrefetch"),r=null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.model;if(!(null==r?void 0:r.id)&&P.P.hasPassword)throw new s._W("Model requires a password");const d=((null==r?void 0:r.views)||[]).find((e=>"matterport.model.composite"===e.type));if(!(new k.e).isAuthenticated()){const t=P.P.modelErrorCode,i=null==r?void 0:r.state;if(t===E.b.MODEL_COMPLIANCE)throw new s.Q8;if(t===E.b.MODEL_DELETED)throw new s.a_;if(!(d||t!==E.b.MODEL_PROCESSING&&i!==N.ve.PROCESSING))throw new s.Wz;if(t===E.b.MODEL_FAILED||i===N.ve.FAILED)throw new s.GI;if(t===E.b.MODEL_ARCHIVED||i===N.ve.INACTIVE)throw new s.X5;if(t===E.b.MODEL_PENDING||i===N.ve.PENDING)throw new s.cC;const l=null===(n=P.P.getQueryErrors("GetModelPrefetch"))||void 0===n?void 0:n.find((e=>{var t;return(null===(t=null==e?void 0:e.path)||void 0===t?void 0:t.length)&&"model"===(null==e?void 0:e.path[0])}));if((null===(a=null==l?void 0:l.extensions)||void 0===a?void 0:a.code)===o.c.NOT_FOUND)throw new s.X6("Model not found (404)");if(r&&(null==r?void 0:r.id)!==e)throw new s.ZT("Access denied (403)")}}const h=await this.modelQuery(e);if(null===(r=h.errors)||void 0===r?void 0:r.length){switch(null===(d=h.errors[0].extensions)||void 0===d?void 0:d.code){case o.c.PASSWORD_REQUIRED:throw new s._W("Access token required (401)");case o.c.NOT_FOUND:throw new s.X6("Model not found (404)");default:throw new s.ZT("Access denied (403)")}}else if((null===(c=null===(l=h.data)||void 0===l?void 0:l.model)||void 0===c?void 0:c.id)!==e)throw new s.ZT("Access denied (403)")}async getOrganization(e){if(e in this._organizationCache)return this._organizationCache[e];const t=`${this.baseUrl}/api/v2/organizations/${e}`,i=await this.get(t,{responseType:"json"}).catch((e=>{_.error(e)}));let n=null;return i&&(n=new r({id:i.sid,name:i.company_name||"",blurEnabled:!!i.manual_blur})),this._organizationCache[e]=n,n}async getUser(e="current"){if(e&&e in this._userCache)return this._userCache[e];const t=`${this.baseUrl}/api/v2/users/${e}`,i=this.get(t,{responseType:"json"}).then((e=>{var t;const i=p(e);return(null===(t=this.mdsContext)||void 0===t?void 0:t.simulateApiOutage)===S.u.TIMEOUT&&(i.loggedIn=!1),i})).catch((e=>(_.error(e),p(void 0))));return this._userCache[e]=i,i}async modelQuery(e){var t;const i=null===(t=this.mdsContext)||void 0===t?void 0:t.sharedCaches,n=new T.t({baseUrl:this.baseUrl,mdsContext:this.mdsContext}),a=await n.query(I.GetModelPolicies,{modelId:e},{prefetchKey:"data.model.policies"}),o=(a.errors||[]).filter((e=>{var t;return 1===(null===(t=e.path)||void 0===t?void 0:t.length)&&"model"===e.path[0]}));return 0===o.length&&i&&(this.modelDetailCache&&i.delete(this.modelDetailCache),this.modelDetailCache=new D(I.GetModelPolicies,{modelId:e},a),i.add(this.modelDetailCache)),{data:a.data,errors:o}}};var A=i(77201);class x extends A.nV{constructor(){super(...arguments),this.name="api-client"}async init(e,t){this.api=await this.initApi(e)}async initApi(e){const t=new C(e.apiQueue,e.storeQueue,e.baseUrl,e.mdsContext);return await t.init(e.preloadConfig),t}getApi(){return this.api}}},29254:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>g});var n=i(77201),a=i(65945),o=i(10389),s=i(29200),r=i(87263),d=i(56147),l=i(17299),c=i(55057),u=i(49953),h=i(70400),m=i(71687),p=function(e,t,i,n){var a,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var r=e.length-1;r>=0;r--)(a=e[r])&&(s=(o<3?a(s):o>3?a(t,i,s):a(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},v=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let f=class extends n.nV{constructor(){super(),this.name="brand",this.data=new s.b}async init(e,t){let i=o.$.MATTERPORT;if(e.enableCostarLogos){const[e,n,a]=await Promise.all([t.market.waitForData(u.L),t.market.waitForData(c.q),t.getModuleBySymbol(m.qL)]),o=e.hasPolicy(r.Qi),s=(0,l.eO)(n.model.externalListings),d=null==s?void 0:s.listingType;d&&o&&(i=d.toLowerCase()),t.broadcast(new h.$j(i)),this.setupCriteoTracking(t,e,a,(0,l.$Y)(n.model.externalListings))}return await this.loadLogos(i),t.market.register(s.b,this.data),super.init(e,t)}async loadLogos(e){this.data.logoWhiteR=(await i(10055)(`./${e}-logo-white-r.svg`)).default,this.data.logoPhraseKey=y[e],e===o.$.MATTERPORT?(this.data.logoBlackR=(await i.e(244).then(i.t.bind(i,40244,17))).default,this.data.logoBlack=(await i.e(6885).then(i.t.bind(i,46885,17))).default,this.data.logoWhite=(await i.e(5443).then(i.t.bind(i,45443,17))).default):(this.data.logoBlackR=this.data.logoWhiteR,this.data.logoBlack=this.data.logoWhiteR,this.data.logoWhite=this.data.logoWhiteR),this.data.iconBlack=(await i.e(1633).then(i.t.bind(i,51633,17))).default,this.data.iconWhite=(await i.e(3167).then(i.t.bind(i,13167,17))).default,this.data.brand=e,this.data.commit()}async setupCriteoTracking(e,t,i,n){var a;if(n){const o=t.hasPolicy(r.ID),s=i.getApi(),d=await s.getGeoIpLocation(),c=await s.getConfigs("showcase"),u="Homes"===n.listingType?c.criteo_campaign_homes_id:c.criteo_campaign_apartments_id;if(o&&"US"===d.country_code&&u&&n.homesPropertyKey){const t=document.referrer||(null===(a=window.top)||void 0===a?void 0:a.location.origin),i=t?new URL(t).origin.replace(/^https?:\/\/(?:www.)?/i,"").toLowerCase():"";await(0,l.R1)(i)||(window.dispatchEvent(new CustomEvent("mp-set-tracking-cookie",{detail:{criteoAppId:u,propertyKey:n.homesPropertyKey,referrer:i}})),e.broadcast(new h.Or(n.homesPropertyKey,n.listingType,n.listingId)))}}}};f=p([(0,a._q)(),v("design:paramtypes",[])],f);const g=f,y={[o.$.MATTERPORT]:d.A.ALT_MATTERPORT_LOGO,[o.$.APARTMENTS]:d.A.ALT_APARTMENTS_LOGO,[o.$.HOMES]:d.A.ALT_HOMES_LOGO,[o.$.LOOPNET]:d.A.ALT_LOOPNET_LOGO}},40739:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>N});var n=i(68909),a=i(25316),o=i(77201),s=i(71687),r=i(94814),d=i(3249),l=i(52885),c=i(40397);var u=i(27960);class h extends u.d{constructor(e="Unhandled Camera Exception"){super(e),this.name="CameraTransitionException"}}class m extends u.d{constructor(e="Cannot move while the camera is already moving"){super(e),this.name="CameraTransitionException"}}var p=i(10459),v=i(13893);class f extends o.QB{constructor(e,t){super(),this.from=t,this.to=e,this.timestamp=Date.now()}}class g extends f{}var y=i(62568),w=i(19968);const b={[v.fl.Instant]:{blackoutTime:0,transitionTime:0},[v.fl.FadeToBlack]:{blackoutTime:y.Ay.camera.transitionBlackoutTime,transitionTime:2*y.Ay.camera.transitionBlackoutTime},[v.fl.Interpolate]:{blackoutTime:0,transitionTime:y.Ay.camera.transitionFadeTime},[v.fl.MoveToBlack]:{blackoutTime:y.Ay.camera.transitionBlackoutTime,transitionTime:y.Ay.camera.transitionFadeTime},[v.fl.OrbitTo]:{blackoutTime:0,transitionTime:y.Ay.camera.transitionFadeTime}};class k{constructor(e,t=()=>{},i=()=>{},a=null){this.data=e,this.broadcast=t,this.startGenerator=i,this.visibleMeshBounds=a,this.transitionSpeed=y.Ay.camera.transitionSpeed,this.baseTransitionTime=y.Ay.camera.baseTransitionTime,this.computeOrbitDistance=()=>{const{pose:e}=this.data;if(this.visibleMeshBounds){const t=new n.Ray(e.position.clone(),e.forward().clone());return this.visibleMeshBounds.computeFocusPoint(t).distanceTo(e.position)/e.fovDistanceScale()}return e.fovCorrectedFocalDistance()}}beginExternalTransition(){const{transition:e}=this.data;e.activeInternal||(e.startTime=Date.now(),e.active=!0,e.promise=new o.iB,e.commit())}endExternalTransition(){var e;const{transition:t}=this.data;t.activeInternal||(t.active=!1,null===(e=t.promise)||void 0===e||e.resolve(),t.commit())}updateCameraPosition(e){const{pose:t}=this.data;t.position.copy(e),t.commit()}updateCameraRotation(e){const{pose:t}=this.data;t.rotation.copy(e),t.commit()}updateCameraProjection(e){const{pose:t}=this.data;t.projection.copy(e),t.commit()}updateCameraFocus(e){const{pose:t}=this.data;t.focalDistance=e,t.commit()}updateCameraPose(e){const{pose:t}=this.data;t.copy(e),t.commit()}setBaseProjection(e){this.data.setBaseProjection(e)}async cancelTransition(){const{transition:e,pose:t}=this.data;if(e.active)return new Promise((i=>{(0,p.q)(t,e.to,!1);const n=Date.now()-e.startTime;e.duration=n,e.progress.stop(1),t.commit(),e.commit();const a=e.onPropertyChanged("active",(e=>{e||(a&&a.cancel(),i())}))}))}updateTransitionSpeed(e){const{transition:t}=this.data;if(t.active){const i=Date.now(),n=i-t.startTime,a=n/e,o=t.progress,s=(o.duration-n)/e+a;t.duration=s,t.startTime=i-a,o.modifyAnimation(o.value,o.endValue,s,o.easing,a),t.commit()}}moveTo(e){const{pose:t,transition:i}=this.data;if(!this.data.canTransition())return o.iB.reject(new m("Tried to start transition while another transition was active"));const n=b[e.transitionType],a=e.pose.rotation,s=e.pose.position,l=null==e.fadeToBlackSubType?v.pw.Full:e.fadeToBlackSubType;let u=e.projection;e.autoOrtho?u=void 0:e.pose.zoom&&(u&&(0,c.Gp)(u)||this.data.isOrtho())&&(u=this.adjustProjectionZoom(u||t.projection.clone(),e.pose.zoom));const p=void 0!==e.blackoutTime?e.blackoutTime:n.blackoutTime,w=e.transitionType,k=e.transitionSpeedMultiplier?1/e.transitionSpeedMultiplier:1;let S=w===v.fl.Instant?0:e.transitionTime;if(void 0===S)if(e.transitionType===v.fl.Interpolate&&s){const e=s.distanceTo(t.position);S=this.baseTransitionTime+Math.log2(1+e)*y.mn*this.transitionSpeed*k}else S=n.transitionTime;const T=this.fromPose(!!e.autoOrtho),I=w===v.fl.OrbitTo?e.targetPhi:void 0,D=w===v.fl.OrbitTo?r.p9:e.easing;this.beginInternalTransition({transitionType:w,transitionTime:S,blackoutTime:p,pose:{position:s,rotation:a},autoOrtho:!!e.autoOrtho,projection:u,easing:D,rotationDelay:e.rotationDelay||0,rotationDuration:e.rotationDuration||1,matrixDelay:e.matrixDelay||0,matrixDuration:e.matrixDuration||1,focalDistance:e.focalDistance||T.focalDistance,targetPhi:I,fadeToBlackSubType:l});const N={position:e.pose.position?e.pose.position.clone():void 0,rotation:e.pose.rotation?e.pose.rotation.clone():void 0,projection:e.projection?e.projection.clone():void 0,focalDistance:e.focalDistance?e.focalDistance:void 0};this.broadcast(new f(N,T));const E=i.promise;if(!E)return o.iB.reject(new h("Expected promise to have been created."));const P=this.progressInternalTransition.bind(this),_=this.shouldProgressInternalTransition.bind(this),C=this.endInternalTransition.bind(this),A=this;return E.notify(0),this.startGenerator((function*(){let t=16;for(t>=i.duration&&(E.notify(.5),yield new o.oN);_(t);){P(t,p);const e=(0,d.qE)(t/i.duration,0,1);E.notify(e),yield new o.oN,t=16+Date.now()-i.startTime}C(e.transitionType),A.data.commit(),E.notify(1),E.resolve(),A.broadcast(new g(N,T))})),E.promise()}beginInternalTransition(e){const{transition:t,pose:i}=this.data,n=e.transitionTime||0;if(t.startTime=Date.now(),t.duration=n,t.active=!0,t.promise=new o.iB,t.activeInternal=!0,t.type=e.transitionType,t.progress.modifyAnimation(0,1,n,e.easing||r.dV),t.rotationDelay=e.rotationDelay||0,t.rotationDuration=e.rotationDuration||1,t.matrixDelay=e.matrixDelay||0,t.matrixDuration=e.matrixDuration||1,t.autoOrtho=!!e.autoOrtho,t.fadeToBlackSubType=e.fadeToBlackSubType||v.pw.Full,e.transitionType===v.fl.FadeToBlack&&(t.blackoutProgress.modifyAnimation(0,1,e.blackoutTime,r.p9),t.fadeToBlackSubType===v.pw.BlackToClear&&t.blackoutProgress.updateAbsolute(e.blackoutTime)),e.transitionType===v.fl.MoveToBlack){const e=500;t.blackoutProgress.modifyAnimation(0,1,n-2*e,r.sP,0,e)}t.from=this.fromPose(!!e.autoOrtho),t.to.position=e.pose.position?e.pose.position.clone():void 0,t.to.rotation=e.pose.rotation?e.pose.rotation.clone():void 0,t.to.projection=e.projection?e.projection.clone():void 0,t.to.focalDistance=e.focalDistance?e.focalDistance:void 0,e.transitionType===v.fl.FadeToBlack&&t.fadeToBlackSubType===v.pw.BlackToClear&&(0,p.q)(t.to,i,!1),null!=e.targetPhi&&(t.orbitStartDistance=this.computeOrbitDistance(),t.orbitTarget=e.targetPhi,t.orbitStartPhi=i.phi(),t.instantOrbit=!(n>0),i.focalDistance=t.orbitStartDistance*i.fovDistanceScale()),t.commit()}progressInternalTransition(e,t){const{transition:i,pose:n}=this.data;if(i.active){if(i.progress.updateAbsolute(e),i.type===v.fl.Interpolate)this.updateInterpolateTransition();else if(i.type===v.fl.FadeToBlack){let a=0;const o=i.duration;i.fadeToBlackSubType===v.pw.Full?e<=t?a=e:((0,p.q)(i.to,n,!1),a=e>=o-t?o-e:t):i.fadeToBlackSubType===v.pw.ClearToBlack?e<=t?a=e:((0,p.q)(i.to,n,!1),a=t):i.fadeToBlackSubType===v.pw.BlackToClear&&(a=e>=o-t?o-e:t),i.blackoutProgress.updateAbsolute(a),i.progress.updateAbsolute(e<=t?0:o)}else if(i.type===v.fl.MoveToBlack){const t=i.blackoutProgress;this.updateInterpolateTransition(),t.updateAbsolute(e-t.delay)}else i.type===v.fl.OrbitTo&&this.updateOrbitToTransition();n.commit(),i.commit()}}endInternalTransition(e){const{transition:t,pose:i}=this.data;e!==v.fl.OrbitTo&&((0,p.q)(t.to,i,!1),t.autoOrtho&&(i.resetProjMatrix(),i.applyPhiBasedFovSquish())),t.type=null,t.active=!1,t.activeInternal=!1,t.progress.stop(1),e!==v.fl.FadeToBlack&&e!==v.fl.MoveToBlack||(t.fadeToBlackSubType===v.pw.ClearToBlack?t.blackoutProgress.stop(1):t.blackoutProgress.stop(0)),i.commit(),t.commit()}updateInterpolateTransition(){const{transition:e,pose:t}=this.data,i=e.from,n=e.to;if(n.position&&i.position&&t.position.copy(i.position).lerp(n.position,e.progress.value),n.focalDistance&&i.focalDistance&&(t.focalDistance=(0,l.C)(i.focalDistance,n.focalDistance,e.progress.value)),n.rotation&&i.rotation){const a=(0,r.jv)(e.progress.easing,e.progress.value,e.progress.elapsed,e.progress.duration*e.rotationDuration,e.rotationDelay);t.rotation.copy(i.rotation).slerp(n.rotation,a)}if(e.autoOrtho)t.resetProjMatrix(),t.applyPhiBasedFovSquish();else if(n.projection&&i.projection){const a=(0,r.jv)(r.p_,e.progress.value,e.progress.elapsed,e.progress.duration*e.matrixDuration,e.matrixDelay);!function(e,t,i,n){const a=n.elements,o=e.elements,s=t.elements;for(let e=0;e<16;e++)a[e]=o[e]*(1-i)+s[e]*i}(i.projection,n.projection,a,t.projection)}}updateOrbitToTransition(){const{transition:e,pose:t}=this.data;if(null!=e.orbitTarget){const i=(0,w.n4)(t,e.orbitTarget,e.orbitStartPhi,e.orbitStartDistance,e.instantOrbit,t);e.progress.updateProgress(i)}}adjustProjectionZoom(e,t){const i=1/t;return e.elements[0]=i/this.data.aspectRatio,e.elements[5]=i,e}fromPose(e=!1){const{pose:t}=this.data;return{position:e?t.fovCorrectedPosition().clone():t.position.clone(),rotation:t.rotation.clone(),projection:t.projection.clone(),focalDistance:e?t.fovCorrectedFocalDistance():t.focalDistance}}shouldProgressInternalTransition(e){const{transition:t}=this.data;return t.type===v.fl.OrbitTo?t.progress.value<1:e<t.duration}}class S{constructor(){}onAccessGranted(e){}onAccessRevoked(e){}}class T{constructor(e,t){this.proxy=e,this.target=t}updateCameraPose(e){this.proxy.activeSession(this)&&this.target.updateCameraPose(e)}beginExternalTransition(){this.proxy.activeSession(this)&&this.target.beginExternalTransition()}endExternalTransition(){this.proxy.activeSession(this)&&this.target.endExternalTransition()}updateCameraPosition(e){this.proxy.activeSession(this)&&this.target.updateCameraPosition(e)}updateCameraRotation(e){this.proxy.activeSession(this)&&this.target.updateCameraRotation(e)}updateCameraFocus(e){this.proxy.activeSession(this)&&this.target.updateCameraFocus(e)}updateCameraProjection(e){this.proxy.activeSession(this)&&this.target.updateCameraProjection(e)}moveTo(e){return this.proxy.activeSession(this)?this.target.moveTo(e):o.iB.resolve()}setBaseProjection(e){this.proxy.activeSession(this)&&this.target.setBaseProjection(e)}async cancelTransition(){if(this.proxy.activeSession(this))return this.target.cancelTransition()}updateTransitionSpeed(e){this.proxy.activeSession(this)&&this.target.updateTransitionSpeed(e)}}class I{constructor(e,t){this.controller=e,this.data=t,this.proxies=[]}get pose(){return this.data.pose}activeSession(e){if(0===this.proxies.length)return!1;return this.proxies[this.proxies.length-1].controller===e}newSession(e){let t=null;if(-1!==this.proxies.findIndex((t=>t.requester===e)))throw new Error("Cannot create two sessions with the same requester");return(0,o.Sh)((()=>{if(!t){if(this.proxies.length>0){const e=this.proxies[this.proxies.length-1];e.requester.onAccessRevoked(e.controller)}t=new T(this,this.controller),this.proxies.push({controller:t,requester:e}),e.onAccessGranted(t)}}),(()=>{if(t){const e=this.proxies.findIndex((e=>e.controller===t));if(-1!==e){const t=this.proxies[e],i=e===this.proxies.length-1;if(i&&t.requester.onAccessRevoked(t.controller),this.proxies.splice(e,1),this.proxies.length>0&&i){const e=this.proxies[this.proxies.length-1];e.requester.onAccessGranted(e.controller)}}}}))}}const D=(e,t)=>new I(e,t);class N extends o.nV{constructor(){super(...arguments),this.name="camera-data",this.cameraDatas=new o.Es,this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion,this.cameraDataInfo=new Map}async init(e,t){let i;t.market.waitForData(a.o).then((e=>{i=e,this.bindings.push(e.onSettingChanged(y.l6,(e=>{for(const t of this.cameraDataInfo.values())t.cameraPoseController.baseTransitionTime=e})))})),t.getModuleBySymbol(s.UN).then((e=>this.visibleMeshBounds=e));const n=await t.getModuleBySymbol(s.Qm),r=t.broadcast.bind(t),d=t.startGenerator.bind(t),{switchableData:l,dataMap:c,bindings:u}=n.manageDataForViewports((e=>{const t=new p.M(e.size.x,e.size.y);this.cameraDatas.set(t.id,t);const a=new k(t,r,d,this.visibleMeshBounds);return i&&(a.baseTransitionTime=i.tryGetSetting(y.l6,y.Ay.camera.baseTransitionTime)),this.cameraDataInfo.set(t.id,{bindings:new o.PF(t.pose.onChanged((()=>{e!==n.viewportManager.defaultViewport&&t.pose.applyToCamera(e.camera)})),e.onChanged((()=>{t.setCameraDimensions(e.size.x,e.size.y)}))),cameraPoseProxy:D(a,t),cameraPoseController:a}),t}));this._cameraData=l,this.viewportCameras=c,this.bindings.push(...u),this.bindings.push(c.onElementChanged({onRemoved:e=>{const t=this.cameraDataInfo.get(e.id);t&&(t.bindings.cancel(),this.cameraDataInfo.delete(e.id)),this.cameraDatas.delete(e.id)}})),this.bindings.push(n.viewportManager.onPropertyChanged("activeViewport",(e=>{for(const[t,i]of this.viewportCameras.entries())i.priority=t===e.id?1:0}))),t.market.register(p.M,this.cameraData)}get cameraData(){return this._cameraData}onUpdate(e){}getCameraDataForViewport(e){const t=e?this.viewportCameras.get(e):this._cameraData.currentObservable;if(!t)throw new Error("No camera data found for viewport");return t}getCameraControllerForData(e=this.cameraData){const t=this.cameraDataInfo.get(e.id);if(!t)throw new Error("No controller for cameraData!");return t.cameraPoseController}getCameraPoseProxyForViewport(e){return this.getInfoForViewport(e).cameraPoseProxy}getCameraControllerForViewport(e){return this.getInfoForViewport(e).cameraPoseController}getInfoForViewport(e){const t=this.getCameraDataForViewport(e),i=this.cameraDataInfo.get(t.id);if(!i)throw new Error("No proxy for viewport!");return i}disableAllCameraControls(){return new o.PF(...Array.from(this.cameraDataInfo.values()).map((e=>e.cameraPoseProxy.newSession(new S))))}resetPitch(){this.eulerCache.setFromQuaternion(this.cameraData.pose.rotation,"YXZ"),this.eulerCache.x=0,this.eulerCache.z=0,this.quaternionCache.setFromEuler(this.eulerCache),this.getController().updateCameraRotation(this.quaternionCache)}setBaseProjection(e){this.cameraData.setBaseProjection(e)}getController(e=this.cameraData){const t=this.cameraDataInfo.get(e.id);if(!t)throw new Error("No controller for camera!");return t.cameraPoseController}}},53084:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>S});var n=i(77201),a=i(97800),o=i(86866),s=i(2812),r=i(71687),d=i(2993),l=i(12837),c=i(81530),u=i(26482),h=i(20968),m=i(71271),p=i(72853);class v{serialize(e){return{image:e.sid}}}const f=new a.Vy("mds-camera-start-store");class g extends h.g{constructor(e){super(e),this.serializer=new v,this.prefetchKey="data.model.image",this.deserializer=new p.S}async read(e){var t,i,n,a;const o={modelId:this.getViewId()},s=await this.query(m.GetModelImage,o,e);let r=null===(i=null===(t=null==s?void 0:s.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.image;if(!r&&o.modelId!==this.getBaseViewId()){o.modelId=this.getBaseViewId();const t=await this.query(m.GetModelImage,o,e);r=null===(a=null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.model)||void 0===a?void 0:a.image}return{image:(null==r?void 0:r.id)||"",snapshot:this.deserializer.deserialize(r)}}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(m.PatchModel,{modelId:t,patch:i}).then((e=>{f.debug(e)}))}async getStartLocationSweeps(){var e,t;const i={modelId:this.getBaseViewId()},n=null===(t=null===(e=(await this.query(m.GetStartLocations,i,{fetchPolicy:"no-cache"})).data)||void 0===e?void 0:e.model)||void 0===t?void 0:t.views,a=[];return n&&n.forEach((e=>{var t,i,n,o;const s=null===(o=null===(n=null===(i=null===(t=e.model)||void 0===t?void 0:t.image)||void 0===i?void 0:i.snapshotLocation)||void 0===n?void 0:n.anchor)||void 0===o?void 0:o.id;s&&a.push({viewId:e.id,sweepId:s})})),a}}var y=i(74328),w=i(78711),b=i(99455),k=i(30517);class S extends n.nV{constructor(){super(...arguments),this.name="camera-start",this.store=null,this.duplicateViewData=new u.G(void 0,new a.fN("",new Date)),this.processData=async e=>{var t,i,n;let o,s;const r=e.image,d=e.snapshot;if(d?(o=this.buildCameraStart(d),s=d.thumbnailUrl):r&&(await this.snapshotDataLoadPromise,o=null!==(t=this.getIconStartPose(r))&&void 0!==t?t:void 0,s=this.getIconThumbnail(r)),o||(o=null!==(i=this.getStartFallback())&&void 0!==i?i:void 0),null===(n=null==o?void 0:o.pano)||void 0===n?void 0:n.uuid){const e=this.sweepData.getSweep(o.pano.uuid);e&&!e.enabled&&(a.Vy.for(this).warn(`Enabled hidden start sweep ${o.pano.uuid}`),e.enabled=!0,e.commit())}this.data.atomic((()=>{this.data.icon=r,s&&this.data.thumb?this.data.thumb.refreshFrom(s):(this.data.thumb=s,s&&(s.onStale=async()=>{var e;await(null===(e=this.store)||void 0===e?void 0:e.refresh())})),this.data.pose.copy(null!=o?o:new u.n)})),this.data.commit()},this.beforeViewDuplicate=async()=>{this.duplicateViewData.copy(this.data,!0)},this.afterViewDuplicate=async()=>{this.data.copy(this.duplicateViewData,!0),this.data.commit(),await this.save()}}async init(e,t){const{readonly:i,baseUrl:o}=e,{market:d}=t,[c,h,m]=await Promise.all([t.getModuleBySymbol(r.T9),d.waitForData(l.A),t.getModuleBySymbol(r.az)]);this.storage=c,this.sweepData=h,this.data=new u.G,this.engine=t,this.snapshotDataLoadPromise=d.waitForData(s.O).then((e=>{this.snapshotsData=e}));const p=y.s.deserialize();if(p){const e=(0,w.d)(p,this.sweepData);(0,w.X)(e,this.sweepData)?(this.data.deepLinkPose=new u.n,this.data.deepLinkPose.copy(e),a.Vy.for(this).debug("Starting Camera Pose",this.data.deepLinkPose)):a.Vy.for(this).error("Invalid start pose",e)}this.store=new g({context:m.layersData.mdsContext,readonly:i,baseUrl:o}),this.store.onNewData(this.processData),await this.store.refresh(),i||this.bindings.push(this.storage.onSave((()=>this.save()),{dataType:n.pe.START_LOCATION})),this.bindings.push(m.registerDuplicateViewHelper({beforeDuplicate:this.beforeViewDuplicate,afterDuplicate:this.afterViewDuplicate})),t.market.register(u.G,this.data),this.startLocationViewData=new k.t,i?t.market.register(k.t,this.startLocationViewData):this.fetchAllStartLocations().then((()=>{t.market.register(k.t,this.startLocationViewData)}))}async updateStartLocationFromSnapshot(e){const t=this.snapshotsData.get(e),i=this.buildCameraStart(t),a=new u.G(t.sid,t.thumbnailUrl,i);this.data.copy(a,!0),this.data.commit(),this.engine.broadcast(new b.F(t.is360)),await this.engine.commandBinder.issueCommand(new c.F({dataTypes:[n.pe.START_LOCATION]}))}setMoveCameraOnViewChange(e){this.data.moveCameraOnViewChange=e,this.data.commit()}async fetchAllStartLocations(){if(this.store){const e=await this.store.getStartLocationSweeps();this.startLocationViewData.setStartLocations(e)}}async save(){const e=this.data.icon;if(!e||!this.store)return void a.Vy.for(this).warn("Unable to save start location");const t=this.snapshotsData.get(e);this.store.update(t).then((()=>{this.fetchAllStartLocations()}))}buildCameraStart(e){const t={mode:e.metadata.cameraMode,camera:{position:e.metadata.cameraPosition,rotation:e.metadata.cameraQuaternion,zoom:e.metadata.orthoZoom},pano:{}};return(0,d.nI)(t.mode)&&(t.pano={uuid:e.metadata.scanId}),t.floorVisibility=e.metadata.floorVisibility,t}defaultCameraStart(e){return{mode:d.N3.Panorama,camera:{position:e.position,rotation:(0,o.V5)(e.rotation),zoom:0},pano:{uuid:e.id}}}getStartFallback(){const e=this.sweepData.getFirstAlignedSweep()||this.sweepData.getFirstSweep();return void 0===e?null:this.defaultCameraStart(e)}getIconStartPose(e){let t=null;return e&&e in this.snapshotsData.collection&&(t=(new u.n).copy(this.buildCameraStart(this.snapshotsData.get(e)))),(0,w.X)(t,this.sweepData)||(t=null),t}getIconThumbnail(e){if(e&&e in this.snapshotsData.collection)return this.snapshotsData.get(e).thumbnailUrl}}},15045:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ResizeProperty:()=>n,default:()=>u});var n,a=i(77201),o=i(52018),s=i(58095),r=i(10459),d=i(37105);class l extends o.t{}!function(e){e.left="left",e.top="top",e.width="width",e.height="height"}(n||(n={}));const c={[n.width]:"width",[n.height]:"height",[n.top]:"top",[n.left]:"left"};class u extends a.nV{constructor(){super(...arguments),this.name="canvas",this.getNewX=()=>0,this.getNewY=()=>0,this.getNewWidth=e=>e.width,this.getNewHeight=e=>e.height,this.activeTransitions=[],this.activeTransitionMap={left:null,top:null,width:null,height:null},this.onResize=e=>{e.propertyName in n&&(this.resolveActiveTransition(e.propertyName),this._canvas.style.transitionDuration=this.stringifyTransitionDurations())},this.onContainerResize=()=>{this.transitionDurations.left=this.transitionDurations.top=this.transitionDurations.width=this.transitionDurations.height="0s",this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition(),this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()}}async init(e,t){if(this.engine=t,!e.container)throw new l;this.container=e.container,this.container.appendChild(e.canvas),this.containerBounds=this.container.getBoundingClientRect(),this._canvas=e.canvas,this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this.transitionDurations={left:"0s",top:"0s",width:"0s",height:"0s",filter:"0.4s"},this._canvas.style.transitionProperty=Object.keys(this.transitionDurations).join(","),this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.updateTransitions(),this.bindings.push(t.subscribe(s.P,this.onContainerResize),this.makeTransitionEndSubscription());for(const e of this.bindings)e.renew();this.canvasBounds=this._canvas.getBoundingClientRect(),this.containerBounds=this.container.getBoundingClientRect(),this.data=new d.p(this.canvasBounds.width,this.canvasBounds.height,this._canvas),t.market.register(d.p,this.data)}async resizeCanvas(e){if(0===e.length)return[];const t=this.engine.market.tryGetData(r.M);return t&&!t.canTransition()&&await t.transition.promise,this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),e.forEach((e=>{const{property:t,setDimension:i,duration:o=0}=e,s=c[t],r=this._canvas.style[s];switch(t){case n.height:this.setHeight(i,o);break;case n.width:this.setWidth(i,o);break;case n.top:this.setY(i,o);break;case n.left:this.setX(i,o)}if(this._canvas.style[s]!==r&&o>0){const e=new a.iB;e.then((()=>{clearTimeout(i)}));const i=setTimeout((()=>{this.resolveActiveTransition(t)}),o+500);this.activeTransitionMap[t]=e,this.activeTransitions.push(t)}})),this.hasActiveTransitions()||(this.canvasBounds=this._canvas.getBoundingClientRect()),this.getTransitionPromise()}makeTransitionEndSubscription(){let e=!1;return{renew:()=>{e||(this.element.addEventListener("transitionend",this.onResize),e=!0)},cancel:()=>{e&&(this.element.removeEventListener("transitionend",this.onResize),e=!1)}}}dispose(e){super.dispose(e)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){const e=this.container.getBoundingClientRect(),t=this.containerHasChanged(e);t&&(this.containerBounds=e,this.updateTransitions()),(t||this.hasActiveTransitions())&&(this.canvasBounds=this._canvas.getBoundingClientRect());const i=this.data.width!==this.width||this.data.height!==this.height,n=this.data.x!==this.x||this.data.y!==this.y;i&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.engine.broadcast(new a.hB(this.width,this.height))),n&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.engine.broadcast(new a.CV(this.x-this.containerBounds.left,this.y-this.containerBounds.top)))}containerHasChanged(e){return e.left!==this.containerBounds.left||e.top!==this.containerBounds.top||e.width!==this.containerBounds.width||e.height!==this.containerBounds.height}setX(e,t=0){this.getNewX="number"==typeof e?()=>e:e,this.transitionDurations.left=`${t}ms`,this.updateTransitions()}setY(e,t=0){this.getNewY="number"==typeof e?()=>e:e,this.transitionDurations.top=`${t}ms`,this.updateTransitions()}setWidth(e,t=0){this.getNewWidth="number"==typeof e?()=>e:e,this.transitionDurations.width=`${t}ms`,this.updateTransitions()}setHeight(e,t=0){this.getNewHeight="number"==typeof e?()=>e:e,this.transitionDurations.height=`${t}ms`,this.updateTransitions()}screenToCanvasPoint(e,t){return{x:e-this.x,y:t-this.y}}getTransitionPromise(){return Promise.all(this.activeTransitions.map((e=>this.activeTransitionMap[e])).filter((e=>!!e)))}updateTransitions(){this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition()}applySize(){this._canvas.style.width=`${this.getNewWidth(this.containerBounds)}px`,this._canvas.style.height=`${this.getNewHeight(this.containerBounds)}px`}applyPosition(){this._canvas.style.left=`${this.getNewX(this.containerBounds)}px`,this._canvas.style.top=`${this.getNewY(this.containerBounds)}px`}stringifyTransitionDurations(){return Object.keys(this.transitionDurations).map((e=>this.transitionDurations[e])).join(",")}resolveActiveTransition(e){this.canvasBounds=this._canvas.getBoundingClientRect();const t=this.activeTransitions.indexOf(e);-1!==t&&this.activeTransitions.splice(t,1);const i=this.activeTransitionMap[e];i&&i.resolve(),this.activeTransitionMap[e]=null,this.transitionDurations[e]="0s"}hasActiveTransitions(){return this.activeTransitions.length>0}}},71927:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var n=i(77201),a=i(58480),o=i(44879),s=i(58095),r=i(43591);class d extends n.nV{constructor(){super(...arguments),this.name="container-data",this.onResize=()=>{const{clientWidth:e,clientHeight:t}=this.data.element;this.data.size={width:e,height:t},this.data.orientation=e>t?o.U.LANDSCAPE:o.U.PORTRAIT,this.data.commit()}}async init(e,t){this.data=new a.G(e.element),t.market.register(a.G,this.data),this.resizeObserver=new r.A(this.onResize),this.resizeObserver.observe(e.element),this.onResize(),this.data.onPropertyChanged("size",(e=>{t.broadcast(new s.P(e.width,e.height))})),this.data.onPropertyChanged("orientation",(e=>{t.broadcast(new s.H(e))}))}dispose(e){e.market.unregister(a.G),this.resizeObserver.disconnect(),super.dispose(e)}}},58095:(e,t,i)=>{"use strict";i.d(t,{H:()=>o,P:()=>a});var n=i(77201);class a extends n.QB{constructor(e,t){super(),this.width=e,this.height=t}}class o extends n.QB{constructor(e){super(),this.orientation=e}}},57503:(e,t,i)=>{"use strict";i.d(t,{C:()=>a,x:()=>o});var n=i(92475);class a extends n.E{constructor(e,t,i,n){super(e),this.pointerCount=t,this.position=Object.assign({},i),this.delta=Object.assign({},n)}}class o extends n.E{constructor(e,t,i,n,a){super(e),this.pointerCount=t,this.position=Object.assign({},i),this.delta=Object.assign({},n),this.timeSinceLastMove=a}}},10589:(e,t,i)=>{"use strict";i.d(t,{K:()=>a,t:()=>o});var n=i(92475);class a extends n.E{constructor(e,t){super(e),this.rotateDelta=t}}class o extends n.E{constructor(e,t,i){super(e),this.rotateDelta=t,this.timeSinceLastMove=i}}},44019:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ne});var n=i(77201),a=i(97800),o=i(90082),s=i(20819),r=i(72268);const d=e=>{const t=r.O[r.m[e]];return"number"==typeof t?t:void 0},l=e=>{const t=r.m[r.O[e]];return"number"==typeof t?t:void 0};var c=i(78079),u=i(2998),h=i(97610),m=i(48539),p=i(46957);class v{constructor(e,t,i,o,s,d){if(this.config=e,this.canvasData=i,this.gutterScrollEnabled=s,this.viewportManger=d,this.handledTouchesAsPointer=0,this.lastTouchEnd=0,this.scrollGutterStart=!1,this.bindings=[],this.activeButtons=r.O.NONE,this.preventDoubleTap=e=>{e.cancelable&&e.timeStamp-this.lastTouchEnd<=v.doubleTapThreshold&&e.preventDefault(),this.lastTouchEnd=e.timeStamp},this.preventMultiTouchGesture=e=>{const t=e.touches&&e.touches.length>1,i="scale"in e&&1!==e.scale;(t||i)&&e.cancelable&&e.preventDefault()},this.onEventCallback=o,window.PointerEvent||this.bindings.push(new n.wo(t,"mousedown",(e=>this.onMouseDown(e))),new n.wo(t,"mouseup",(e=>this.onMouseUp(e))),new n.wo(t,"mousemove",(e=>this.onMouseMove(e))),new n.wo(t,"mouseenter",(e=>this.onMouseEnter(e)))),this.bindings.push(new n.wo(t,"contextmenu",(e=>e.preventDefault())),new n.wo(t,"touchstart",(e=>this.onTouchStart(e))),new n.wo(t,"touchend",(e=>this.onTouchEnd(e))),new n.wo(t,"touchmove",(e=>this.onTouchMove(e))),new n.wo(t,"touchcancel",(e=>this.onTouchEnd(e))),new n.wo(t,"pointerdown",(e=>this.onPointerDown(e))),new n.wo(t,"pointerup",(e=>this.onPointerUp(e))),new n.wo(t,"pointermove",(e=>this.onPointerMove(e))),new n.wo(t,"pointercancel",(e=>this.onPointerUp(e))),new n.wo(t,"pointerenter",(e=>this.onMouseEnter(e)))),(0,a.OF)()||(0,a.J0)()){const e=h.u?{passive:!1}:void 0;this.bindings.push(new n.wo(t,"touchmove",this.preventMultiTouchGesture,e),new n.wo(t,"touchend",this.preventDoubleTap,e))}}dispose(){for(const e of this.bindings)e.cancel();this.bindings.length=0}toggleTouchScrolling(e){this.gutterScrollEnabled=e}onMouseDown(e){e.currentTarget.focus(),this.tryPreventDefault(e);const t=e.button;if((0,a.T)()&&this.isMouseHeld())return;this.activeButtons|=1<<t;const{ndc:i,client:n,viewport:o}=this.getPointerPosition(e,!0);this.onEventCallback(new c.CD(o.id,this.getPointerId(e),i,n,t,!0,u.o.MOUSE,e))}onMouseUp(e){this.tryPreventDefault(e);const t=l(this.activeButtons),i=(0,a.T)()&&null!=t?t:e.button;this.activeButtons&=~(1<<i);const{ndc:n,client:o,viewport:s}=this.getPointerPosition(e,!1);this.onEventCallback(new c.CD(s.id,this.getPointerId(e),n,o,i,!1,u.o.MOUSE,e))}onMouseMove(e){this.tryPreventDefault(e);const{ndc:t,client:i,viewport:n}=this.getPointerPosition(e,!this.activeButtons);this.onEventCallback(new c.$3(n.id,this.getPointerId(e),t,i,this.activeButtons,u.o.MOUSE,e))}onMouseEnter(e){this.checkMissingButtons(e)}isMouseHeld(){return this.activeButtons!==r.O.NONE}checkMissingButtons(e){const t=(0,m.Uk)(e.buttons,r.m.MIDDLE,r.m.SECONDARY),i=(this.activeButtons^t)&~t;for(let t=r.m.PRIMARY;t<r.m.COUNT;++t){const n=d(t);if(n&&(i&n)>0){const{ndc:i,client:n,viewport:a}=this.getPointerPosition(e,!1);this.onEventCallback(new c.CD(a.id,this.getPointerId(e),i,n,t,!1,u.o.MOUSE,e))}}this.activeButtons=t}onTouchStart(e){if(this.scrollGutterStart=this.isScrollGutter(e),e.currentTarget.focus(),this.scrollGutterStart||this.tryPreventDefault(e),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t);if(i){const{ndc:t,client:n,viewport:a}=this.getPointerPosition(i,!0);this.onEventCallback(new c.CD(a.id,i.identifier,t,n,r.m.PRIMARY,!0,u.o.TOUCH,e))}}}onTouchEnd(e){if(this.scrollGutterStart?this.scrollGutterStart=!1:this.tryPreventDefault(e),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t);if(i){const{ndc:t,client:n,viewport:a}=this.getPointerPosition(i,!1);this.onEventCallback(new c.CD(a.id,i.identifier,t,n,r.m.PRIMARY,!1,u.o.TOUCH,e))}}}onTouchMove(e){if(this.scrollGutterStart&&(this.isScrollGutter(e)||(this.scrollGutterStart=!1)),this.scrollGutterStart||this.tryPreventDefault(e),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t);if(i){const{ndc:t,client:n,viewport:a}=this.getPointerPosition(i,!1),o=new c.$3(a.id,i.identifier,t,n,r.O.PRIMARY,u.o.TOUCH,e);this.onEventCallback(o)}}}onPointerDown(e){const{ndc:t,client:i,viewport:n}=this.getPointerPosition(e,!0);switch(this.scrollGutterStart=this.isScrollGutter(e),this.scrollGutterStart||this.tryPreventDefault(e),e.pointerType){case u.o.MOUSE:this.onMouseDown(e);break;case u.o.GAMEPAD:case u.o.TOUCH:++this.handledTouchesAsPointer,this.onEventCallback(new c.CD(n.id,e.pointerId,t,i,r.m.PRIMARY,!0,e.pointerType,e))}}onPointerUp(e){switch(this.scrollGutterStart?this.scrollGutterStart=!1:this.tryPreventDefault(e),e.pointerType){case u.o.MOUSE:this.onMouseUp(e);break;case u.o.GAMEPAD:case u.o.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i,viewport:n}=this.getPointerPosition(e,!1);this.onEventCallback(new c.CD(n.id,e.pointerId,t,i,r.m.PRIMARY,!1,e.pointerType,e))}}onPointerMove(e){switch(this.scrollGutterStart&&(this.isScrollGutter(e)||(this.scrollGutterStart=!1)),this.scrollGutterStart||this.tryPreventDefault(e),e.pointerType){case u.o.MOUSE:-1!==e.button?this.activeButtons<e.buttons?this.onMouseDown(e):this.activeButtons>e.buttons&&this.onMouseUp(e):this.onMouseMove(e);break;case u.o.GAMEPAD:case u.o.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i,viewport:n}=this.getPointerPosition(e,!1);this.onEventCallback(new c.$3(n.id,e.pointerId,t,i,r.O.PRIMARY,e.pointerType,e))}}getPointerId(e){return(0,s.EE)(e)?e.pointerId:0}getPointerPosition(e,t){const{viewport:i,x:n,y:a}=this.viewportManger.getPickPosNDC(e.clientX,e.clientY,t);return{ndc:{x:n,y:a},client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y},viewport:i}}isScrollGutter(e){if(!this.gutterScrollEnabled)return!1;let t;if(!(e instanceof PointerEvent)){if(1!==e.changedTouches.length)return!1;const i=e.changedTouches.item(0);i&&(t=this.getPointerPosition(i,!0).client.x)}else{if(e.pointerType!==u.o.TOUCH)return!1;t=this.getPointerPosition(e,!0).client.x}return null!=t&&(0,p.b)(t,e.currentTarget)}tryPreventDefault(e){if(!e.cancelable)return;(!(e instanceof MouseEvent||e instanceof PointerEvent)||this.config.pointerPreventDefault)&&e.preventDefault()}}v.doubleTapThreshold=300;var f,g=i(71397),y=i(28337),w=i(60043);!function(e){e[e.SEMICOLON=59]="SEMICOLON",e[e.PLUSEQUALS=61]="PLUSEQUALS",e[e.DASHUNDERSCORE=173]="DASHUNDERSCORE"}(f||(f={}));const b=[g.D.TAB,g.D.RETURN,g.D.SPACE,g.D.ESCAPE];class k{constructor(e,t){this.rootNode=e,this.keysDown={},this.bindings=[],this.onEventCallback=t,this.bindHandlers()}dispose(){for(const e of this.bindings)e.cancel();this.bindings.length=0}isKeyHeld(e){return!!this.keysDown[e]}bindHandlers(){const e=this.rootNode;this.bindings.push(new n.wo(e,"focusout",(({relatedTarget:e})=>{e&&e instanceof Node&&this.rootNode.contains(e)||Object.keys(this.keysDown).forEach((e=>this.keysDown[e]=!1))})),new n.wo(e,"keydown",(e=>{if(e.ctrlKey||e.metaKey)return void(this.keysDown[this.translateFirefoxKeys(e.which||e.keyCode)]=!0);b.includes(e.keyCode)||(e.preventDefault(),e.stopPropagation());const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]=!0,this.onEventCallback(new w.k(t,y.$.DOWN,e))})),new n.wo(e,"keyup",(e=>{const t=this.translateFirefoxKeys(e.which||e.keyCode);e.ctrlKey||e.metaKey?this.keysDown[t]=!1:(b.includes(e.keyCode)||(e.preventDefault(),e.stopPropagation()),this.keysDown[t]&&this.onEventCallback(new w.k(t,y.$.PRESSED,e)),this.keysDown[t]=!1,this.onEventCallback(new w.k(t,y.$.UP,e)))})))}translateFirefoxKeys(e){switch(e){case f.SEMICOLON:return g.D.SEMICOLON;case f.PLUSEQUALS:return g.D.PLUSEQUALS;case f.DASHUNDERSCORE:return g.D.DASHUNDERSCORE}return e}}var S,T=i(68909);!function(e){e[e.WAITING=0]="WAITING",e[e.WAITINGTOEXCEEDTHRESHOLD=1]="WAITINGTOEXCEEDTHRESHOLD",e[e.GESTURING=2]="GESTURING"}(S||(S={}));const I=.04;var D=i(31002);class N{constructor(e=.04,t=300){this.dragLimit=e,this.holdLimit=t,this.startPosition=new T.Vector2,this.pointerDelta=new T.Vector2,this.activeButtons=r.O.NONE,this.state=S.WAITING}start(e,t){if(this.state===S.WAITING&&(this.startPosition.copy(t.position),this.startViewportId=e),t.buttons&t.buttons-1){if(this.activeButtons)return this.state=S.GESTURING,new D.Ds(this.startViewportId,t.position,this.activeButtons)}else this.startTime=Date.now(),this.activeButtons=t.buttons,this.state=S.WAITINGTOEXCEEDTHRESHOLD}stop(){let e;if(this.state===S.WAITINGTOEXCEEDTHRESHOLD&&Date.now()-this.startTime<this.holdLimit){const t=l(this.activeButtons);void 0!==t&&(e=new D.rX(this.startViewportId,this.startPosition.add(this.pointerDelta),t),this.pointerDelta.set(0,0))}return this.state=S.WAITING,e}onMove(e){if(this.state===S.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.dragLimit))return this.state=S.GESTURING,new D.Ds(this.startViewportId,e.position,e.buttons)}compareState(e){return e===this.state}}class E{constructor(e=.04,t=500){this.dragLimit=e,this.threshold=t,this.lastClick=null,this.lastClickButton=null,this.lastClickPosition={x:0,y:0}}checkForDoubleClick(e){const t=()=>{this.lastClick=performance.now(),this.lastClickButton=e.button,this.lastClickPosition.x=e.position.x,this.lastClickPosition.y=e.position.y};if(this.lastClick){const i=performance.now()-this.lastClick,n=this.lastClickPosition.x-e.position.x,a=this.lastClickPosition.y-e.position.y,o=n*n+a*a;if(!(i>this.threshold||o>this.dragLimit||e.button!==this.lastClickButton))return this.lastClick=null,new D.wR(e.viewportId,e.position,e.button);t()}else t()}}var P=i(94790);class _{constructor(e,t=.04){this.onEventCallback=e,this.startPosition=new T.Vector2,this.previousPosition=new T.Vector2,this.pointerDelta=new T.Vector2,this.lastPointerMove=Date.now(),this.state=S.WAITING,this.pointerId=0,this.threshold=t,this.device=null}start(e,t){return this.startViewportId=e,this.state===S.WAITING&&(this.startPosition.copy(t.position),this.previousPosition.copy(this.startPosition),this.pointerDelta.set(0,0),this.state=S.WAITINGTOEXCEEDTHRESHOLD,this.device=t.device,this.pointerId=t.id,this.pointer=t),new P.SK(e,t.position,t.buttons,t.device,!!t.ctrlKey,t.id)}stop(){const e=(new T.Vector2).copy(this.previousPosition).sub(this.startPosition);this.state===S.GESTURING&&this.onEventCallback(new P.Ve(this.startViewportId,this.previousPosition,this.startPosition,e,this.pointer)),this.state===S.WAITING&&this.pointerDelta.set(0,0),this.state=S.WAITING;const t=Date.now()-this.lastPointerMove,i=this.device;if(this.device=null,i)return new P._w(this.startViewportId,this.previousPosition,this.pointerDelta,r.O.NONE,t,e,i,this.pointerId)}onMove(e){let t;return this.state===S.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.threshold&&(this.state=S.GESTURING,this.onEventCallback(new P.Qm(this.startViewportId,this.startPosition,e)))),this.state===S.GESTURING&&(this.pointerDelta.copy(e.position).sub(this.previousPosition),this.device=e.device,this.pointerDelta.length()>0&&(t=new P.jF(this.startViewportId,this.previousPosition,this.pointerDelta,e.buttons,e.clientPosition,e.device,e.id))),this.previousPosition.copy(e.position),this.lastPointerMove=Date.now(),t}compareState(e){return e===this.state}compareStartPoint(e){return e.equals(this.startPosition)}compareDelta(e){return e.equals(this.pointerDelta)}}var C=i(92475);class A extends C.E{constructor(e,t){super(e),this.scrollY=t}}class x{constructor(e,t,i=3){this.gutterScrollEnabled=e,this.canvas=t,this.threshold=i,this.state=S.WAITING}toggleTouchScrolling(e){this.gutterScrollEnabled=e}start(e,t){this.gutterScrollEnabled&&(this.startViewportId=e,(0,p.b)(t.clientPosition.x,this.canvas)&&this.state===S.WAITING&&(this.startPosition=Object.assign({},t.clientPosition),this.previousY=t.clientPosition.y,this.state=S.WAITINGTOEXCEEDTHRESHOLD))}stop(){this.gutterScrollEnabled&&(this.state=S.WAITING)}onMove(e){if(!this.gutterScrollEnabled)return;const{x:t,y:i}=e.clientPosition,n=(0,p.b)(t,this.canvas);if(n&&this.state===S.WAITINGTOEXCEEDTHRESHOLD){const e=Math.abs(t-this.startPosition.x),n=Math.abs(i-this.startPosition.y);n>e&&n>this.threshold&&(this.state=S.GESTURING)}const a=i-this.previousY;if(this.previousY=i-a,n&&this.state===S.GESTURING)return new A(this.startViewportId,-a);!n&&[S.GESTURING,S.WAITINGTOEXCEEDTHRESHOLD].includes(this.state)&&(this.state=S.WAITING)}}var V=i(20014);class M{constructor(e=new T.Vector2,t=new T.Vector2,i=0){this.lastPosition=e,this.velocity=t,this.samePositionTicks=i}start(e){this.lastPosition.copy(e),this.velocity.set(0,0),this.samePositionTicks=0}update(e){if(this.lastPosition.distanceTo(e)<=.01){if(this.samePositionTicks++,this.samePositionTicks<2)return}else this.samePositionTicks=0;this.velocity.copy(this.lastPosition).sub(e),this.lastPosition.copy(e)}stationary(){return this.samePositionTicks>=2||this.velocity.length()<.01}}const O=2*Math.SQRT2;class L{constructor(e=.04){this.threshold=e,this.startDistance=0,this.previousDistance=0,this.pointerDelta=new T.Vector2,this.lastPointerMove=Date.now(),this.pinchDelta=0,this.state=S.WAITING,this.pointerMovement1=new M,this.pointerMovement2=new M}start(e,t,i){this.state===S.WAITING&&(this.restart(t,i),this.pointerMovement1.start(t.position),this.pointerMovement2.start(i.position),this.startViewportId=e)}stop(){this.state=S.WAITING;const e=Date.now()-this.lastPointerMove;return new V.g(this.startViewportId,this.pinchDelta,e)}onMove(e,t){this.pointerMovement1.update(e.position),this.pointerMovement2.update(t.position);if(!(this.pointerMovement1.stationary()||this.pointerMovement2.stationary()||this.pointerMovement1.velocity.dot(this.pointerMovement2.velocity)<0))return void this.restart(e,t);this.pointerDelta.copy(e.position).sub(t.position);const i=this.pointerDelta.length()/O;if(this.state===S.WAITINGTOEXCEEDTHRESHOLD){const e=i-this.startDistance;Math.abs(e)>this.threshold&&(this.state=S.GESTURING)}let n;if(this.state===S.GESTURING){const e=i-this.previousDistance;Math.abs(e)>0&&(this.pinchDelta=e,n=new V.l(this.startViewportId,e))}return this.previousDistance=i,this.lastPointerMove=Date.now(),n}restart(e,t){this.state=S.WAITINGTOEXCEEDTHRESHOLD,this.startDistance=e.position.distanceTo(t.position)/O,this.previousDistance=this.startDistance}}var R=i(3249),F=i(10589);class B{constructor(e=.1){this.startPointerDelta=new T.Vector2,this.previousPointerDelta=new T.Vector2,this.pointerDelta=new T.Vector2,this.lastPointerMove=Date.now(),this.angleWithDirection=0,this.state=S.WAITING,this.threshold=e}start(e,t,i){this.state===S.WAITING&&(this.state=S.WAITINGTOEXCEEDTHRESHOLD,this.startPointerDelta.copy(t.position).sub(i.position).normalize(),this.pointerDelta.copy(this.startPointerDelta),this.previousPointerDelta.copy(this.pointerDelta),this.startViewportId=e)}stop(){this.state=S.WAITING;const e=Date.now()-this.lastPointerMove;return new F.t(this.startViewportId,this.angleWithDirection,e)}onMove(e,t){if(this.pointerDelta.copy(e.position).sub(t.position).normalize(),this.state===S.WAITINGTOEXCEEDTHRESHOLD){Math.acos((0,R.qE)(this.pointerDelta.dot(this.startPointerDelta),-1,1))>this.threshold&&(this.state=S.GESTURING)}let i;if(this.state===S.GESTURING){const e=Math.acos((0,R.qE)(this.pointerDelta.dot(this.previousPointerDelta),-1,1));if(e>0){const t=this.previousPointerDelta.x*this.pointerDelta.y-this.previousPointerDelta.y*this.pointerDelta.x;this.angleWithDirection=t>=0?e:-e,i=new F.K(this.startViewportId,this.angleWithDirection)}}return this.previousPointerDelta.copy(this.pointerDelta),this.lastPointerMove=Date.now(),i}compareState(e){return e===this.state}}const U=function(e,t){if(t.setLength(0),0===e.length)return t;let i=0;for(const n of e)t.add(n),i++;return t.divideScalar(i),t};var $=i(57503);class j{constructor(e=.04){this.startEpicenter=new T.Vector2,this.previousEpicenter=new T.Vector2,this.deltaEpicenter=new T.Vector2,this.currentEpicenter=new T.Vector2,this.pointerCount=0,this.lastPointerMove=Date.now(),this.state=S.WAITING,this.pointerMovements=[],this.threshold=e}start(e,t){this.state===S.WAITING&&(this.restart(t),this.pointerMovements=t.map((e=>new M)),t.forEach(((e,t)=>{this.pointerMovements[t].start(e.position)})),this.startViewportId=e)}stop(){this.state=S.WAITING;const e=this.pointerCount;this.pointerCount=0;const t=Date.now()-this.lastPointerMove;return new $.x(this.startViewportId,e,this.currentEpicenter,this.deltaEpicenter,t)}onMove(e){U(this.getPointerPositions(e),this.currentEpicenter),e.forEach(((e,t)=>{this.pointerMovements[t].update(e.position)}));if(this.pointerMovements.find((e=>e.stationary())))return void this.restart(e);const t=this.pointerMovements[0].velocity;if(this.pointerMovements.find((e=>t.dot(e.velocity)<0)))return void this.restart(e);if(this.state===S.WAITINGTOEXCEEDTHRESHOLD){this.currentEpicenter.distanceTo(this.startEpicenter)>this.threshold&&(this.state=S.GESTURING)}let i;return this.state===S.GESTURING&&(this.deltaEpicenter.copy(this.currentEpicenter).sub(this.previousEpicenter),i=new $.C(this.startViewportId,e.length,this.currentEpicenter,this.deltaEpicenter)),this.previousEpicenter.copy(this.currentEpicenter),this.lastPointerMove=Date.now(),i}getPointerPositions(e){return e.map((e=>e.position))}restart(e){U(this.getPointerPositions(e),this.startEpicenter),this.previousEpicenter.copy(this.startEpicenter),this.currentEpicenter.copy(this.previousEpicenter),this.state=S.WAITINGTOEXCEEDTHRESHOLD,this.pointerCount=e.length}}var G=i(44667),z=i(18633);const H=new a.Vy("longpress");var q;!function(e){e[e.IDLE=0]="IDLE",e[e.WAITING=1]="WAITING",e[e.STARTED=2]="STARTED",e[e.SUCCESSFUL=3]="SUCCESSFUL"}(q||(q={}));class W{constructor(e,t=300,i=500,n=.1){this.onEventCallback=e,this.startThreshold=t,this.confirmThreshold=i,this.dragThreshold=n,this.state=q.IDLE,this.ndcStartPosition=new T.Vector2,this.pointerDelta=new T.Vector2,this.ndcPosition=new T.Vector2,this.clientPosition=new T.Vector2}start(e,t){this.state!==q.IDLE&&this.stop(),this.state===q.IDLE&&(t.buttons&t.buttons-1||(this.ndcStartPosition.copy(t.position),this.state=q.WAITING,this.buttons=t.buttons,this.pointerDelta.set(0,0),this.ndcPosition.copy(t.position),this.clientPosition.copy(t.clientPosition),this.startViewportId=e,this.holdTimeout=window.setTimeout((()=>{this.state=q.STARTED,H.debug("STARTED"),this.startTime=Date.now(),this.progress(0),this.onEventCallback(new z.OR(e,t.position,t.clientPosition,t.buttons)),this.successTimeout=window.setTimeout((()=>{H.debug("SUCCESSFUL"),this.state=q.SUCCESSFUL,this.progress(1),this.onEventCallback(new z.Zl(e,this.ndcPosition,this.clientPosition,this.buttons))}),this.confirmThreshold)}),this.startThreshold)))}stop(){const e=this.state;if(this.state=q.IDLE,window.clearTimeout(this.holdTimeout),window.clearTimeout(this.successTimeout),e>q.WAITING){H.debug("DONE, cancelled:",e<q.SUCCESSFUL);const t=e<q.SUCCESSFUL;this.onEventCallback(new z.vp(this.startViewportId,this.ndcPosition,this.clientPosition,t))}}onMove(e){const t=this.state===q.STARTED||this.state===q.WAITING,i=this.state===q.STARTED||this.state===q.SUCCESSFUL;(t||i)&&(this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.pointerDelta.copy(this.ndcPosition).sub(this.ndcStartPosition)),t&&this.pointerDelta.length()>this.dragThreshold?this.stop():i&&this.onEventCallback(new z.v3(this.startViewportId,this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons))}tick(){if(this.state===q.STARTED){const e=(Date.now()-this.startTime)/this.confirmThreshold;this.progress(Math.min(1,e))}}progress(e){this.onEventCallback(new z.v0(this.startViewportId,this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons,e))}}var K=i(92598);class X{constructor(){this.displayTouches=!1,this.touches=new Map}init(e){e.registerMenuButton({header:"Input",buttonName:"Toggle pointer visualization",callback:()=>{this.displayTouches=!this.displayTouches}})}addPointer(e,t){this.displayTouches&&(this.touches.set(e,this.createPointer(t)),this.movePointer(e,t))}removePointer(e){const t=this.touches.get(e);t&&(document.body.removeChild(t),this.touches.delete(e))}movePointer(e,t){const i=this.touches.get(e);i&&(i.style.left=t.x-25+"px",i.style.top=t.y-25+"px")}createPointer(e){const t=document.createElement("div");return t.style.position="fixed",t.style.backgroundColor="#aa11aa",t.style.width="50px",t.style.height="50px",t.style.zIndex="99999",t.style.pointerEvents="none",t.style.touchAction="none",t.style.borderRadius="50px",document.body.appendChild(t),t}}var Y;!function(e){e[e.NONE=0]="NONE",e[e.CLICK_DRAG_LONGPRESS=1]="CLICK_DRAG_LONGPRESS",e[e.PINCH_ROTATE=2]="PINCH_ROTATE",e[e.MULTI_SWIPE_ONLY=3]="MULTI_SWIPE_ONLY"}(Y||(Y={}));class Q{constructor(){this.activeGesture=Y.NONE,this.pointers=[],this.couldBeClick=!1,this.isScrolling=!1,this.inputDebug=new X,this.bindings=[],this.config={}}async init(e,t,i,n,o){this.config=e,this.onEventCallback=t,this.viewportManager=i,this.clicker=new N(e.dragThreshold,e.holdThreshold),this.doubleClicker=new E(e.dragThreshold,e.doubleClickThreshold),this.longPress=new W(t,e.holdThreshold,e.longPressThreshold,e.longPressDragThreshold),this.dragger=new _(t,e.dragThreshold),this.pincher=new L(e.pinchThreshold),this.rotater=new B(e.rotateThreshold),this.multiswiper=new j(e.dragThreshold);const s=(0,a.al)()&&(0,a.C8)();this.scroller=new x(s,n.element,e.scrollThreshold),e.disableWheel||this.bindWheelHandlers(n.element),this.inputDebug.init(o)}dispose(){for(const e of this.bindings)null==e||e.cancel();this.bindings=[]}setDragThreshold(e){var t;const i=null!==(t=null!=e?e:this.config.dragThreshold)&&void 0!==t?t:I;this.dragger.threshold=i,this.clicker.dragLimit=i,this.doubleClicker.dragLimit=i}get activePointers(){return this.pointers.length}onPointerChange(e){this.isMoveEvent(e)?this.onPointerMove(e):this.onPointerButton(e)}toggleTouchScrolling(e){this.scroller.toggleTouchScrolling(e)}isMoveEvent(e){return!e.hasOwnProperty("down")}onPointerMove(e){this.movePointer(e),this.inputDebug.movePointer(e.id,e.clientPosition)}onPointerButton(e){e.down?(this.addPointer(e),this.inputDebug.addPointer(e.id,e.clientPosition)):(this.removePointer(e),this.inputDebug.removePointer(e.id))}bindWheelHandlers(e){this.bindings.push(new n.wo(e,"wheel",(t=>{if((0,a.al)()&&(0,p.b)(t.clientX,e))return;t.preventDefault();const{viewport:i}=this.viewportManager.getPickPosNDC(t.clientX,t.clientY,!0);this.onEventCallback(new G.s(i.id,{x:t.clientX,y:t.clientY},{x:this.normalizeWheelDelta(t.deltaMode,t.deltaX),y:this.normalizeWheelDelta(t.deltaMode,t.deltaY)}))})))}normalizeWheelDelta(e,t){if(e===WheelEvent.DOM_DELTA_LINE){return.7*t*t*t+13*t}return t}addPointer(e){const{id:t,button:i,position:n,clientPosition:a,device:o}=e,s=d(i);if(!s)return;const r=this.getPointer(t);r?(r.buttons|=s,r.activeButtons=(0,m.gr)(r.buttons),r.device=o):this.pointers.push({id:t,position:new T.Vector2(n.x,n.y),clientPosition:new T.Vector2(a.x,a.y),buttons:s,activeButtons:1,device:o,ctrlKey:e.nativeEvent.ctrlKey}),this.toggleGestures(e)}removePointer(e){const{id:t,button:i}=e,n=d(i);if(!n)return;const a=this.getPointerIndex(t);if(-1!==a){const t=this.pointers[a];t.buttons&n&&(t.buttons&=~n,t.activeButtons--),t.activeButtons||this.pointers.splice(a,1),this.toggleGestures(e)}}movePointer(e){const{id:t,position:i,clientPosition:n,buttons:a}=e,o=this.getPointer(t);if(o)switch(o.position.copy(i),o.clientPosition.copy(n),o.buttons!==a?this.updateOffscreenPointer(o,e):this.onEventCallback(new K.H(e.viewportId,this.pointers)),this.activeGesture){case Y.CLICK_DRAG_LONGPRESS:const e=this.scroller.onMove(o);this.isScrolling=!!e;const t=this.clicker.onMove(o);t&&this.onEventCallback(t);const i=this.dragger.onMove(o);i&&!this.isScrolling&&this.onEventCallback(i),this.longPress.onMove(o);break;case Y.PINCH_ROTATE:const n=this.pincher.onMove(this.pointers[0],this.pointers[1]),a=this.rotater.onMove(this.pointers[0],this.pointers[1]);n&&this.onEventCallback(n),a&&this.onEventCallback(a);case Y.MULTI_SWIPE_ONLY:const s=this.multiswiper.onMove(this.pointers);s&&this.onEventCallback(s)}}getPointer(e){const t=this.getPointerIndex(e);if(-1!==t)return this.pointers[t]}toggleGestures(e){this.onEventCallback(new K.H(e.viewportId,this.pointers));const t=this.activeGesture;if(this.activeGesture=this.pointers.length,t===Y.CLICK_DRAG_LONGPRESS&&this.activeGesture===Y.NONE&&this.couldBeClick){const e=this.clicker.stop();if(e&&!this.isScrolling){this.onEventCallback(e);const t=this.doubleClicker.checkForDoubleClick(e);t&&this.onEventCallback(t)}}if(this.couldBeClick=t===Y.NONE&&this.activeGesture===Y.CLICK_DRAG_LONGPRESS,this.activeGesture!==Y.CLICK_DRAG_LONGPRESS||t!==Y.NONE&&t!==Y.CLICK_DRAG_LONGPRESS){if(t===Y.CLICK_DRAG_LONGPRESS){const e=this.dragger.stop();this.scroller.stop(),this.isScrolling=!1,this.longPress.stop(),e&&this.onEventCallback(e)}}else{const t=this.clicker.start(e.viewportId,this.pointers[0]);if(t&&this.onEventCallback(t),!e.defaultPrevented){this.scroller.start(e.viewportId,this.pointers[0]);const t=this.dragger.start(e.viewportId,this.pointers[0]);t&&this.onEventCallback(t),this.longPress.start(e.viewportId,this.pointers[0])}}this.activeGesture===Y.PINCH_ROTATE?(this.pincher.start(e.viewportId,this.pointers[0],this.pointers[1]),this.rotater.start(e.viewportId,this.pointers[0],this.pointers[1]),this.multiswiper.start(e.viewportId,this.pointers)):t===Y.PINCH_ROTATE&&(this.onEventCallback(this.pincher.stop()),this.onEventCallback(this.rotater.stop()),this.onEventCallback(this.multiswiper.stop())),this.activeGesture===Y.MULTI_SWIPE_ONLY?this.multiswiper.start(e.viewportId,this.pointers):t===Y.MULTI_SWIPE_ONLY&&this.onEventCallback(this.multiswiper.stop())}getPointerIndex(e){for(let t=0;t<this.pointers.length;t++){if(this.pointers[t].id===e)return t}return-1}updateOffscreenPointer(e,t){if(e.buttons=t.buttons,0===t.buttons){const i=this.getPointerIndex(e.id);this.pointers.splice(i,1),this.toggleGestures(t)}}tick(){this.longPress.tick()}}var J=i(81544),Z=i(71687),ee=i(9360);class te{constructor(e){this.equalsFn=e,this.list=[],this.map=new Map}add(e){const t=this.equalsFn(e);return this.map.has(t)||(this.list.push(e),this.map.set(t,this.list.length-1)),this}getBy(e){const t=this.map.get(e);return null!=t?this.list[t]:null}delete(e){const t=this.equalsFn(e),i=this.map.get(t),n=null!=i;return n&&(this.list.splice(i,1),this.map.delete(t)),n}clear(){this.map.clear(),this.list=[]}get size(){return this.list.length}asList(){return this.list.slice()}*[Symbol.iterator](){yield*this.list}getByIndex(e){return this.list[e]}}class ie{constructor(e,t,i){this._renew=e,this._cancel=t,this.active=i}renew(){this.active()||this._renew()}cancel(){this.active()&&this._cancel()}}class ne extends n.nV{constructor(){super(...arguments),this.name="input-ini",this.fallbackHandlerMap={},this.meshHandlerMap={},this.priorityHandlerMap={},this.unfilteredHandlerMap={},this.captureHandlerMap={},this.gesturing=!1,this.gestureCapture=new te((e=>e.object)),this.activeIntersections=new te((e=>e.object)),this.eventTypeLookup=new a.b0,this.meshTypeLookup=new a.b0,this.enabled=!0,this.hoveredMesh={object:null,instanceId:void 0,index:void 0},this.registerUnfilteredHandler=(e,t)=>{this.insertHandler(e,this.unfilteredHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e);return new ie((()=>this.registerUnfilteredHandler(e,t)),(()=>this.unregisterUnfilteredHandler(e,t)),(()=>-1!==this.unfilteredHandlerMap[i].indexOf(t)))},this.registerMesh=(e,t,i)=>{this.raycaster.targets.addTarget(e,t,i)},this.unregisterMesh=e=>{this.raycaster.targets.removeTarget(e)},this.onPointerEvent=e=>{if(!this.enabled)return;const t=!e.hasOwnProperty("down"),i=!t&&e.down,n=!i&&!t;this.raycaster.pointer.updatePointer(e.position),this.activeIntersections.clear();for(const e of this.raycaster.pointer.cast())this.activeIntersections.add(e);if(t||i){if(!this.gesturing){this.gestureCapture.clear();for(const e of this.activeIntersections)this.gestureCapture.add(e);this.updateHoveredMesh(e)}i&&(this.gesturing=!0),this.onEvent(e)}n&&this.onEvent(e),this.inputGesture.onPointerChange(e),0===this.inputGesture.activePointers&&(this.activeIntersections.clear(),this.gestureCapture.clear(),this.gesturing&&this.updateHoveredMesh(e),this.gesturing=!1)},this.onEvent=e=>{if(!this.enabled)return;const t=this.eventTypeLookup.getKeyByInstance(e),i=this.captureHandlerMap[t];if(i&&i.length>0){for(const t of i)t(e);return void(i.length=0)}const n=this.unfilteredHandlerMap[t];if(n)for(const t of n)t(e);const a=this.iterateMeshCallbacks(e,this.gesturing?this.gestureCapture:this.activeIntersections),o=this.fallbackHandlerMap[t];if(!a&&o)for(const t of o)t(e)}}async init(e,t){const i=(0,a.al)()&&(0,a.C8)();this.bindings.push(t.commandBinder.addBinding(ee.RK,(async()=>{i&&(this.inputGesture.toggleTouchScrolling(!0),this.inputPointer.toggleTouchScrolling(!0))})),t.commandBinder.addBinding(ee.WH,(async()=>{i&&(this.inputGesture.toggleTouchScrolling(!1),this.inputPointer.toggleTouchScrolling(!1))})),t.commandBinder.addBinding(ee.TY,(async()=>{this.setEnabled(!0)})),t.commandBinder.addBinding(ee.q$,(async()=>{this.setEnabled(!1)})));const[n,s,r]=await Promise.all([t.getModuleBySymbol(Z.CE),t.getModuleBySymbol(o.ZF),t.getModuleBySymbol(Z.Qm)]);this.viewportManager=r.viewportManager,this.raycaster=await t.getModuleBySymbol(Z.sA),this.inputPointer=new v({pointerPreventDefault:e.pointerPreventDefault},n.element,n.data,this.onPointerEvent,i,this.viewportManager),this.keyboardState=new k(e.rootNode,this.onEvent),this.inputGesture=new Q,this.inputGesture.init(e,this.onEvent,this.viewportManager,n,s)}setEnabled(e){this.enabled=e}overrideDragThreshold(e){this.inputGesture.setDragThreshold(e)}dispose(e){super.dispose(e),this.inputPointer.dispose(),this.keyboardState.dispose(),this.inputGesture.dispose()}registerHandler(e,t){this.insertHandler(e,this.fallbackHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e,!0);return new ie((()=>this.registerHandler(e,t)),(()=>this.unregisterHandler(e,t)),(()=>-1!==this.fallbackHandlerMap[i].indexOf(t)))}unregisterHandler(e,t){this.removeHandler(e,this.fallbackHandlerMap,t)}registerMeshHandler(e,t,i,n){return this._registerMeshHandler(e,{comparator:t,callback:i,default:null==n?void 0:n.default})}_registerMeshHandler(e,t){var i;const n=this.eventTypeLookup.getKeyByType(e,!0);this.meshHandlerMap[n]||(this.meshHandlerMap[n]=[]);const a=this.meshHandlerMap[n];let o=a.length;if(!t.default)for(;null===(i=a[o-1])||void 0===i?void 0:i.default;)o--;return a.splice(o,0,t),new ie((()=>this._registerMeshHandler(e,t)),(()=>this.unregisterMeshHandler(e,t)),(()=>-1!==a.indexOf(t)))}unregisterMeshHandler(e,t){const i=this.eventTypeLookup.getKeyByType(e,!0);if(this.meshHandlerMap[i]){const e=this.meshHandlerMap[i],n=e.indexOf(t);n>-1&&e.splice(n,1)}}registerPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0),o=this.meshTypeLookup.getKeyByType(t,!0);this.priorityHandlerMap[n]||(this.priorityHandlerMap[n]={});const s=this.priorityHandlerMap[n];if(s[o]){const i=(0,a.Uz)(e),n=(0,a.Uz)(t);throw Error(`${i} already has a priority handler registered for mesh type: ${n}`)}return s[o]=i,new ie((()=>this.registerPriorityHandler(e,t,i)),(()=>this.unregisterPriorityHandler(e,t,i)),(()=>void 0!==s[o]))}unregisterPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e),a=this.priorityHandlerMap[n];if(a){const e=this.meshTypeLookup.getKeyByType(t),n=a[e];n&&i===n&&delete a[e]}}unregisterUnfilteredHandler(e,t){this.removeHandler(e,this.unfilteredHandlerMap,t)}captureNext(e,t){return this.insertHandler(e,this.captureHandlerMap,t),t}removeCaptureHandler(e,t){this.removeHandler(e,this.captureHandlerMap,t)}registerSnappingMeshGeometry(e,t,i,n){this.raycaster.snapping.addMeshGeometry(e,t,i,n)}unregisterSnappingMeshGeometry(e){this.raycaster.snapping.removeMeshGeometry(e)}getCurrentPointerRay(){return this.raycaster.pointer.pointerRay.clone()}getCurrentRayHits(){return this.activeIntersections.asList()}updateHoveredMesh(e){const t=this.activeIntersections.getByIndex(0),i=t&&t.object===this.hoveredMesh.object&&t.instanceId===this.hoveredMesh.instanceId&&t.index===this.hoveredMesh.index;let n=!1;if(this.hoveredMesh.object&&(void 0===t||!i)){const i=this.getMeshHandler(J.q,(0,a.Pw)(this.hoveredMesh.object),this.priorityHandlerMap);if(i&&(n=i(new J.q(e.nativeEvent),this.hoveredMesh.object,t)||!1),!n){const i=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(J.q)];if(i)for(const n of i)n.comparator.compare(this.hoveredMesh.object)&&n.callback(new J.q(e.nativeEvent),this.hoveredMesh.object,t)}}let o=!1;if(t&&!i){const i=this.getMeshHandler(J.L,(0,a.Pw)(t.object),this.priorityHandlerMap);if(i&&(o=i(new J.L(e.nativeEvent),t.object,t)||!1),!o){const i=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(J.L)];if(i)for(const n of i)n.comparator.compare(t.object)&&n.callback(new J.L(e.nativeEvent),t.object,t)}}this.hoveredMesh.object=t&&t.object||null,this.hoveredMesh.instanceId=null==t?void 0:t.instanceId,this.hoveredMesh.index=null==t?void 0:t.index}iterateMeshCallbacks(e,t){let i=!1;const n=this.eventTypeLookup.getKeyByInstance(e);for(let a=0;a<t.size;a++){const o=t.getByIndex(a);if(!o)continue;if(i)break;const s=o.object,r=this.activeIntersections.getBy(s)||o;for(const t in this.priorityHandlerMap[n])if(o.object instanceof this.meshTypeLookup.getTypeByKey(t)){const a=this.priorityHandlerMap[n]&&this.priorityHandlerMap[n][t];if(a&&(i=!0,a(e,s,r)||e.propagationStopped))return!0}const d=this.meshHandlerMap[n];if(d)for(const t of d)if(t.comparator.compare(s)&&(!t.default||!e.defaultPrevented)){const n=t.callback(e,s,r);(n||void 0===n||e.propagationStopped)&&(i=!0)}}return i}insertHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0);t[n]||(t[n]=[]),t[n].push(i)}removeHandler(e,t,i){const n=t[this.eventTypeLookup.getKeyByType(e)];if(n)for(let e=0;e<n.length;e++)if(n[e]===i){n.splice(e,1);break}}getMeshHandler(e,t,i){const n=i[this.eventTypeLookup.getKeyByType(e)];if(n){return n[this.meshTypeLookup.getKeyByType(t)]}return null}onUpdate(){this.inputGesture.tick()}}},86515:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LayersModule:()=>W,default:()=>K});var n=i(77201),a=i(97800),o=i(71687),s=i(49953),r=i(25316),d=i(99625),l=i(24790),c=i(74381),u=i(85204),h=i(62876),m=i(8427),p=i(78115),v=i(47004),f=i(52018);class g extends f.t{constructor(e,t="80001"){super(e),this.name="LayersViewError",this.code=t}}var y=i(28577),w=i(56547),b=i(93877),k=i(25095),S=i(47737),T=i(96276),I=i(20968),D=i(57186),N=i(43066),E=i(33012),P=i(68909),_=i(86866),C=i(81587);const A=new a.Vy("composite-views");var x;!function(e){e.COMPARE="compare",e.EXTERIOR="exterior",e.PROJECT="project",e.SITE="site"}(x||(x={}));class V{validate(e){const t=null==e?void 0:e.compositeViews;return!!t&&Array.isArray(t)&&t.every((e=>Array.isArray(e.connections)&&null!=e.id&&null!=e.name))}deserialize(e){var t;const i=null==e?void 0:e.compositeViews;return i&&e.state?{compositeViews:i.map((e=>this.deserializeCompositeView(e))),state:e.state}:(A.debug("Deserialized invalid composite layer data from MDS",i),{state:null!==(t=null==e?void 0:e.state)&&void 0!==t?t:"failed",compositeViews:[]})}deserializeCompositeView(e){return{id:e.id,name:e.name,connections:this.deserializeConnections(e),layers:this.deserializeLayers(e),mode:this.deserializeMode(e.mode)}}deserializeLayers(e){return(e.layers||[]).map((e=>({layer:{id:null==e?void 0:e.layer.id,type:null==e?void 0:e.layer.type,label:(null==e?void 0:e.layer.label)||""},sources:((null==e?void 0:e.sources)||[]).map((e=>{var t,i,n;return{view:{id:null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.id,type:null===(i=null==e?void 0:e.view)||void 0===i?void 0:i.type},layer:{id:null===(n=null==e?void 0:e.layer)||void 0===n?void 0:n.id}}}))}))).filter((e=>e.layer&&null!=e.layer.type))}deserializeConnections(e){return(e.connections||[]).map((e=>{var t,i,n,o,s,r,d,l;const c=(null===(t=null==e?void 0:e.model)||void 0===t?void 0:t.name)||`Connection ${e.sequence}`,u=null!==(o=null===(n=null===(i=e.model)||void 0===i?void 0:i.image)||void 0===n?void 0:n.thumbnailUrl)&&void 0!==o?o:"",h=(0,C.X)(null===(r=null===(s=e.model)||void 0===s?void 0:s.image)||void 0===r?void 0:r.validUntil,null);return{model:{id:null===(d=e.model)||void 0===d?void 0:d.id,name:c,imageUrl:new a.fN(u,null!=h?h:null)},index:e.sequence,visible:e.visible,locked:e.locked,transform:{position:_.U$.fromVisionVector(e.position.translation),rotation:_.U$.fromVisionQuaternion(e.position.rotation),scale:null!==(l=e.position.scale)&&void 0!==l?l:new P.Vector3(1,1,1)}}})).filter((e=>null!=e.model.id)).sort(((e,t)=>e.index-t.index))}deserializeMode(e){switch(e){case"compare":return x.COMPARE;case"project":default:return x.PROJECT;case"site":return x.SITE;case"exterior":return x.EXTERIOR}}}class M extends I.g{async read(e){var t,i;const n=null!==(t=null==e?void 0:e.modelId)&&void 0!==t?t:this.getViewId(),a=await this.query(E.GetCompositeViews,{modelId:n});return(new V).deserialize(null===(i=a.data)||void 0===i?void 0:i.model)}async refresh(e){return super.refresh(Object.assign({fetchPolicy:"no-cache"},e))}async readCompositeView(e){var t,i;const n=await this.query(E.GetCompositeView,{compositeViewId:e});return(null===(t=n.data)||void 0===t?void 0:t.view)&&null!==(i=(new V).deserializeCompositeView(n.data.view))&&void 0!==i?i:null}async addCompositeView(e,t,i){var n,a,o;return null!==(o=null===(a=null===(n=(await this.mutate(E.AddCompositeView,{modelId:e,name:t,mode:i})).data)||void 0===n?void 0:n.view)||void 0===a?void 0:a.id)&&void 0!==o?o:null}async addConnection(e,t,i){var n,a,o,s;return null!==(s=null===(o=null===(a=null===(n=(await this.mutate(E.AddConnection,Object.assign({compositeViewId:e,sourceModelId:t},i),{fetchPolicy:"no-cache"})).data)||void 0===n?void 0:n.view)||void 0===a?void 0:a.connection)||void 0===o?void 0:o.id)&&void 0!==s?s:null}async patchConnection(e,t,i){await this.mutate(E.PatchConnection,Object.assign({compositeViewId:e,sourceModelId:t},i),{fetchPolicy:"no-cache"})}async deleteConnection(e,t){await this.mutate(E.DeleteConnection,{compositeViewId:e,sourceModelId:t},{fetchPolicy:"no-cache"})}async update(e){return await this.mutate(E.UpdateCompositeViewMode,{viewId:this.getViewId(),mode:e.mode})}}const O=new a.Vy("MdsModelViewStore");class L extends I.g{constructor(e){super(e),this.prefetchKey=l.l9,this.deserializer=new D.K}async read(e){var t,i,n,a,o,s;const r=null!==(t=null==e?void 0:e.modelId)&&void 0!==t?t:this.viewId;if(!r)throw new T.V("Cannot read Views, no initial view configured");const d=await this.query(N.GetViews,{modelId:r},e).catch((e=>{throw new T.tW(e)}));let l=null;(null!==(a=null===(n=null===(i=d.data)||void 0===i?void 0:i.model)||void 0===n?void 0:n.views)&&void 0!==a?a:[]).find((e=>e.type.startsWith("matterport.model.composite")))&&(l=await this.readCompositeViews(r));const c=null===(s=null===(o=d.data)||void 0===o?void 0:o.model)||void 0===s?void 0:s.views,u=[];if(c)for(const e of c){const t=this.deserializer.deserialize(e,null==l?void 0:l.compositeViews.find((t=>t.id===e.id)));t&&u.push(t)}return u.sort(((e,t)=>e.created.getTime()-t.created.getTime())),u}async readCompositeViews(e){return await new M(this.config).read({modelId:e})}async readView(e){var t,i,n,o,s;const r=await this.query(N.GetView,{viewId:e},{prefetchKey:void 0}).catch((e=>{throw new T.tW(e)})),d=null===(i=null===(t=r.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.views;if(!d||1!==d.length)throw a.Vy.for(this).error(d),new T.V("GetView failed");const l=d[0];let c;if(l.type.startsWith("matterport.model.composite")){c=null!==(n=(await this.readCompositeViews(l.id)).compositeViews.find((e=>e.id===l.id)))&&void 0!==n?n:void 0}const u=this.deserializer.deserialize(l,c);if(!u)throw new T.V("Cannot read view");return function(e,t){return e.name=t&&""===e.name?t:e.name,e}(u,null===(s=null===(o=r.data)||void 0===o?void 0:o.model)||void 0===s?void 0:s.name)}async create(e){const t=this.getBaseViewId();return this.mutate(N.AddUserView,{modelId:t,name:e}).then((e=>{var t;return this.deserializer.deserialize(null===(t=e.data)||void 0===t?void 0:t.addView)}))}async delete(e,t){var i;const n=this.getBaseViewId();if(e===n)throw new T.V("Cannot delete the base view");const a=!!(null===(i=(await this.mutate(N.DeleteView,{modelId:n,viewId:e,deleteLayersIfOrphaned:t})).data)||void 0===i?void 0:i.deleteView);return a||O.error("View deletion failed!"),a}async moveItemsToLayer(e,t,i){var n;const a=!!(null===(n=(await this.mutate(N.MoveViewDataToLayer,{viewId:e,layerId:t,viewSelections:i})).data)||void 0===n?void 0:n.moveViewData);return a||O.error("MoveViewDataToLayer failed!"),a}async deleteItemsFromView(e,t){var i;if(t.find((e=>!e.ids||0===e.ids.length)))return O.error("deleteItemsFromView fails without list of ids"),!1;const n=!!(null===(i=(await this.mutate(N.DeleteFromView,{viewId:e,viewSelections:t})).data)||void 0===i?void 0:i.deleteFromView);return n||O.error("DeleteFromView failed!"),n}async rename(e,t){var i,n;const a=null===(n=null===(i=(await this.mutate(N.RenameView,{viewId:e,name:t})).data)||void 0===i?void 0:i.patchView)||void 0===n?void 0:n.name;if(null==a)throw new T.YA("Unable to rename view!");return a}async setEnabled(e,t){var i,n;const a=null===(n=null===(i=(await this.mutate(N.SetViewEnabled,{viewId:e,enabled:t})).data)||void 0===i?void 0:i.patchView)||void 0===n?void 0:n.enabled;if(null==a)throw new T.YA("Unable to enable/disable view!");return a}async convertModelToLayered(e){var t;const i=null===(t=(await this.mutate(N.ConvertRootViewToLayered,{modelId:e})).data)||void 0===t?void 0:t.convertRootViewToLayered;if(null==i)throw new T.YA("Unable to convert model to layered!");const n=this.deserializer.deserialize(i);if(!n)throw new T.V("Cannot read converted view");return n}async convertModelToLegacy(e){var t;const i=null===(t=(await this.mutate(N.ConvertRootViewToLegacy,{modelId:e})).data)||void 0===t?void 0:t.convertRootViewToLegacy;if(null==i)throw new T.YA("Unable to convert model to legacy!");const n=this.deserializer.deserialize(i);if(!n)throw new T.V("Cannot read converted view");return n}async duplicate(e,t,i,n){var a;const o=await this.mutate(N.DuplicateView,{modelId:e,viewId:t,name:i,enabled:n});return this.deserializer.deserialize(null===(a=o.data)||void 0===a?void 0:a.addView)}async hasWorkshopChanges(e){var t,i,n;const a=null===(n=null===(i=null===(t=(await this.client.query(N.GetMergeDiff,{viewId:e}).catch((e=>{throw new T.tW(e)}))).data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.mergeDiff)||void 0===n?void 0:n.typesModified;return!!a&&a.length>0}}var R=i(92646),F=i(56707),B=i(86867);const U=new a.Vy("MdsDataLayerStore");class $ extends I.g{constructor(e,t){super(e),this.getCompositeView=t,this.deserializer=new F.F,this.prefetchKey="data.view.layers"}async read(){return this.readLayersForView(this.getViewId())}async readLayersForView(e,t=!0){var i,n;const a={viewId:e,modelId:e},o={prefetchKey:t?this.prefetchKey:void 0,fetchPolicy:t?"cache-first":"no-cache"},s=null===(n=null===(i=(await this.query(R.GetLayers,a,o).catch((e=>{throw new T.tW(e)}))).data)||void 0===i?void 0:i.view)||void 0===n?void 0:n.layers;if(!s)throw new Error("No layers to read for view!");const r=[];for(const t of s){const i=this.deserializer.deserialize(t,e,this.getCompositeView(e));i&&r.push(i)}return r}async readLayersForModel(e,t=[],i=!1){var n,a;const o={types:t,modelId:e,includeUnassociated:i},s=null===(a=null===(n=(await this.query(R.GetAllLayers,o,{fetchPolicy:"no-cache"}).catch((e=>{throw new T.tW(e)}))).data)||void 0===n?void 0:n.model)||void 0===a?void 0:a.layers;if(!s)throw new Error(`No layers to read from model ${e}`);const r=[];for(const t of s){const i=[],n=t.views;if(n)for(const t of n){const n=this.deserializer.deserialize(t,e,this.getCompositeView(e));n&&i.push(n)}r.push({type:(0,B.U)(b.ku,t.type)?t.type:b.ku.OTHER,id:t.id,views:i})}return r}async addLayer(e,t,i,n,a=!0){var o,s;const r={viewId:this.getViewId(),label:e,writable:t,position:i,copyDataFrom:n,generateIds:a},d=null===(s=null===(o=(await this.mutate(R.AddLayer,r).catch((e=>{throw new T.YA(e)}))).data)||void 0===o?void 0:o.layer)||void 0===s?void 0:s.id;if(!d)throw new Error("Unable to get id for new layer");return d}async addCommonLayer(e,t){var i,n;const a={viewId:this.getViewId(),label:e,position:t},o=null===(n=null===(i=(await this.mutate(R.AddCommonLayer,a).catch((e=>{throw new T.YA(e)}))).data)||void 0===i?void 0:i.layer)||void 0===n?void 0:n.id;if(!o)throw new Error("Unable to get id for new common layer");return await this.refresh(),o}async duplicateLayer(e,t,i,n=null,a=null){var o,s;const r={viewId:this.getViewId(),label:e,visible:t,copyDataFrom:i,translation:n,rotation:null===a?a:{x:a.x,y:a.y,z:a.z,w:a.w}},d=null===(s=null===(o=(await this.mutate(R.DuplicateLayer,r).catch((e=>{throw new T.YA(e)}))).data)||void 0===o?void 0:o.layer)||void 0===s?void 0:s.id;if(!d)throw new Error("Unable to duplicate layer");return await this.refresh(),d}async copyItemsToLayer(e,t,i,n=null,a=null){var o;const s=!!(null===(o=(await this.mutate(R.CopyViewDataToLayer,{viewId:e,layerId:t,copyDataFrom:i,translation:n,rotation:null===a?a:{x:a.x,y:a.y,z:a.z,w:a.w}})).data)||void 0===o?void 0:o.copyViewData);return s||U.error("CopyViewData failed!"),s}async convertLayerToCommon(e,t,i){var n,a;const o={viewId:this.getViewId(),layerId:e,visible:t,position:i};if(!(null===(a=null===(n=(await this.mutate(R.ConvertToCommonLayer,o).catch((e=>{throw new T.YA(e)}))).data)||void 0===n?void 0:n.convertToCommonLayer)||void 0===a?void 0:a.id))throw new Error("Unable to convert layer to common");await this.refresh()}async convertLayerToDedicated(e){var t,i;const n={viewId:this.getViewId(),layerId:e};if(!(null===(i=null===(t=(await this.mutate(R.ConvertToDedicatedLayer,n).catch((e=>{throw new T.YA(e)}))).data)||void 0===t?void 0:t.convertToDedicatedLayer)||void 0===i?void 0:i.id))throw new Error("Unable to convert layer to dedicated");await this.refresh()}async patchLayer(e,t,i,n,a){var o,s;const r={viewId:this.getViewId(),layerId:e,layerLabel:t,writable:i,position:n,visible:a};if(!(null===(s=null===(o=(await this.mutate(R.PatchLayer,r).catch((e=>{throw new T.YA(e)}))).data)||void 0===o?void 0:o.patchLayer)||void 0===s?void 0:s.id))throw new Error("No data returned by patch");null===i&&null===n&&null===a||await this.refresh()}async patchLayerViews(e,t,i,n){var a,o;const s=t.map((e=>({viewId:e,visible:i,remove:n}))),r={viewId:this.getViewId(),layerId:e,views:s};if(!(null===(o=null===(a=(await this.mutate(R.PatchLayerViews,r).catch((e=>{throw new T.YA(e)}))).data)||void 0===a?void 0:a.patchLayerViews)||void 0===o?void 0:o.id))throw new Error("No data returned by patchLayerViews");await this.refresh()}async deleteLayer(e){const t={viewId:this.getViewId(),layerId:e};await this.mutate(R.DeleteLayer,t).catch((e=>{throw new T.YA(e)}))}async removeLayer(e,t=this.getViewId(),i=!1){const n={viewId:t,layerId:e,deleteIfOrphaned:i};await this.mutate(R.RemoveLayer,n).catch((e=>{throw new T.YA(e)}))}async convertToProxiedLayering(){const e={modelId:this.getBaseViewId()};await this.mutate(R.ConvertToProxiedLayering,e)}}var j=i(47840),G=i(9026),z=i(81530);const H=[c.jM.LABEL,c.jM.MEASUREMENTPATH,c.jM.MATTERTAG,c.jM.NOTE,c.jM.OBJECTANNOTATION];var q=i(25712);class W extends n.nV{constructor(){super(...arguments),this.name="layers",this.viewChangeConfirmers=[],this.duplicateHelpers=new Set,this.initialViewDataLoad=!0,this.viewHistory=[],this.onHistoryPop=()=>{if(this.data.getCurrentView().viewType===b.jK.SESSION)return;const e=(0,a.DE)(),t=e.get("m")||e.get("model");t&&t!==this.data.currentViewId&&this.setActiveModelView(t)},this.renameView=this.modifyInsideSaveCommand("view_only",(async(e,t)=>{const i=this.data.getView(e);if(!i)throw new g("View does not exist");if(!this.data.validateViewName(t))throw new g("Invalid view name!");const n=await this.viewStore.rename(e,t);i.name=n,i.commit()})),this.setViewEnabled=this.modifyInsideSaveCommand("view_only",(async(e,t)=>{const i=this.data.getView(e);if(!i)throw new g("View does not exist");if(!this.data.canDisableView(e))throw new g("Unable to enable/disable view");const n=await this.viewStore.setEnabled(e,t);i.enabled=n,i.commit()})),this.duplicateView=this.modifyInsideSaveCommand("view_only",(async(e,t)=>{const i=this.data.getView(e);if(!i)throw new g("Cannot duplicate, view does not exist");if(!this.data.canDuplicateView(e))throw new g("Duplicate not supported on this view");const n=Array.from(this.duplicateHelpers.keys());await Promise.all(n.map((e=>e.beforeDuplicate())));const a=await this.viewStore.duplicate(this.data.getBaseModelId(),e,t,i.enabled);if(!a)throw new g("Unable to duplicate view!");this.data.addView(a),await this.setActiveModelView(a.id),await Promise.all(n.map((e=>e.afterDuplicate())))})),this.addLayer=this.modifyInsideSaveCommand("views_and_layers",(async(e,t,i=[])=>this.addLayerWorker(e,t,i))),this.duplicateLayer=this.modifyInsideSaveCommand("views_and_layers",(async(e,t)=>{const i=this.data.getLayer(e);if(!i)throw new g("Unable to find layer to duplicate");const n=i.layerType===b.ku.BASE_LAYER,o=i.layerType===b.ku.VIEW_DATA_LAYER;if(n||o)return void a.Vy.for(this).debug("Duplicate not supported on base or view layer");const s=this.getLayerTypesToDuplicate(),r=this.data.getCurrentView().id,d=s.map((t=>({viewId:r,layerId:e,type:t})));await this.layerStore.duplicateLayer(t,i.visible,d)&&this.data.mdsContext.refreshLayeredStores(s)})),this.renameLayer=this.modifyInsideSaveCommand("views_and_layers",(async(e,t)=>{const i=this.data.getLayer(e);if(!i)throw new g("Unable to find layer to rename");await this.layerStore.patchLayer(e,t,null,null,null),i.name=t,i.commit()})),this.deleteLayer=this.modifyInsideSaveCommand("views_and_layers",(async e=>{const t=this.data.getLayer(e);if(!t||this.data.inMemoryLayers.includes(t))throw new g("Unable to find layer to delete");await this.layerStore.deleteLayer(e),this.refreshView(this.data.getCurrentView())})),this.removeLayer=this.modifyInsideSaveCommand("views_and_layers",(async(e,t,i)=>{await this.layerStore.removeLayer(e,t,i);const n=t?this.data.getView(t):this.data.getCurrentView();this.refreshView(n)})),this.patchLayerViews=this.modifyInsideSaveCommand("views_and_layers",(async(e,t,i,n)=>{if(await this.layerStore.patchLayerViews(e,t,i,n),t.length>0)for(const e of t){const t=this.data.getView(e);this.refreshView(t)}else this.refreshView(this.data.getCurrentView())})),this.toggleLayerAsCommon=this.modifyInsideSaveCommand("views_and_layers",(async(e,t)=>{const i=this.data.getLayer(e);if(!i)throw new g("Unable to find layer to toggle common");t?await this.layerStore.convertLayerToCommon(e,i.visible,0):await this.layerStore.convertLayerToDedicated(e)})),this.toggleLayerVisible=this.modifyInsideSaveCommand("views_and_layers",(async(e,t)=>{const i=this.data.getLayer(e);if(!i)throw new g("Unable to find layer to toggle visibility");if(i.layerType===b.ku.COMMON_USER_LAYER){const i=this.data.getOrderedModelViews({includeInsights:!0}).map((e=>e.id));await this.layerStore.patchLayerViews(e,i,t)}else await this.layerStore.patchLayer(e,null,null,null,t)})),this.copyItemsToLayer=this.modifyInsideSaveCommand("views_and_layers",(async(e,t)=>{await this.copyItemsToLayerWorker(e,t)})),this.copyItemsToNewLayer=this.modifyInsideSaveCommand("views_and_layers",(async(e,t)=>{await this.copyItemsToLayerWorker(e,null,t)})),this.moveItemsToLayer=this.modifyInsideSaveCommand("views_and_layers",(async(e,t)=>{const{currentViewId:i}=this.data,n={},a=[];e.forEach((e=>{if(e.supportsLayeredCopyMove()){n[e.typeId]||(n[e.typeId]=[]);const t=e.parentId||e.id;n[e.typeId].push(t),a.push(e)}}));const o=[];for(const e in n)o.push({type:e,ids:n[e],all:!1});await this.viewStore.moveItemsToLayer(i,t,o)&&(this.data.mdsContext.refreshLayeredStores(o.map((e=>e.type))),this.engine.broadcast(new p.NX(a)))})),this.deleteItemsFromView=this.modifyInsideSaveCommand("views_and_layers",(async e=>{if(!this.data.canBatchDeleteInActiveView())return void a.Vy.for(this).debug("Cannot batch delete items in non-layered model");const{currentViewId:t}=this.data,i={},n=[];e.forEach((e=>{if(e.supportsBatchDelete()){i[e.typeId]||(i[e.typeId]=[]);const t=e.parentId||e.id;i[e.typeId].push(t),n.push(e)}}));const o=[];for(const e in i)o.push({type:e,ids:i[e]});await this.viewStore.deleteItemsFromView(t,o)&&(this.data.mdsContext.refreshLayeredStores(o.map((e=>e.type))),this.engine.broadcast(new p.NX(n)))})),this.layerModelAndUpdate=this.modifyInsideSaveCommand("view_only",(()=>{let e;return async()=>{e||(e=new Promise((async e=>{const t=this.data.getBaseModelView();if(t&&!(0,w.r0)(t)){const e=await this.viewStore.convertModelToLayered(t.id),i=await this.layerStore.readLayersForView(this.data.getBaseModelId(),!1);this.updateViewDetails(t,e),t.layers.replace(i)}e()}))),await e}})()),this.checkForProxyLayer=this.modifyInsideSaveCommand("none",(async()=>{if(this.data.isWorkshopSessionView())throw new Error("Workshop session view not supported!");const e=this.data.getBaseModelView();if(!e)return;if(!this.data.getProxyLayerId()){await this.layerStore.convertToProxiedLayering();const t=await this.layerStore.readLayersForView(this.data.getBaseModelId(),!1);if(!e)throw new Error("Expected base view when converting to proxied layer!!");e.layers.replace(t);const i=this.data.getCurrentView();if(i!==e){const e=await this.layerStore.readLayersForView(i.id,!1);i.layers.replace(e)}}}))}async init(e,t){var i;const{baseUrl:n,readonly:o,viewId:d,mdsContext:c}=e,{market:u}=t,[h,p]=await Promise.all([t.market.waitForData(r.o),t.market.waitForData(s.L)]);this.settingsData=h,this.config=e,this.viewStore=new L({context:c,readonly:o,baseUrl:n,viewId:d}),this.engine=t;const v=await this.loadViews(e),f=v.find((e=>e.id===d))||a.Vy.for(this).debugWarn(`Initial view ${d} not found in views`)||new k.j({id:d});this.data=this.layersData=new S.P(c,f).setViews(v),a.Vy.for(this).debug("Loaded views",v);const g=await this.getInitialViewId(),w=g===(null===(i=this.data.getWorkshopSessionView())||void 0===i?void 0:i.id),T=(0,y.Tl)(p),I=!w&&this.isViewsPolicyEnabled(T);this.setViewsFeatureSetting(I);const D=!w&&this.isDataLayersPolicyEnabled(T);this.setLayersFeatureSetting(D),c.baseViewId=this.data.getBaseModelId(),this.viewStore.onNewData((async e=>{var t,i;if(e)for(const n of e){const e=null===(t=this.layersData.tryGetView(n.id))||void 0===t?void 0:t.connections;if(e){const t=n.compositeView;for(const n of e){const e=null===(i=null==t?void 0:t.connections)||void 0===i?void 0:i.find((e=>e.model.id===n.model.id));e&&n.model.imageUrl.refreshFrom(e.model.imageUrl)}}}})),(0,a._z)(v,(async()=>{this.viewStore.refresh()})),this.layerStore=new $({context:c,readonly:o,baseUrl:n},(e=>{var t;return null===(t=this.data.tryGetView(e))||void 0===t?void 0:t.compositeView})),D&&this.layerStore.onNewData((async e=>{const t=e.filter((e=>e.layerType!==b.ku.WORKSHOP)).sort(((e,t)=>e.position-t.position));if(!t.length)throw new Error("No layers available!!");const i=this.data.getCurrentView(),n=i.layers.filter((e=>e.isInMemory));for(const e of n)t.push(e);i.layers.replace(t);const a=this.data.activeLayerId;if(!a||!t.find((e=>e.id===a))){const e=this.data.filterUserFacingLayers(t);this.data.setActiveCurrentLayer(e[0].id)}})),c.autoProvisionLayerCheckCallback=async e=>{this.data.getLayer(e)||await this.layerStore.refresh()},await this.setActiveModelView(g),this.updateMdsContext(),D||(this.data.setBaseLayerOnly(),this.data.setActiveCurrentLayer(l.qw)),window.addEventListener("popstate",this.onHistoryPop),I&&D&&this.bindings.push(this.data.onPropertyChanged("currentViewId",(()=>this.updateMdsContext()))),u.register(S.P,this.data);let N=this.onInMemoryLayerChanges();this.bindings.push(this.data.onPropertyChanged("currentViewId",(()=>{N&&N.cancel(),N=this.onInMemoryLayerChanges()}))),this.viewHistory.push(this.data.currentViewId),this.bindings.push(this.data.onPropertyChanged("currentViewId",(()=>{this.viewHistory.push(this.data.currentViewId),this.viewHistory.length>2&&this.viewHistory.shift()}))),this.bindings.push(m.q.onTransactionsAdded((async(e,t)=>{this.applyTransactions([e],(()=>t.applyNew()))})))}dispose(e){var t,i;super.dispose(e),null===(t=this.editViewHandlers)||void 0===t||t.cancel(),null===(i=this.editLayerHandlers)||void 0===i||i.cancel(),window.removeEventListener("popstate",this.onHistoryPop)}async getInitialViewId(){const{viewId:e,inWorkshop:t}=this.config,i=this.data.getBaseModelView();if(t&&i&&i.id===e&&!(0,w.r0)(i)){const e=this.data.getWorkshopSessionView();if(e&&e.enabled){if(await this.viewStore.hasWorkshopChanges(e.id))return e.id}}return e}isDataLayersPolicyEnabled(e){return[y.T5.LAYERS_ONLY,y.T5.VIEWS_AND_LAYERS].includes(e)}isViewsPolicyEnabled(e){return[y.T5.VIEWS_OPTIONAL_OPT_IN,y.T5.VIEWS_ENABLED,y.T5.VIEWS_AND_LAYERS].includes(e)}setViewsFeatureSetting(e){this.settingsData.setSetting(y.rX,e),this.engine.getModuleBySymbol(o.aF).then((t=>{t.trackFeatures(`${y.AH}:${e}`)}))}setLayersFeatureSetting(e){this.data.layersEnabled=e,this.data.commit(),this.settingsData.setSetting(y.qD,e),this.engine.getModuleBySymbol(o.aF).then((t=>{t.trackFeatures(`${y.H6}:${e}`)}))}async loadViews({isLoggedIn:e=!1}){const t=e?"no-cache":"cache-first";let i=await this.viewStore.read({fetchPolicy:t});if(!i.find((e=>e.id===this.config.viewId))){const e=await this.engine.getModuleBySymbol(o.qL),{loggedIn:t}=await e.getApi().user;t&&(i=await this.viewStore.read({anonymous:!1,fetchPolicy:"no-cache"}))}return i}async setActiveModelView(e){const{currentViewId:t}=this.data;if(e===t||!await this.canChangeView())return;const i=this.data.getView(e);if(i){const e=t;a.Vy.for(this).debug(`Switching to view: ${i.id} (${i.viewType}), from: ${e}`),this.data.setCurrentView(i.id),await this.refreshView(i,e)}else a.Vy.for(this).warn(`Missing model view '${e}'`)}async toggleDefurnishView(e=!1){var t;const i=this.data.getOrderedModelViews({includeDefurnish:!0,includeDisabled:!1}).filter((e=>(0,w.AF)(e)));i.sort(((e,t)=>e.created<t.created?1:-1));const n=null===(t=i.find((e=>(0,w.AF)(e))))||void 0===t?void 0:t.id;if(!n)return;const a=this.viewHistory.length>=2?this.viewHistory[this.viewHistory.length-2]:void 0;this.engine.broadcast(new p.uU);const o=this.data.currentViewId===n?a||this.data.getBaseModelId():n;try{const t=()=>this.setActiveModelView(o);e?await(async(e,t,i)=>{const n=new Promise((e=>{const n=()=>{i.unsubscribe(t,n),e()};i.subscribe(t,n)})),a=await e();return await n,a})(t,v.A,this.engine):await t()}catch(e){}finally{this.engine.broadcast(new p.Yp)}}async refreshView(e,t){const{mdsContext:i}=this.config;if(e.transient)await i.setViewManually(e.id);else{const n=this.settingsData.tryGetSetting(y.qD,!1),a=new j.B({baseUrl:this.config.baseUrl,prefetchPolicy:d.G.PRELOAD,query:G.GetModelViewPrefetch,variables:{modelId:e.id,includeDisabled:!this.config.readonly,includeLayers:n&&this.viewSupportsLayers(),viewLookup:i.getViewLookupMode({firstLoad:this.initialViewDataLoad})},mdsContext:this.data.mdsContext,anonymous:!this.config.inWorkshop,initialData:void 0});i.sharedCaches.add(a),await a.preload()?(n&&(this.layerStore.setStoreViewId(e.id),await this.layerStore.refresh()),await i.setCurrentViewId(e.id),this.initialViewDataLoad=!1,this.updateBrowserOnViewChange(e),t?(i.sharedCaches.delete(a),this.engine.broadcast(new p.tj)):this.config.modulesLoadedPromise.then((()=>{i.sharedCaches.delete(a)}))):t&&this.data.setCurrentView(t)}await this.applyTransactions(e.layers.map((e=>e.id)),(e=>e.applyTransactions()))}async canChangeView(){for(const e of this.viewChangeConfirmers)if(!await e())return!1;return!0}registerConfirmViewChange(e){this.viewChangeConfirmers.push(e)}registerDuplicateViewHelper(e){return(0,n.Sh)((()=>this.duplicateHelpers.add(e)),(()=>this.duplicateHelpers.delete(e)))}updateBrowserOnViewChange(e){if(e.viewType===b.jK.SESSION)return;const t=(0,a.DE)(),i=t.get("m")||t.get("model");e.id!==i&&(t.has("model")?t.set("model",e.id):t.has("m")&&t.set("m",e.id),(0,a.SS)(t.toString(),!1))}async disableWorkshopSession(){const e=this.data.getWorkshopSessionView();if(!e)return void a.Vy.for(this).debug("No Workshop Session View to disable.");if(!e.enabled)return;const t=await this.viewStore.setEnabled(e.id,!1);e.enabled=t,e.commit()}async addUserView(e,t=!1){if(!this.data.validateViewName(e))throw new g("Invalid view name!");if(t){const t=new k.j({id:(0,q.W0)(k.j.idLength),name:e,viewType:b.jK.USER,rootModelId:this.data.getBaseModelId()},!0);return this.data.addView(t),t.layers.concat(this.data.commonInMemoryLayers),t}return this.modifyInsideSaveCommand("view_only",(async()=>{const t=await this.viewStore.create(e);if(t)return this.data.addView(t),a.Vy.for(this).debug("Added new view"),await this.setActiveModelView(t.id),t.layers.concat(this.data.commonInMemoryLayers),t;throw Error("Unable to create user view")}))()}async deleteView(e){let t=!1;const i=this.data.getView(e);if(!i)throw new g("Cannot delete missing view");i.transient?t=!0:await this.modifyInsideSaveCommand("view_only",(async()=>{if(!this.data.canDeleteView(e))throw new g("Cannot delete model view");const n=!(0,w.V6)(i);t=await this.viewStore.delete(e,n)}))(),t&&this.data.atomic((()=>{const t=e===this.data.currentViewId;if(this.data.deleteView(e),a.Vy.for(this).debug("Deleted user view"),t){const e=this.data.getBaseModelId();if(!e)throw new g("No base view");this.setActiveModelView(e)}}))}async readLayersForModel(e,t,i){return this.layerStore.readLayersForModel(e,t,i)}async selectLayer(e,t){const i=this.data.getViewLayerId(),n=this.data.getBaseLayerId(),a=e===i||e===n,o=i||n;let s;if(t)s=a?o:e;else{if(a)return;s=o}if(!s)throw new g("No Active layer to set");s!==this.data.activeLayerId&&this.data.setActiveCurrentLayer(s)}async addLayerWorker(e,t,i=[]){let n;const a=this.data.getCurrentView();if(a.transient)throw Error("A transient layer can only be added to a transient View");if(n=t?await this.layerStore.addCommonLayer(e,0):await this.layerStore.addLayer(e,!0,0,i),(0,w.XF)(a)&&!(0,w.r0)(a)){const e=await this.viewStore.readView(a.id);this.updateViewDetails(a,e)}return await this.layerStore.refresh(),this.selectLayer(n,!0),this.engine.broadcast(new p.V7(n)),n}async copyItemsToLayerWorker(e,t,i){const{currentViewId:n}=this.data,a={},o=[];e.forEach((e=>{if(e.supportsLayeredCopyMove()){a[e.typeId]||(a[e.typeId]=[]);const t=e.parentId||e.id;a[e.typeId].push(t),o.push(e)}}));const s=[];for(const e in a)s.push({viewId:n,type:e,ids:a[e]});let r;if(t)r=await this.layerStore.copyItemsToLayer(n,t,s);else{if(!i)throw new g("No layer id or name for copy");r=await this.addLayerWorker(i,!1,s)}r&&(this.data.mdsContext.refreshLayeredStores(s.map((e=>e.type))),this.engine.broadcast(new p.NX(o)))}addInMemoryLayer(e){return this.data.addInMemoryLayer(e)}deleteInMemoryLayer(e){if(!this.data.inMemoryLayers.find((t=>t.id===e)))throw new g("Unable to find the in-memory layer to delete");this.data.removeInMemoryLayer(e),this.refreshView(this.data.getCurrentView())}getLayerTypesToDuplicate(){const e=H.slice(),t=(t,i)=>{if(this.settingsData.tryGetSetting(t,!1))return;const n=e.indexOf(i);e.splice(n,1)};return t(u.nc,c.jM.NOTE),t(h._H,c.jM.OBJECTANNOTATION),e}viewSupportsLayers(){return this.data.getCurrentView().viewType!==b.jK.SESSION}updateMdsContext(){const e=this.viewSupportsLayers(),t=this.settingsData.tryGetSetting(y.qD,!1),i=this.data.isCurrentViewLayered();this.data.mdsContext.readLayerId=e;const n=e&&t&&i;this.data.mdsContext.toggleNonBaseLayeredWrites(n)}updateViewDetails(e,t){Object.assign(e,{viewType:t.viewType,rawViewType:t.rawViewType,name:t.name,enabled:t.enabled,modified:t.modified}),e.commit(),this.updateMdsContext()}async convertModelToLayered(){if(this.data.isWorkshopSessionView())return;const e=this.data.getBaseModelView();e&&!(0,w.r0)(e)&&await this.layerModelAndUpdate()}onInMemoryLayerChanges(){const e=this.data.getCurrentView(),t={onAdded:e=>{e.isInMemory&&e.applyTransactions()},onRemoved:t=>{t.isInMemory&&this.refreshView(e)}};return e.layers.onElementChanged(t)}async applyTransactions(e,t){const i=this.layersData.getActiveLayer();for(const i of e){const e=this.layersData.getLayer(i);e&&(this.selectLayer(i,!0),await t(e))}if(i)this.selectLayer(i.id,!0);else{const e=this.layersData.getActiveLayer();e&&e!==i&&this.selectLayer(e.id,!1)}}modifyInsideSaveCommand(e,t){return async(...i)=>{if(this.config.readonly)throw new g("Attempt to modify read-only layers/views.");if("none"!==e){if(!this.settingsData.getSetting(y.rX))throw new g("Views not enabled")}if("views_and_layers"===e&&!this.layersData.layersEnabled)throw new g("Layers not enabled");let a;return await this.engine.commandBinder.issueCommand(new z.F({dataTypes:[n.pe.LAYERS],onCallback:async()=>{a=await t(...i)},skipDirtyUpdate:!0})),a}}async queryView(e){try{return await this.viewStore.readView(e)}catch(t){a.Vy.for(this).error(`${e} failed to load`,t)}return null}}const K=W},45035:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>w});var n=i(96540),a=i(5338),o=i(77201),s=i(74848),r=i(32485),d=i.n(r),l=i(56147);const c=i.p+"images/login-screen-background.jpg";var u=i(17605),h=i(48270);const{INVITED_MESSAGE:m,CREATE_ACCOUNT:p,HAVE_ACCOUNT:v,SIGN_IN:f}=l.A.LOGIN;class g extends n.Component{constructor(e){super(e),this.signup=()=>{window.top&&(window.top.location.href=this.props.registerUrl)}}render(){const{loginUrl:e,backgroundUrl:t,locale:i}=this.props,n=t||c;return(0,s.jsx)("div",{className:"login-redirect-screen",style:{backgroundImage:`url(${n})`},children:(0,s.jsx)("div",{className:d()("login-redirect",{skrim:!!t}),children:(0,s.jsxs)("div",{className:"login-redirect-body",children:[(0,s.jsx)("h1",{className:"login-redirect-title",children:i.t(m)}),(0,s.jsx)("div",{className:"login-redirect-create",children:(0,s.jsx)(u.$,{variant:h.A.PRIMARY,size:"large",theme:"dark",onClick:this.signup,label:i.t(p)})}),(0,s.jsxs)("div",{className:"login-redirect-link",children:[i.t(v),(0,s.jsx)("a",{className:"link",href:e,children:i.t(f)})]})]})})})}}var y=i(71687);class w extends o.nV{constructor(){super(...arguments),this.name="login-redirect"}async init(e,t){this.config=e,this.engine=t}async loadUi(){var e;const{container:t,loginUrl:i,registerUrl:s}=this.config,r=await this.engine.getModuleBySymbol(y.gS),d=encodeURIComponent((null===(e=window.top)||void 0===e?void 0:e.location.href)||"");return this.reactContainer=document.createElement("div"),this.reactContainer.id="login-redirect-container",t.appendChild(this.reactContainer),this.reactRoot=(0,a.createRoot)(this.reactContainer),this.reactRoot.render((0,n.createElement)(g,{locale:r,backgroundUrl:this.getBackground(),loginUrl:`${i}?target=${d}`,registerUrl:`${s}?target=${d}`})),new o.iB}async unloadUi(){return!!this.reactContainer&&(this.reactRoot.unmount(),this.reactContainer.remove(),delete this.reactContainer,!0)}getBackground(){const{baseUrl:e,modelId:t}=this.config;if(!t||!e)return;const i=window.devicePixelRatio||1;return`${e}/api/v1/player/models/${t}/thumb?width=${Math.max(this.config.container.clientWidth,400)}&dpr=${i}&disable=upscale`}}},59906:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>T});var n=i(77201),a=i(97800),o=i(8647),s=i(92637),r=i(79243),d=i(56147),l=i(71687),c=i(85846),u=i(86866),h=i(81587),m=i(14240),p=i(44094);const v=new a.Vy("JsonStoreMeshTrimDeserializer"),f=[{path:["position","x"],type:"number"},{path:["position","y"],type:"number"},{path:["position","z"],type:"number"},{path:["scale","x"],type:"number"},{path:["scale","y"],type:"number"},{path:["scale","z"],type:"number"},{path:["rotation","x"],type:"number"},{path:["rotation","y"],type:"number"},{path:["rotation","z"],type:"number"},{path:["rotation","w"],type:"number"},{path:["index"],type:"number"},{path:["enabled"],type:"boolean"},{path:["meshGroup"],type:"number"},{path:["id"],type:"string"},{path:["created"],type:"string"},{path:["modified"],type:"string"}];class g{constructor(){this.deserialize=e=>{if(!this.isValid(e))return v.debug("Unable to deserialize invalid mesh trim data",e),null;const{position:t,scale:i,rotation:n,index:a,enabled:o,meshGroup:s,created:r,modified:d,id:l,name:c,discardContents:p,activeInPanoMode:f}=e;return new m.e(u.U$.fromVisionVector(t),u.U$.fromVisionVector(i),u.U$.fromVisionSweepQuaternion(n),a,o,s,(0,h.X)(r),(0,h.X)(d),l,c,p,f)}}isValid(e){if(!e||"object"!=typeof e)return!1;const t=e;return(0,p.sw)(t.meshGroup)||(t.meshGroup=t.floorIndex),f.every((t=>this.hasRequiredField(e,t)))}hasRequiredField(e,t){try{return typeof t.path.reduce(((i,n)=>{if("object"==typeof i&&null!==i)return i[n];throw new Error(`data ${JSON.stringify(e)} must be addressable by ${t.path.join(".")} with a value of type ${t.type}`)}),e)===t.type}catch(e){return v.debug(e),!1}}}var y=i(78498);class w{serialize(e){if(!e)return null;const{position:t,scale:i,rotation:n,index:a,enabled:o,meshGroup:s,created:r,modified:d,id:l,name:c,discardContents:m,activeInPanoMode:p}=e;return{position:(0,y.I)(u.U$.toVisionVector(t)),scale:(0,y.I)(u.U$.toVisionVector(i)),rotation:(0,y.p)(u.U$.toVisionSweepQuaternion(n)),index:a,enabled:o,meshGroup:s,created:(0,h.$)(r),modified:(0,h.$)(d),id:l,name:c,discardContents:m,activeInPanoMode:p}}}class b extends c.xO{constructor(e,t,i){const a=new g,o=new w,s=new n.Th({deserializer:a,serializer:o});super({queue:e,path:`${t}/api/v1/jsonstore/model/trims/${i}`,batchUpdate:!0,deserialize:e=>s.deserialize(e),serialize:e=>s.serialize(e)})}}var k=i(67823);const{TRIM:S}=d.A.WORKSHOP;class T extends n.nV{constructor(){super(...arguments),this.name="trim-data",this.dataLoadedPromise=new n.iB,this.load=async()=>{let e={};try{e=await this.store.read()||{}}catch(e){a.Vy.for(this).debug("error when reading from json storage",e)}try{const t=Object.values(e);this.modelMeshModule.meshTrimData.addMeshGroups(t.map((e=>e.meshGroup))),this.modelMeshModule.meshTrimData.add(...t)}catch(e){a.Vy.for(this).debug("error when adding trims from json storage",e)}this.monitor&&this.monitor.removeOnChanged(this.onMeshTrimsChanged),this.monitor=new n.Fy(this.modelMeshModule.meshTrimData.meshTrimsById,{aggregationType:n.DF.Immediate}),this.monitor.onChanged(this.onMeshTrimsChanged),this.dataLoadedPromise.resolve()},this.createMeshTrim=async e=>{this.modelMeshModule.meshTrimData.add(e)},this.deleteMeshTrim=async e=>{this.modelMeshModule.meshTrimData.delete(e)},this.save=async()=>{const e=this.monitor.getDiffRecord();if(this.monitor.clearDiffRecord(),!e.length)return;const t={};for(const i of e)switch(i.action){case n.Xw.added:case n.Xw.updated:const e=this.modelMeshModule.meshTrimData.getTrimById(i.index);e&&!e.transient&&(t[i.index]=e);break;case n.Xw.removed:t[i.index]=null}if(Object.keys(t).length)try{await this.store.update(t)}catch(e){a.Vy.for(this).debug("error when writing to json storage",e);const t=S.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE;this.engine.commandBinder.issueCommand(new s.P(t,{throttle:30,type:o.v.ERROR}))}},this.moveMeshTrimToAllFloors=async e=>{const t=e.enabled;this.deleteMeshTrim(e),e.meshGroup=-1,e.enabled=t,this.createMeshTrim(e)},this.onMeshTrimsChanged=(0,r.n)(this.save,1e3)}get waitForData(){return this.dataLoadedPromise.nativePromise()}async init(e,t){this.engine=t,this.store=new b(e.queue,e.baseUrl,e.baseModelId),this.modelMeshModule=await t.getModuleBySymbol(l.GR),this.load(),this.bindings.push(t.commandBinder.addBinding(k.zZ,this.createMeshTrim),t.commandBinder.addBinding(k.Sc,this.deleteMeshTrim),t.commandBinder.addBinding(k.l0,this.moveMeshTrimToAllFloors))}}},75772:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>G});var n=i(77201),a=i(97800),o=i(90082),s=i(71687),r=i(58687),d=i(47737),l=i(13767),c=i(81530),u=i(20968),h=i(71271),m=i(81587),p=i(83375),v=i(44094),f=i(61430),g=i(52018);class y extends g.t{constructor(e,t){super(e),this.name="ModelLoadException",this.code=t}}var w,b,k,S=i(35404);!function(e){e.PUBLIC="public",e.UNLISTED="unlisted",e.PASSWORD="password",e.PRIVATE="private",e.UNKNOWN="unknown"}(w||(w={})),function(e){e.MAX="max",e.LOD0="lod0",e.LOD1="lod1",e.LOD2="lod2",e.LOD3="lod3"}(b||(b={})),function(e){e.custom="custom",e.basic1="basic1",e.medium1="medium1"}(k||(k={}));var T=i(68909);class I{constructor(e){this.textures={},this.position=new T.Vector3,this.rotation=new T.Quaternion,this.modelId=e}key(){var e,t,i,n,a;return null!==(a=null!==(t=null===(e=this.tileset)||void 0===e?void 0:e.s3LocationKey)&&void 0!==t?t:null===(n=null===(i=this.meshUrls)||void 0===i?void 0:i[0])||void 0===n?void 0:n.s3LocationKey)&&void 0!==a?a:this.modelId}}class D{constructor(){this.meshAssets={}}key(){return Object.values(this.meshAssets).map((e=>e.key())).join(",")}refresh(e){var t;this.sid=e.sid,this.uuid=e.uuid;for(const[i,n]of Object.entries(this.meshAssets)){const a=e.meshAssets[i];if(a){for(const e in n.textures)a.textures[e]&&n.textures[e].refreshFrom(a.textures[e]);null===(t=n.meshUrls)||void 0===t||t.forEach(((e,t)=>{var i,n;const o=null===(n=null===(i=a.meshUrls)||void 0===i?void 0:i[t])||void 0===n?void 0:n.url;e.url&&o&&e.url.refreshFrom(o)})),n.tileset&&a.tileset&&(n.tileset.urlTemplate.refreshFrom(a.tileset.urlTemplate),n.tileset.s3LocationKey=a.tileset.s3LocationKey,n.tileset.maxLOD=a.tileset.maxLOD,n.tileset.rootFilename=a.tileset.rootFilename,n.tileset.tilesetVersion=a.tileset.tilesetVersion)}}}assetsEqual(e){if(!(0,a.vq)(Array.from(Object.keys(this.meshAssets)),Array.from(Object.keys(e.meshAssets))))return!1;for(const[t,i]of Object.entries(this.meshAssets)){const n=e.meshAssets[t];if(!n)throw new Error("Corresponding asset not found!");if(i.tileset&&n.tileset&&i.tileset.s3LocationKey!==n.tileset.s3LocationKey)return!1;if(i.meshUrls&&n.meshUrls&&i.meshUrls[0].s3LocationKey!==n.meshUrls[0].s3LocationKey)return!1}return!0}}const N=new a.Vy("mds-model-serializer");class E{deserialize(e,t){var i,n,o,s,r,d;const l=null==e?void 0:e.model;if(!l||!this.validate(l)||!l.assets)return N.debug("Deserialized invalid model data from MDS",l),null;const c=new D,u=e=>{const t=c.meshAssets[e]||new I(e);return c.meshAssets[e]=t,t},h=(0,a.qb)(l.assets.textures,(e=>{var t;return(null===(t=e.model)||void 0===t?void 0:t.id)||""}));for(const[e,t]of h.entries()){if(""===e)throw new y("Invalid model id!");const i=u(e);for(const e of["high","low"]){const n=_(t.filter((t=>t.quality===e))[0]);n&&(i.textures[e]=new a.fN(n,(0,m.X)(n.validUntil,null)))}}const p=(0,a.qb)(l.assets.meshes,(e=>{var t;return(null===(t=e.model)||void 0===t?void 0:t.id)||""}));for(const[e,t]of p.entries()){if(""===e)throw new y("Invalid model id!");const i=u(e),n=this.getDamFileUrls(t);(null==n?void 0:n.length)&&(i.meshUrls=n)}const v=(0,a.qb)(l.assets.tilesets,(e=>{var t;return(null===(t=e.model)||void 0===t?void 0:t.id)||""}));for(const[e,t]of v.entries()){if(""===e)throw new y("Invalid model id!");const i=u(e),n=t[0];this.validateTileset(n)&&(i.tileset=this.getTileset(n,l.lod),i.textures.max=this.getTilesetTextures(n))}const f="staging"===l.state,g=c.meshAssets[c.sid];if(!f&&g&&!g.meshUrls&&!g.tileset)throw N.error("No DAM or tileset info found for model",c),new y("No DAM or tileset info found for model",null!==(i=l.state)&&void 0!==i?i:"unknown");if(c.baseModelId=null!==(n=null==l?void 0:l.rootModelId)&&void 0!==n?n:"",c.sid=l.id,c.overlayAvailable=((null==l?void 0:l.defurnishViews)||[]).some((e=>null==e?void 0:e.model.id))?"defurnish":void 0,c.overlayActive=!!c.overlayAvailable&&!(null===(s=null===(o=null==l?void 0:l.overlayLayers)||void 0===o?void 0:o.length)||void 0===s||!s),c.uuid=(null===(d=null===(r=null==g?void 0:g.meshUrls)||void 0===r?void 0:r[0])||void 0===d?void 0:d.uuid)||"",c.state=l.state||"failed",t&&t.length)for(const e of t){const t=c.meshAssets[e.model.id];t&&(t.position.copy(e.transform.position),t.rotation.copy(e.transform.rotation))}return c}validate(e){return["id","assets","rootModelId"].every((t=>t in e))}getDamFileUrls(e){return(e||[]).reduce(((e,t)=>{var i;if(!t.model||!t.layer)throw new y("No model or layer for mesh");if(t.status===f.fd.AVAILABLE&&t.url){const n=new RegExp(/[a-f0-9]{8}[a-f0-9]{4}4[a-f0-9]{3}(:?8|9|A|B)[a-f0-9]{3}[a-f0-9]{12}/gi),o=new URL(t.url).pathname.matchAll(n);let s="";for(const e of o)s+=s?","+e[0]:e[0];const r=(null===(i=t.filename)||void 0===i?void 0:i.replace(".dam","").replace("_50k",""))||"unknown",d={modelId:t.model.id,layerId:t.layer.id,url:new a.fN(t.url,(0,m.X)(t.validUntil,null)),s3LocationKey:s,uuid:r};"50k"===t.resolution?e.unshift(d):e.push(d)}return e}),[])}validateTileset(e){var t;if(!e)return!1;const i=p.h.lt(null!==(t=e.tilesetVersion)&&void 0!==t?t:"0","1.0.0");return e&&e.status===f.fd.AVAILABLE&&!i}getTileset(e,t){var i;if(!e.model||!e.layer)throw new y("No model or layer for tileset!");const n=this.getTilesetMaxLOD(e,t),o=this.getRootTilesetFilename(e,t),s=this.getUrlTemplate(e),r=new URLSearchParams(s).get("k")+"/";return{modelId:e.model.id,layerId:e.layer.id,maxLOD:n,rootFilename:o,urlTemplate:new a.fN(s,(0,m.X)(e.validUntil,null)),tilesetVersion:null!==(i=e.tilesetVersion)&&void 0!==i?i:"0",s3LocationKey:r}}getTilesetMaxLOD(e,t){var i,n,o;let s=2;const r=p.h.gte(null!==(i=e.tilesetVersion)&&void 0!==i?i:"0","1.2.0"),d=!r&&e.tilesetPreset===k.basic1,l=e.tilesetPreset===k.custom,c=e.tilesetDepth;if(P(c)&&(r||l||!d))return c;switch(null===(n=null==t?void 0:t.options)||void 0===n?void 0:n[0]){case b.MAX:s=P(c)?c:4,p.h.lt(null!==(o=e.tilesetVersion)&&void 0!==o?o:"0","1.1.0")&&(s=3);break;case b.LOD3:s=3;break;case b.LOD2:s=2;break;case b.LOD1:s=1;break;case b.LOD0:s=0}return 1===(0,a.P3)("debugTiles",0)&&(0,a.P3)("maxLOD",s)!==s&&(s=(0,a.P3)("maxLOD",s)),s}getRootTilesetFilename(e,t){if(1===(0,a.P3)("debugTiles",0)&&""!==(0,a.P3)("tilesetroot",""))return(0,a.P3)("tilesetroot","");if(e.tilesetPreset===k.custom)return"tileset.json";return`${this.getTilesetMaxLOD(e,t)}.json`}getTilesetTextures(e){if(!e.model||!e.layer)throw new y("Missing model or layer info for tileset");const t=this.getUrlTemplate(e);return new a.fN({id:"tiled",modelId:e.model.id,layerId:e.layer.id,resolution:"*",quality:"max",format:"jpg",urlTemplate:t.replace(S.tQ.urlTemplateToken,"<folder>/<texture>.jpg"),validUntil:e.validUntil},(0,m.X)(e.validUntil,null))}getUrlTemplate(e){var t;return S.tQ.urlTemplateOverride?S.tQ.urlTemplateOverride+S.tQ.urlTemplateToken+"?t=fake":null!==(t=e.urlTemplate)&&void 0!==t?t:S.tQ.urlTemplateToken}}function P(e){return(0,v.sw)(e)&&!isNaN(e)}function _(e){return(null==e?void 0:e.id)&&e.resolution&&e.quality&&e.urlTemplate&&e.model&&e.layer?{id:e.id,modelId:e.model.id,layerId:e.layer.id,format:e.format,validUntil:e.validUntil||"",resolution:e.resolution,quality:e.quality,urlTemplate:e.urlTemplate}:null}class C extends u.g{constructor(e,t){super(e),this.getConnections=t,this.assetsDeserializer=new E}async read(e){var t,i;const n={modelId:null!==(t=null==e?void 0:e.modelId)&&void 0!==t?t:this.getViewId()};e=Object.assign({prefetchKey:this.context.isCompositeModel?"":null!==(i=null==e?void 0:e.prefetchKey)&&void 0!==i?i:"data.model.assets.textures"},e);const a=await this.query(h.GetModelAssets,n,e);return this.assetsDeserializer.deserialize(null==a?void 0:a.data,this.getConnections())}async refresh(e){return super.refresh(Object.assign({fetchPolicy:"no-cache"},e))}}var A=i(74381),x=i(95386);class V{constructor(){this.lastPublished=null}hasDiscoverUrl(){return[w.PUBLIC,w.UNLISTED].includes(this.visibility)}copy(e){this.baseModelId=e.baseModelId,this.details=e.details,this.lastPublished=e.lastPublished,this.options=e.options,this.sid=e.sid,this.visibility=e.visibility,this.vrSupported=e.vrSupported}}const M=new a.Vy("base-model-deserializer");class O{deserialize(e){var t,i,n,a;if(!e||!this.validate(e)||!e.publication)return M.debug("Deserialized invalid model data from MDS",e),null;const o=e.publication,s=o.contact||{name:"",email:"",phoneNumber:""},r=e.options,d=new V;return d.sid=e.id,d.state=e.state||A.ve.ACTIVE,d.details={sid:e.id,name:e.name||"",presentedBy:o.presentedBy||"",summary:o.summary||"",defaultViewId:o.defaultViewId||d.sid,description:o.description||"",formattedAddress:o.address||"",contact:{email:s.email||"",name:s.name||"",phone:s.phoneNumber||"",formattedPhone:s.phoneNumber||""},externalUrl:o.externalUrl||""},d.options={urlBranding:null===(t=null==r?void 0:r.urlBrandingEnabled)||void 0===t||t,socialSharing:!!(null==r?void 0:r.socialSharingEnabled),isPublic:!!o.published,isVR:!!(null==r?void 0:r.vrEnabled)},o.lastPublished&&(d.lastPublished=(0,m.X)(o.lastPublished,null)),d.visibility=this.getModelVisibility(e),d.externalListings=null!==(n=null===(i=e.externalListings)||void 0===i?void 0:i.slice())&&void 0!==n?n:[],d.baseModelId=null!==(a=null==e?void 0:e.rootModelId)&&void 0!==a?a:"",d}validate(e){return["id","publication","rootModelId"].every((t=>t in e))}getModelVisibility(e){return x.P.hasPassword?w.PASSWORD:(0,v.sw)(e.visibility)&&e.visibility!==A.K7.PUBLIC?e.visibility===A.K7.PRIVATE?w.PRIVATE:w.UNKNOWN:e.discoverable?w.PUBLIC:w.UNLISTED}}class L{serialize(e){const t=e||{},i={},n={};void 0!==t.defaultViewId&&(i.defaultViewId=t.defaultViewId),void 0!==t.name&&(n.name=t.name);const a=Object.keys(i).length>0;return n.publication=a?i:void 0,n}}const R=new a.Vy("mds-model-store");class F extends u.g{constructor(){super(...arguments),this.detailsDeseralizer=new O,this.detailsSerializer=new L}async read(e,t="root"){var i,n,a,o;const s={modelId:null!==(i=null==e?void 0:e.modelId)&&void 0!==i?i:this.getBaseViewId(),viewLookup:t};e=Object.assign({prefetchKey:null!==(n=null==e?void 0:e.prefetchKey)&&void 0!==n?n:"data.model.discoverable"},e);const r=await this.query(h.GetModelDetails,s,e);let d=this.detailsDeseralizer.deserialize(null===(a=null==r?void 0:r.data)||void 0===a?void 0:a.model);if(!d){const t={modelId:this.getViewId(),viewLookup:"self"},i=Object.assign(Object.assign({},e),{fetchPolicy:"no-cache"});R.warn("Failed to read model details for model from view:root, some options/details may be stale",s,"retry with",t);const n=await this.query(h.GetModelDetails,t,i);d=this.detailsDeseralizer.deserialize(null===(o=null==n?void 0:n.data)||void 0===o?void 0:o.model)}if(!d)throw new Error("Failed to read model details");return d}async update(e){const t=this.getBaseViewId(),i=this.detailsSerializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(h.PatchModel,{modelId:t,patch:i}).then((e=>{R.debug(e)}))}async refresh(e){return super.refresh(Object.assign({fetchPolicy:"no-cache"},e))}}var B=i(55057),U=i(94);async function $(e,t){var i;const[n,a]=await Promise.all([t.getModuleBySymbol(s.aF),t.getModuleBySymbol(s.az)]),o={model_id:null!==(i=e.baseModelId)&&void 0!==i?i:e.sid,model_mesh_type:Array.from(Object.values(e.meshAssets)).some((e=>!!e.tileset))?"streamed":"dam",overlay_active:e.overlayActive,overlay_available:e.overlayAvailable};(null==a?void 0:a.layersData.getCameraRemovalLayerId())&&(o.cam_reflections_hidden=!0),n.setOptions(o)}var j=i(88111);class G extends n.nV{constructor(){super(...arguments),this.name="model-data",this.data=new B.q}async init(e,t){this.engine=t;const{baseUrl:i,readonly:n}=e,o=await t.market.waitForData(d.P);this.assetsStore=new C({context:o.mdsContext,readonly:n,baseUrl:i},(()=>{var e;return(null===(e=o.getCurrentView())||void 0===e?void 0:e.connections.values())||[]})),this.store=new F({context:o.mdsContext,readonly:n,baseUrl:i});const l=await this.store.read({modelId:o.currentViewId,fetchPolicy:"cache-first"});if(l.state!==A.ve.ACTIVE&&!o.mdsContext.isCompositeModel)throw new y("model unavailable",l.state);this.data.setModel(l),o.onPropertyChanged("currentViewId",(e=>{const t=this.data.getModelAssets(e);a.Vy.for(this).debugInfo("view change",e,t),t&&this.setActiveModel(e)})),this.assetsStore.onNewData((async e=>{if(e){const t=this.data.getModelAssets(e.sid);a.Vy.for(this).debugInfo("data change",e.sid,void 0!==t?"refresh":"add"),t?t.refresh(e):(this.addAssets(e.sid,e),this.setActiveModel(e.sid))}})),t.getModuleBySymbol(s.GR).then((e=>{let i=this.data.getModelAssets();e.isolateMesh(this.data.getModelAssets()),this.data.onPropertyChanged("activeAssetsId",(async n=>{const a=this.data.getModelAssets(n);$(a,t),(!i||a&&!a.assetsEqual(i))&&(e.isolateMesh(a),i=a)}))})),await this.assetsStore.refresh({modelId:o.currentViewId,fetchPolicy:"cache-first"}),t.market.register(B.q,this.data),this.registerSettings(this.data.model),$(this.data.getModelAssets(),t),t.market.waitForData(r.M).then((e=>{const t=this.data.model.lastPublished;t&&(e.lastPublished=t.getTime())})),this.bindings.push(this.engine.commandBinder.addBinding(j.j,this.setDefaultView.bind(this)))}queryAssets(e){return this.assetsStore.read(e)}queryModel(e){return this.store.read(e)}async setDefaultView(e){this.engine.commandBinder.issueCommand(new c.F({dataTypes:[n.pe.SETTINGS]})),this.data.model.details.defaultViewId=e.defaultViewId,this.data.commit(),this.store.update({defaultViewId:e.defaultViewId})}setActiveModel(e){this.data.activeAssetsId=e,this.data.commit()}addAssets(e,t){if(!this.data.hasModelAssets(e)){const i=this.data.getModelAssets();this.data.addModelAssets(e,t),(0,a._z)(t,(async()=>{await this.assetsStore.refresh({modelId:t.sid})})),(!i||i&&!i.assetsEqual(t))&&this.engine.broadcast(new U.A(e,this.data.model.vrSupported))}}async registerSettings(e){var t;const i=await this.engine.getModuleBySymbol(o.ZF),n="Model Options",{urlBranding:a=!0,socialSharing:s,isPublic:r,isVR:d}=e.options||{};i.registerSetting(n,S.wD,s),i.registerSetting(n,"is_public",r),i.registerSetting(n,"is_vr",d);const c=!a||!!i.settingsData.getOverrideParam("brand",!0),u=a?i.settingsData.getOverrideParam("mls","0"):"0",h=a?i.settingsData.getOverrideParam("title","1"):"1",m=null!==(t=i.settingsData.getOverrideParam("tagNav","1"))&&void 0!==t?t:"1";i.registerSetting(n,S.wx,"0"!==h&&"2"!==u),i.registerSetting(n,S.ov,"0"!==h&&"2"!==h),i.registerSetting(n,S.Lj,c),i.registerSetting(n,S.qu,"1"===u||"2"===u),i.registerSetting(n,l.rp,"0"!==m)}}},25434:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o,u:()=>a});var n=i(77201);class a extends n.QB{constructor(e,t,i){super(),this.name=e,this.version=t,this.loadTime=i}}class o{constructor(){this.handlers=[{msgType:a,func:(e,t,i)=>{e.track("plugin_loaded",{name:t.name,version:t.version,time:t.loadTime})}}]}}},99460:(e,t,i)=>{"use strict";i.r(t),i.d(t,{LIST_EDIT_ONLY:()=>n.L$,PluginConfigData:()=>n.Y7,default:()=>_,getPluginMetadataUrl:()=>y,getPluginUrl:()=>g,manifestEndpoint:()=>n.TR});var n=i(56846),a=i(99589),o=i(77201),s=i(97800),r=i(71687),d=i(13586),l=i(85846);const c="0.0";function u(e){if(!e)return[];const t={[c]:h}[c];if(!t)throw new Error(`[PluginConfigDeserializer] Data with version "${e.version}": not recognized.`);return t(e)}function h(e){return e[c]}const m="0.0";function p(e){const t={[m]:v};if(!e)throw new Error("[PluginConfigSerializer] no data to serialize.");const i=t[m];if(!i)throw new Error(`[PluginConfigSerializer] Version "${m}" not recognized.`);return i(e)}function v(e){return{[m]:e}}class f extends l.xO{constructor(e,t,i){super({queue:e,path:`${t}/api/v1/jsonstore/model/plugins/${i}`,batchUpdate:!0,deserialize:u,serialize:p}),this.clearCache()}clearCache(){this.config.cachedData={data:null}}}function g(e,t,i){return i+`${e}/${t}/${e}.js`}function y(e,t,i){return i+`${e}/${t}/plugin.json`}const w=e=>{var t,i,n;return null!==(n=null===(i=null===(t=null==e?void 0:e.src)||void 0===t?void 0:t.match(/(\d+\.\d+\.\d+)\/[^\/]*\.js$/))||void 0===i?void 0:i[1])&&void 0!==n?n:null};var b=i(49953),k=i(25316),S=i(83375),T=i(47737),I=i(41122);const D="unknown-app-key",N="manifest",E=["draft","edge","show","work"],P=["local",...E];class _ extends o.nV{constructor(){super(...arguments),this.name="plugin-config",this._registryLoaded=new o.Lj(!1)}get serviceSdkKey(){if(!this._applicationKey)throw new Error("[PluginConfigData] service key has not yet been set.");return this._applicationKey}get canOverrideStrict(){var e,t;return null===(t=null===(e=this._config)||void 0===e?void 0:e.pluginPolicies)||void 0===t?void 0:t.canDebug}get registryLoadedObservable(){return this._registryLoaded}get registryLoaded(){return this._registryLoaded.value}async reloadStoreData(e){e&&this.currentStore.clearCache(),await this.loadCurrentStoreData(this._config.readonly)}async init(e,t){if(this.queue=e.queue,this._config=e,[this._policyData,this._layersData,this._settingsData]=await Promise.all([t.market.waitForData(b.L),t.market.waitForData(T.P),t.market.waitForData(k.o)]),this.pluginConfigData=new n.Y7(this._settingsData),e.pluginPolicies.enabled){const e=(await t.getModuleBySymbol(r.qL)).getApi(),i=await e.getAppKey("showcase","plugin");if(i instanceof Object){const e=i;await this.initializePluginRegistry(e,this._config,!0),this.initializePluginRegistry(e,this._config,!1).then((async()=>{this.currentStore=new f(this.queue,this._config.apiHostBaseUrl,this._config.modelId),this.pluginConfigData.setupConfigStore(this._layersData.mdsContext,this._config.readonly,this._config.apiHostBaseUrl),await this.loadCurrentStoreData(this._config.readonly),this._registryLoaded.value=!0})).catch((e=>{s.Vy.for(this).error(e)}))}}t.commandBinder.addBinding(I.W,(async e=>{var t,i;const n=(await this.pluginConfigData.getMdsResult()).find((t=>t.name===e.pluginId)),a=null!==(i=null===(t=null==n?void 0:n.attachments)||void 0===t?void 0:t.map((e=>e.id)))&&void 0!==i?i:[];this.pluginConfigData.updateMds({name:e.pluginId,attachments:[...a,e.attachmentId]})})),t.market.register(n.Y7,this.pluginConfigData)}async saveToMds(e){var t,i;if(!this.pluginConfigData.mdsIsSetup)return void s.Vy.for(this).warn("Plugin changes will NOT be saved");const n=null!==(t=w(e))&&void 0!==t?t:"0.0.0";if(!this._manifest.find((t=>t.name===e.id&&t.versions[n])))return void s.Vy.for(this).warn(`Version ${n} does not exist in registry. Changes not saved to MDS.`);const a=[];let o;for(const t of Object.keys(e.config)){const n=null===(i=this.pluginConfigData.availablePlugins.get(e.id))||void 0===i?void 0:i.config;n&&"object"==typeof n[t]&&(o=n[t]||{},"attachment"!==o["ui:widget"]&&"imageUpload"!==o["ui:field"]||a.push(e.config[t]))}const r={name:e.id,version:n};a.length>0&&(r.attachments=a),this.pluginConfigData.updateMds(r)}deleteFromMds(e){this.pluginConfigData.mdsIsSetup?this.pluginConfigData.deleteMdsById(e.id):s.Vy.for(this).warn("Plugin changes will NOT be saved")}saveConfig(e,t){const i=this.pluginConfigData.lastSavedConfiguration.values();s.Vy.for(this).debugInfo(`configuration for ${e.id} updated. ${JSON.stringify(i,void 0,2)}`),e.enabled?this.saveToMds(e):this.deleteFromMds(e),this.currentStore.update(i)}async loadCurrentStoreData(e){let t;try{t=await this.currentStore.read()||[],t=t.filter((e=>!this.pluginConfigData.disabledPlugins.includes(e.id))),s.Vy.for(this).debugWarn(`Saved configuration data loaded for ${t.length} plugin(s).`),s.Vy.for(this).debugInfo(JSON.stringify(t,void 0,2))}catch(e){t=[],s.Vy.for(this).error("Failed to load configured plugins: ",e)}this.pluginConfigData.lastSavedConfiguration.replace(t),e||this.pluginConfigData.lastSavedConfiguration.onElementChanged({onAdded:this.saveConfig.bind(this),onUpdated:this.saveConfig.bind(this),onRemoved:this.deleteFromMds.bind(this)}),this.pluginConfigData.pluginConfigReady.resolve()}getAutoUpgradedVersion(e,t){var i;const n=Object.keys(t.versions).sort(((e,t)=>S.h.compare(t,e))).filter((e=>this.hasRequiredPolicies(t.versions[e].requiredPolicies))),o=null!==(i=a.maxSatisfying(n,`~${e}`))&&void 0!==i?i:e,s=t.currentVersion;let r=o;return a.gt(o,s)&&(r=s),r}dispose(e){super.dispose(e),e.market.unregister(n.Y7),this.pluginConfigData=void 0}async initializePluginRegistry(e,t,i){if(!this._manifest){const{manifestUrl:i,applicationKey:n}=this.getManifestUrl(e,t);this._applicationKey=n;const a=await this.queue.get(i,{responseType:"json"}).catch((e=>(s.Vy.for(this).error(e),null)));if(null===a)return void s.Vy.for(this).error("Plugin manifest could not be found, please contact support.");this._manifest=a}await this.populateFromManifest(this._manifest,e,this._applicationKey,i)}getManifestUrl(e,t,i=!0){var a;let o=this._config.apiHostBaseUrl+n.TR,r=e.applicationKey;if(this.pluginConfigData.pluginVersion){const e=this.pluginConfigData.pluginVersion.match(/^(https?:\/\/)?(localhost|127.0.0.1)(:\d*)?(\/((?:\w+-)*)?manifest.json)?$/)||this.pluginConfigData.pluginVersion.match(`^(${P.join("|")})(:\\d*)?(:?\\/)?()([\\w-]+)?$`);if(e){const t=!e[4],i=null===(a=e[5])||void 0===a?void 0:a.slice(0,t?void 0:-1);o=this.constructManifestUrl(e,i),s.Vy.for(this).devInfo(`Using local manifest override: ${o}`),e[5]&&s.Vy.for(this).devInfo("with specified plugin name",i)}else{const e=this.pluginConfigData.pluginVersion.match(/^(?:([a-zA-Z-]+)-)?\d+\.\d+\.\d+-\d+-g[0-9a-f]{7}/);o+=e?`?v=${e[0]}&${N}=${e[1]||"true"}`:`?v=${this.pluginConfigData.pluginVersion}&${N}=true`}}else this.pluginConfigData.manifestUrl&&((0,s.Jt)(this.pluginConfigData.manifestUrl)||t.pluginPolicies.canDebug)?o=this.pluginConfigData.manifestUrl:o+=`?${N}=true`;return s.Vy.for(this).devInfo(`Using manifest URL: ${o}`),(o.match(/localhost/)||o.match(/127.0.0.1/))&&i&&!t.pluginPolicies.canDebug&&(r=D),{manifestUrl:o,applicationKey:r}}constructManifestUrl(e,t){const i=P.includes(e[1]),n=["edge","show","work"].includes(e[1]),a=window.location.protocol+"//",o=i?a:e[1]||a,s=i?"localhost":e[2]||"localhost",r=(i?e[2]:e[3])||":8800";let d=n?`/${e[1]}-manifest.json`:e[4]||"/draft-manifest.json";return e[4]&&t&&!E.includes(t)&&(d="/edge-manifest.json"),`${o}${s}${r}${d}?${N}=${t||"true"}`}async populateFromManifest(e,t,i,n){const a=[];for(const o of e){!!o.description&&o.description.includes("early-loading")&&(o.loadEarly=!0);(n?o.loadEarly:!o.loadEarly)&&a.push(this.registerManifestEntry(o,t,i))}await Promise.all(a)}async registerManifestEntry(e,t,i){var n,a,o;const r=this.findLatestPermittedVersion(e.versions,e.currentVersion);if(!r)return;e.currentVersion=r;const d=Object.assign(Object.assign({},e),{description:e.description||"",src:e.src||g(e.name,e.currentVersion,t.baseUrl),meta:e.meta||y(e.name,e.currentVersion,t.baseUrl),icon:e.icon||"",applicationKey:e.applicationKey||i||D,fetchLevel:null!==(n=e.fetchLevel)&&void 0!==n?n:this.pluginConfigData.defaultFetchLevel,loadEarly:e.loadEarly||!1});if(!(0,s.Jt)(d.src)||!(0,s.Jt)(d.meta))return;const l=await this.queue.get(d.meta,{responseType:"json"}).catch((e=>{s.Vy.for(this).error(e)}));var c,u,h;l&&this.pluginConfigData.add({name:d.name,description:d.description||l.description,version:d.currentVersion,config:l.config||{},outputs:l.outputs||{},applicationKey:d.applicationKey||D,src:d.src,meta:d.meta,icon:(null===(a=l.options)||void 0===a?void 0:a.icon)?d.icon||(c=e.name,u=e.currentVersion,h=t.baseUrl,h+`${c}/${u}/${c}.svg`):void 0,enabled:!1,strict:this.canOverrideStrict&&null!==this.pluginConfigData.defaultStrict?this.pluginConfigData.defaultStrict:d.sesStrict,fetchLevel:null!==(o=d.fetchLevel)&&void 0!==o?o:this.pluginConfigData.defaultFetchLevel,options:l.options,peerDependencies:l.peerDependencies,loadEarly:d.loadEarly||this.pluginConfigData.defaultLoadEarly})}findLatestPermittedVersion(e,t){const i=Object.keys(e).sort(((e,t)=>S.h.compare(t,e)));for(const n of i){const i=e[n].requiredPolicies;if(!S.h.gt(n,t)&&this.hasRequiredPolicies(i))return n}return null}hasRequiredPolicies(e){if(!e||0===e.length)return!0;const t=this._config.pluginPolicies.groups||[],i=e=>-1===e.indexOf(".")?-1!==t.indexOf(e):this._policyData.hasPolicy(e);return e.reduce(((e,t)=>{if(!e)return e;if(t instanceof Object){if("or"===t.operator)return t.policies.some((e=>i(e)));if("xor"===t.operator){let e=0;return t.policies.forEach((t=>{e+=i(t)?1:0})),1===e}return s.Vy.for(this).warn(`unrecognized required policy entry, operator: <${t.operator}> - plugin disabled`),!1}return i(t)}),!0)}checkMLSMode(e,t,i,n){var a;if(e){if(!t.meta)return s.Vy.for(this).warn(`MLS mode requires plugin meta. Plugin meta URL missing from plugin "${null==n?void 0:n.id}"`),!1;if(!(null===(a=null==i?void 0:i.options)||void 0===a?void 0:a.mlsEnabled))return s.Vy.for(this).info(`Plugin "${null==n?void 0:n.id}" not allowed in MLS mode.`),!1}return!0}checkEditOnly(e,t,i){var n;return!(null===(n=null==t?void 0:t.options)||void 0===n?void 0:n.editOnly)||e===o.lg.WORKSHOP||(s.Vy.for(this).info(`Plugin "${null==i?void 0:i.id}" is edit-only and cannot be loaded in Showcase.`),!1)}updatePatchInProduction(e){var t;const i=w(e),n=this._manifest.find((t=>t.name===e.id));if(i&&n){const a=this.getAutoUpgradedVersion(i,n);null!==a&&a!==i&&(s.Vy.for(this).debugInfo(`Replacing ${n.name} version ${i} with version ${a}`),e.src=e.src.replace(i,a),e.meta=null===(t=e.meta)||void 0===t?void 0:t.replace(i,a))}else s.Vy.for(this).debugInfo(`Missing config version or manifest entry for ${e.id}. Not auto-updating patch for this plugin.`)}async getConfiguredPlugins(e,t){let i=[];try{const e=await this.currentStore.read();e&&(i=e)}catch(e){s.Vy.for(this).warn("Failed to load Plugin config, proceeding without it")}const n=[],a=this._settingsData.getOverrideParam("mls",0,"number");return i.forEach((i=>{var o,r,l,c;if(!this.pluginConfigData.disabledPlugins.includes(i.id)){if(t){const e=this.pluginConfigData.availablePlugins.get(i.id);if(!(null==e?void 0:e.loadEarly))return}if(i.enabled){const t=this.pluginConfigData.availablePlugins.get(i.id);let u=!(t&&(!t||void 0!==t.strict))||t.strict;if(!t)return s.Vy.for(this).warn(`"${i.id}" plugin not found in current plugin manifest -- was it configured with a different one?`),void s.Vy.for(this).warn(`Unrecognized plugin disallowed "${null==i?void 0:i.id}" cannot load from ${null==i?void 0:i.src}`);const h={config:i.config||{},src:i.src||t.src,meta:i.meta||t.meta,id:i.id||t.name,strict:u,applicationKey:null==t?void 0:t.applicationKey,permissionLevel:null!==(o=null==t?void 0:t.fetchLevel)&&void 0!==o?o:d.D.None,peerDependencies:null!==(r=null==t?void 0:t.peerDependencies)&&void 0!==r?r:{}};if(!this.checkMLSMode(a,h,t,i))return;if(!this.checkEditOnly(e,t,i))return;this.updatePatchInProduction(h),h.canPlaceInGrid=(null===(l=null==t?void 0:t.options)||void 0===l?void 0:l.canPlaceInGrid)||!1,h.hideViewToggle=(null===(c=null==t?void 0:t.options)||void 0===c?void 0:c.hideViewToggle)||!1,n.push(h)}}})),s.Vy.for(this).debugWarn(`Readied configuration data for ${n.length} plugin(s).`),s.Vy.for(this).debugInfo(JSON.stringify(n,void 0,2)),n}}},45667:(e,t,i)=>{"use strict";i.r(t),i.d(t,{EDIT_SDK_EVENT_KEY:()=>a.fF,PluginPositionArea:()=>n.FT,PluginUIData:()=>o.kR,SlotType:()=>n.nT,VISIBILITY_EVENT_KEY:()=>a.EM,default:()=>l,usePluginSlotData:()=>c.nY,usePluginUI:()=>c.HH,usePluginUiData:()=>c.DN});var n=i(58749),a=i(68570),o=i(62193),s=i(77201),r=i(49953),d=i(78671);class l extends s.nV{constructor(){super(...arguments),this.name="plugin-ui"}async init(e,t){this.engine=t,[this.policyData]=await Promise.all([t.market.waitForData(r.L)]);const i=this.policyData.hasPolicy(d.I)?"open":"closed";this.pluginUiData=new o.kR(e.mainDiv,t.commandBinder,i),this.engine.market.register(o.kR,this.pluginUiData)}dispose(e){this.pluginUiData.dispose(),this.engine.market.unregister(o.kR),super.dispose(e)}}var c=i(30159)},58424:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PolicyData:()=>d.L,WORKSHOP_EDIT_POLICY:()=>c.I,default:()=>u});var n=i(77201),a=i(20968),o=i(3718),s=i(15732);class r extends a.g{constructor(e){super(e),this.prefetchKey="data.model.policies"}async read(e){const t=new s.S,i=this.getViewId();return this.query(o.GetModelPolicies,{modelId:i},e).then((e=>{var i,n;return t.deserialize((null===(n=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.model)||void 0===n?void 0:n.policies)||[])}))}}var d=i(49953);class l extends n.nV{constructor(){super(...arguments),this.name="policy-module"}async init(e,t){this.store=new r({context:e.mdsContext,readonly:!0,baseUrl:e.baseUrl,viewId:e.viewId});const i=e.isLoggedIn?"no-cache":"cache-first",n=await this.store.read({fetchPolicy:i});this.policyData=new d.L(n),t.market.register(d.L,this.policyData)}dispose(e){super.dispose(e),e.market.unregister(d.L)}}var c=i(60477);const u=l},39769:(e,t,i)=>{"use strict";i.r(t),i.d(t,{IntersectionPriority:()=>g.I,default:()=>F});var n=i(65945),a=i(77201),o=i(71687),s=i(68909);function r(e){return"excludeFromOctree"in e}var d=i(86866),l=i(30443),c=i(74025);const u=new s.Vector3,h=new s.Matrix4;class m{constructor(){this.parent=null,this.raycastDistance=1/0,this.distance=1/0}updateRaycastDistance(e){this.raycastDistance=this.bounds.distanceToPoint(e)}updateDistanceToBounds(e){this.distance=this.bounds.distanceToPoint(e)}}class p extends m{constructor(e){super(),this.mesh=e,this.bounds=(0,l.UX)(this.mesh.geometry).clone().applyMatrix4(this.mesh.matrixWorld),this.center=this.bounds.getCenter(new s.Vector3)}raycast(e,t){this.mesh.visible&&this.mesh.raycast(e,t)}nearestPointOnGeometry(e){const t=e.clone().applyMatrix4((new s.Matrix4).copy(this.mesh.matrixWorld).invert());let i;const n=this.mesh.geometry.boundsTree;return i=n?n.closestPointToPoint(t):(0,l.U7)(this.mesh.geometry,t),i?(i.point.applyMatrix4(this.mesh.matrixWorld),{object:this.mesh,point:i.point,distance:i.point.distanceTo(e),faceIndex:i.faceIndex}):null}}class v extends m{get depth(){return this.level}constructor(e,t,i){super(),this.level=t,this.leafMinSize=i,this.childNodes=[],this.children=[],this.intersectsCapsule=(()=>{const e=new s.Box3,t=new s.Ray,i=new s.Matrix4,n=new s.Line3;return(e,o,s,r,d)=>{var l;if(!a(e,o,s,this.bounds))return!1;for(const m of this.children)if(r(m)){if(m instanceof v&&m.intersectsCapsule(e,o,s,r))return!0;if(m instanceof p){const r=null!==(l=m.mesh.geometry.boundsTree)&&void 0!==l?l:m.mesh.geometry.computeBoundsTree();n.set(e,o);let p=s;if(!m.mesh.matrixWorld.equals(h)){const e=i.copy(m.mesh.matrixWorld).invert();n.applyMatrix4(e),p=s*e.getMaxScaleOnAxis()}if(r.shapecast({intersectsBounds:e=>a(n.start,n.end,p,e)?c.b_:c.Bw,intersectsTriangle(e){t.origin.copy(n.start),t.direction.subVectors(n.end,n.start).normalize();let i=null;const a=t.intersectTriangle(e.a,e.b,e.c,!1,u);if(a&&n.start.distanceToSquared(a)<=n.start.distanceToSquared(n.end)&&(i={object:m.mesh,point:a.clone(),distance:n.start.distanceTo(a)}),!i){e.closestPointToSegment(n,u)<p&&(i={object:m.mesh,point:u.clone(),distance:n.start.distanceTo(u)})}return!!i&&(!d||d(i))}}))return!0}}return!1};function a(i,n,a,o){if(e.copy(o).expandByScalar(a),e.containsPoint(i))return!0;t.origin.copy(i),t.direction.subVectors(n,i).normalize();const s=t.intersectBox(e,u);return!!s&&i.distanceToSquared(s)<=i.distanceToSquared(n)}})(),this.listeners={},this.bounds=e.clone(),this.size=e.getSize(new s.Vector3),this.center=e.getCenter(new s.Vector3)}*addMeshes(e){e.updateMatrixWorld(!0);const t=[];e.traverse((e=>{!(e instanceof s.Mesh&&e.geometry)||r(e)&&e.excludeFromOctree||t.push(e)}));for(const e of t)this.addMesh(new p(e))}removeMeshes(e){let t=!1;for(let i=0;i<this.children.length;i++){const n=this.children[i];n instanceof p&&n.mesh.id===e.id&&(n.parent=null,this.children.splice(i,1),this.emit("removed",this,n),t=!0)}if(!t)throw new Error("Mesh that is being attempted removed does not exist in this node.")}addMesh(e){this.parent||this.expandToFit(e);let t=!1;if(this.size.length()>this.leafMinSize){0===this.childNodes.length&&this.buildChildNodes();for(const i of this.childNodes)i.bounds.containsBox(e.bounds)&&(t=!0,i.addMesh(e))}t||this.add(e)}add(e){if(e.parent)throw new Error("ColliderNode already has a parent, remove before trying to add in another node");e.parent=this,this.children.push(e),this.emit("added",this,e)}expandToFit(e){let t=!1;for(;!this.bounds.containsBox(e.bounds);){const{bounds:i,size:n,center:a,children:o,childNodes:s}=this,r=a.clone();this.children=[],this.childNodes=[],n.multiplyScalar(2),a.set(i[e.center.x>a.x?"max":"min"].x,i[e.center.y>a.y?"max":"min"].y,i[e.center.z>a.z?"max":"min"].z),i.setFromCenterAndSize(a,n),this.buildChildNodes();for(const e of this.childNodes)if(e.center.distanceToSquared(r)<1e-10){e.children=o,e.childNodes=s,o.forEach((t=>{this.emit("removed",t.parent,t),t.parent=e,this.emit("added",e,t)}));break}t=!0}t&&this.traverse((e=>{e.parent&&(e.level=e.parent.level+1)}))}traverse(e){e(this);for(const t of this.childNodes)t.traverse(e)}clear(){this.childNodes.length=0,this.children.length=0}buildChildNodes(){const e=u.copy(this.size).multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let n=0;n<2;n++){const a=this.bounds.min.x+e.x*n,o=a+e.x,r=this.bounds.min.y+e.y*t,d=r+e.y,l=this.bounds.min.z+e.z*i,c=l+e.z,u=new s.Box3(new s.Vector3(a,r,l),new s.Vector3(o,d,c)),h=new v(u,this.level+1,this.leafMinSize);this.childNodes.push(h),this.add(h)}}raycast(e,t){if(!0===e.ray.intersectsBox(this.bounds))for(const i of this.children)i.raycast(e,t)}pick(e,t,i,n=null){if(!e.ray.intersectsBox(this.bounds))return t;for(const t of this.children)t.updateRaycastDistance(e.ray.origin);this.children.sort(((e,t)=>e.raycastDistance-t.raycastDistance));for(const a of this.children){if(t&&t.distance<a.raycastDistance)break;if(i(a))if(a instanceof v)t=a.pick(e,t,i,n);else{const i=[];a.raycast(e,i);for(const e of i)t&&!(t.distance>e.distance)||n&&!n(e)||(t=e)}}return t}nearestTo(e,t,i=null){for(const t of this.children)t.updateDistanceToBounds(e);this.children.sort(((e,t)=>e.distance-t.distance));for(const n of this.children){if(0!==n.distance&&i&&i.distance<n.distance)break;if(t(n))if(n instanceof v)i=n.nearestTo(e,t,i);else if(n instanceof p){const t=n.nearestPointOnGeometry(e);if(t){(!i||i.distance>t.distance)&&(i=t)}}}return i}getAllBounds(e,t=0,i=1/0,n=!1){for(const a of this.children)this.level>=t&&this.level<=i&&(a instanceof p||!n)&&e.push(a.bounds.clone()),a instanceof v&&a.getAllBounds(e,t,i,n)}emit(e,...t){const i=this.listeners[e]||[];for(const e of i)e(...t);this.parent&&this.parent.emit(e,...t)}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}class f{get depth(){return this._depth}constructor(e,t){this.meshToNodes={},this._depth=0;const i=(0,d.C)(e);this.root=new v(i,0,t),this.root.on("added",((e,t)=>{e.depth>this._depth&&(this._depth=e.depth),t instanceof p&&(this.meshToNodes[t.mesh.id]||(this.meshToNodes[t.mesh.id]=[]),this.meshToNodes[t.mesh.id].push(t))})),this.root.on("removed",((e,t)=>{if(t instanceof p){const e=this.meshToNodes[t.mesh.id];for(let i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)}}))}*addMeshesAsync(e){yield*this.root.addMeshes(e)}addMeshes(e){for(const t of this.root.addMeshes(e));}removeMeshes(e){e.traverse((e=>{const t=this.meshToNodes[e.id]||[];for(const i of t)i.parent&&i.parent.removeMeshes(e)}))}clear(){this.root.clear(),this.meshToNodes={}}raycast(e){const t=[];return this.root.raycast(e,t),t}getAllBounds(e=0,t=1/0,i=!1){const n=[];return this.root.getAllBounds(n,e,t,i),n}pick(e,t,i=null){const n=e.firstHitOnly;e.firstHitOnly=!i;const a=this.root.pick(e,null,(e=>!(t&&e instanceof p)||t(e.mesh)),i);return e.firstHitOnly=n,a}intersectsCapsule(e,t,i,n,a){return this.root.intersectsCapsule(e,t,i,(e=>!(n&&e instanceof p)||n(e.mesh)),a)}nearestMeshTo(e,t){const i=this.root.bounds.clampPoint(e,new s.Vector3);return this.root.nearestTo(i,(e=>!(t&&e instanceof p)||t(e.mesh)))}getDebugBoundsMesh(e=16777215,t=0,i=1/0,n=!1){const a=this.getAllBounds(t,i,n),o=new s.LineBasicMaterial({color:e});if(a.length>0){const e=[];for(const t of a){const i=new s.Box3Helper(t);i.updateMatrixWorld(!0),i.geometry.applyMatrix4(i.matrixWorld),e.push(i.geometry)}const t=(0,l.h0)(e);return new s.LineSegments(t,o)}return new s.LineSegments(new s.BufferGeometry,o)}}var g=i(23431),y=i(45979),w=i(21567);class b{constructor(e,t,i,n){this.camera=e,this.cameraData=t,this.defaultRaycastFilter=i,this.intersectionFilter=n,this.meshes=new Set,this.splats=new Set,this.octreeEnabledMeshes=new Set,this.meshFilters=new Map,this.raycaster=new s.Raycaster,this.applyIntersectionFilterToDynamicMeshes=!1,this.getOctree=()=>this.octree}init(){this.raycaster=new s.Raycaster,this.raycaster.camera=this.camera,this.raycaster.params.Line&&(this.raycaster.params.Line.threshold=.1)}dispose(){this.octree.clear(),this.meshes.clear(),this.splats.clear()}updateIntersectionFilter(e,t=!1){this.intersectionFilter=e,this.applyIntersectionFilterToDynamicMeshes=t}cast(e,t,i){e&&t&&this.raycaster.set(e,t),this.raycaster.layers.mask=this.camera.layers.mask;let n=[];if(this.octree){const e=this.getRaycastFilter(I.OctreeMeshes,i),t=this.octree.pick(this.raycaster,e,this.intersectionFilter);t&&n.push(t)}const a=this.getRaycastFilter(I.DynamicMeshes,i);for(const e of this.meshes)if(a(e)){const t=[];k(e,this.raycaster,t),t.sort(((e,t)=>e.distance-t.distance)),n=n.concat(this.intersectionFilter&&this.applyIntersectionFilterToDynamicMeshes?t.filter(this.intersectionFilter):t)}const o=this.cameraData.isOrtho()?T:S;return n.sort(((e,t)=>o(e,t))),n}pick(e,t,i){var n;this.raycaster.set(e,t);const a=this.getRaycastFilter(I.OctreeMeshes,i);return null===(n=this.octree)||void 0===n?void 0:n.pick(this.raycaster,a,this.intersectionFilter)}pickSplats(e,t){this.raycaster.set(e,t);const i=[];for(const e of this.splats)e.raycast(this.raycaster,i);return(0,w.B)(i)}nearest(e,t){return this.octree.nearestMeshTo(e,this.getRaycastFilter(I.OctreeMeshes,t))}intersectsCapsule(e,t,i,n){return this.octree.intersectsCapsule(e,t,i,this.getRaycastFilter(I.OctreeMeshes,n),this.intersectionFilter||void 0)}setupOctree(e){this.octree=new f(e,.5);for(const e of this.meshes)e instanceof s.Object3D&&this.octreeEnabledMeshes.has(e)&&this.octree.addMeshes(e);return this.octree}addTarget(e,t,i){const n=e,a=n.collider?n.collider:e;this.meshes.add(a),i&&this.meshFilters.set(a,i),e instanceof s.Object3D&&this.octree&&t&&(this.octreeEnabledMeshes.add(e),this.octree.addMeshes(e),e.traverse((e=>{!(e instanceof s.Mesh)||r(e)&&e.excludeFromOctree||(t&&this.octreeEnabledMeshes.add(e),i&&this.meshFilters.set(e,i))}))),a instanceof y.z&&this.splats.add(a)}removeTarget(e){e instanceof s.Object3D&&this.octree&&this.octreeEnabledMeshes.has(e)&&(this.octree.removeMeshes(e),this.octreeEnabledMeshes.delete(e),e.traverse((e=>{e instanceof s.Mesh&&(this.octreeEnabledMeshes.delete(e),this.meshFilters.delete(e))})));this.meshes.has(e)&&(this.meshFilters.delete(e),this.meshes.delete(e)),e instanceof y.z&&this.splats.delete(e)}getRaycastFilter(e,t){const i=t||this.defaultRaycastFilter,n=t=>{const i=t instanceof s.Object3D&&this.octreeEnabledMeshes.has(t);switch(e){case I.DynamicMeshes:return!i;case I.OctreeMeshes:return i}};return e=>n(e)&&i(e)&&this.checkMeshSpecificFilter(e)}checkMeshSpecificFilter(e){const t=this.meshFilters.get(e);return!t||t(e)}render(){}activate(){}deactivate(){}}function k(e,t,i){(!e.layers||e.layers.test(t.layers))&&e.raycast(t,i);const n=e.children;if(n)for(let e=0,a=n.length;e<a;e++)k(n[e],t,i)}function S(e,t){const i=(null!=e.object.intersectionPriority?e.object.intersectionPriority:g.I.Normal)-(null!=t.object.intersectionPriority?t.object.intersectionPriority:g.I.Normal);return 0!==i?i:e.object.hasIntersectionPriorityWithRespectTo&&e.object.hasIntersectionPriorityWithRespectTo(t)?-1:t.object.hasIntersectionPriorityWithRespectTo&&t.object.hasIntersectionPriorityWithRespectTo(e)?1:e.distance-t.distance}function T(e,t){const i=null!=e.object.picking2DPriority?e.object.picking2DPriority:e.object.renderOrder,n=null!=t.object.picking2DPriority?t.object.picking2DPriority:t.object.renderOrder;return i>n?-1:i<n?1:S(e,t)}var I;!function(e){e[e.OctreeMeshes=0]="OctreeMeshes",e[e.DynamicMeshes=1]="DynamicMeshes"}(I||(I={}));var D=i(5243),N=i(43543),E=i(19968);class P{constructor(e,t){this.raycaster=e,this.cameraData=t,this.currentRay=new s.Ray,this.pointer=new s.Vector2(-2,-2),this.origin=new s.Vector3,this.direction=new s.Vector3,this.cast=e=>{const t=this.pointerRay;return this.raycaster.cast(t.origin,t.direction,e).slice()},this.updatePointer=e=>{this.pointer.set(e.x,e.y)}}get pointerRay(){const{origin:e,direction:t}=this.updateDirections();return this.currentRay.set(e,t)}get ndcPosition(){return this.pointer}updateDirections(){return(0,E.Ft)(this.cameraData.pose,this.origin.set(this.pointer.x,this.pointer.y,-1),this.origin),(0,E.Ft)(this.cameraData.pose,this.direction.set(this.pointer.x,this.pointer.y,1),this.direction),this.direction.sub(this.origin).normalize(),{origin:this.origin,direction:this.direction}}}class _{constructor(e,t,i){this.raycaster=e,this.data=t,this.cameraData=i,this.cache={normal4:new s.Vector4,normal:new s.Vector3,rotationMatrix:new s.Matrix4,ndc3:new s.Vector3}}beforeRenderViewport(){this.data.pointerRay.copy(this.raycaster.pointer.pointerRay),this.data.pointerOrigin.copy(this.data.pointerRay.origin),this.data.pointerDirection.copy(this.data.pointerRay.direction);const e=this.raycaster.pointer.cast();if(this.data.hits.length=0,this.data.hits.push(...e),this.data.pointerNdcPosition.copy(this.raycaster.pointer.ndcPosition),this.cache.ndc3.set(this.data.pointerNdcPosition.x,this.data.pointerNdcPosition.y,.5),this.data.pointerScreenPosition.copy((0,E.zH)(this.cameraData.width,this.cameraData.height,this.cache.ndc3)),e.length>0){const t=e[0];if(t&&t.face&&t.object instanceof s.Object3D){const e=t.face.normal;this.cache.normal4.set(e.x,e.y,e.z,0),this.cache.rotationMatrix.extractRotation(t.object.matrixWorld),this.cache.normal4.applyMatrix4(this.cache.rotationMatrix),this.cache.normal.set(this.cache.normal4.x,this.cache.normal4.y,this.cache.normal4.z),this.data.hit=new D.t(t.point.clone(),this.cache.normal.clone(),t.object,t)}}else this.data.hit=null;this.data.commit()}init(){}render(){}dispose(){this.data.hit=null,this.data.hits.length=0,this.data.commit()}activate(){}deactivate(){}}var C=i(10459),A=i(6687),x=i(70046),V=i(97171),M=function(e,t,i,n){var a,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var r=e.length-1;r>=0;r--)(a=e[r])&&(s=(o<3?a(s):o>3?a(t,i,s):a(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},L=function(e,t){return function(i,n){t(i,n,e)}};let R=class extends a.nV{constructor(e){var t;super(),this.name="raycaster",this.overridePointer=null,this.setOverridePointer=e=>{this.overridePointer=e};const i=null==e?void 0:e.manageDataForViewports((()=>new D.$));this.raycasterPointerData=null!==(t=null==i?void 0:i.switchableData)&&void 0!==t?t:new D.$,i&&this.bindings.push(...i.bindings)}async init(e,t){t.market.register(D.$,this.raycasterPointerData);const[i,n]=await Promise.all([t.getModuleBySymbol(o.M7),t.market.waitForData(C.M)]),a=i.getCamera();this.raycaster=new b(a,n,A.f_,null),t.addComponent(this,this.raycaster),this.defaultPointer=new P(this.raycaster,n),this.snapcaster=new N.v(n,t);const s=new _(this,this.raycasterPointerData,n);t.addComponent(this,s),t.broadcast(new x.sb(V.D.Raycaster)),t.broadcast(new x.sb(V.D.Octree)),t.broadcast(new x.sb(V.D.Snapping))}dispose(e){super.dispose(e),this.raycaster.dispose(),this.snapcaster.dispose()}setupOctree(e){this.raycaster.setupOctree(e),this.snapcaster.setupOctree(e)}setIntersectionFilter(e,t=!1){this.raycaster.updateIntersectionFilter(e,t)}getOctree(){return this.raycaster.getOctree()}get pointer(){return null!==this.overridePointer?this.overridePointer:this.defaultPointer}get targets(){return this.raycaster}get picking(){return this.raycaster}get snapping(){return this.snapcaster}get data(){return this.raycasterPointerData}};R=M([(0,n._q)(),L(0,(0,n.y_)(o.Qm)),O("design:paramtypes",[Object])],R);const F=R},63257:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ScheduleProcessCommand:()=>s.i,ScheduleTaskCommand:()=>o.m,Task:()=>c,default:()=>u});var n,a=i(77201),o=i(65936),s=i(27526),r=i(97800);class d{constructor(e){this.name=e,this.taskDurations=new r.CZ(100),this.medianDuration=1}get typicalStepDuration(){return this.medianDuration}addTaskDuration(e){this.taskDurations.push(e),this.taskDurations.index%10==0&&(this.medianDuration=this.taskDurations.median())}}!function(e){e.WAITING="waiting",e.STARTED="started",e.DONE="done"}(n||(n={}));class l{constructor(){this.tasks=[],this.types={}}getType(e){return this.types[e]||(this.types[e]=new d(e)),this.types[e]}addTask(e){this.tasks.push(e)}update(e){this.tasks=this.tasks.filter((e=>e.status!==n.DONE)),this.tasks.sort(((e,t)=>t.urgency-e.urgency));let t=0;e:for(const i of this.tasks)for(;i.status!==n.DONE;){const n=performance.now(),a=t+i.type.typicalStepDuration>e,o=n>=i.deadline;if(a&&!o)break e;const s=n;i.run();const r=performance.now()-s;i.type.addTaskDuration(r),t+=r}}}class c{constructor(e,t,i,a){this.type=e,this.func=t,this.deadline=i,this.steps=a,this.status=n.WAITING,this.promise=new Promise(((e,t)=>{this.onSuccess=e,this.onError=t}))}run(){let e;this.status=n.STARTED;try{e=this.func.next()}catch(e){return this.status=n.DONE,void this.onError(e)}this.steps-=1,e.done&&(this.status=n.DONE,this.onSuccess(e.value))}get estimatedDuration(){return this.steps*this.type.typicalStepDuration}get urgency(){const e=this.deadline-performance.now();return e<=0?1e6-e:this.estimatedDuration/e/e}}class u extends a.nV{constructor(){super(...arguments),this.name="scheduler-module",this.scheduler=new l}async init(e,t){this.engine=t,this.engine.commandBinder.addBinding(o.m,(async e=>{const t=new c(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t})),this.engine.commandBinder.addBinding(s.i,(async e=>{const t=new c(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t}))}onUpdate(e){this.scheduler.update(4)}}},33717:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h});var n=i(77201),a=i(71687),o=i(96540),s=i(5338),r=i(56147),d=i(74848),l=i(19151);function c({loadingMessage:e,messageDelay:t}){const[i,n]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{if(!i){const e=setTimeout((()=>{n(!0)}),t);return()=>clearTimeout(e)}return()=>{}})),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"spinner-container",children:(0,d.jsx)(l.A,{progress:33,barWidth:4,progressColor:"#ffffff"})}),i&&(0,d.jsx)("div",{className:"message",children:e})]})}class u extends n.nV{constructor(){super(...arguments),this.name="sdk-landing",this.messageDelay=3e3}async init(e,t){this.locale=await t.getModuleBySymbol(a.gS),this.reactContainer=document.createElement("div"),this.reactContainer.id="sdk-landing-container",this.container=e.container}show(){this.container.appendChild(this.reactContainer),this.reactRoot=(0,s.createRoot)(this.reactContainer),this.reactRoot.render((0,o.createElement)(c,{loadingMessage:this.locale.t(r.A.SDK.AWAITING),messageDelay:this.messageDelay}))}hide(){var e;this.container.removeChild(this.reactContainer),this.reactRoot.unmount(),null===(e=this.reactContainer)||void 0===e||e.remove()}}const h=u},87287:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Va});var n=i(10833),a=i(77201),o=i(97800),s=i(50380);function r(e,t){return fetch(e,Object.assign(Object.assign({},t),{credentials:"omit"}))}function d(e,t){const i=e instanceof Request?e.url:e,n=(0,s.v)(i,{},void 0);return fetch(e,Object.assign(Object.assign({},t),{headers:Object.assign(Object.assign({},null==t?void 0:t.headers),n)}))}const l=globalThis,{Array:c,Date:u,FinalizationRegistry:h,Float32Array:m,JSON:p,Map:v,Math:f,Number:g,Object:y,Promise:w,Proxy:b,Reflect:k,RegExp:S,Set:T,String:I,Symbol:D,WeakMap:N,WeakSet:E}=globalThis,{Error:P,RangeError:_,ReferenceError:C,SyntaxError:A,TypeError:x}=globalThis,{assign:V,create:M,defineProperties:O,entries:L,freeze:R,getOwnPropertyDescriptor:F,getOwnPropertyDescriptors:B,getOwnPropertyNames:U,getPrototypeOf:$,is:j,isFrozen:G,isSealed:z,isExtensible:H,keys:q,prototype:W,seal:K,preventExtensions:X,setPrototypeOf:Y,values:Q,fromEntries:J}=y,{species:Z,toStringTag:ee,iterator:te,matchAll:ie,unscopables:ne,keyFor:ae,for:oe}=D,{isInteger:se}=g,{stringify:re}=p,{defineProperty:de}=y,le=(e,t,i)=>{const n=de(e,t,i);if(n!==e)throw x(`Please report that the original defineProperty silently failed to set ${re(I(t))}. (SES_DEFINE_PROPERTY_FAILED_SILENTLY)`);return n},{apply:ce,construct:ue,get:he,getOwnPropertyDescriptor:me,has:pe,isExtensible:ve,ownKeys:fe,preventExtensions:ge,set:ye}=k,{isArray:we,prototype:be}=c,{prototype:ke}=v,{revocable:Se}=b,{prototype:Te}=RegExp,{prototype:Ie}=T,{prototype:De}=I,{prototype:Ne}=N,{prototype:Ee}=E,{prototype:Pe}=Function,{prototype:_e}=w,Ce=$(Uint8Array.prototype),{bind:Ae}=Pe,xe=Ae.bind(Ae.call),Ve=xe(W.hasOwnProperty),Me=xe(be.filter),Oe=xe(be.forEach),Le=xe(be.includes),Re=xe(be.join),Fe=xe(be.map),Be=xe(be.pop),Ue=xe(be.push),$e=xe(be.slice),je=xe(be.some),Ge=xe(be.sort),ze=xe(be[te]),He=xe(ke.set),qe=xe(ke.get),We=xe(ke.has),Ke=xe(ke.delete),Xe=xe(ke.entries),Ye=xe(ke[te]),Qe=xe(Ie.add),Je=(xe(Ie.delete),xe(Ie.forEach)),Ze=xe(Ie.has),et=xe(Ie[te]),tt=xe(Te.test),it=xe(Te.exec),nt=xe(Te[ie]),at=xe(De.endsWith),ot=xe(De.includes),st=xe(De.indexOf),rt=(xe(De.match),xe(De.replace)),dt=xe(De.search),lt=xe(De.slice),ct=xe(De.split),ut=xe(De.startsWith),ht=xe(De[te]),mt=xe(Ne.delete),pt=xe(Ne.get),vt=xe(Ne.has),ft=xe(Ne.set),gt=xe(Ee.add),yt=xe(Ee.has),wt=xe(Pe.toString),{all:bt}=w,kt=xe(_e.catch),St=xe(_e.then),Tt=h&&xe(h.prototype.register),It=(h&&xe(h.prototype.unregister),R(M(null))),Dt=e=>y(e)===e,Nt=e=>e instanceof P,Et=eval,Pt=Function,_t=()=>{throw x('Cannot eval with evalTaming set to "noEval" (SES_NO_EVAL)')};if(function(){return this}())throw x("SES failed to initialize, sloppy mode (SES_NO_SLOPPY)");const{freeze:Ct}=Object,{apply:At}=Reflect,xt=(e=>(t,...i)=>At(e,t,i))(Array.prototype.push),Vt=JSON.stringify,Mt=(e,...t)=>{let i=e[0];for(let n=0;n<t.length;n+=1)i=`${i}${t[n]}${e[n+1]}`;throw Error(i)},Ot=e=>{const t=[],i=(i,n)=>{"string"==typeof i||Mt`Environment option name ${Vt(i)} must be a string.`,"string"==typeof n||Mt`Environment option default setting ${Vt(n)} must be a string.`;let a=n;const o=e.process;if(o&&"object"==typeof o){const e=o.env;if(e&&"object"==typeof e&&i in e){xt(t,i);const n=e[i];"string"==typeof n||Mt`Environment option named ${Vt(i)}, if present, must have a corresponding string value, got ${Vt(n)}`,a=n}}return a};Ct(i);const n=()=>Ct([...t]);return Ct(n),Ct({getEnvironmentOption:i,getCapturedEnvironmentOptionNames:n})};Ct(Ot);const Lt=e=>(e=`${e}`).length>=1&&ot("aeiouAEIOU",e[0])?`an ${e}`:`a ${e}`;R(Lt);const Rt=(e,t=void 0)=>{const i=new T,n=(e,t)=>{switch(typeof t){case"object":{if(null===t)return null;if(Ze(i,t))return"[Seen]";if(Qe(i,t),Nt(t))return`[${t.name}: ${t.message}]`;if(ee in t)return`[${t[ee]}]`;if(we(t))return t;const e=q(t);if(e.length<2)return t;let n=!0;for(let t=1;t<e.length;t+=1)if(e[t-1]>=e[t]){n=!1;break}if(n)return t;Ge(e);const a=Fe(e,(e=>[e,t[e]]));return J(a)}case"function":return`[Function ${t.name||"<anon>"}]`;case"string":return ut(t,"[")?`[${t}]`:t;case"undefined":case"symbol":return`[${I(t)}]`;case"bigint":return`[${t}n]`;case"number":return j(t,NaN)?"[NaN]":t===1/0?"[Infinity]":t===-1/0?"[-Infinity]":t;default:return t}};try{return re(e,n,t)}catch(e){return"[Something that failed to stringify]"}};R(Rt);const{freeze:Ft}=Object,{isSafeInteger:Bt}=Number,Ut=e=>{const t={next:void 0,prev:void 0,data:e};return t.next=t,t.prev=t,t},$t=(e,t)=>{if(e===t)throw TypeError("Cannot splice a cell into itself");if(t.next!==t||t.prev!==t)throw TypeError("Expected self-linked cell");const i=t,n=e.next;return i.prev=e,i.next=n,e.next=i,n.prev=i,i},jt=e=>{const{prev:t,next:i}=e;t.next=i,i.prev=t,e.prev=e,e.next=e},Gt=e=>{if(!Bt(e)||e<0)throw TypeError("keysBudget must be a safe non-negative integer number");const t=new WeakMap;let i=0;const n=Ut(void 0),a=e=>{const i=t.get(e);if(void 0!==i&&void 0!==i.data)return jt(i),$t(n,i),i},o=e=>void 0!==a(e);Ft(o);const s=e=>{const t=a(e);return t&&t.data&&t.data.get(e)};Ft(s);const r=(o,s)=>{if(e<1)return l;let r=a(o);if(void 0===r&&(r=Ut(void 0),$t(n,r)),!r.data)for(i+=1,r.data=new WeakMap,t.set(o,r);i>e;){const e=n.prev;jt(e),e.data=void 0,i-=1}return r.data.set(o,s),l};Ft(r);const d=e=>{const n=t.get(e);return void 0!==n&&(jt(n),t.delete(e),void 0!==n.data&&(n.data=void 0,i-=1,!0))};Ft(d);const l=Ft({has:o,get:s,set:r,delete:d,[Symbol.toStringTag]:"LRUCacheMap"});return l};Ft(Gt);const zt=(e=1e3,t=100)=>{if(!Bt(t)||t<1)throw TypeError("argsPerErrorBudget must be a safe positive integer number");const i=Gt(e),n=(e,n)=>{const a=i.get(e);void 0!==a?(a.length>=t&&a.shift(),a.push(n)):i.set(e,[n])};Ft(n);const a=e=>{const t=i.get(e);return i.delete(e),t};return Ft(a),Ft({addLogArgs:n,takeLogArgsArray:a})};Ft(zt);const Ht=new N,qt=(e,t=void 0)=>{const i=R({toString:R((()=>Rt(e,t)))});return ft(Ht,i,e),i};R(qt);const Wt=R(/^[\w:-]( ?[\w:-])*$/),Kt=(e,t=void 0)=>{if("string"!=typeof e||!tt(Wt,e))return qt(e,t);const i=R({toString:R((()=>e))});return ft(Ht,i,e),i};R(Kt);const Xt=new N,Yt=({template:e,args:t})=>{const i=[e[0]];for(let n=0;n<t.length;n+=1){const a=t[n];let o;o=vt(Ht,a)?`${a}`:Nt(a)?`(${Lt(a.name)})`:`(${Lt(typeof a)})`,Ue(i,o,e[n+1])}return Re(i,"")},Qt=R({toString(){const e=pt(Xt,this);return void 0===e?"[Not a DetailsToken]":Yt(e)}});R(Qt.toString);const Jt=(e,...t)=>{const i=R({__proto__:Qt});return ft(Xt,i,{template:e,args:t}),i};R(Jt);const Zt=(e,...t)=>(t=Fe(t,(e=>vt(Ht,e)?e:qt(e))),Jt(e,...t));R(Zt);const ei=({template:e,args:t})=>{const i=[e[0]];for(let n=0;n<t.length;n+=1){let a=t[n];vt(Ht,a)&&(a=pt(Ht,a));const o=rt(Be(i)||"",/ $/,"");""!==o&&Ue(i,o);const s=rt(e[n+1],/^ /,"");Ue(i,a,s)}return""===i[i.length-1]&&Be(i),i},ti=new N;let ii=0;const ni=new N,ai=(e,t=e.name)=>{let i=pt(ni,e);return void 0!==i||(ii+=1,i=`${t}#${ii}`,ft(ni,e,i)),i},oi=(e=Jt`Assert failed`,t=l.Error,{errorName:i}={})=>{"string"==typeof e&&(e=Jt([e]));const n=pt(Xt,e);if(void 0===n)throw x(`unrecognized details ${qt(e)}`);const a=new t(Yt(n));return ft(ti,a,ei(n)),void 0!==i&&ai(a,i),a};R(oi);const{addLogArgs:si,takeLogArgsArray:ri}=zt(),di=new N,li=(e,t)=>{"string"==typeof t&&(t=Jt([t]));const i=pt(Xt,t);if(void 0===i)throw x(`unrecognized details ${qt(t)}`);const n=ei(i),a=pt(di,e);if(void 0!==a)for(const t of a)t(e,n);else si(e,n)};R(li);const ci={getStackString:l.getStackString||(e=>{if(!("stack"in e))return"";const t=`${e.stack}`,i=st(t,"\n");return ut(t," ")||-1===i?t:lt(t,i+1)}),tagError:e=>ai(e),resetErrorTagNum:()=>{ii=0},getMessageLogArgs:e=>pt(ti,e),takeMessageLogArgs:e=>{const t=pt(ti,e);return mt(ti,e),t},takeNoteLogArgsArray:(e,t)=>{const i=ri(e);if(void 0!==t){const i=pt(di,e);i?Ue(i,t):ft(di,e,[t])}return i||[]}};R(ci);const ui=(e=void 0,t=!1)=>{const i=t?Zt:Jt,n=i`Check failed`,a=(t=n,i=l.Error)=>{const a=oi(t,i);throw void 0!==e&&e(a),a};R(a);const o=(e,...t)=>a(i(e,...t));const s=(e,t,n=void 0,o=void 0)=>{j(e,t)||a(n||i`Expected ${e} is same as ${t}`,o||_)};R(s);const r=(e,t,n)=>{if(typeof e!==t){if("string"==typeof t||o`${qt(t)} must be a string`,void 0===n){const a=Lt(t);n=i`${e} must be ${Kt(a)}`}a(n,x)}};R(r);const d=V((function(e,t=void 0,i=void 0){e||a(t,i)}),{error:oi,fail:a,equal:s,typeof:r,string:(e,t=void 0)=>r(e,"string",t),note:li,details:i,Fail:o,quote:qt,bare:Kt,makeAssert:ui});return R(d)};R(ui);const hi=ui(),mi=F(Ce,ee);hi(mi);const pi=mi.get;hi(pi);const vi=e=>{X(e),Oe(fe(e),(t=>{const i=F(e,t);hi(i),(e=>{const t=+I(e);return se(t)&&I(t)===e})(t)||le(e,t,{...i,writable:!1,configurable:!1})}))},fi={Infinity:1/0,NaN:NaN,undefined:void 0},gi={isFinite:"isFinite",isNaN:"isNaN",parseFloat:"parseFloat",parseInt:"parseInt",decodeURI:"decodeURI",decodeURIComponent:"decodeURIComponent",encodeURI:"encodeURI",encodeURIComponent:"encodeURIComponent",Array:"Array",ArrayBuffer:"ArrayBuffer",BigInt:"BigInt",BigInt64Array:"BigInt64Array",BigUint64Array:"BigUint64Array",Boolean:"Boolean",DataView:"DataView",EvalError:"EvalError",Float32Array:"Float32Array",Float64Array:"Float64Array",Int8Array:"Int8Array",Int16Array:"Int16Array",Int32Array:"Int32Array",Map:"Map",Number:"Number",Object:"Object",Promise:"Promise",Proxy:"Proxy",RangeError:"RangeError",ReferenceError:"ReferenceError",Set:"Set",String:"String",SyntaxError:"SyntaxError",TypeError:"TypeError",Uint8Array:"Uint8Array",Uint8ClampedArray:"Uint8ClampedArray",Uint16Array:"Uint16Array",Uint32Array:"Uint32Array",URIError:"URIError",WeakMap:"WeakMap",WeakSet:"WeakSet",Iterator:"Iterator",AsyncIterator:"AsyncIterator",JSON:"JSON",Reflect:"Reflect",escape:"escape",unescape:"unescape",lockdown:"lockdown",harden:"harden",HandledPromise:"HandledPromise"},yi={Date:"%InitialDate%",Error:"%InitialError%",RegExp:"%InitialRegExp%",Math:"%InitialMath%",getStackString:"%InitialGetStackString%"},wi={Date:"%SharedDate%",Error:"%SharedError%",RegExp:"%SharedRegExp%",Symbol:"%SharedSymbol%",Math:"%SharedMath%"},bi=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError],ki={"[[Proto]]":"%FunctionPrototype%",length:"number",name:"string"},Si=ki,Ti={"[[Proto]]":"%AsyncFunctionPrototype%"},Ii={get:Si,set:"undefined"},Di={get:Si,set:Si},Ni=e=>e===Ii||e===Di;function Ei(e){return{"[[Proto]]":"%SharedError%",prototype:e}}function Pi(e){return{"[[Proto]]":"%ErrorPrototype%",constructor:e,message:"string",name:"string",toString:!1,cause:!1}}function _i(e){return{"[[Proto]]":"%TypedArray%",BYTES_PER_ELEMENT:"number",prototype:e}}function Ci(e){return{"[[Proto]]":"%TypedArrayPrototype%",BYTES_PER_ELEMENT:"number",constructor:e}}const Ai={E:"number",LN10:"number",LN2:"number",LOG10E:"number",LOG2E:"number",PI:"number",SQRT1_2:"number",SQRT2:"number","@@toStringTag":"string",abs:Si,acos:Si,acosh:Si,asin:Si,asinh:Si,atan:Si,atanh:Si,atan2:Si,cbrt:Si,ceil:Si,clz32:Si,cos:Si,cosh:Si,exp:Si,expm1:Si,floor:Si,fround:Si,hypot:Si,imul:Si,log:Si,log1p:Si,log10:Si,log2:Si,max:Si,min:Si,pow:Si,round:Si,sign:Si,sin:Si,sinh:Si,sqrt:Si,tan:Si,tanh:Si,trunc:Si,idiv:!1,idivmod:!1,imod:!1,imuldiv:!1,irem:!1,mod:!1},xi={"[[Proto]]":null,"%ThrowTypeError%":Si,Infinity:"number",NaN:"number",undefined:"undefined","%UniqueEval%":Si,isFinite:Si,isNaN:Si,parseFloat:Si,parseInt:Si,decodeURI:Si,decodeURIComponent:Si,encodeURI:Si,encodeURIComponent:Si,Object:{"[[Proto]]":"%FunctionPrototype%",assign:Si,create:Si,defineProperties:Si,defineProperty:Si,entries:Si,freeze:Si,fromEntries:Si,getOwnPropertyDescriptor:Si,getOwnPropertyDescriptors:Si,getOwnPropertyNames:Si,getOwnPropertySymbols:Si,getPrototypeOf:Si,hasOwn:Si,is:Si,isExtensible:Si,isFrozen:Si,isSealed:Si,keys:Si,preventExtensions:Si,prototype:"%ObjectPrototype%",seal:Si,setPrototypeOf:Si,values:Si,groupBy:Si},"%ObjectPrototype%":{"[[Proto]]":null,constructor:"Object",hasOwnProperty:Si,isPrototypeOf:Si,propertyIsEnumerable:Si,toLocaleString:Si,toString:Si,valueOf:Si,"--proto--":Di,__defineGetter__:Si,__defineSetter__:Si,__lookupGetter__:Si,__lookupSetter__:Si},"%UniqueFunction%":{"[[Proto]]":"%FunctionPrototype%",prototype:"%FunctionPrototype%"},"%InertFunction%":{"[[Proto]]":"%FunctionPrototype%",prototype:"%FunctionPrototype%"},"%FunctionPrototype%":{apply:Si,bind:Si,call:Si,constructor:"%InertFunction%",toString:Si,"@@hasInstance":Si,caller:!1,arguments:!1},Boolean:{"[[Proto]]":"%FunctionPrototype%",prototype:"%BooleanPrototype%"},"%BooleanPrototype%":{constructor:"Boolean",toString:Si,valueOf:Si},"%SharedSymbol%":{"[[Proto]]":"%FunctionPrototype%",asyncDispose:"symbol",asyncIterator:"symbol",dispose:"symbol",for:Si,hasInstance:"symbol",isConcatSpreadable:"symbol",iterator:"symbol",keyFor:Si,match:"symbol",matchAll:"symbol",prototype:"%SymbolPrototype%",replace:"symbol",search:"symbol",species:"symbol",split:"symbol",toPrimitive:"symbol",toStringTag:"symbol",unscopables:"symbol",useSimple:!1,useSetter:!1},"%SymbolPrototype%":{constructor:"%SharedSymbol%",description:Ii,toString:Si,valueOf:Si,"@@toPrimitive":Si,"@@toStringTag":"string"},"%InitialError%":{"[[Proto]]":"%FunctionPrototype%",prototype:"%ErrorPrototype%",captureStackTrace:Si,stackTraceLimit:Di,prepareStackTrace:Di},"%SharedError%":{"[[Proto]]":"%FunctionPrototype%",prototype:"%ErrorPrototype%",captureStackTrace:Si,stackTraceLimit:Di,prepareStackTrace:Di},"%ErrorPrototype%":{constructor:"%SharedError%",message:"string",name:"string",toString:Si,at:!1,stack:Di,cause:!1},EvalError:Ei("%EvalErrorPrototype%"),RangeError:Ei("%RangeErrorPrototype%"),ReferenceError:Ei("%ReferenceErrorPrototype%"),SyntaxError:Ei("%SyntaxErrorPrototype%"),TypeError:Ei("%TypeErrorPrototype%"),URIError:Ei("%URIErrorPrototype%"),"%EvalErrorPrototype%":Pi("EvalError"),"%RangeErrorPrototype%":Pi("RangeError"),"%ReferenceErrorPrototype%":Pi("ReferenceError"),"%SyntaxErrorPrototype%":Pi("SyntaxError"),"%TypeErrorPrototype%":Pi("TypeError"),"%URIErrorPrototype%":Pi("URIError"),Number:{"[[Proto]]":"%FunctionPrototype%",EPSILON:"number",isFinite:Si,isInteger:Si,isNaN:Si,isSafeInteger:Si,MAX_SAFE_INTEGER:"number",MAX_VALUE:"number",MIN_SAFE_INTEGER:"number",MIN_VALUE:"number",NaN:"number",NEGATIVE_INFINITY:"number",parseFloat:Si,parseInt:Si,POSITIVE_INFINITY:"number",prototype:"%NumberPrototype%"},"%NumberPrototype%":{constructor:"Number",toExponential:Si,toFixed:Si,toLocaleString:Si,toPrecision:Si,toString:Si,valueOf:Si},BigInt:{"[[Proto]]":"%FunctionPrototype%",asIntN:Si,asUintN:Si,prototype:"%BigIntPrototype%",bitLength:!1,fromArrayBuffer:!1},"%BigIntPrototype%":{constructor:"BigInt",toLocaleString:Si,toString:Si,valueOf:Si,"@@toStringTag":"string"},"%InitialMath%":{...Ai,random:Si},"%SharedMath%":{...Ai,random:Si},"%InitialDate%":{"[[Proto]]":"%FunctionPrototype%",now:Si,parse:Si,prototype:"%DatePrototype%",UTC:Si},"%SharedDate%":{"[[Proto]]":"%FunctionPrototype%",now:Si,parse:Si,prototype:"%DatePrototype%",UTC:Si},"%DatePrototype%":{constructor:"%SharedDate%",getDate:Si,getDay:Si,getFullYear:Si,getHours:Si,getMilliseconds:Si,getMinutes:Si,getMonth:Si,getSeconds:Si,getTime:Si,getTimezoneOffset:Si,getUTCDate:Si,getUTCDay:Si,getUTCFullYear:Si,getUTCHours:Si,getUTCMilliseconds:Si,getUTCMinutes:Si,getUTCMonth:Si,getUTCSeconds:Si,setDate:Si,setFullYear:Si,setHours:Si,setMilliseconds:Si,setMinutes:Si,setMonth:Si,setSeconds:Si,setTime:Si,setUTCDate:Si,setUTCFullYear:Si,setUTCHours:Si,setUTCMilliseconds:Si,setUTCMinutes:Si,setUTCMonth:Si,setUTCSeconds:Si,toDateString:Si,toISOString:Si,toJSON:Si,toLocaleDateString:Si,toLocaleString:Si,toLocaleTimeString:Si,toString:Si,toTimeString:Si,toUTCString:Si,valueOf:Si,"@@toPrimitive":Si,getYear:Si,setYear:Si,toGMTString:Si},String:{"[[Proto]]":"%FunctionPrototype%",fromCharCode:Si,fromCodePoint:Si,prototype:"%StringPrototype%",raw:Si,fromArrayBuffer:!1},"%StringPrototype%":{length:"number",at:Si,charAt:Si,charCodeAt:Si,codePointAt:Si,concat:Si,constructor:"String",endsWith:Si,includes:Si,indexOf:Si,lastIndexOf:Si,localeCompare:Si,match:Si,matchAll:Si,normalize:Si,padEnd:Si,padStart:Si,repeat:Si,replace:Si,replaceAll:Si,search:Si,slice:Si,split:Si,startsWith:Si,substring:Si,toLocaleLowerCase:Si,toLocaleUpperCase:Si,toLowerCase:Si,toString:Si,toUpperCase:Si,trim:Si,trimEnd:Si,trimStart:Si,valueOf:Si,"@@iterator":Si,substr:Si,anchor:Si,big:Si,blink:Si,bold:Si,fixed:Si,fontcolor:Si,fontsize:Si,italics:Si,link:Si,small:Si,strike:Si,sub:Si,sup:Si,trimLeft:Si,trimRight:Si,compare:!1,isWellFormed:Si,toWellFormed:Si,unicodeSets:Si},"%StringIteratorPrototype%":{"[[Proto]]":"%IteratorPrototype%",next:Si,"@@toStringTag":"string"},"%InitialRegExp%":{"[[Proto]]":"%FunctionPrototype%",prototype:"%RegExpPrototype%","@@species":Ii,input:!1,$_:!1,lastMatch:!1,"$&":!1,lastParen:!1,"$+":!1,leftContext:!1,"$`":!1,rightContext:!1,"$'":!1,$1:!1,$2:!1,$3:!1,$4:!1,$5:!1,$6:!1,$7:!1,$8:!1,$9:!1},"%SharedRegExp%":{"[[Proto]]":"%FunctionPrototype%",prototype:"%RegExpPrototype%","@@species":Ii},"%RegExpPrototype%":{constructor:"%SharedRegExp%",exec:Si,dotAll:Ii,flags:Ii,global:Ii,hasIndices:Ii,ignoreCase:Ii,"@@match":Si,"@@matchAll":Si,multiline:Ii,"@@replace":Si,"@@search":Si,source:Ii,"@@split":Si,sticky:Ii,test:Si,toString:Si,unicode:Ii,unicodeSets:Ii,compile:!1},"%RegExpStringIteratorPrototype%":{"[[Proto]]":"%IteratorPrototype%",next:Si,"@@toStringTag":"string"},Array:{"[[Proto]]":"%FunctionPrototype%",from:Si,isArray:Si,of:Si,prototype:"%ArrayPrototype%","@@species":Ii,at:Si,fromAsync:Si},"%ArrayPrototype%":{at:Si,length:"number",concat:Si,constructor:"Array",copyWithin:Si,entries:Si,every:Si,fill:Si,filter:Si,find:Si,findIndex:Si,flat:Si,flatMap:Si,forEach:Si,includes:Si,indexOf:Si,join:Si,keys:Si,lastIndexOf:Si,map:Si,pop:Si,push:Si,reduce:Si,reduceRight:Si,reverse:Si,shift:Si,slice:Si,some:Si,sort:Si,splice:Si,toLocaleString:Si,toString:Si,unshift:Si,values:Si,"@@iterator":Si,"@@unscopables":{"[[Proto]]":null,copyWithin:"boolean",entries:"boolean",fill:"boolean",find:"boolean",findIndex:"boolean",flat:"boolean",flatMap:"boolean",includes:"boolean",keys:"boolean",values:"boolean",at:"boolean",findLast:"boolean",findLastIndex:"boolean",toReversed:"boolean",toSorted:"boolean",toSpliced:"boolean",with:"boolean",group:"boolean",groupToMap:"boolean",groupBy:"boolean"},findLast:Si,findLastIndex:Si,toReversed:Si,toSorted:Si,toSpliced:Si,with:Si,group:Si,groupToMap:Si,groupBy:Si},"%ArrayIteratorPrototype%":{"[[Proto]]":"%IteratorPrototype%",next:Si,"@@toStringTag":"string"},"%TypedArray%":{"[[Proto]]":"%FunctionPrototype%",from:Si,of:Si,prototype:"%TypedArrayPrototype%","@@species":Ii},"%TypedArrayPrototype%":{at:Si,buffer:Ii,byteLength:Ii,byteOffset:Ii,constructor:"%TypedArray%",copyWithin:Si,entries:Si,every:Si,fill:Si,filter:Si,find:Si,findIndex:Si,forEach:Si,includes:Si,indexOf:Si,join:Si,keys:Si,lastIndexOf:Si,length:Ii,map:Si,reduce:Si,reduceRight:Si,reverse:Si,set:Si,slice:Si,some:Si,sort:Si,subarray:Si,toLocaleString:Si,toString:Si,values:Si,"@@iterator":Si,"@@toStringTag":Ii,findLast:Si,findLastIndex:Si,toReversed:Si,toSorted:Si,with:Si},BigInt64Array:_i("%BigInt64ArrayPrototype%"),BigUint64Array:_i("%BigUint64ArrayPrototype%"),Float32Array:_i("%Float32ArrayPrototype%"),Float64Array:_i("%Float64ArrayPrototype%"),Int16Array:_i("%Int16ArrayPrototype%"),Int32Array:_i("%Int32ArrayPrototype%"),Int8Array:_i("%Int8ArrayPrototype%"),Uint16Array:_i("%Uint16ArrayPrototype%"),Uint32Array:_i("%Uint32ArrayPrototype%"),Uint8Array:_i("%Uint8ArrayPrototype%"),Uint8ClampedArray:_i("%Uint8ClampedArrayPrototype%"),"%BigInt64ArrayPrototype%":Ci("BigInt64Array"),"%BigUint64ArrayPrototype%":Ci("BigUint64Array"),"%Float32ArrayPrototype%":Ci("Float32Array"),"%Float64ArrayPrototype%":Ci("Float64Array"),"%Int16ArrayPrototype%":Ci("Int16Array"),"%Int32ArrayPrototype%":Ci("Int32Array"),"%Int8ArrayPrototype%":Ci("Int8Array"),"%Uint16ArrayPrototype%":Ci("Uint16Array"),"%Uint32ArrayPrototype%":Ci("Uint32Array"),"%Uint8ArrayPrototype%":Ci("Uint8Array"),"%Uint8ClampedArrayPrototype%":Ci("Uint8ClampedArray"),Map:{"[[Proto]]":"%FunctionPrototype%","@@species":Ii,prototype:"%MapPrototype%",groupBy:Si},"%MapPrototype%":{clear:Si,constructor:"Map",delete:Si,entries:Si,forEach:Si,get:Si,has:Si,keys:Si,set:Si,size:Ii,values:Si,"@@iterator":Si,"@@toStringTag":"string"},"%MapIteratorPrototype%":{"[[Proto]]":"%IteratorPrototype%",next:Si,"@@toStringTag":"string"},Set:{"[[Proto]]":"%FunctionPrototype%",prototype:"%SetPrototype%","@@species":Ii},"%SetPrototype%":{add:Si,clear:Si,constructor:"Set",delete:Si,entries:Si,forEach:Si,has:Si,keys:Si,size:Ii,values:Si,"@@iterator":Si,"@@toStringTag":"string"},"%SetIteratorPrototype%":{"[[Proto]]":"%IteratorPrototype%",next:Si,"@@toStringTag":"string"},WeakMap:{"[[Proto]]":"%FunctionPrototype%",prototype:"%WeakMapPrototype%"},"%WeakMapPrototype%":{constructor:"WeakMap",delete:Si,get:Si,has:Si,set:Si,"@@toStringTag":"string"},WeakSet:{"[[Proto]]":"%FunctionPrototype%",prototype:"%WeakSetPrototype%"},"%WeakSetPrototype%":{add:Si,constructor:"WeakSet",delete:Si,has:Si,"@@toStringTag":"string"},ArrayBuffer:{"[[Proto]]":"%FunctionPrototype%",isView:Si,prototype:"%ArrayBufferPrototype%","@@species":Ii,fromString:!1,fromBigInt:!1},"%ArrayBufferPrototype%":{byteLength:Ii,constructor:"ArrayBuffer",slice:Si,"@@toStringTag":"string",concat:!1,transfer:Si,resize:Si,resizable:Ii,maxByteLength:Ii,transferToFixedLength:Si,detached:Ii},SharedArrayBuffer:!1,"%SharedArrayBufferPrototype%":!1,DataView:{"[[Proto]]":"%FunctionPrototype%",BYTES_PER_ELEMENT:"number",prototype:"%DataViewPrototype%"},"%DataViewPrototype%":{buffer:Ii,byteLength:Ii,byteOffset:Ii,constructor:"DataView",getBigInt64:Si,getBigUint64:Si,getFloat32:Si,getFloat64:Si,getInt8:Si,getInt16:Si,getInt32:Si,getUint8:Si,getUint16:Si,getUint32:Si,setBigInt64:Si,setBigUint64:Si,setFloat32:Si,setFloat64:Si,setInt8:Si,setInt16:Si,setInt32:Si,setUint8:Si,setUint16:Si,setUint32:Si,"@@toStringTag":"string"},Atomics:!1,JSON:{parse:Si,stringify:Si,"@@toStringTag":"string",rawJSON:Si,isRawJSON:Si},Iterator:{"[[Proto]]":"%FunctionPrototype%",prototype:"%IteratorPrototype%",from:Si},"%IteratorPrototype%":{"@@iterator":Si,constructor:"Iterator",map:Si,filter:Si,take:Si,drop:Si,flatMap:Si,reduce:Si,toArray:Si,forEach:Si,some:Si,every:Si,find:Si,"@@toStringTag":"string",toAsync:Si},"%WrapForValidIteratorPrototype%":{"[[Proto]]":"%IteratorPrototype%",next:Si,return:Si},"%IteratorHelperPrototype%":{"[[Proto]]":"%IteratorPrototype%",next:Si,return:Si,"@@toStringTag":"string"},AsyncIterator:{"[[Proto]]":"%FunctionPrototype%",prototype:"%AsyncIteratorPrototype%",from:Si},"%AsyncIteratorPrototype%":{"@@asyncIterator":Si,constructor:"AsyncIterator",map:Si,filter:Si,take:Si,drop:Si,flatMap:Si,reduce:Si,toArray:Si,forEach:Si,some:Si,every:Si,find:Si,"@@toStringTag":"string"},"%WrapForValidAsyncIteratorPrototype%":{"[[Proto]]":"%AsyncIteratorPrototype%",next:Si,return:Si},"%AsyncIteratorHelperPrototype%":{"[[Proto]]":"%AsyncIteratorPrototype%",next:Si,return:Si,"@@toStringTag":"string"},"%InertGeneratorFunction%":{"[[Proto]]":"%InertFunction%",prototype:"%Generator%"},"%Generator%":{"[[Proto]]":"%FunctionPrototype%",constructor:"%InertGeneratorFunction%",prototype:"%GeneratorPrototype%","@@toStringTag":"string"},"%InertAsyncGeneratorFunction%":{"[[Proto]]":"%InertFunction%",prototype:"%AsyncGenerator%"},"%AsyncGenerator%":{"[[Proto]]":"%FunctionPrototype%",constructor:"%InertAsyncGeneratorFunction%",prototype:"%AsyncGeneratorPrototype%",length:"number","@@toStringTag":"string"},"%GeneratorPrototype%":{"[[Proto]]":"%IteratorPrototype%",constructor:"%Generator%",next:Si,return:Si,throw:Si,"@@toStringTag":"string"},"%AsyncGeneratorPrototype%":{"[[Proto]]":"%AsyncIteratorPrototype%",constructor:"%AsyncGenerator%",next:Si,return:Si,throw:Si,"@@toStringTag":"string"},HandledPromise:{"[[Proto]]":"Promise",applyFunction:Si,applyFunctionSendOnly:Si,applyMethod:Si,applyMethodSendOnly:Si,get:Si,getSendOnly:Si,prototype:"%PromisePrototype%",resolve:Si},Promise:{"[[Proto]]":"%FunctionPrototype%",all:Si,allSettled:Si,any:!1,prototype:"%PromisePrototype%",race:Si,reject:Si,resolve:Si,"@@species":Ii},"%PromisePrototype%":{catch:Si,constructor:"Promise",finally:Si,then:Si,"@@toStringTag":"string","UniqueSymbol(async_id_symbol)":Di,"UniqueSymbol(trigger_async_id_symbol)":Di,"UniqueSymbol(destroyed)":Di},"%InertAsyncFunction%":{"[[Proto]]":"%InertFunction%",prototype:"%AsyncFunctionPrototype%"},"%AsyncFunctionPrototype%":{"[[Proto]]":"%FunctionPrototype%",constructor:"%InertAsyncFunction%",length:"number","@@toStringTag":"string"},Reflect:{apply:Si,construct:Si,defineProperty:Si,deleteProperty:Si,get:Si,getOwnPropertyDescriptor:Si,getPrototypeOf:Si,has:Si,isExtensible:Si,ownKeys:Si,preventExtensions:Si,set:Si,setPrototypeOf:Si,"@@toStringTag":"string"},Proxy:{"[[Proto]]":"%FunctionPrototype%",revocable:Si},escape:Si,unescape:Si,"%UniqueCompartment%":{"[[Proto]]":"%FunctionPrototype%",prototype:"%CompartmentPrototype%",toString:Si},"%InertCompartment%":{"[[Proto]]":"%FunctionPrototype%",prototype:"%CompartmentPrototype%",toString:Si},"%CompartmentPrototype%":{constructor:"%InertCompartment%",evaluate:Si,globalThis:Ii,name:Ii,toString:Si,import:Ti,load:Ti,importNow:Si,module:Si},lockdown:Si,harden:{...Si,isFake:"boolean"},"%InitialGetStackString%":Si},Vi=e=>"function"==typeof e;function Mi(e,t,i){if(Ve(e,t)){const n=F(e,t);if(!n||!j(n.value,i.value)||n.get!==i.get||n.set!==i.set||n.writable!==i.writable||n.enumerable!==i.enumerable||n.configurable!==i.configurable)throw x(`Conflicting definitions of ${t}`)}le(e,t,i)}function Oi(e,t){const i={__proto__:null};for(const[n,a]of L(t))Ve(e,n)&&(i[a]=e[n]);return i}const Li=()=>{const e=M(null);let t;const i=t=>{!function(e,t){for(const[i,n]of L(t))Mi(e,i,n)}(e,B(t))};R(i);const n=()=>{for(const[t,i]of L(e)){if(!Dt(i))continue;if(!Ve(i,"prototype"))continue;const n=xi[t];if("object"!=typeof n)throw x(`Expected permit object at whitelist.${t}`);const a=n.prototype;if(!a)throw x(`${t}.prototype property not whitelisted`);if("string"!=typeof a||!Ve(xi,a))throw x(`Unrecognized ${t}.prototype whitelist entry`);const o=i.prototype;if(Ve(e,a)){if(e[a]!==o)throw x(`Conflicting bindings of ${a}`)}else e[a]=o}};R(n);const a=()=>(R(e),t=new E(Me(Q(e),Vi)),e);R(a);const o=e=>{if(!t)throw x("isPseudoNative can only be called after finalIntrinsics");return yt(t,e)};R(o);const s={addIntrinsics:i,completePrototypes:n,finalIntrinsics:a,isPseudoNative:o};return R(s),i(fi),i(Oi(l,gi)),s};function Ri(e,t){const i=["undefined","boolean","number","string","symbol"],n=new v(D?Fe(Me(L(xi["%SharedSymbol%"]),(([e,t])=>"symbol"===t&&"symbol"==typeof D[e])),(([e])=>[D[e],`@@${e}`])):[]);function a(e,t){if("string"==typeof t)return t;const i=qe(n,t);if("symbol"==typeof t){if(i)return i;{const e=ae(t);return void 0!==e?`RegisteredSymbol(${e})`:`Unique${I(t)}`}}throw x(`Unexpected property name type ${e} ${t}`)}function o(t,n,a,o){if("object"==typeof o)return d(t,n,o),!0;if(!1===o)return!1;if("string"==typeof o)if("prototype"===a||"constructor"===a){if(Ve(e,o)){if(n!==e[o])throw x(`Does not match whitelist ${t}`);return!0}}else if(Le(i,o)){if(typeof n!==o)throw x(`At ${t} expected ${o} not ${typeof n}`);return!0}throw x(`Unexpected whitelist permit ${o} at ${t}`)}function s(e,t,i,n){const a=F(t,i);if(!a)throw x(`Property ${i} not found at ${e}`);if(Ve(a,"value")){if(Ni(n))throw x(`Accessor expected at ${e}`);return o(e,a.value,i,n)}if(!Ni(n))throw x(`Accessor not expected at ${e}`);return o(`${e}<get>`,a.get,i,n.get)&&o(`${e}<set>`,a.set,i,n.set)}function r(e,t,i){const n="__proto__"===i?"--proto--":i;return Ve(t,n)?t[n]:"function"==typeof e&&Ve(ki,n)?ki[n]:void 0}function d(i,n,o){if(null==n)return;!function(t,i,n){if(!Dt(i))throw x(`Object expected: ${t}, ${i}, ${n}`);const a=$(i);if(null!==a||null!==n){if(void 0!==n&&"string"!=typeof n)throw x(`Malformed whitelist permit ${t}.__proto__`);if(a!==e[n||"%ObjectPrototype%"])throw x(`Unexpected intrinsic ${t}.__proto__ at ${n}`)}}(i,n,o["[[Proto]]"]),"function"==typeof n&&t(n);for(const e of fe(n)){const t=a(i,e),d=`${i}.${t}`,l=r(n,o,t);if(!l||!s(d,n,e,l)){!1!==l&&console.warn(`Removing ${d}`);try{delete n[e]}catch(t){if(e in n){if("function"==typeof n&&"prototype"===e&&(n.prototype=void 0,void 0===n.prototype)){console.warn(`Tolerating undeletable ${d} === undefined`);continue}console.error(`failed to delete ${d}`,t)}else console.error(`deleting ${d} threw`,t);throw t}}}}d("intrinsics",e,xi)}const Fi={"%ObjectPrototype%":{toString:!0},"%FunctionPrototype%":{toString:!0},"%ErrorPrototype%":{name:!0}},Bi={"%ObjectPrototype%":{toString:!0,valueOf:!0},"%ArrayPrototype%":{toString:!0,push:!0},"%FunctionPrototype%":{constructor:!0,bind:!0,toString:!0},"%ErrorPrototype%":{constructor:!0,message:!0,name:!0,toString:!0},"%TypeErrorPrototype%":{constructor:!0,message:!0,name:!0},"%SyntaxErrorPrototype%":{message:!0,name:!0},"%RangeErrorPrototype%":{message:!0,name:!0},"%URIErrorPrototype%":{message:!0,name:!0},"%EvalErrorPrototype%":{message:!0,name:!0},"%ReferenceErrorPrototype%":{message:!0,name:!0},"%PromisePrototype%":{constructor:!0},"%TypedArrayPrototype%":"*","%Generator%":{constructor:!0,name:!0,toString:!0},"%IteratorPrototype%":{toString:!0}},Ui={...Bi,"%ObjectPrototype%":"*","%TypedArrayPrototype%":"*","%MapPrototype%":"*","%SetPrototype%":"*"};const{Fail:$i,quote:ji}=hi,Gi=/^(\w*[a-z])Locale([A-Z]\w*)$/,zi={localeCompare(e){if(null==this)throw x('Cannot localeCompare with null or undefined "this" value');const t=`${this}`,i=`${e}`;return t<i?-1:t>i?1:(t===i||$i`expected ${ji(t)} and ${ji(i)} to compare`,0)},toString(){return`${this}`}},Hi=zi.localeCompare,qi=zi.toString;const{Fail:Wi}=hi,Ki=e=>{for(const[t,i]of L(fi))le(e,t,{value:i,writable:!1,enumerable:!1,configurable:!1})},Xi=(e,{intrinsics:t,newGlobalPropertyNames:i,makeCompartmentConstructor:n,markVirtualizedNativeFunction:a})=>{for(const[i,n]of L(gi))Ve(t,n)&&le(e,i,{value:t[n],writable:!0,enumerable:!1,configurable:!0});for(const[n,a]of L(i))Ve(t,a)&&le(e,n,{value:t[a],writable:!0,enumerable:!1,configurable:!0});const o={globalThis:e};o.Compartment=n(n,t,a);for(const[t,i]of L(o))le(e,t,{value:i,writable:!0,enumerable:!1,configurable:!0}),"function"==typeof i&&a(i)},Yi=(e,t,i)=>{{const a=(n=t,e=>"string"!=typeof e?e:n(e));i(a),le(e,"eval",{value:a,writable:!0,enumerable:!1,configurable:!0})}var n;{const n=(e=>{const t=function(t){const i=`${Be(arguments)||""}`,n=`${Re(arguments,",")}`;return new Pt(n,""),new Pt(i),e(`(function anonymous(${n}\n) {\n${i}\n})`)};return O(t,{prototype:{value:Pt.prototype,writable:!1,enumerable:!1,configurable:!1}}),$(Pt)===Pt.prototype||Wi`Function prototype is the same accross compartments`,$(t)===Pt.prototype||Wi`Function constructor prototype is the same accross compartments`,t})(t);i(n),le(e,"Function",{value:n,writable:!0,enumerable:!1,configurable:!0})}},{Fail:Qi,quote:Ji}=hi,Zi=new b(It,R({get(e,t){Qi`Please report unexpected scope handler trap: ${Ji(I(t))}`}})),en=R(M(Zi,B({get(e,t){},set(e,t,i){throw C(`${I(t)} is not defined`)},has:(e,t)=>t in l,getPrototypeOf:e=>null,getOwnPropertyDescriptor(e,t){const i=Ji(I(t));console.warn(`getOwnPropertyDescriptor trap on scopeTerminatorHandler for ${i}`,x().stack)},ownKeys:e=>[]}))),tn=new b(It,en),nn=e=>{const t={...en,set:(t,i,n)=>ye(e,i,n),has:(e,t)=>!0},i=R(M(Zi,B(t)));return new b(It,i)};R(nn);const{Fail:an}=hi,on="\\s*[@#]\\s*([a-zA-Z][a-zA-Z0-9]*)\\s*=\\s*([^\\s\\*]*)",sn=new S(`(?:\\s*//${on}|/\\*${on}\\s*\\*/)\\s*$`),rn=e=>{let t="<unknown>";for(;e.length>0;){const i=it(sn,e);if(null===i)break;e=lt(e,0,e.length-i[0].length),"sourceURL"===i[3]?t=i[4]:"sourceURL"===i[1]&&(t=i[2])}return t};function dn(e,t){const i=dt(e,t);if(i<0)return-1;const n="\n"===e[i]?1:0;return ct(lt(e,0,i),"\n").length+n}const ln=new S("(?:\x3c!--|--\x3e)","g"),cn=e=>{const t=dn(e,ln);if(t<0)return e;const i=rn(e);throw A(`Possible HTML comment rejected at ${i}:${t}. (SES_HTML_COMMENT_REJECTED)`)},un=e=>rt(e,ln,(e=>"<"===e[0]?"< ! --":"-- >")),hn=new S("(^|[^.]|\\.\\.\\.)\\bimport(\\s*(?:\\(|/[/*]))","g"),mn=e=>{const t=dn(e,hn);if(t<0)return e;const i=rn(e);throw A(`Possible import expression rejected at ${i}:${t}. (SES_IMPORT_REJECTED)`)},pn=e=>rt(e,hn,((e,t,i)=>`${t}__import__${i}`)),vn=new S("(^|[^.])\\beval(\\s*\\()","g"),fn=e=>{const t=dn(e,vn);if(t<0)return e;const i=rn(e);throw A(`Possible direct eval expression rejected at ${i}:${t}. (SES_EVAL_REJECTED)`)},gn=e=>(e=cn(e),e=mn(e)),yn=(e,t)=>{for(const i of t)e=i(e);return e},wn=(R({rejectHtmlComments:R(cn),evadeHtmlCommentTest:R(un),rejectImportExpressions:R(mn),evadeImportExpressionTest:R(pn),rejectSomeDirectEvalExpressions:R(fn),mandatoryTransforms:R(gn),applyTransforms:R(yn)}),["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","yield","let","static","enum","implements","package","protected","interface","private","public","await","null","true","false","this","arguments"]),bn=/^[a-zA-Z_$][\w$]*$/,kn=e=>"eval"!==e&&!Le(wn,e)&&tt(bn,e);function Sn(e,t){const i=F(e,t);return i&&!1===i.configurable&&!1===i.writable&&Ve(i,"value")}function Tn(e,t){return 0===e.length?"":`const {${Re(e,",")}} = this.${t};`}const In=e=>{const{globalObjectConstants:t,moduleLexicalConstants:i}=((e,t={})=>{const i=U(e),n=U(t),a=Me(n,(e=>kn(e)&&Sn(t,e)));return{globalObjectConstants:Me(i,(t=>!Le(n,t)&&kn(t)&&Sn(e,t))),moduleLexicalConstants:a}})(e.globalObject,e.moduleLexicals),n=Tn(t,"globalObject"),a=Tn(i,"moduleLexicals"),o=Pt(`\n    with (this.scopeTerminator) {\n      with (this.globalObject) {\n        with (this.moduleLexicals) {\n          with (this.evalScope) {\n            ${n}\n            ${a}\n            return function() {\n              'use strict';\n              return eval(arguments[0]);\n            };\n          }\n        }\n      }\n    }\n  `);return ce(o,e,[])},{Fail:Dn}=hi,Nn=({globalObject:e,moduleLexicals:t={},globalTransforms:i=[],sloppyGlobalsMode:n=!1})=>{const a=n?nn(e):tn,o=(()=>{const e=M(null),t=R({eval:{get:()=>(delete e.eval,Et),enumerable:!1,configurable:!0}}),i={evalScope:e,allowNextEvalToBeUnsafe(){const{revoked:n}=i;null!==n&&an`a handler did not reset allowNextEvalToBeUnsafe ${n.err}`,O(e,t)},revoked:null};return i})(),{evalScope:s}=o,r=R({evalScope:s,moduleLexicals:t,globalObject:e,scopeTerminator:a});let d;return{safeEvaluate:(t,n)=>{const{localTransforms:a=[]}=n||{};let l;d||(d=In(r)),t=yn(t,[...a,...i,gn]);try{return o.allowNextEvalToBeUnsafe(),ce(d,e,[t])}catch(e){throw l=e,e}finally{const e="eval"in s;delete s.eval,e&&(o.revoked={err:l},Dn`handler did not reset allowNextEvalToBeUnsafe ${l}`)}}}};let En;const Pn=()=>{if(void 0===En){const e=new E;le(Pe,"toString",{value:{toString(){const t=wt(this);return at(t,") { [native code] }")||!yt(e,this)?t:`function ${this.name}() { [native code] }`}}.toString}),En=R((t=>gt(e,t)))}return En};const _n=R([["debug","debug"],["log","log"],["info","info"],["warn","warn"],["error","error"],["trace","log"],["dirxml","log"],["group","log"],["groupCollapsed","log"]]),Cn=R([["assert","error"],["timeLog","log"],["clear",void 0],["count","info"],["countReset",void 0],["dir","log"],["groupEnd","log"],["table","log"],["time","info"],["timeEnd","info"],["profile",void 0],["profileEnd",void 0],["timeStamp",void 0]]),An=R([..._n,...Cn]);R(((e,{shouldResetForDebugging:t=!1}={})=>{t&&e.resetErrorTagNum();let i=[];const n=J(Fe(An,(([e,t])=>{const n=(...t)=>{Ue(i,[e,...t])};return le(n,"name",{value:e}),[e,R(n)]})));R(n);const a=()=>{const e=R(i);return i=[],e};R(a);return R({loggingConsole:n,takeLog:a})}));const xn={NOTE:"ERROR_NOTE:",MESSAGE:"ERROR_MESSAGE:"};R(xn);const Vn=(e,t)=>{const{getStackString:i,tagError:n,takeMessageLogArgs:a,takeNoteLogArgsArray:o}=t,s=(e,t)=>Fe(e,(e=>Nt(e)?(Ue(t,e),`(${n(e)})`):e)),r=(t,i,a,o,r)=>{const d=n(i),l=a===xn.MESSAGE?`${d}:`:`${d} ${a}`,c=s(o,r);e[t](l,...c)},d=(t,i,n=void 0)=>{if(0===i.length)return;if(1===i.length&&void 0===n)return void c(t,i[0]);let a;a=1===i.length?"Nested error":`Nested ${i.length} errors`,void 0!==n&&(a=`${a} under ${n}`),e.group(a);try{for(const e of i)c(t,e)}finally{e.groupEnd()}},l=new E,c=(t,s)=>{if(yt(l,s))return;const c=n(s);gt(l,s);const u=[],h=a(s),m=o(s,(e=>(t,i)=>{const a=[];r(e,t,xn.NOTE,i,a),d(e,a,n(t))})(t));void 0===h?e[t](`${c}:`,s.message):r(t,s,xn.MESSAGE,h,u);let p=i(s);"string"==typeof p&&p.length>=1&&!at(p,"\n")&&(p+="\n"),e[t](p);for(const e of m)r(t,s,xn.NOTE,e,u);d(t,u,c)},u=Fe(_n,(([t,i])=>{const n=(...i)=>{const n=[],a=s(i,n);e[t](...a),d(t,n)};return le(n,"name",{value:t}),[t,R(n)]})),h=Me(Cn,(([t,i])=>t in e)),m=Fe(h,(([t,i])=>{const n=(...i)=>{e[t](...i)};return le(n,"name",{value:t}),[t,R(n)]})),p=J([...u,...m]);return R(p)};R(Vn);R(((e,t,i=void 0)=>{const n=Me(An,(([t,i])=>t in e)),a=Fe(n,(([i,n])=>[i,R(((...a)=>{(void 0===n||t.canLog(n))&&e[i](...a)}))])),o=J(a);return R(o)}));const Mn=e=>{if(void 0===h)return;let t=0;const i=new v;let n;const a=e=>{Ke(i,e),n&&0===i.size&&(n(),n=void 0)},o=new N,s=new h((t=>{if(We(i,t)){const n=qe(i,t);a(t),e(n)}}));return{rejectionHandledHandler:e=>{const t=pt(o,e);a(t)},unhandledRejectionHandler:(e,n)=>{t+=1;const a=t;He(i,a,e),ft(o,n,a),Tt(s,n,a,n)},processTerminationHandler:()=>{for(const[t,n]of Xe(i))a(t),e(n)}}},On=console,Ln=["getTypeName","getFunctionName","getMethodName","getFileName","getLineNumber","getColumnNumber","getEvalOrigin","isToplevel","isEval","isNative","isConstructor","isAsync","getPosition","getScriptNameOrSourceURL","toString"],Rn=e=>{const t=J(Fe(Ln,(t=>{const i=e[t];return[t,()=>ce(i,e,[])]})));return M(t,{})},Fn=[/\/node_modules\//,/^(?:node:)?internal\//,/\/packages\/ses\/src\/error\/assert.js$/,/\/packages\/eventual-send\/src\//],Bn=[/^((?:.*[( ])?)[:/\w_-]*\/\.\.\.\/(.+)$/,/^((?:.*[( ])?)[:/\w_-]*\/(packages\/.+)$/],Un=(e,t,i,n)=>{const a=e.captureStackTrace,o=e=>"verbose"===n||(e=>{if(!e)return!0;for(const t of Fn)if(tt(t,e))return!1;return!0})(e.getFileName()),s=e=>{let t=`${e}`;return"concise"===n&&(t=(e=>{for(const t of Bn){const i=it(t,e);if(i)return Re($e(i,1),"")}return e})(t)),`\n  at ${t}`},r=(e,t)=>Re(Fe(Me(t,o),s),""),d=new N,l={captureStackTrace(t,i=l.captureStackTrace){"function"!=typeof a?ye(t,"stack",""):ce(a,e,[t,i])},getStackString(e){let t=pt(d,e);if(void 0===t&&(e.stack,t=pt(d,e),t||(t={stackString:""},ft(d,e,t))),void 0!==t.stackString)return t.stackString;const i=r(0,t.callSites);return ft(d,e,{stackString:i}),i},prepareStackTrace(e,t){if("unsafe"===i){const i=r(0,t);return ft(d,e,{stackString:i}),`${e}${i}`}return ft(d,e,{callSites:t}),""}},c=l.prepareStackTrace;e.prepareStackTrace=c;const u=new E([c]),h=e=>{if(yt(u,e))return e;const t={prepareStackTrace:(t,i)=>(ft(d,t,{callSites:i}),e(t,(e=>Fe(e,Rn))(i)))};return gt(u,t.prepareStackTrace),t.prepareStackTrace};return O(t,{captureStackTrace:{value:l.captureStackTrace,writable:!0,enumerable:!1,configurable:!0},prepareStackTrace:{get:()=>e.prepareStackTrace,set(t){if("function"==typeof t){const i=h(t);e.prepareStackTrace=i}else e.prepareStackTrace=c},enumerable:!1,configurable:!0}}),l.getStackString},$n=F(P.prototype,"stack"),jn=$n&&$n.get,Gn={getStackString:e=>"function"==typeof jn?ce(jn,e,[]):"stack"in e?`${e.stack}`:""};const{Fail:zn,details:Hn,quote:qn}=hi,Wn=()=>{},Kn=(e,t,i,n,a,o,s,r,d)=>{const{resolveHook:l,moduleRecords:c}=pt(e,i),u=((e,t,i)=>{const n=M(null);for(const a of e){const e=t(a,i);n[a]=e}return R(n)})(a.imports,l,n),h=R({compartment:i,staticModuleRecord:a,moduleSpecifier:n,resolvedImports:u,importMeta:d});for(const n of Q(u)){const a=Xn(e,t,i,n,o,s,r);Qe(o,St(a,Wn,(e=>{Ue(r,e)})))}return He(c,n,h),h},Xn=async(e,t,i,n,a,o,s)=>{const{name:r}=pt(e,i);let d=qe(o,i);void 0===d&&(d=new v,He(o,i,d));let l=qe(d,n);return void 0!==l||(l=kt((async(e,t,i,n,a,o,s)=>{const{importHook:r,moduleMap:d,moduleMapHook:l,moduleRecords:c}=pt(e,i);let u=d[n];if(void 0===u&&void 0!==l&&(u=l(n)),"string"==typeof u)hi.fail(Hn`Cannot map module ${qn(n)} to ${qn(u)} in parent compartment, not yet implemented`,x);else if(void 0!==u){const i=pt(t,u);void 0===i&&hi.fail(Hn`Cannot map module ${qn(n)} because the value is not a module exports namespace, or is from another realm`,C);const r=await Xn(e,t,i.compartment,i.specifier,a,o,s);return He(c,n,r),r}if(We(c,n))return qe(c,n);const h=await r(n);if(null!==h&&"object"==typeof h||zn`importHook must return a promise for an object, for module ${qn(n)} in compartment ${qn(i.name)}`,void 0!==h.specifier){if(void 0!==h.record){if(void 0!==h.compartment)throw x("Cannot redirect to an explicit record with a specified compartment");const{compartment:r=i,specifier:d=n,record:l,importMeta:u}=h,m=Kn(e,t,r,d,l,a,o,s,u);return He(c,n,m),m}if(void 0!==h.compartment){if(void 0!==h.importMeta)throw x("Cannot redirect to an implicit record with a specified importMeta");const i=await Xn(e,t,h.compartment,h.specifier,a,o,s);return He(c,n,i),i}throw x("Unnexpected RedirectStaticModuleInterface record shape")}return Kn(e,t,i,n,h,a,o,s)})(e,t,i,n,a,o,s),(e=>{throw hi.note(e,Hn`${e.message}, loading ${qn(n)} in compartment ${qn(r)}`),e})),He(d,n,l)),l},Yn=async(e,t,i,n)=>{const{name:a}=pt(e,i),o=new T,s=new v,r=[],d=Xn(e,t,i,n,o,s,r);Qe(o,St(d,Wn,(e=>{Ue(r,e)})));for(const e of o)await e;if(r.length>0)throw x(`Failed to load module ${qn(n)} in package ${qn(a)} (${r.length} underlying failures: ${Re(Fe(r,(e=>e.message)),", ")}`)},{quote:Qn}=hi,Jn=(e,t,i,n)=>{const{deferredExports:a}=t;if(!We(a,n)){const t=(()=>{let e=!1;const t=M(null);return R({activate(){e=!0},proxiedExports:t,exportsProxy:new b(t,{get(i,n,a){if(!e)throw x(`Cannot get property ${Qn(n)} of module exports namespace, the module has not yet begun to execute`);return he(t,n,a)},set(e,t,i){throw x(`Cannot set property ${Qn(t)} of module exports namespace`)},has(i,n){if(!e)throw x(`Cannot check property ${Qn(n)}, the module has not yet begun to execute`);return pe(t,n)},deleteProperty(e,t){throw x(`Cannot delete property ${Qn(t)}s of module exports namespace`)},ownKeys(i){if(!e)throw x("Cannot enumerate keys, the module has not yet begun to execute");return fe(t)},getOwnPropertyDescriptor(i,n){if(!e)throw x(`Cannot get own property descriptor ${Qn(n)}, the module has not yet begun to execute`);return me(t,n)},preventExtensions(i){if(!e)throw x("Cannot prevent extensions of module exports namespace, the module has not yet begun to execute");return ge(t)},isExtensible(){if(!e)throw x("Cannot check extensibility of module exports namespace, the module has not yet begun to execute");return ve(t)},getPrototypeOf:e=>null,setPrototypeOf(e,t){throw x("Cannot set prototype of module exports namespace")},defineProperty(e,t,i){throw x(`Cannot define property ${Qn(t)} of module exports namespace`)},apply(e,t,i){throw x("Cannot call module exports namespace, it is not a function")},construct(e,t){throw x("Cannot construct module exports namespace, it is not a constructor")}})})})();ft(i,t.exportsProxy,((e,t)=>R({compartment:e,specifier:t}))(e,n)),He(a,n,t)}return qe(a,n)},Zn=(e,t,i)=>{if("string"!=typeof t)throw x("first argument of evaluate() must be a string");const{transforms:n=[],__evadeHtmlCommentTest__:a=!1,__evadeImportExpressionTest__:o=!1,__rejectSomeDirectEvalExpressions__:s=!0}=i,r=[...n];!0===a&&Ue(r,un),!0===o&&Ue(r,pn),!0===s&&Ue(r,fn);const{safeEvaluate:d}=((e,t)=>{const{sloppyGlobalsMode:i=!1,__moduleShimLexicals__:n}=t;let a;if(void 0!==n||i){let{globalTransforms:t}=e;const{globalObject:o}=e;let s;void 0!==n&&(t=void 0,s=M(null,B(n))),({safeEvaluate:a}=Nn({globalObject:o,moduleLexicals:s,globalTransforms:t,sloppyGlobalsMode:i}))}else({safeEvaluate:a}=e);return{safeEvaluate:a}})(e,i);return d(t,{localTransforms:r})},{quote:ea}=hi,{Fail:ta,quote:ia}=hi,na=(e,t,i,n)=>{const{name:a,moduleRecords:o}=pt(e,i),s=qe(o,n);if(void 0===s)throw C(`Missing link to module ${ia(n)} from compartment ${ia(a)}`);return aa(e,t,s)};const aa=(e,t,i)=>{const{compartment:n,moduleSpecifier:a,resolvedImports:o,staticModuleRecord:s}=i,{instances:r}=pt(e,n);if(We(r,a))return qe(r,a);!function(e,t){Dt(e)||ta`Static module records must be of type object, got ${ia(e)}, for module ${ia(t)}`;const{imports:i,exports:n,reexports:a=[]}=e;we(i)||ta`Property 'imports' of a static module record must be an array, got ${ia(i)}, for module ${ia(t)}`,we(n)||ta`Property 'exports' of a precompiled module record must be an array, got ${ia(n)}, for module ${ia(t)}`,we(a)||ta`Property 'reexports' of a precompiled module record must be an array if present, got ${ia(a)}, for module ${ia(t)}`}(s,a);const d=new v;let l;if(function(e){return"string"==typeof e.__syncModuleProgram__}(s))!function(e,t){const{__fixedExportMap__:i,__liveExportMap__:n}=e;Dt(i)||ta`Property '__fixedExportMap__' of a precompiled module record must be an object, got ${ia(i)}, for module ${ia(t)}`,Dt(n)||ta`Property '__liveExportMap__' of a precompiled module record must be an object, got ${ia(n)}, for module ${ia(t)}`}(s,a),l=((e,t,i,n)=>{const{compartment:a,moduleSpecifier:o,staticModuleRecord:s,importMeta:r}=i,{reexports:d=[],__syncModuleProgram__:l,__fixedExportMap__:c={},__liveExportMap__:u={},__reexportMap__:h={},__needsImportMeta__:m=!1,__syncModuleFunctor__:p}=s,v=pt(e,a),{__shimTransforms__:f,importMetaHook:g}=v,{exportsProxy:y,proxiedExports:w,activate:b}=Jn(a,v,t,o),k=M(null),S=M(null),T=M(null),I=M(null),D=M(null);r&&V(D,r),m&&g&&g(o,D);const N=M(null),E=M(null);function P(e){const t=M(null);t.default=!1;for(const[i,a]of e){const e=qe(n,i);e.execute();const{notifiers:o}=e;for(const[e,t]of a){const n=o[e];if(!n)throw A(`The requested module '${i}' does not provide an export named '${e}'`);for(const e of t)n(e)}if(Le(d,i))for(const[e,i]of L(o))void 0===t[e]?t[e]=i:t[e]=!1;if(h[i])for(const[e,n]of h[i])t[n]=o[e]}for(const[e,i]of L(t))if(!E[e]&&!1!==i){let t;E[e]=i,i((e=>t=e)),k[e]={get:()=>t,set:void 0,enumerable:!0,configurable:!1}}Oe(Ge(q(k)),(e=>le(w,e,k[e]))),R(w),b()}let _;Oe(L(c),(([e,[t]])=>{let i=N[t];if(!i){let e,n=!0,a=[];const o=()=>{if(n)throw C(`binding ${ea(t)} not yet initialized`);return e},s=R((i=>{if(!n)throw x(`Internal: binding ${ea(t)} already initialized`);e=i;const o=a;a=null,n=!1;for(const e of o||[])e(i);return i}));i={get:o,notify:t=>{t!==s&&(n?Ue(a||[],t):t(e))}},N[t]=i,T[t]=s}k[e]={get:i.get,set:void 0,enumerable:!0,configurable:!1},E[e]=i.notify})),Oe(L(u),(([e,[t,i]])=>{let n=N[t];if(!n){let a,o=!0;const s=[],r=()=>{if(o)throw C(`binding ${ea(e)} not yet initialized`);return a},d=R((e=>{a=e,o=!1;for(const t of s)t(e)})),l=e=>{if(o)throw C(`binding ${ea(t)} not yet initialized`);a=e;for(const t of s)t(e)};n={get:r,notify:e=>{e!==d&&(Ue(s,e),o||e(a))}},N[t]=n,i&&le(S,t,{get:r,set:l,enumerable:!0,configurable:!1}),I[t]=d}k[e]={get:n.get,set:void 0,enumerable:!0,configurable:!1},E[e]=n.notify})),E["*"]=e=>{e(w)},_=void 0!==p?p:Zn(v,l,{globalObject:a.globalThis,transforms:f,__moduleShimLexicals__:S});let O,F=!1;return R({notifiers:E,exportsProxy:y,execute:function(){if(_){const e=_;_=null;try{e(R({imports:R(P),onceVar:R(T),liveVar:R(I),importMeta:D}))}catch(e){F=!0,O=e}}if(F)throw O}})})(e,t,i,d);else{if(!function(e){return"function"==typeof e.execute}(s))throw x(`importHook must return a static module record, got ${ia(s)}`);!function(e,t){const{exports:i}=e;we(i)||ta`Property 'exports' of a third-party static module record must be an array, got ${ia(i)}, for module ${ia(t)}`}(s,a),l=((e,t,i,n,a,o)=>{const{exportsProxy:s,proxiedExports:r,activate:d}=Jn(i,pt(e,i),n,a),l=M(null);if(t.exports){if(!we(t.exports)||je(t.exports,(e=>"string"!=typeof e)))throw x(`SES third-party static module record "exports" property must be an array of strings for module ${a}`);Oe(t.exports,(e=>{let t=r[e];const i=[];le(r,e,{get:()=>t,set:e=>{t=e;for(const t of i)t(e)},enumerable:!0,configurable:!1}),l[e]=e=>{Ue(i,e),e(t)}})),l["*"]=e=>{e(r)}}const c={activated:!1};return R({notifiers:l,exportsProxy:s,execute(){if(pe(c,"errorFromExecute"))throw c.errorFromExecute;if(!c.activated){d(),c.activated=!0;try{t.execute(r,i,o)}catch(e){throw c.errorFromExecute=e,e}}}})})(e,s,n,t,a,o)}He(r,a,l);for(const[i,a]of L(o)){const o=na(e,t,n,a);He(d,i,o)}return l},{quote:oa}=hi,sa=new N,ra=new N,da=e=>{const{importHook:t,resolveHook:i}=pt(ra,e);if("function"!=typeof t||"function"!=typeof i)throw x("Compartment must be constructed with an importHook and a resolveHook for it to be able to load modules")},la=function(e={},t={},i={}){throw x("Compartment.prototype.constructor is not a valid constructor.")},ca=(e,t)=>{const{execute:i,exportsProxy:n}=na(ra,sa,e,t);return i(),n},ua={constructor:la,get globalThis(){return pt(ra,this).globalObject},get name(){return pt(ra,this).name},evaluate(e,t={}){const i=pt(ra,this);return Zn(i,e,t)},toString:()=>"[object Compartment]",module(e){if("string"!=typeof e)throw x("first argument of module() must be a string");da(this);const{exportsProxy:t}=Jn(this,pt(ra,this),sa,e);return t},async import(e){if("string"!=typeof e)throw x("first argument of import() must be a string");return da(this),St(Yn(ra,sa,this,e),(()=>({namespace:ca(this,e)})))},async load(e){if("string"!=typeof e)throw x("first argument of load() must be a string");return da(this),Yn(ra,sa,this,e)},importNow(e){if("string"!=typeof e)throw x("first argument of importNow() must be a string");return da(this),ca(this,e)}};O(la,{prototype:{value:ua}});const ha=(e,t,i)=>{function n(n={},a={},o={}){if(void 0===new.target)throw x("Class constructor Compartment cannot be invoked without 'new'");const{name:s="<unknown>",transforms:r=[],__shimTransforms__:d=[],resolveHook:l,importHook:c,moduleMapHook:u,importMetaHook:h}=o,m=[...r,...d],p=new v,f=new v,g=new v;for(const[e,t]of L(a||{})){if("string"==typeof t)throw x(`Cannot map module ${oa(e)} to ${oa(t)} in parent compartment`);if(void 0===pt(sa,t))throw C(`Cannot map module ${oa(e)} because it has no known compartment in this realm`)}const y={};(e=>{le(e,ne,R(V(M(null),{set:R((()=>{throw x("Cannot set Symbol.unscopables of a Compartment's globalThis")})),enumerable:!1,configurable:!1})))})(y),Ki(y);const{safeEvaluate:w}=Nn({globalObject:y,globalTransforms:m,sloppyGlobalsMode:!1});Xi(y,{intrinsics:t,newGlobalPropertyNames:wi,makeCompartmentConstructor:e,markVirtualizedNativeFunction:i}),Yi(y,w,i),V(y,n),ft(ra,this,{name:`${s}`,globalTransforms:m,globalObject:y,safeEvaluate:w,resolveHook:l,importHook:c,moduleMap:a,moduleMapHook:u,importMetaHook:h,moduleRecords:p,__shimTransforms__:d,deferredExports:g,instances:f})}return n.prototype=ua,n};function ma(e){return $(e).constructor}const pa=(e,t)=>{if("safe"!==t&&"unsafe"!==t)throw x(`unrecognized fakeHardenOption ${t}`);if("safe"===t)return e;if(Object.isExtensible=()=>!1,Object.isFrozen=()=>!0,Object.isSealed=()=>!0,Reflect.isExtensible=()=>!1,e.isFake)return e;const i=e=>e;return i.isFake=!0,R(i)};R(pa);const{Fail:va,details:fa,quote:ga}=hi;let ya,wa;const ba=(()=>{if("function"==typeof l.harden){return l.harden}const e=new E,{harden:t}={harden(t){const i=new T,n=new N;function a(t,a=void 0){if(!Dt(t))return;const o=typeof t;if("object"!==o&&"function"!==o)throw x(`Unexpected typeof: ${o}`);yt(e,t)||Ze(i,t)||(Qe(i,t),ft(n,t,a))}function o(e){void 0!==ce(pi,e,[])?vi(e):R(e);const t=pt(n,e)||"unknown",i=B(e);a($(e),`${t}.__proto__`),Oe(fe(i),(e=>{const n=`${t}.${I(e)}`,o=i[e];Ve(o,"value")?a(o.value,`${n}`):(a(o.get,`${n}(get)`),a(o.set,`${n}(set)`))}))}function s(t){gt(e,t)}return a(t),Je(i,o),Je(i,s),t}};return t})(),ka=(e={})=>{const{getEnvironmentOption:t}=Ot(l),{errorTaming:i=t("LOCKDOWN_ERROR_TAMING","safe"),errorTrapping:n=t("LOCKDOWN_ERROR_TRAPPING","platform"),unhandledRejectionTrapping:a=t("LOCKDOWN_UNHANDLED_REJECTION_TRAPPING","report"),regExpTaming:o=t("LOCKDOWN_REGEXP_TAMING","safe"),localeTaming:s=t("LOCKDOWN_LOCALE_TAMING","safe"),consoleTaming:r=t("LOCKDOWN_CONSOLE_TAMING","safe"),overrideTaming:d=t("LOCKDOWN_OVERRIDE_TAMING","moderate"),stackFiltering:c=t("LOCKDOWN_STACK_FILTERING","concise"),domainTaming:h=t("LOCKDOWN_DOMAIN_TAMING","safe"),evalTaming:p=t("LOCKDOWN_EVAL_TAMING","safeEval"),overrideDebug:y=Me(ct(t("LOCKDOWN_OVERRIDE_DEBUG",""),","),(e=>""!==e)),__hardenTaming__:w=t("LOCKDOWN_HARDEN_TAMING","safe"),dateTaming:b="safe",mathTaming:k="safe",...N}=e;"unsafeEval"===p||"safeEval"===p||"noEval"===p||va`lockdown(): non supported option evalTaming: ${ga(p)}`;const E=fe(N);0===E.length||va`lockdown(): non supported option ${ga(E)}`,void 0===ya||hi.fail(fa`Already locked down at ${ya} (SES_ALREADY_LOCKED_DOWN)`,x),ya=x("Prior lockdown (SES_ALREADY_LOCKED_DOWN)"),ya.stack,(()=>{let e=!1;try{e=Pt("eval","SES_changed",'        eval("SES_changed = true");\n        return SES_changed;\n      ')(Et,!1),e||delete l.SES_changed}catch(t){e=!0}if(!e)throw x("SES cannot initialize unless 'eval' is the original intrinsic 'eval', suitable for direct-eval (dynamically scoped eval) (SES_DIRECT_EVAL)")})();if(l.Function.prototype.constructor!==l.Function&&"function"==typeof l.harden&&"function"==typeof l.lockdown&&l.Date.prototype.constructor!==l.Date&&"function"==typeof l.Date.now&&j(l.Date.prototype.constructor.now(),NaN))throw x("Already locked down but not by this SES instance (SES_MULTIPLE_INSTANCES)");!function(e="safe"){if("safe"!==e&&"unsafe"!==e)throw x(`unrecognized domainTaming ${e}`);if("unsafe"!==e&&"object"==typeof l.process&&null!==l.process){const e=F(l.process,"domain");if(void 0!==e&&void 0!==e.get)throw x("SES failed to lockdown, Node.js domains have been initialized (SES_NO_DOMAINS)");le(l.process,"domain",{value:null,configurable:!1,writable:!1,enumerable:!1})}}(h);const _=Pn(),{addIntrinsics:C,completePrototypes:V,finalIntrinsics:G}=Li(),z=pa(ba,w);C({harden:z}),C(function(){try{Pt.prototype.constructor("return 1")}catch(e){return R({})}const e={};function t(t,i,n){let a;try{a=(0,eval)(n)}catch(e){if(e instanceof A)return;throw e}const o=$(a),s=function(){throw x("Function.prototype.constructor is not a valid constructor.")};O(s,{prototype:{value:o},name:{value:t,writable:!1,enumerable:!1,configurable:!0}}),O(o,{constructor:{value:s}}),s!==Pt.prototype.constructor&&Y(s,Pt.prototype.constructor),e[i]=s}return t("Function","%InertFunction%","(function(){})"),t("GeneratorFunction","%InertGeneratorFunction%","(function*(){})"),t("AsyncFunction","%InertAsyncFunction%","(async function(){})"),t("AsyncGeneratorFunction","%InertAsyncGeneratorFunction%","(async function*(){})"),e}()),C(function(e="safe"){if("safe"!==e&&"unsafe"!==e)throw x(`unrecognized dateTaming ${e}`);const t=u,i=t.prototype,n={now(){throw x("secure mode Calling %SharedDate%.now() throws")}},a=({powers:e="none"}={})=>{let n;return n="original"===e?function(...e){return void 0===new.target?ce(t,void 0,e):ue(t,e,new.target)}:function(...e){if(void 0===new.target)throw x("secure mode Calling %SharedDate% constructor as a function throws");if(0===e.length)throw x("secure mode Calling new %SharedDate%() with no arguments throws");return ue(t,e,new.target)},O(n,{length:{value:7},prototype:{value:i,writable:!1,enumerable:!1,configurable:!1},parse:{value:t.parse,writable:!0,enumerable:!1,configurable:!0},UTC:{value:t.UTC,writable:!0,enumerable:!1,configurable:!0}}),n},o=a({powers:"original"}),s=a({powers:"none"});return O(o,{now:{value:t.now,writable:!0,enumerable:!1,configurable:!0}}),O(s,{now:{value:n.now,writable:!0,enumerable:!1,configurable:!0}}),O(i,{constructor:{value:s}}),{"%InitialDate%":o,"%SharedDate%":s}}(b)),C(function(e="safe",t="concise"){if("safe"!==e&&"unsafe"!==e)throw x(`unrecognized errorTaming ${e}`);if("concise"!==t&&"verbose"!==t)throw x(`unrecognized stackFiltering ${t}`);const i=P.prototype,n="function"==typeof P.captureStackTrace?"v8":"unknown",{captureStackTrace:a}=P,o=(e={})=>{const t=function(...e){let i;return i=void 0===new.target?ce(P,this,e):ue(P,e,new.target),"v8"===n&&ce(a,P,[i,t]),i};return O(t,{length:{value:1},prototype:{value:i,writable:!1,enumerable:!1,configurable:!1}}),t},s=o({powers:"original"}),r=o({powers:"none"});O(i,{constructor:{value:r}});for(const e of bi)Y(e,r);O(s,{stackTraceLimit:{get(){if("number"==typeof P.stackTraceLimit)return P.stackTraceLimit},set(e){"number"==typeof e&&("number"!=typeof P.stackTraceLimit||(P.stackTraceLimit=e))},enumerable:!1,configurable:!0}}),O(r,{stackTraceLimit:{get(){},set(e){},enumerable:!1,configurable:!0}}),"v8"===n&&O(r,{prepareStackTrace:{get:()=>()=>"",set(e){},enumerable:!1,configurable:!0},captureStackTrace:{value:(e,t)=>{le(e,"stack",{value:""})},writable:!1,enumerable:!1,configurable:!0}});let d=Gn.getStackString;return"v8"===n?d=Un(P,s,e,t):O(i,"unsafe"===e?{stack:{get(){return d(this)},set(e){O(this,{stack:{value:e,writable:!0,enumerable:!0,configurable:!0}})}}}:{stack:{get(){return`${this}`},set(e){O(this,{stack:{value:e,writable:!0,enumerable:!0,configurable:!0}})}}}),{"%InitialGetStackString%":d,"%InitialError%":s,"%SharedError%":r}}(i,c)),C(function(e="safe"){if("safe"!==e&&"unsafe"!==e)throw x(`unrecognized mathTaming ${e}`);const t=f,i=t,{random:n,...a}=B(t);return{"%InitialMath%":i,"%SharedMath%":M(W,{...a,random:{value:{random(){throw x("secure mode %SharedMath%.random() throws")}}.random,writable:!0,enumerable:!1,configurable:!0}})}}(k)),C(function(e="safe"){if("safe"!==e&&"unsafe"!==e)throw x(`unrecognized regExpTaming ${e}`);const t=S.prototype,i=(e={})=>{const i=function(...e){return void 0===new.target?S(...e):ue(S,e,new.target)},n=F(S,Z);if(!n)throw x("no RegExp[Symbol.species] descriptor");return O(i,{length:{value:2},prototype:{value:t,writable:!1,enumerable:!1,configurable:!1},[Z]:n}),i},n=i(),a=i();return"unsafe"!==e&&delete t.compile,O(t,{constructor:{value:a}}),{"%InitialRegExp%":n,"%SharedRegExp%":a}}(o)),C((()=>{const e=D,t=e.prototype,i=t=>e(t);O(t,{constructor:{value:i}});const n=L(B(e)),a=J(Fe(n,(([e,t])=>[e,{...t,configurable:!0}])));return O(i,a),{"%SharedSymbol%":i}})()),C((()=>{const e=Pt.prototype.constructor,t=F(function(){return arguments}(),"callee"),i=t&&t.get,n=ht(new I),a=$(n),o=Te[ie]&&nt(/./),s=o&&$(o),r=ze([]),d=$(r),c=$(m),u=Ye(new v),h=$(u),p=et(new T),f=$(p),g=$(d),y=ma((function*(){})),w=y.prototype,b=ma((async function*(){})),k=b.prototype,S=k.prototype,D=$(S),N={"%InertFunction%":e,"%ArrayIteratorPrototype%":d,"%InertAsyncFunction%":ma((async function(){})),"%AsyncGenerator%":k,"%InertAsyncGeneratorFunction%":b,"%AsyncGeneratorPrototype%":S,"%AsyncIteratorPrototype%":D,"%Generator%":w,"%InertGeneratorFunction%":y,"%IteratorPrototype%":g,"%MapIteratorPrototype%":h,"%RegExpStringIteratorPrototype%":s,"%SetIteratorPrototype%":f,"%StringIteratorPrototype%":a,"%ThrowTypeError%":i,"%TypedArray%":c,"%InertCompartment%":la};return l.Iterator&&(N["%IteratorHelperPrototype%"]=$(l.Iterator.from([]).take(0)),N["%WrapForValidIteratorPrototype%"]=$(l.Iterator.from({next(){}}))),l.AsyncIterator&&(N["%AsyncIteratorHelperPrototype%"]=$(l.AsyncIterator.from([]).take(0)),N["%WrapForValidAsyncIteratorPrototype%"]=$(l.AsyncIterator.from({next(){}}))),N})()),V();const H=G();let q;"unsafe"!==i&&(q=H["%InitialGetStackString%"]);const K=((e="safe",t="platform",i="report",n)=>{if("safe"!==e&&"unsafe"!==e)throw x(`unrecognized consoleTaming ${e}`);let a;a=void 0===n?ci:{...ci,getStackString:n};const o="unsafe"===e?On:Vn(On,a);if("none"!==t&&void 0!==l.process&&l.process.on("uncaughtException",(e=>{o.error(e),"platform"===t||"exit"===t?l.process.exit(l.process.exitCode||-1):"abort"===t&&l.process.abort()})),"none"!==i&&void 0!==l.process){const e=Mn((e=>{o.error("SES_UNHANDLED_REJECTION:",e)}));e&&(l.process.on("unhandledRejection",e.unhandledRejectionHandler),l.process.on("rejectionHandled",e.rejectionHandledHandler),l.process.on("exit",e.processTerminationHandler))}if("none"!==t&&void 0!==l.window&&void 0!==l.window.addEventListener&&l.window.addEventListener("error",(e=>{e.preventDefault(),o.error(e.error),"exit"!==t&&"abort"!==t||(l.window.location.href="about:blank")})),"none"!==i&&void 0!==l.window&&void 0!==l.window.addEventListener){const e=Mn((e=>{o.error("SES_UNHANDLED_REJECTION:",e)}));e&&(l.window.addEventListener("unhandledrejection",(t=>{t.preventDefault(),e.unhandledRejectionHandler(t.reason,t.promise)})),l.window.addEventListener("rejectionhandled",(t=>{t.preventDefault(),e.rejectionHandledHandler(t.promise)})),l.window.addEventListener("beforeunload",(t=>{e.processTerminationHandler()})))}return{console:o}})(r,n,a,q);if(l.console=K.console,"unsafe"===i&&l.assert===hi&&(l.assert=ui(void 0,!0)),function(e,t="safe"){if("safe"!==t&&"unsafe"!==t)throw x(`unrecognized localeTaming ${t}`);if("unsafe"!==t){le(I.prototype,"localeCompare",{value:Hi});for(const t of U(e)){const i=e[t];if(Dt(i))for(const e of U(i)){const t=it(Gi,e);if(t){"function"==typeof i[e]||$i`expected ${ji(e)} to be a function`;const n=`${t[1]}${t[2]}`,a=i[n];"function"==typeof a||$i`function ${ji(n)} not found`,le(i,e,{value:a})}}}le(g.prototype,"toLocaleString",{value:qi})}}(H,s),Ri(H,_),Ki(l),Xi(l,{intrinsics:H,newGlobalPropertyNames:yi,makeCompartmentConstructor:ha,markVirtualizedNativeFunction:_}),"noEval"===p)Yi(l,_t,_);else if("safeEval"===p){const{safeEvaluate:e}=Nn({globalObject:l});Yi(l,e,_)}return()=>(void 0===wa||hi.fail(fa`Already locked down at ${wa} (SES_ALREADY_LOCKED_DOWN)`,x),wa=x("Prior lockdown (SES_ALREADY_LOCKED_DOWN)"),wa.stack,function(e,t,i=[]){const n=new T(i);function a(e,t,i,a){if("value"in a&&a.configurable){const{value:o}=a;function s(){return o}le(s,"originalValue",{value:o,writable:!1,enumerable:!1,configurable:!1});const r=Ze(n,i);function d(n){if(t===this)throw x(`Cannot assign to read only property '${I(i)}' of '${e}'`);Ve(this,i)?this[i]=n:(r&&console.error(x(`Override property ${i}`)),le(this,i,{value:n,writable:!0,enumerable:!0,configurable:!0}))}le(t,i,{get:s,set:d,enumerable:a.enumerable,configurable:a.configurable})}}function o(e,t,i){const n=F(t,i);n&&a(e,t,i,n)}function s(e,t){const i=B(t);i&&Oe(fe(i),(n=>a(e,t,n,i[n])))}let r;switch(t){case"min":r=Fi;break;case"moderate":r=Bi;break;case"severe":r=Ui;break;default:throw x(`unrecognized overrideTaming ${t}`)}!function e(t,i,n){for(const a of U(n)){const r=F(i,a);if(!r||r.get||r.set)continue;const d=`${t}.${I(a)}`,l=n[a];if(!0===l)o(d,i,a);else if("*"===l)s(d,r.value);else{if(!Dt(l))throw x(`Unexpected override enablement plan ${d}`);e(d,r.value,l)}}}("root",e,r)}(H,d,y),z(H),z)};l.lockdown=e=>{const t=ka(e);l.harden=t()},l.repairIntrinsics=e=>{const t=ka(e);l.hardenIntrinsics=()=>{l.harden=t()}};const Sa=Pn();l.Compartment=ha(ha,(e=>{const{addIntrinsics:t,finalIntrinsics:i}=Li();return t(Oi(e,wi)),i()})(l),Sa),l.assert=hi;const Ta=[1/0,Array,ArrayBuffer,Boolean,DataView,Date,Error,EvalError,Float32Array,Float64Array,Function,Int8Array,Int16Array,Int32Array,JSON,Map,Math,NaN,Number,Object,Promise,Proxy,RangeError,ReferenceError,Reflect,RegExp,Set,String,SyntaxError,TypeError,URIError,Uint8Array,Uint8ClampedArray,Uint16Array,Uint32Array,WeakMap,WeakSet,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,eval,isFinite,isNaN,parseFloat,parseInt,unescape,XMLHttpRequest,Headers,HTMLIFrameElement,Document,HTMLDocument,HTMLCanvasElement,DOMException,URLSearchParams,ResizeObserver];class Ia{constructor(e,t){this.originalSetFunc=e,this.originalClearFunc=t,this.disposed=!1,this.ids=new Set}setFunc(e,t){if(this.disposed)return-1;const i=this.originalSetFunc((t=>e(t)),t);return this.ids.add(i),i}clearFunc(e){this.disposed||this.ids.has(e)&&(this.ids.delete(e),this.originalClearFunc(e))}dispose(){if(!this.disposed){this.disposed=!0;for(const e of this.ids)this.originalClearFunc(e);this.ids.clear()}}}var Da,Na=i(62193),Ea=i(58749),Pa=i(68570),_a=i(39803),Ca=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(i[n[a]]=e[n[a]])}return i};const Aa=function(e){return Object.freeze(e),Object.getOwnPropertyNames(e).forEach((function(t){const i=Object.getOwnPropertyDescriptor(e,t);(null==i?void 0:i.value)&&"object"==typeof i.value&&Aa(i.value)})),e};class xa extends a.nV{constructor(){super(...arguments),this.name="SesModule",this.frozen=!1,this.libraryCache=new _a.t}freezeForStrict(){if(!this.frozen){for(const e of Ta)Aa(e);this.frozen=!0}}async init(e,t){[this.semver]=await Promise.all([Promise.resolve().then(i.t.bind(i,99589,23)).then((e=>e.default))]),this.pluginUIData=await t.market.waitForData(Na.kR),globalThis.process&&(globalThis.process.on=()=>{})}async makeSecureEnvironment(e,t,i,n,a){const{strict:s,isFullyOpen:r}=i,d=new o.Vy(`plugin ${e}`);if(Object.freeze(d),!this.pluginUIData)return o.Vy.for(this).warn("Not creating a secure env due to missing plugin data"),null;if(t.startsWith("http")||t.startsWith("//")&&window.location.href.match(/^https?:/))try{const e=await fetch(t);t=await e.text()}catch(e){return o.Vy.for(this).warn("There was an error retrieving the plugin source."),null}const l=e.split(this.pluginUIData.separator)[1],c=this.pluginUIData.createRoots(l,i),u=this.setupPluginEnv(d,l,n,c);let h,m={};for(const[e,t]of Object.entries(a||{}))m=Object.assign(Object.assign({},m),await this.loadLibrary(e,t));let p=()=>{};const v=function(e,t=!0){return t?{log:(...t)=>e.info(...t),error:(...t)=>e.error(...t),info:(...t)=>e.info(...t),warn:(...t)=>e.warn(...t),assert:(t,...i)=>e.assert(t,...i),time:t=>e.time(t),timeEnd:t=>e.timeEnd(t)}:{log:e.info.bind(e),error:e.error.bind(e),info:e.info.bind(e),warn:e.warn.bind(e),assert:e.assert.bind(e),time:e.time.bind(e),timeEnd:e.timeEnd.bind(e)}}(d,!r);let f;if(r){d.warn("This plugin has full access to the environment. This is not recommended.");const e=Object.keys(m),i=Object.values(m),n=new Function(...e,...Object.keys(u),"console",`"use strict";\n${t}`);let a;f=async()=>{n(...i,...Object.values(u),v,m),a=globalThis.plugin,delete globalThis.plugin},g=()=>a,h={get globalThis(){return{plugin:g()}},get name(){return"<raw eval>"},evaluate(e,t){throw new Error("evaluate not supported in raw eval")},import(e){throw new Error("import not supported in raw eval")},load(e){throw new Error("load not supported in raw eval")},importNow(e){throw new Error("importNow not supported in raw eval")},module(e){throw new Error("module not supported in raw eval")}}}else{const e=function(){const e=new Ia(((e,t)=>window.setInterval(e,t)),(e=>window.clearInterval(e))),t=new Ia(((e,t)=>window.setTimeout(e,t)),(e=>window.clearTimeout(e))),i=new Ia((e=>window.requestAnimationFrame(e)),(e=>window.cancelAnimationFrame(e)));function n(t,i){return e.setFunc(t,i)}function a(t){return e.clearFunc(t)}function o(e,i){return t.setFunc(e,i)}function s(e){return t.clearFunc(e)}function r(e){return i.setFunc(e)}function d(e){return i.clearFunc(e)}return{setInterval:n,clearInterval:a,setTimeout:o,clearTimeout:s,requestAnimationFrame:r,cancelAnimationFrame:d,queueMicrotask:window.queueMicrotask.bind(window),_dispose:()=>{e.dispose(),t.dispose(),i.dispose()}}}(),{_dispose:n}=e,a=Ca(e,["_dispose"]),o=Object.assign(Object.assign({},a),{console:v});p=n;const{strictGlobalThis:r,openGlobalThis:d}=this.createGlobalThis(o,m,u,i);h=new Compartment(s?r:d),f=async()=>{h.evaluate(t,s?void 0:{__evadeImportExpressionTest__:!0,__evadeHtmlCommentTest__:!0})}}var g;let y=!1;return{initialEvaluation:f,compartment:h,overlayElement:this.pluginUIData.overlayRoot,uiRecords:c,dispose:()=>{y||(y=!0,this.pluginUIData.disposeByKey(l),p())}}}createGlobalThis(e,t,i,a){const o=Object.assign(Object.assign(Object.assign({},e),{window:Object.assign(Object.assign({},e),{parent:{postMessage(e,t,i){(0,n.K)(t)?window.parent.postMessage(e,t,i):window.parent.postMessage(e,t)}}})}),t),s=Object.assign(Object.assign({},o.window),{HTMLIFrameElement,location:{href:""},document,getComputedStyle:getComputedStyle.bind(globalThis),parent:window.parent}),l=Object.assign(Object.assign(Object.assign({},o),{window:s,HTMLIFrameElement,Document,HTMLDocument,HTMLCanvasElement,DOMException,URLSearchParams,ResizeObserver,Error,Headers,DOMMatrix,DOMMatrixReadOnly,URL,Blob,FileReader,TextDecoder,WebAssembly,document,navigator:{userAgent:navigator.userAgent,language:navigator.language}}),i);if(l.self=l,a.canFetch){const e=a.canFetchAsUser?d:r;s.fetch=e,l.fetch=e,l.XMLHttpRequest=XMLHttpRequest,l.Request=Request}if(a.canStoreLocal){let e;for(e of[l,s])e.indexedDB=indexedDB,e.IDBKeyRange=IDBKeyRange,e.IDBTransaction=IDBTransaction,e.IDBDatabase=IDBDatabase,e.IDBObjectStore=IDBObjectStore,e.IDBIndex=IDBIndex,e.IDBCursor=IDBCursor,e.IDBCursorWithValue=IDBCursorWithValue,e.IDBRequest=IDBRequest,e.IDBOpenDBRequest=IDBOpenDBRequest,e.IDBVersionChangeEvent=IDBVersionChangeEvent,e.IDBFactory=IDBFactory}return{strictGlobalThis:o,openGlobalThis:l}}setupPluginEnv(e,t,i,n){const a=(n,a)=>{e.debug("dispatching plugin event:",n,a),i.set(t,{name:n,eventData:a})};return{overlaySlot:()=>n[Ea.nT.OVERLAY].getOrCreateShadowRoot()||null,slot(e,t){const i=void 0!==t?t:Pa.U[e];return a(Pa.fF,{slot:e,visible:i}),n[e].getOrCreateShadowRoot()||null},notifyEvent(e,t){a(e,t)}}}async loadLibrary(e,t){var i;const n=this.libraryCache.get(e,t);if(n)return n;const a=null===(i=this.semver.coerce(t))||void 0===i?void 0:i.raw;if(!a)throw Error(`${t} is an invalid version for ${e}@${t}`);if(Da.libraryManifest.hasKey(e)){const i=Da.libraryManifest.getValuesAtKey(e);for(const[t,n]of i)if(this.semver.satisfies(a,t)){const i=await n();return this.libraryCache.set(e,t,i),i}throw Error(`${e}@${t} is unsupported. Supported versions are \n\t${[...i.keys()].join("\n\t")}`)}throw Error(`${e} is unsupported as a peer dependency. Include it as a normal dependency to utilize it.`)}}Da=xa,xa.libraryManifest=new _a.t([["three",[["0.171",async()=>({THREE:await Promise.resolve().then(i.t.bind(i,68909,23))})]]],["react",[["19",()=>i.e(5352).then(i.bind(i,85352))],["18",()=>i.e(5455).then(i.bind(i,45455))],["17",()=>i.e(8094).then(i.bind(i,48094))]]],["react-dom",[["19",()=>i.e(5352).then(i.bind(i,85352))],["18",()=>i.e(5455).then(i.bind(i,45455))],["17",()=>i.e(8094).then(i.bind(i,48094))]]],["@sparkjsdev/spark",[["0.1.6",async()=>({SPARK:await i.e(2955).then(i.bind(i,42955))})]]]]);const Va=xa},86426:(e,t,i)=>{"use strict";i.d(t,{Ns:()=>s,gp:()=>a,t6:()=>r,tZ:()=>o});var n=i(77201);class a extends n.uB{constructor(e,t){super(),this.payload={id:e,name:t}}}a.id="RENAME_SNAPSHOT";class o extends n.uB{constructor(e){super(),this.payload={id:e}}}o.id="DELETE_SNAPSHOT";class s extends n.uB{constructor(e,t){super(),this.payload={snapshot:e,viewId:t}}}s.id="UPLOAD_SNAPSHOT";class r extends n.uB{constructor(e){super(),this.payload={id:e}}}r.id="SET_CURRENT_SNAPSHOT_PHOTO"},52540:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var n=i(77201),a=i(58229),o=i(47737),s=i(2812),r=i(20968),d=i(58619),l=i(72853),c=i(73427),u=i(66416);class h extends r.g{constructor(e){super(e),this.prefetchKey="data.model.assets.photos",this.deserializer=new l.S,this.serializer=new c.a}async read(e={}){var t;const i={modelId:null!==(t=e.modelId)&&void 0!==t?t:this.getViewId()};return e=Object.assign({anonymous:!0},e),this.query(d.GetSnapshots,i,e).then((e=>{var t,i,n,a,o,s,r,d;const l=((null===(n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.assets)||void 0===n?void 0:n.photos)||[]).map((e=>this.deserializer.deserialize(e))),c={};for(const e of l)e&&(c[e.sid]=e,this.privateBaseViewIdWorkaround(e));const u=(null===(o=null===(a=null==e?void 0:e.data)||void 0===a?void 0:a.model)||void 0===o?void 0:o.defurnishedViews)||[];for(const e of u){const t=((null===(r=null===(s=e.model)||void 0===s?void 0:s.assets)||void 0===r?void 0:r.photos)||[]).map((e=>this.deserializer.deserialize(e)));for(const i of t)i&&(i.sourceViewId=null===(d=e.model)||void 0===d?void 0:d.id,c[i.sid]=i)}return c}))}async refresh(){return super.refresh({fetchPolicy:"no-cache"})}async create(e,t,i={}){var n;const a=null!==(n=i.modelId)&&void 0!==n?n:this.getViewId(),o=e.category===u.X.TOUR,s=o?"UploadHighlightReelSnapshot":"UploadModelSnapshot",r=o?d.UploadHighlightReelSnapshot:d.UploadModelSnapshot,l=this.serializer.serialize(e,t);return this.client.upload(r,s,Object.assign(Object.assign({},l),{modelId:a})).then((e=>{var t;return this.privateBaseViewIdWorkaround(this.deserializer.deserialize(null===(t=e.data)||void 0===t?void 0:t.snapshot))}))}async update(e,t={}){var i,n;const a=null!==(i=t.modelId)&&void 0!==i?i:this.getViewId(),o=null===(n=(await this.client.mutate(d.PatchPhoto,{modelId:a,photoId:e.sid,label:e.name})).data)||void 0===n?void 0:n.patchPhoto;return this.deserializer.deserialize(o)}async delete(e,t={}){var i,n;const a=null!==(i=t.modelId)&&void 0!==i?i:this.getViewId();return(null===(n=(await this.client.mutate(d.DeletePhoto,{modelId:a,photoId:e})).data)||void 0===n?void 0:n.deletePhoto)||!1}privateBaseViewIdWorkaround(e){return e&&e.sourceViewId===this.getBaseViewId()&&(e.sourceViewId=void 0),e}}var m=i(86426),p=i(50444),v=i(97800);class f extends n.nV{constructor(){super(...arguments),this.name="snapshots-data",this.getWriteViewId=(e=this.layersData.currentViewId)=>{const t=this.layersData.getView(e);return t.isPrivateView()||t.isCompositeView()||t.isDefurnishView()?t.id:this.layersData.getBaseModelId()}}async init(e,t){const{readonly:i,baseUrl:n,initialViewId:a,baseModelId:r}=e;this.engine=t;const d=await t.market.waitForData(o.P);this.layersData=d;this.store=new h({context:d.mdsContext,readonly:i,baseUrl:n,viewId:(()=>{const e=d.getView(a);return e.isPrivateView()||e.isCompositeView()?e.id:r})()});const l=await this.store.read()||{};this.snapshotsData=new s.O(l),this.snapshotsData.onStale=()=>this.store.refresh(),t.market.register(s.O,this.snapshotsData),i||this.bindings.push(t.commandBinder.addBinding(m.Ns,(({snapshot:e,viewId:t})=>this.uploadSnapshot(e,t))),t.commandBinder.addBinding(m.gp,(({id:e,name:t})=>this.renameSnapshot(e,t))),t.commandBinder.addBinding(m.tZ,(({id:e})=>this.deleteSnapshot(e))),t.commandBinder.addBinding(m.t6,(({id:e})=>this.setSelectedSnapshot(e))))}async setSelectedSnapshot(e){this.snapshotsData.setSelectedPhoto(e)}async uploadSnapshot(e,t){const i=await this.engine.market.waitForData(a.q),n=await this.store.create(e,{floorsData:i},{modelId:this.getWriteViewId(t)});return n&&(this.snapshotsData.add(n),this.engine.broadcast(new p.W(n,e))),n}async renameSnapshot(e,t){const i=this.snapshotsData.get(e);t!==i.name&&(i.name=t,i.commit(),this.snapshotsData.commit(),await this.store.update(i,{modelId:this.getWriteViewId()}))}async deleteSnapshot(e){await this.store.delete(e,{modelId:this.getWriteViewId()}).catch((t=>{v.Vy.for(this).error(`Failed to delete snapshot ${e}`,t)}))&&(this.snapshotsData.remove(e),this.snapshotsData.commit())}}},58687:(e,t,i)=>{"use strict";i.d(t,{M:()=>o});var n=i(77201),a=i(98848);class o extends n.B_{constructor(e={}){super(),this.name="storage-data",this.lastPublished=null,this.transactionState=a.i.IDLE,this.isInProcessingSubState=!1,Object.assign(this,e)}setTransactionState(e){if(e!==this.transactionState){if(![this.transactionState,e].includes(a.i.IDLE))throw new Error(`Cannot transition from ${this.transactionState} to ${e}`);this.transactionState=e,this.transactionState===a.i.IDLE&&(this.isInProcessingSubState=!1),this.commit()}}setProcessingSubState(e){if(e&&this.transactionState===a.i.IDLE)throw new Error("Cannot be in a Processing sub-state while Transaction State is Idle");this.isInProcessingSubState=e,this.commit()}}},98848:(e,t,i)=>{"use strict";var n,a;i.d(t,{i:()=>n,w:()=>a}),function(e){e.IDLE="idle",e.SAVING="saving"}(n||(n={})),function(e){e.ON="on",e.BEFORE="before",e.AFTER="after"}(a||(a={}))},74565:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DataSavedMessage:()=>h.DI,ForbiddenError:()=>d,ForbiddenErrorMessage:()=>h.xt,PublishError:()=>c,PublishErrorMessage:()=>h.ft,SaveCommand:()=>n.F,SaveError:()=>l,SaveErrorMessage:()=>h.xi,StorageAnalytics:()=>m.Y,StorageData:()=>p.M,StorageError:()=>r,TransactionPhase:()=>a.w,TransactionState:()=>a.i,default:()=>_,getErrorCodeForDataType:()=>u});var n=i(81530),a=i(98848),o=i(52018),s=i(77201);class r extends o.t{constructor(e,t="50001"){super(e),this.name="StorageError",this.code=t}}class d extends o.t{constructor(e,t="53100"){super(e),this.name="ForbiddenError",this.code=t}}class l extends o.t{constructor(e,t="53100"){super(e),this.name="SaveError",this.code=t}}class c extends o.t{constructor(e,t="53200"){super(e),this.name="PublishError",this.code=t}}function u(e){return{[s.pe.BLUR_SUGGESTIONS]:"12",[s.pe.BLURS]:"01",[s.pe.FLOORS]:"02",[s.pe.HIGHLIGHTS]:"03",[s.pe.LABELS]:"04",[s.pe.MATTERTAGS]:"05",[s.pe.MEASUREMENTS]:"06",[s.pe.NOTES]:"07",[s.pe.OBJECT_ANNOTATIONS]:"15",[s.pe.ORDERED_LISTS]:"13",[s.pe.PHOTOS]:"08",[s.pe.PLUGINS]:"17",[s.pe.SETTINGS]:"09",[s.pe.START_LOCATION]:"10",[s.pe.SWEEPS]:"11",[s.pe.LAYERS]:"14",[s.pe.ROOM_BOUNDS]:"16"}[e]||"99"}var h=i(45548),m=i(85730),p=i(58687),v=i(48086),f=i(8032),g=i(20563),y=i(97800),w=i(96276),b=i(43066),k=i(47737),S=i(12837),T=i(99583),I=i(39209),D=i(10459),N=i(74328);const E=new y.Vy("publishing-manager");class P{constructor(e,t,i){this.engine=t,this.lock=i,this.client=e;const{market:n}=this.engine;Promise.all([n.waitForData(s.zH),n.waitForData(k.P)]).then((([e,i])=>{const n=i.getWorkshopSessionView();if(n)if(e.application===s.lg.WORKSHOP)this.publish(n);else{const e=t.subscribe(s.E5,(t=>{t.application===s.lg.WORKSHOP&&(e.cancel(),this.publish(n))}))}}))}async publish(e){const t=await this.lock.lock();E.debug("Publishing"),await this.mergeView(e.id).catch((e=>{E.error(e),t.unlock();const i="53200";if(e instanceof g.ZT||e instanceof g._W){const t=new d(e,i);throw this.engine.broadcast(new h.xt(t,[])),t}const n=new c(e,i);throw this.engine.broadcast(new h.ft(n,[])),n})),t.unlock(),await this.hasWorkshopChanges(e.id)?E.error("Auto-Publishing failed"):(E.debug("Auto-Publishing completed"),this.reloadWorkshop())}async mergeView(e){const t=await this.client.query(b.PublishView,{viewId:e}).catch((e=>{throw new w.YA(e)})),i="53200"===(0,y.P3)("error","");if(!v.t.isOk(t)||i){const e=new w.YA(v.t.getErrorMessage(t));throw i&&(e.isMock=!0),e}}async hasWorkshopChanges(e){var t,i,n;const a=null===(n=null===(i=null===(t=(await this.client.query(b.GetMergeDiff,{viewId:e}).catch((e=>{throw new w.tW(e)}))).data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.mergeDiff)||void 0===n?void 0:n.typesModified;return!!a&&a.length>0}async reloadWorkshop(){const{market:e}=this.engine,[t,i,n,a]=await Promise.all([e.waitForData(S.A),e.waitForData(T.X),e.waitForData(I.X),e.waitForData(D.M)]),o=N.s.serialize({cameraData:a,viewmodeData:i,floorsViewData:n,sweepData:t});o.set("edit","1"),o.set("qs","1"),(0,y._0)(o.toString())}}class _ extends s.nV{constructor(){super(...arguments),this.name="storage",this.saveHandlers=new Set,this.lock=new f.c,this.pendingSaves=0,this.unsavedChangesPopup=e=>{this.data.transactionState!==a.i.IDLE&&e.preventDefault()}}async init(e,t){const{baseUrl:i,mdsContext:a}=e;this.config=e,this.engine=t,this.client=new v.t({baseUrl:i,mdsContext:a}),this.data=new p.M,this.bindings.push(t.commandBinder.addBinding(n.F,(e=>this.save(e.dataTypes,e.onCallback,e.skipDirtyUpdate))),(0,s.Sh)((()=>window.addEventListener("beforeunload",this.unsavedChangesPopup)),(()=>window.removeEventListener("beforeunload",this.unsavedChangesPopup)))),t.market.waitForData(k.P).then((e=>{e.isWorkshopSessionView()&&new P(this.client,this.engine,this.lock)})),t.market.register(p.M,this.data)}dispose(e){super.dispose(e)}onSave(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||a.w.ON};return(0,s.Sh)((()=>this.saveHandlers.add(i)),(()=>this.saveHandlers.delete(i)),!0)}async save(e,t,i=!1){this.pendingSaves++;const n=await this.lock.lock(),o=t=>{y.Vy.for(this).error(t),this.pendingSaves--,n.unlock(),0===this.pendingSaves&&this.data.setTransactionState(a.i.IDLE);const i=e[0]?`531${u(e[0])}`:"53100";if(t instanceof g.ZT||t instanceof g._W){const n=new d(t,i);throw this.engine.broadcast(new h.xt(n,e)),n}const o=new l(t,i);throw this.engine.broadcast(new h.xi(o,e)),o};y.Vy.for(this).debug(`Saving ${[...e].join(", ")}...`),this.data.setTransactionState(a.i.SAVING);const{before:s,on:r,after:c}=this.getCallbacksByPhase(this.saveHandlers,e);await Promise.all(s.map((e=>e()))).catch(o),await Promise.all(r.map((e=>e()))).catch(o),t&&await t().catch(o),this.engine.broadcast(new h.DI(e)),await Promise.all(c.map((e=>e()))).catch(o),this.pendingSaves--,n.unlock(),0===this.pendingSaves&&this.data.setTransactionState(a.i.IDLE),y.Vy.for(this).debug(`Saving ${[...e].join(", ")} completed`)}getCallbacksByPhase(e,t){const i=Array.isArray(t)?t:Object.values(s.pe),n=[...e.values()].filter((e=>!e.dataType||i.includes(e.dataType))),o={[a.w.BEFORE]:[],[a.w.ON]:[],[a.w.AFTER]:[]};return n.reduce(((e,t)=>(e[t.phase].push((()=>t.callback(i))),e)),o)}}},35872:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>B});var n=i(77201),a=i(97800),o=i(27960),s=i(94814),r=i(71687),d=i(13893),l=i(81530),c=i(47737),u=i(99583),h=i(47907),m=i(89383),p=i(20968);const v=new a.Vy("mds-sweep-serializer");class f{serialize(e){const t={};return void 0===e.enabled&&void 0===e.vrenabled||(t.tags=[],e.enabled&&t.tags.push("showcase"),e.vrenabled&&t.tags.push("vr")),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["tags"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,a=void 0===e.tags||Array.isArray(e.tags),o=a&&i&&n;return o||v.debug("Invalid AnchorPatch:",{tagsIsArrayIfPresent:a,hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),o}}var g=i(51666),y=i(50018),w=i(86866),b=i(76318),k=i(81587),S=i(74381);const T=new a.Vy("mds-sweep-serializer"),I={[S.$h.AUTO]:y.EO.AUTO,[S.$h.MANUAL]:y.EO.MANUAL,[S.$h.UNPLACED]:y.EO.UNPLACED},D={[S.n.VISION]:y.c$.ALIGNED,[S.n.UPLOAD]:y.c$.UNALIGNED};class N{constructor(e){this.ctx=e,this._currentQueryRootId=null}setCurrentRootModelId(e){this._currentQueryRootId=e}setOverlayActive(e){this._overlayActive=e}deserialize(e){var t,i,n,a;if(!e||!this.validate(e))return T.debug("Deserialized invalid Sweep data from MDS",e),null;const o=e;let s=null;this._overlayActive&&o.model.id!==this._currentQueryRootId?s=o.model.id:this.ctx.isPrivateSession?s=null:this.ctx.isCompositeModel?s=o.model.id:this.ctx.baseViewId!==this._currentQueryRootId&&(s=this._currentQueryRootId);const r=new y.Ay({platformId:o.id,sourceViewId:s,neighbours:o.neighbors||[]});r.index=o.index,r.enabled=!!(null===(t=o.tags)||void 0===t?void 0:t.includes("showcase")),r.vrenabled=!!(null===(i=o.tags)||void 0===i?void 0:i.includes("vr")),o.position&&(r.floorPosition=w.U$.fromVisionVector(o.position)),r.floorId=(null===(n=o.floor)||void 0===n?void 0:n.id)||null,r.roomId=(null===(a=o.room)||void 0===a?void 0:a.id)||null;const d=o.pano;let l=d.label||"";if(l===`${r.index}`&&(l=""),r.name=l,r.alignmentType=D[d.source],r.uuid=d.sweepUuid||"",r.alignmentType===y.c$.ALIGNED?r.placementType=y.EO.AUTO:r.placementType=I[d.placement],d.position){const e=w.U$.fromVisionVector(d.position);r.placementType!==y.EO.AUTO&&e.distanceTo(r.floorPosition)>1e3&&(r.placementType=y.EO.UNPLACED),r.position=e}r.resolutions=[];const c=d.skyboxes||[];if(d.resolutions)for(const e of d.resolutions){const t=this.getPanoSizeClass(e),i=this.makeSkybox(c.find((t=>t.resolution===e)));t&&i?(r.resolutions.push(t),r.skyboxes[t]=i):T.debug(`Invalid pano size class ${e}`)}return d.rotation&&(r.rotation=w.U$.fromVisionSweepQuaternion(d.rotation)),r.floorId||(r.alignmentType===y.c$.ALIGNED?T.debug(`Aligned sweep ${r.index} has no floor association`):r.placementType===y.EO.MANUAL&&T.debug(`Manually placed sweep ${r.index} has no floor association`)),r.roomId||r.alignmentType===y.c$.ALIGNED&&T.debug(`Aligned sweep ${r.index} has no room association`),r}validate(e){if(!e)return!1;const t=[],i=["id","index","tags"];if(t.push((()=>i.every((t=>t in e)))),t.push((()=>"number"==typeof e.index)),t.push((()=>!!e.position&&(0,g.Z)(e.position))),t.push((()=>"pano"in e&&!!e.pano)),e.pano){const{placement:i,source:n,position:a}=e.pano;t.push((()=>!!i&&i in I)),t.push((()=>!!n&&n in D)),t.push((()=>!!a&&(0,g.Z)(a)))}return t.every((e=>e()))}getPanoSizeClass(e){const t={low:b.MF.BASE,high:b.MF.STANDARD,"2k":b.MF.HIGH,"4k":b.MF.ULTRAHIGH};return e in t?t[e]:void 0}makeSkybox(e){if(e&&e.tileUrlTemplate&&e.tileResolution&&e.tileCount)return new a.fN({tileUrlTemplate:e.tileUrlTemplate,tileResolution:parseInt(e.tileResolution,10),tileCount:e.tileCount,urlTemplate:null!==e.urlTemplate?e.urlTemplate:void 0},(0,k.X)(e.validUntil,null))}}var E=i(78498);const P=new a.Vy("mds-sweep-serializer");class _{serialize(e){const t={};return e.rotation&&(t.rotation=(0,E.p)(w.U$.toVisionSweepQuaternion(e.rotation))),e.position&&(t.position=(0,E.I)(w.U$.toVisionVector(e.position))),e.placementType&&e.placementType===y.EO.UNPLACED&&(t.resetPlacement=!0,t.resetFloor=!0,t.resetRoom=!0),"roomId"in e&&(e.roomId?t.roomId=e.roomId:t.resetRoom=!0),"floorId"in e&&(e.floorId?(t.floorId=e.floorId,t.roomId||(t.resetRoom=!0)):t.resetFloor=!0),"name"in e&&(t.label=e.name||""),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["resetPlacement","resetFloor","resetRoom","rotation","position","floorId","roomId","label"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,a=i&&n;return a||P.debug("Invalid PanoramaLocation:",{hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),a}}const C=new a.Vy("mds-sweep-store");class A extends p.g{constructor(e){super(e),this.panoSerializer=new _,this.anchorSerializer=new f,this.prefetchKey="data.model.locations",this.syncedViewMap={},this.deserializer=new N(e.context)}async read(e={}){var t,i,n,a,o,s,r,d,l,c,u,h,p,v;const{readonly:f}=this.config,g=null!==(t=e.modelId)&&void 0!==t?t:this.getViewId(),y={modelId:g,sweepTags:(null!==(i=e.sweepTags)&&void 0!==i?i:f)?["showcase"]:null,sweepIds:null!==(n=e.sweepIds)&&void 0!==n?n:null},w=await this.query(m.GetSweeps,y,e),b=null!==(s=null===(o=null===(a=null==w?void 0:w.data)||void 0===a?void 0:a.model)||void 0===o?void 0:o.rootModelId)&&void 0!==s?s:this.getBaseViewId(),k=((null===(d=null===(r=null==w?void 0:w.data)||void 0===r?void 0:r.model)||void 0===d?void 0:d.defurnishViews)||[]).map((e=>e.model.id));for(const e of k)this.syncedViewMap[e]=[b,...k.filter((t=>t!==e))],this.syncedViewMap[b]=this.syncedViewMap[b]?[...this.syncedViewMap[b],e]:[e];const S=null===(c=null===(l=null==w?void 0:w.data)||void 0===l?void 0:l.model)||void 0===c?void 0:c.locations,T=null!==(v=null===(p=null===(h=null===(u=null==w?void 0:w.data)||void 0===u?void 0:u.model)||void 0===h?void 0:h.overlayLayers)||void 0===p?void 0:p.some((e=>e.id)))&&void 0!==v&&v;if(!S||!Array.isArray(S))return null;this.deserializer.setOverlayActive(T?g:null),this.deserializer.setCurrentRootModelId(b);const I={},D={};for(const e of S){if(!e)continue;const t=this.deserializer.deserialize(e);t&&(I[t.id]=t,D[t.platformId]=t)}if(this.deserializer.setCurrentRootModelId(null),this.deserializer.setOverlayActive(null),null===y.sweepIds)for(const e of Object.values(I))e.neighbours=e.neighbours.filter((e=>e in D||e in I));return I}async refresh(e={}){return super.refresh(Object.assign({fetchPolicy:"no-cache"},e))}async update(e){if(!e||0===e.length)return;const t=[],i=new Map,n=this.getViewId();e.forEach((e=>{const t=e.sourceViewId||n,a=i.get(t)||[];a.push(e);const o=this.syncedViewMap[t]||[];for(const t of o){const n=this.panoSerializer.serialize(e),a=this.anchorSerializer.serialize(e);if(n||a){const n=i.get(t)||[];n.push(e),i.set(t,n)}}i.set(t,a)}));let a=0;for(const e of i.keys()){const n=i.get(e)||[];let o="";const s={};s.modelId=e;let r="";for(const e of n){a++;const t=this.panoSerializer.serialize(e),i=this.anchorSerializer.serialize(e);if(!t&&!i){C.debug("No changes to update:",e);continue}o+=""+(t?`, $pano${a}: PanoramicImageLocationPatch!`:"")+` ${i?`, $anchor${a}: AnchorPatch!`:""} `,t&&(s[`pano${a}`]=t),i&&(s[`anchor${a}`]=i),r+=`\n          ${t?`\n            panoLocation${a}: patchPanoLocation(modelId: $modelId, , locationId: "${e.id}", patch: $pano${a}) {\n              id\n              placement\n              model { id }\n              position { x y z }\n              rotation { x y z w }\n            }`:""}\n          ${i?`\n            panoAnchor${a}: patchAnchor(modelId: $modelId, , anchorId: "${e.id}", patch: $anchor${a}) {\n              id\n              tags\n              model { id }\n              floor { id, meshId }\n              room { id, meshId }\n            }`:""}\n        `}if(C.devInfo(r),""===r)continue;const d=h.J1`
        mutation sweepUpdate($modelId: ID! ${o}) {
          ${r}
        }
      `;t.push({mutation:d,variables:s})}return t.map((e=>C.devInfo(e.variables))),Promise.all(t.map((e=>this.mutate(e.mutation,e.variables)))).then((()=>{}))}}var x=i(12837),V=i(34184),M=i(47004),O=i(40899),L=i(63362),R=i(93941);const F=s.ME;class B extends n.nV{constructor(){super(),this.name="sweep-data",this.data=new x.A,this.monitor=null,this.internalProgress=!1,this.filteredViewSubscription=null,this.activeOverlayViewId=null,this.activeModelIds=new Set(null),this.refreshSweepDataFilter=()=>{this.filteredViewSubscription&&this.filteredViewSubscription.cancel(),this.filteredViewSubscription=this.data.addFilter("sourceViewId",(e=>this.activeModelIds.has(e.sourceViewId)))},this.ensureValidSweep=()=>{var e;const t=this.cameraModule.cameraData;if(t.transition.active&&t.transition.promise){return t.transition.promise.then((()=>{this.ensureValidSweep()}))}const i=!this.data.containsSweep(this.data.state.currentSweep),n=this.data.getSweep(this.data.state.currentSweep);if(this.data.state.currentSweep&&i){let i=this.data.getClosestSweep(t.pose.position,!0);if(n){const e=this.data.getAlternateSweeps(n)[0];e&&(i=e)}if(i)return(null===(e=this.engine.market.tryGetData(u.X))||void 0===e?void 0:e.isPano())?this.moveToSweep({sweepId:i.id,transitionType:n&&this.data.isSweepAligned(i.id)?d.fl.Interpolate:d.fl.Instant,transitionTime:500}).nativePromise():this.setCurrentSweep({sweepId:i.id})}return Promise.resolve()},this.moveToSweep=this.moveToSweep.bind(this),this.activateSweepUnsafe=this.activateSweepUnsafe.bind(this),this.instantSweepTransition=this.instantSweepTransition.bind(this),this.beginSweepTransition=this.beginSweepTransition.bind(this),this.endSweepTransition=this.endSweepTransition.bind(this),this.setCurrentSweep=this.setCurrentSweep.bind(this),this.sweepNeighborModify=this.sweepNeighborModify.bind(this),this.addSweeps=this.addSweeps.bind(this)}async init(e,t){const{readonly:i}=e;this.engine=t,this.market=this.engine.market;const a=await this.engine.getModuleBySymbol(r.Qm);this.data.initSwitchableFromViewport(a),this.bindings.push(t.commandBinder.addBinding(L.HP,this.setCurrentSweep),t.commandBinder.addBinding(L.WS,(async e=>this.sweepNeighborModify(e))),this.data.onSweepsChanged(this.ensureValidSweep)),this.cameraModule=await this.engine.getModuleBySymbol(r.jh),this.store=await this.initSweepStore(e,t),this.market.register(x.A,this.data),!1===i&&(this.monitor=new n.Fy(this.data.getCollectionUnfiltered(),{aggregationType:n.DF.Debounced,aggregationDuration:250,shallow:!0},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new l.F({dataTypes:[n.pe.SWEEPS]})))),t.getModuleBySymbol(r.T9).then((e=>{this.bindings.push(e.onSave((()=>this.save()),{dataType:n.pe.SWEEPS}))})))}getSweepOnView(e,t=void 0){var i;const n=this.data.getSweep(e),a=null!==(i=null==n?void 0:n.platformId)&&void 0!==i?i:e,o=t===this.baseViewId?null:void 0===t?this.activeOverlayViewId:t,s=this.data.getSweep(y.Ay.formatId(a,o));return s||this.data.getSweep(y.Ay.formatId(a,this.activeOverlayViewId))}async setCurrentSweep(e){if(e.sweepId)try{const t=e.sweepId;await this.activateSweepUnsafe({sweepId:t}),this.beginSweepTransition({sweepId:t,transitionTime:0,internalProgress:!0}),this.data.state.currentSweep=t,this.endSweepTransition({sweepId:t}),this.data.state.commit()}catch(e){a.Vy.for(this).error(e)}else this.data.state.currentSweep=void 0,this.data.state.commit()}sweepNeighborModify(e){if(e.id){const t=this.data.getSweep(e.id);t&&t.atomic((()=>{let i=!1;for(const n of e.added)-1===t.neighbours.indexOf(n)&&this.data.containsSweep(n)&&(t.neighbours.push(n),i=!0);for(const n of e.removed){const e=t.neighbours.indexOf(n);-1!==e&&(t.neighbours.splice(e,1),i=!0)}i&&(t.neighborsEdited=!0,t.commit())}))}}moveToSweep(e){var t;const i=e.cameraData||this.cameraModule.cameraData,s=e.sweepDataState||this.data.state.currentObservable,r=new n.iB;let d=e.sweepId;if(d&&!this.data.containsSweep(d)&&this.data.getSweepByUuid(d)&&(d=null===(t=this.data.getSweepByUuid(d))||void 0===t?void 0:t.id,e.sweepId=d),d){const t=d,i=this.getSweepOnView(d,e.viewId);i&&(d=i.id,e.sweepId=d,d!==t&&a.Vy.for(this).info(`moveToSweep ${t} is not available in view, moving to ${d}.`))}const l=Object.assign(Object.assign({},e),{cameraData:i.id,sweepDataState:s.id});if(!d||!this.data.getSweep(d))return a.Vy.for(this).error(`moveToSweep error ${JSON.stringify(l)}`,"Invalid sweep"),n.iB.reject(new R.m("Invalid sweep"));const c=e;if(!s.canTransition()||!i.canTransition())throw new R.d;return this.activateSweepUnsafe(c).then((()=>{if(!s.canTransition())throw new R.d;return this.beginSweepTransition(c),this.defaultSweepCameraMove(r,c,s)})).then((()=>{this.endSweepTransition(c),r.resolve()})).catch((e=>{e instanceof R.d||e instanceof R.m?a.Vy.for(this).error(`moveToSweep ignored ${JSON.stringify(l)}`,e):e instanceof o.d&&(s.transition.from&&this.endSweepTransition({sweepId:s.transition.from}),a.Vy.for(this).info(`exception moving to sweep ${JSON.stringify(l)}`,e)),r.reject(e)})),r.promise()}async activateSweepUnsafe(e){return this.panoRenderer||(this.panoRenderer=(await this.engine.getModuleBySymbol(r.qD)).getRenderer()),this.panoRenderer.activateSweep(e.sweepId,!0)}instantSweepTransition(e){const t=this.data.state.currentSweep;this.beginSweepTransition({sweepId:e,transitionTime:0,internalProgress:!0}),this.data.state.currentSweep=e,this.data.state.commit(),this.engine.broadcast(new O.A(e,t)),this.endSweepTransition({sweepId:e})}beginSweepTransition(e){const t=e.sweepDataState||this.data.state;t.activateTransition(e.sweepId,t.currentSweep),this.internalProgress=e.internalProgress||!1,t.transition.progress.modifyAnimation(0,1,e.transitionTime||0,e.easing||F),t.commit(),this.engine.broadcast(new V.A(e.sweepId,t.currentSweep))}endSweepTransition(e){const t=e.sweepDataState||this.data.state,i=t.transition.from,n=this.getSweepOnView(e.sweepId,e.viewId);t.deactivateTransition(),t.currentSweep=e.sweepId,t.transition.progress.stop(1),this.internalProgress=!1,t.commit(),this.engine.broadcast(new M.A(e.sweepId,n.alignmentType,n.placementType,i))}async defaultSweepCameraMove(e,t,i){var n;const a={position:(null===(n=this.getSweepOnView(t.sweepId,t.viewId))||void 0===n?void 0:n.position)||this.getSweepOnView(t.sweepId).position,rotation:t.rotation};let o=d.fl.Interpolate;void 0!==t.transitionType&&d.fl[t.transitionType]&&(o=t.transitionType),(this.data.isSweepUnaligned(t.sweepId)||this.data.isSweepUnaligned(i.currentSweep))&&(o=d.fl.FadeToBlack);const s=this.cameraModule.getCameraControllerForData(t.cameraData).moveTo({transitionType:o,pose:a,transitionTime:t.transitionTime,transitionSpeedMultiplier:t.transitionSpeedMultiplier,easing:t.easing,rotationDelay:t.rotationDelay,projection:t.projection});let r=!1;return s.progress((n=>{if(i.transition.progress.updateProgress(n),e.notify(n),n>=.5&&!r){r=!0;const e=i.currentSweep;i.currentSweep=t.sweepId,i.commit(),this.engine.broadcast(new O.A(t.sweepId,e))}})),s.nativePromise()}async initSweepStore(e,t){const{readonly:i,baseUrl:n}=e,a=await t.market.waitForData(c.P),o=new A({context:a.mdsContext,readonly:i,baseUrl:n});this.baseViewId=a.getBaseModelId();let s=a.getCurrentView();const r=async()=>{var e;const t=a.getCurrentView(),i=t.isDefurnishView()&&t.hasOverlayAssets()||this.baseViewId!==t.id&&t.hasOverlayAssets()||t.rootModelId!==s.rootModelId?t.id:null,n=t.isCompositeView()?t:a.getView(null!=i?i:a.getWorkshopOrBaseId());if(this.data.getSweepList().length&&o.getViewId()===n.id)return;o.setStoreViewId(n.id),s=n;const r=await(null===(e=o.refresh)||void 0===e?void 0:e.call(o,{modelId:n.id,fetchPolicy:"cache-first"})),d=this.activeOverlayViewId;this.activeOverlayViewId=i,this.addSweeps(n.id,r);const l=Object.values(null!=r?r:{}).map((e=>e.sourceViewId)).concat(i);this.updateSweepFiltering({added:new Set(l),removed:new Set([d])}),this.data.commit()};return this.bindings.push(a.onPropertyChanged("currentViewId",r)),await r(),o}async query(e){return this.store.read(e)}addSweeps(e,t,i=this.data){t&&((0,a._z)(t,(async()=>{var t,n;const a=await(null===(n=(t=this.store).refresh)||void 0===n?void 0:n.call(t,{modelId:e,fetchPolicy:"no-cache"}))||{};i.refresh(a)})),i.addSweeps(t))}async refreshSweeps(e={modelId:this.baseViewId,fetchPolicy:"no-cache"}){var t,i;const n=await(null===(i=(t=this.store).refresh)||void 0===i?void 0:i.call(t,e));n&&this.data.refresh(n)}updateSweepFiltering({added:e,removed:t}){for(const e of t||[])this.activeModelIds.delete(e);for(const t of e||[])this.activeModelIds.add(t);this.refreshSweepDataFilter(),a.Vy.for(this).debugInfo("filter",{views:[...this.activeModelIds.values()]})}onUpdate(e){this.internalProgress&&this.data.state.transition.active&&this.data.state.transition.progress.tick(e)}dispose(e){var t,i;super.dispose(e),null===(i=null===(t=this.store)||void 0===t?void 0:t.dispose)||void 0===i||i.call(t)}async save(){if(!this.store||!this.monitor)throw Error("No store configured for saving sweep edits!");const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e.filter((e=>e.action===n.Xw.updated)).map((e=>{const t=this.data.getSweep(e.index),i=Object.assign({id:t.platformId},e.diff);return("position"in i||"rotation"in i)&&(i.position=t.position,i.rotation=t.rotation),("enabled"in i||"vrenabled"in i)&&(i.enabled=t.enabled,i.vrenabled=t.vrenabled),t.placementType===y.EO.AUTO&&U.forEach((e=>{e in i&&delete i[e]})),i}));if(t.length)return this.store.update(t)}}const U=["floorId","position","rotation"]},5544:(e,t,i)=>{"use strict";i.d(t,{f:()=>a});var n=i(77201);class a extends n.QB{constructor(){super()}}},42329:(e,t,i)=>{"use strict";i.d(t,{jl:()=>s,ly:()=>a,qO:()=>o});var n=i(77201);class a extends n.uB{constructor(e){super(),this.payload={search:e}}}a.id="USERS_SEARCH";class o extends n.uB{constructor(e){super(),this.payload={userMentions:e}}}o.id="USERS_MENTIONS_FETCH";class s extends n.uB{constructor(e,t,i,n){super(),this.payload={emails:e,message:t,modelAccess:i,noteId:n}}}s.id="USERS_INVITE"},21129:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InviteUsersCommand:()=>f.jl,OrgUser:()=>r,ResolveUserMentionsCommand:()=>f.qO,UserData:()=>v.E,UserInfo:()=>b.o,UserMentionSearchCommand:()=>f.ly,UserStatus:()=>p._,default:()=>k,defaultUserColor:()=>w.g,getUnknownUserInfo:()=>w.A});var n=i(77201),a=i(97800),o=i(20968),s=i(74381);class r{constructor(e){this.id="",this.email="",this.firstName="",this.lastName="",this.modelAccess=s.OQ.PUBLIC,Object.assign(this,e)}}const d=new a.Vy("mds-user-deserializer");class l{constructor(){this.validate=e=>{if(!e)return!1;const t=["id","email"].filter((t=>!(t in e))),i=0===t.length;return i||d.debug("OrgUserMetadata invalid:",{missingFields:t}),i}}deserialize(e){return e&&this.validate(e)?new r(e):(d.debug("Deserialized invalid OrgUserMetadata from MDS",e),null)}}var c=i(46240),u=i(81587);const h=new a.Vy("users-store");class m extends o.g{constructor(e){super(e),this.deserializer=new l}async fetchAccessForUser(e,t){return this.query(c.GetCurrentUserModelAccess,{modelId:t,userId:e}).then((t=>{var i,n;const a=null===(i=t.data)||void 0===i?void 0:i.model,o=null===(n=null==a?void 0:a.users)||void 0===n?void 0:n.results;let r=s.OQ.PUBLIC;return o&&Array.isArray(o)?(o.find((e=>e.modelAccess===s.OQ.FULL))?r=s.OQ.FULL:o.find((e=>e.modelAccess===s.OQ.VIEWER))&&(r=s.OQ.VIEWER),h.debug(`modelAccess: ${o.length} response(s), set to "${r}"`)):h.debug(`fetchModelAccess failed for ${e}`),{modelAccess:r,organization:(null==a?void 0:a.organization)||void 0,demo:(null==a?void 0:a.demo)||void 0,created:(0,u.X)(null==a?void 0:a.created,null)||void 0}}))}async search(e,t,i){const n=this.getViewId();return this.query(c.GetUsers,{modelId:n,search:e||null,ids:i||null,emails:t||null}).then((e=>{var t,i,n;const a=null===(n=null===(i=null===(t=e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.users)||void 0===n?void 0:n.results;if(!a||!Array.isArray(a))return[];const o=[];for(const e of a){const t=this.deserializer.deserialize(e);t&&o.push(t)}return o}))}async addOrUpdateModelShareAccess(e,t,i,n=this.getViewId()){return this.mutate(c.AddOrUpdateModelShareAccess,{email:e,roleId:t,message:i,modelId:n}).then((e=>{var t,i,n;const a=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.addOrUpdateModelShareAccess,o=null==a?void 0:a.user,s=null==a?void 0:a.modelShareAccessLevel;if(o&&s)return{id:o.id,email:o.email,firstName:null!==(i=o.firstName)&&void 0!==i?i:"",lastName:null!==(n=o.lastName)&&void 0!==n?n:"",modelAccess:s.name};throw new Error(`Failed to invite user. ${e.errors}`)})).catch((e=>{throw h.error("Failed to invite user",e),e}))}async getAssignableRoles(e=this.getViewId()){return this.query(c.GetAssignableRoles,{modelId:e}).then((e=>{var t,i;const n=null===(i=null===(t=e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.assignableRoles;return n||(h.error("Failed to fetch assignable roles"),[])}))}}var p=i(87193),v=i(33156),f=i(42329),g=i(47737);class y extends n.nV{constructor(){super(...arguments),this.name="users-module",this.onUserMentionSearch=async e=>{const t=await this.store.search(e.search);this.userData.loadKnownUsers(t)},this.resolveUserMentions=async e=>{if(0===e.userMentions.length)return void a.Vy.for(this).debug("No user mentions to resolve");const t=[];if(e.userMentions.forEach((e=>{this.userData.getUserInfoByEmail(e.email)&&e.userStatus!==p._.MENTIONED||t.push(e)})),t.length>0){const e=t.map((e=>e.email));return this.searchUsers(new Set(e),p._.MENTIONED)}},this.getRoleId=async e=>this.store.getAssignableRoles().then((t=>{var i;return null===(i=t.find((t=>t.name===e)))||void 0===i?void 0:i.id})),this.inviteUsers=async e=>{const{emails:t,modelAccess:i,message:n}=e;if(0===t.length)return;const o=new Set,s=await this.getRoleId(i);if(s)return await Promise.all(e.emails.map((e=>this.store.addOrUpdateModelShareAccess(e,s,n).then((e=>{this.userData.loadKnownUser(e)})).catch((()=>{a.Vy.for(this).debug(`User Invite failed: ${e}`),o.add(e)}))))),o.size>0?this.searchUsers(o,p._.FAILED):void 0;a.Vy.for(this).error(`User cannot assign role ${i} on this model.`)}}async init(e,t){this.store=new m({context:e.mdsContext,readonly:!1,baseUrl:e.baseUrl,viewId:e.viewId}),t.market.waitForData(g.P).then((async i=>{const n=await e.api.user;let a,o,r=s.OQ.PUBLIC,d=!1;if(n.loggedIn&&n.id){const e=await this.store.fetchAccessForUser(n.id,i.getBaseModelId());r=e.modelAccess,a=e.organization,d=!!a&&n.isOrganizationAdmin(a),o=e.created}this.userData=new v.E({id:n.id,firstName:n.firstName,lastName:n.lastName,email:n.email,modelAccess:r},n.loggedIn,d,a,o),this.bindings.push(t.commandBinder.addBinding(f.ly,this.onUserMentionSearch),t.commandBinder.addBinding(f.qO,this.resolveUserMentions),t.commandBinder.addBinding(f.jl,this.inviteUsers)),t.market.register(v.E,this.userData)}))}dispose(e){super.dispose(e),e.market.unregister(v.E)}async searchUsers(e,t){const i=Array.from(e),n=await this.store.search(void 0,i);this.userData.loadSearchResults(n,i,t)}}var w=i(33895),b=i(45332);const k=y},12069:(e,t,i)=>{"use strict";i.d(t,{L:()=>s,g:()=>r});var n=i(77201),a=i(81662),o=i(68909);class s extends n.vm{constructor(e=new o.Box2){var t;super(),this.id=""+s.nextId++,this.camera=new o.PerspectiveCamera,this.scene=null,this.annotationLayerIds=new n.yy,null===(t=this.camera.layers)||void 0===t||t.enableAll(),this.rect=e,this.size=e.getSize(new o.Vector2)}updateRect(e){this.rect=e,this.size=e.getSize(new o.Vector2),this.commit()}}s.nextId=0;class r extends n.vm{constructor(e){super(),this.domElement=e,this.defaultViewport=new s,this.viewports=(0,n.y3)({[this.defaultViewport.id]:this.defaultViewport}),this.activeViewport=this.defaultViewport,this.renderingViewport=null,this.getPickPosNDC=(()=>{const e=new o.Vector2,t=new o.Vector2;return(i,n,a)=>{if(!this.domElement)throw new Error("ViewportManager: No domElement set");const o=this.domElement.getBoundingClientRect(),s=a?[...this.viewports.values.reverse(),this.defaultViewport]:[this.activeViewport];for(const r of s)if(e.set(i-o.left,o.bottom-n),a&&r!==this.defaultViewport||e.clamp(r.rect.min,r.rect.max),r.rect.containsPoint(e))return e.sub(r.rect.min),r.rect.getSize(t),a&&this.activeViewport!==r&&(this.activeViewport=r,this.commit()),{x:e.x/t.x*2-1,y:e.y/t.y*2-1,viewport:r};throw new Error("No viewport for this position")}})(),this.worldToScreenPosition=(()=>{const e=new o.Matrix4,t=new o.Matrix4;return(i,n,s,r,d,l,c)=>{var u,h;if(void 0===d&&(d=(null===(u=this.activeViewport)||void 0===u?void 0:u.id)||(null===(h=this.defaultViewport)||void 0===h?void 0:h.id)),!this.domElement)throw new Error("ViewportManager: No domElement set");const m=this.viewports.get(d);if(!m)throw new Error("Invalid viewport id passed to worldToScreenPosition");l=l||new o.Vector2,c=c||new o.Vector3,t.compose(i,n,a.B1.UNIT),e.copy(t),e.invert(),c.set(r.x,r.y,r.z).applyMatrix4(e).applyMatrix4(s);const p=m.rect.max.x-m.rect.min.x,v=m.rect.max.y-m.rect.min.y;l.set((c.x+1)*p/2,(1-c.y)*v/2);const f=this.domElement.getBoundingClientRect(),g=f.bottom-(m.rect.min.y+v);return l.y+=g,l.y-=f.top,l.x+=m.rect.min.x,{screenPosition:l,ndcPosition:c}}})(),this.updateDefaultViewport=()=>{if(!this.domElement)throw new Error("ViewportManager: No domElement set");const e=this.domElement.getBoundingClientRect();this.defaultViewport.updateRect(new o.Box2(new o.Vector2(0,0),new o.Vector2(e.width,e.height)))},e&&this.setDomElement(e),this.onPropertyChanged("activeViewport",(()=>{this.viewports.sort(((e,t)=>e===this.activeViewport?1:t===this.activeViewport?-1:0))}))}dispose(){this.resizeObserver.disconnect(),this.viewports.clear()}setDomElement(e){this.domElement=e,this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.updateDefaultViewport),this.resizeObserver.observe(e),this.updateDefaultViewport()}viewportIdForLayerId(e){if(1===this.viewports.length)return this.viewports.values[0].id;for(const t of this.viewports)if(t.annotationLayerIds.has(e))return t.id;return this.viewports.values[0].id}}},1526:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>r});var n=i(77201),a=i(97800),o=i(12069);class s extends n.nV{constructor(){super(...arguments),this.name="viewport",this.viewportManager=new o.g}manageDataForViewports(e,t,i){var o;const s=new n.Es;for(const i of this.viewportManager.viewports)i.id!==this.viewportManager.defaultViewport.id?s.set(i.id,e(i)):s.set(i.id,null!=t?t:e(i));if(!i){if(!(t=null!==(o=null!=t?t:s.get(this.viewportManager.defaultViewport.id))&&void 0!==o?o:s.values[0]))throw new Error("No initial data found!");i=(0,n.Rv)(t)}const r=t=>{s.has(t.id)||s.set(t.id,e(t))},d=e=>{const t=e||this.viewportManager.activeViewport||this.viewportManager.defaultViewport;if(!t)return;const n=s.get(t.id);if(!n)throw a.Vy.for(this).error("switchToViewport",t,this),new Error("No data found for viewport with id");i.currentObservable=n},l=[];return l.push(this.viewportManager.viewports.onElementChanged({onAdded:r,onUpdated:r,onRemoved:e=>{e.id!==this.viewportManager.defaultViewport.id&&s.delete(e.id)}}),this.viewportManager.onPropertyChanged("renderingViewport",d),this.viewportManager.onPropertyChanged("activeViewport",d)),{switchableData:i,dataMap:s,bindings:l}}}const r=s},16821:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>f});var n=i(68909),a=i(77201),o=i(22278),s=i(39209),r=i(90082),d=i(81662),l=i(30443),c=i(74025);const u=(()=>{const e=Array.from({length:8},((e,t)=>new n.Vector3));return(t,i)=>{(0,l.jF)(i,e);for(const i of e)if(!t.containsPoint(i))return!1;return!0}})();var h=i(51887),m=i(71687);class p extends a.nV{constructor(){super(...arguments),this.trimsFulfilled=!1,this.trimmedBounds=(0,a.pw)({bounds:new n.Box3,center:new n.Vector3}),this.originalChunkBounds=(0,a.pw)([]),this.trimmedChunkBounds=(0,a.pw)([]),this.initialDataLoaded=Promise.resolve()}async init(e,t){e.calculateTrimmedBounds&&this._initTrims(t)}async _initTrims(e){const[t,i,n]=await Promise.all([e.getModuleBySymbol(r.ZF),e.getModuleBySymbol(m.M7),e.getModuleBySymbol(m.GR)]),[a]=await Promise.all([e.market.waitForData(o.U)]);this.modelMeshModule=n,await n.firstMeshLoadPromise;const s=n.getAllMeshes();this.updateTrimmedBounds(n.meshTrimData,s),this.bindings.push(n.meshTrimData.onChanged((()=>this.updateTrimmedBounds(n.meshTrimData,s)))),t.registerMenuButton({header:"Bounds & Trim",buttonName:"Enable debug options",callback:()=>{e.addComponent(this,new v(this,t,i.getScene(),n.meshTrimData,a))}})}getTrimmedBounds(){const e=this.trimmedBounds.value.bounds;return e.isEmpty()?this.getFullBounds():e}getOriginalChunkBounds(){return 0===this.originalChunkBounds.value.length&&this.calculateOriginalChunkBounds(this.modelMeshModule.getAllMeshes()),this.originalChunkBounds.value.map((e=>e.bounds))}getTrimmedChunkBounds(){return this.trimmedChunkBounds.value.map((e=>e.bounds))}getTrimmedCenter(){return this.trimmedBounds.value.bounds.isEmpty()?this.getCenterOfMass():this.trimmedBounds.value.center}onTrimmedBoundsChanged(e){return this.trimmedBounds.onChanged((({bounds:t})=>e(t)))}computePotentialFocusPoint(e,t,i){const a=Math.ceil(Math.abs(t.y-e.min.y)/3);let o=Number.MAX_VALUE;const s=new n.Vector3,r=new n.Vector3;let l=!1;if(Number.isFinite(a))for(let c=0;c<a;c++){const a=e.min.y+.01+3*c,u=(new n.Plane).setFromNormalAndCoplanarPoint(d.B1.UP,new n.Vector3(e.min.x,a,e.min.z)),h=!!i.intersectPlane(u,s),m=t.distanceTo(s);h&&m<o&&(o=m,r.copy(s),l=!0)}return{intersectsPlane:l,intersectionPoint:r}}computeFocusPoint(e,t){const i=this.getVisibleBounds(),n=this.getCenterOfMass();return this.computeFocusPointForBounds(i,n,e,t)}computeFocusPointForBounds(e,t,i,a){const{intersectsPlane:o,intersectionPoint:s}=this.computePotentialFocusPoint(e,t,i);let r;if(a)r=!a(s);else{const i=e.max.distanceTo(t)*Math.SQRT2;r=!e.clone().expandByVector(new n.Vector3(i,0,i)).containsPoint(s)}return o&&!r||(i.closestPointToPoint(t,s),i.origin.distanceTo(s)<h.X8&&i.at(h.X8,s)),s}calculateOriginalChunkBounds(e){let t=Number.MAX_VALUE;e.forEach((e=>{e.chunks.forEach((e=>{t=Math.min(t,e.lod)})),e.chunks.forEach((e=>{if(e.lod>t)return;let i;e.geometry.boundsTree?i=e.geometry.boundsTree.geometry.boundingBox||new n.Box3:(e.geometry.boundingBox||e.geometry.computeBoundingBox(),i=(new n.Box3).copy(e.geometry.boundingBox||new n.Box3)),this.originalChunkBounds.value.push({bounds:i,center:i.getCenter(new n.Vector3)})}))}))}updateTrimmedBounds(e,t){let i=null,a=!1;for(const t of e.meshTrimsById.values)a=a||!t.discardContents;if(i=this.getDiscardTrimmedBounds(e,t),a){let t=null;for(const i of e.meshTrimsById.values)if(!i.discardContents){const e=i.getContainingAABB();t=t?t.union(e):(new n.Box3).copy(e)}t&&(i=t.intersect(i))}this.trimsFulfilled=!0,i=i||new n.Box3,this.trimmedBounds.value={bounds:i,center:i.getCenter(new n.Vector3)}}getDiscardTrimmedBounds(e,t){let i=null,a=Number.MAX_VALUE;return t.forEach((t=>{t.chunks.forEach((e=>{a=Math.min(a,e.lod)})),t.chunks.forEach((t=>{if(t.lod>a)return;const o=this.getDiscardTrimmedBoundsForChunk(t,e);o&&(this.trimmedChunkBounds.value.push({bounds:o,center:o.getCenter(new n.Vector3)}),i=i?i.union(o):(new n.Box3).copy(o))}))})),i||new n.Box3}getDiscardTrimmedBoundsForChunk(e,t){return e.geometry.boundsTree?((e,t)=>{const i=t.map((e=>e.getOBB()));let a=null;return e.shapecast({intersectsBounds:(e,o,s,r)=>{const d=[];let l=!1;if(a&&a.containsBox(e))return c.Bw;for(let n=0;n<t.length;n++){const a=t[n],s=i[n];if(a.enabled&&a.discardContents){if(a.discardContents&&u(s,e)||!a.discardContents&&!s.intersectsBox3(e))return c.yj;s.intersectsBox3(e)&&(l=!0,(o||r>=10)&&d.push(e))}}if(l){if(o||r>=10){a=a||(new n.Box3).copy(d[0]);for(let e=1;e<d.length;e++)a.union(d[e]);return c.Bw}return c.b_}return a=a?a.union(e):(new n.Box3).copy(e),c.Bw},intersectsRange:()=>!1,intersectsTriangle:()=>!1}),a||null})(e.geometry.boundsTree,t.meshTrimsById.values):(e.geometry.boundingBox||e.geometry.computeBoundingBox(),e.geometry.boundingBox?e.geometry.boundingBox.clone():new n.Box3)}}class v{constructor(e,t,i,a,o){this.settings=t,this.webglScene=i,this.meshTrimData=a,this.trims=new Map,this.bounds={Trimmed:[new n.Box3Helper(e.getTrimmedBounds(),new n.Color("orange"))],Full:[new n.Box3Helper(e.getFullBounds(),new n.Color("white"))],Visible:[new n.Box3Helper(e.getFullBounds(),new n.Color("green"))],OriginalChunk:e.getOriginalChunkBounds().map((e=>new n.Box3Helper(e,new n.Color("red")))),TrimmedChunk:e.getTrimmedChunkBounds().map((e=>new n.Box3Helper(e,new n.Color("yellow")))),"Classic Rooms":[...o.meshGroups.rooms.values()].map((e=>new n.Box3Helper(e.boundingBox,new n.Color("cyan"))))};for(const e of Object.values(this.bounds))e.forEach((e=>e.visible=!1));this.rebuildTrimHelpers();for(const[,e]of this.trims)e.visible=!1;e.onTrimmedBoundsChanged((()=>{this.rebuildTrimHelpers(),this.bounds.Trimmed[0].box.copy(e.getTrimmedBounds())})),e.onFullBoundsChanged((()=>this.bounds.Full[0].box.copy(e.getFullBounds()))),e.onVisibleBoundsChanged((()=>this.bounds.Visible[0].box.copy(e.getVisibleBounds())))}init(){for(const[e,t]of Object.entries(this.bounds))this.settings.registerMenuButton({header:"Bounds & Trim",buttonName:`Toggle ${e} bounds display`,callback:()=>{t.forEach((e=>e.visible=!e.visible))}});this.settings.registerMenuButton({header:"Bounds & Trim",buttonName:"Toggle trim visuals",callback:()=>{for(const[,e]of this.trims)e.visible=!e.visible}})}activate(){this.webglScene.add(...this.getAllBoxHelpers()),this.webglScene.add(...this.trims.values())}dispose(){for(const e of Object.values(this.bounds))e.forEach((e=>e.dispose()));for(const e of Object.values(this.trims))e.dispose()}deactivate(){this.webglScene.remove(...this.getAllBoxHelpers()),this.webglScene.remove(...this.trims.values())}render(){}rebuildTrimHelpers(){var e;for(const t of this.meshTrimData.meshTrimsById){const i=(null===(e=this.trims.get(t))||void 0===e?void 0:e.box)||new n.Box3;i.setFromCenterAndSize(t.position,t.scale);const a=this.trims.get(t)||new n.Box3Helper(i,t.discardContents?new n.Color("red"):new n.Color("yellow"));a.quaternion.copy(t.rotation),this.trims.set(t,a)}}getAllBoxHelpers(){return Object.values(this.bounds).reduce(((e,t)=>e.concat(...t)))}}class f extends p{constructor(){super(...arguments),this.name="visible-mesh-bounds",this.visibleBounds=(0,a.pw)(new n.Box3),this.visibleCenterOfMass=(0,a.pw)(new n.Vector3),this.fullBounds=(0,a.pw)(new n.Box3)}async init(e,t){super.init(e,t),this.initialDataLoaded=Promise.all([t.market.waitForData(o.U),t.market.waitForData(s.X)]).then((([e,t])=>{this.meshData=e,this.floorsViewData=t,this.fullBounds.value=this.meshData.extendedBounds,this.updateBounds(),this.bindings.push(this.onTrimmedBoundsChanged((()=>this.updateBounds())),this.floorsViewData.makeFloorChangeSubscription((()=>this.updateBounds())),...this.floorsViewData.floors.getOrderedValues().map((e=>e.onBoundsChanged((()=>this.updateBounds())))))}))}getVisibleBounds(){return this.visibleBounds.value.clone()}getFullBounds(){return this.fullBounds.value.clone()}getCenterOfMass(){return this.visibleCenterOfMass.value.clone()}onVisibleBoundsChanged(e){return this.visibleBounds.onChanged(e)}onFullBoundsChanged(e){return this.fullBounds.onChanged(e)}updateBounds(){var e;const t=null===(e=this.floorsViewData)||void 0===e?void 0:e.currentFloor;t&&!t.boundingBox.isEmpty()?(this.visibleBounds.value=t.boundingBox.clone(),this.visibleCenterOfMass.value=t.centerOfMass.clone()):this.trimsFulfilled?(this.visibleBounds.value=this.getTrimmedBounds(),this.visibleCenterOfMass.value=this.getTrimmedCenter()):(this.visibleBounds.value=this.meshData.extendedBounds,this.visibleCenterOfMass.value=this.meshData.centerOfMass)}}},35568:(e,t,i)=>{"use strict";i.d(t,{o:()=>n,A:()=>l});var n,a=i(54387),o=i(77201),s=i(68909),r=i(12767);class d extends s.Object3D{constructor(e){super(),this.anchor=this,this.reset=()=>{this.camera.position.set(0,0,0),this.camera.layers.mask=o.HU.ALL.mask,this.camera.updateMatrixWorld(!0)},this.update=e=>{this.anchor.position.copy(e.position),this.camera.quaternion.copy(e.rotation),this.camera.projectionMatrix.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.invert(),this.updateMatrixWorld(!0)},this.camera=new s.PerspectiveCamera(r.Bv.fov,e,r.Bv.near,r.Bv.far),this.add(this.camera),this.name="CameraRig",this.reset()}dispose(){this.remove(this.camera)}}!function(e){e[e.Root=0]="Root",e[e.CameraRig=1]="CameraRig"}(n||(n={}));class l{get lastRenderCallTime(){return this._lastRenderCallTime}constructor(e,t,i,a,o){this.scene=e,this.threeRenderer=t,this.cameraData=i,this.viewportManager=a,this.engine=o,this.ids=n,this.frameCount=0,this.effectComposer=null,this.rendering=!1,this.cameraRigStale=!0,this.canvasSizeChanged=!0,this.updateComposer=(()=>{const e=new s.Vector2;return()=>{this.canvasSizeChanged&&this.effectComposer&&(this.effectComposer.setPixelRatio(this.effectComposer.renderer.getPixelRatio()),this.effectComposer.renderer.getSize(e),this.effectComposer.setSize(e.x,e.y),this.canvasSizeChanged=!1)}})(),this.renderViewports=(()=>{const e=new s.Vector2;return t=>{var i,n;this.threeRenderer.clear();const a=this.cameraRig.camera.layers.mask;for(const a of this.viewportManager.viewports)if(this.viewportManager.renderingViewport=a,this.viewportManager.commit(),a.rect.getSize(e),this.threeRenderer.setViewport(a.rect.min.x,a.rect.min.y,e.x,e.y),null===(n=(i=this.engine).triggerRenderViewport)||void 0===n||n.call(i,t),this.effectComposer){const e=this.effectComposer.passes[0];e.scene=a.scene||this.scene,e.camera=a.camera,this.effectComposer.render(t)}else this.threeRenderer.render(a.scene||this.scene,a.camera);this.cameraRig.camera.layers.mask=a,this.viewportManager.renderingViewport=null,this.viewportManager.commit()}})(),this.cameraRig=new d(i.aspect()),a.setDomElement(t.domElement),this.viewportManager.defaultViewport.scene=this.scene,this.viewportManager.defaultViewport.camera=this.cameraRig.camera,t.info.autoReset=!1}add(...e){for(const t of e)this.addChild(n.Root,t)}remove(...e){for(const t of e)this.removeChild(n.Root,t)}addChild(e,t){switch(e){case n.Root:this.scene.add(t);break;case n.CameraRig:this.cameraRig.add(t);break;default:return!1}return!0}removeChild(e,t){switch(e){case n.Root:this.scene.remove(t);break;case n.CameraRig:this.cameraRig.remove(t);break;default:return!1}return!0}getSubTree(e){return(0,a.W9)(this.scene,e)}get camera(){return this.updateCameraRig(),this.cameraRig.camera}init(){this.cameraRigStale=!0}dispose(){this.cameraRig.dispose()}startRender(e){this.rendering=e}activate(e){this.scene.add(this.cameraRig),this.cameraDataCallback=()=>this.cameraRigStale=!0,this.cameraData.onChanged(this.cameraDataCallback),this.canvasSizeSub=new o.PF(this.cameraData.onPropertyChanged("width",(()=>this.onCanvasSizeChanged())),this.cameraData.onPropertyChanged("height",(()=>this.onCanvasSizeChanged())))}deactivate(e){var t;this.scene.remove(this.cameraRig),this.cameraData.pose.removeOnChanged(this.cameraDataCallback),null===(t=this.canvasSizeSub)||void 0===t||t.cancel()}beforeRender(){this.updateCameraRig(),this.updateComposer()}setCameraDirty(){this.cameraRigStale=!0,this.cameraRig.camera.updateProjectionMatrix()}onCanvasSizeChanged(){this.viewportManager.updateDefaultViewport(),this.canvasSizeChanged=!0}updateCameraRig(){this.cameraRigStale&&(this.cameraRig.update(this.cameraData.pose),this.cameraRigStale=!1)}render(e){var t,i;if(this.rendering)this.threeRenderer.info.reset(),this.renderViewports(e),this.frameCount++;else{for(const n of this.viewportManager.viewports)this.viewportManager.renderingViewport=n,this.viewportManager.commit(),null===(i=(t=this.engine).triggerRenderViewport)||void 0===i||i.call(t,e);this.viewportManager.renderingViewport=null,this.viewportManager.commit()}this._lastRenderCallTime=Date.now()}}},34720:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MAX_RESOLUTION:()=>X,default:()=>Y});var n=i(68909),a=i(77201),o=i(97800),s=i(37105),r=i(10459),d=i(19968),l=i(25316),c=i(70046),u=i(97171);var h=i(15934);const m=(e,t)=>{switch(e){case h.A.GL_TEXTURE_CUBE_MAP_POSITIVE_X:t.set(0,-Math.PI/2,0);break;case h.A.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:t.set(0,Math.PI/2,0);break;case h.A.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:t.set(Math.PI/2,Math.PI,0);break;case h.A.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:t.set(-Math.PI/2,Math.PI,0);break;case h.A.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:t.set(0,-Math.PI,0);break;case h.A.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:t.set(0,0,0)}};var p=i(59155),v=i(10711),f=i(27104),g=i.n(f),y=i(8454),w=i.n(y),b=i(9786),k=i.n(b),S=i(40368),T=i.n(S);const I={copyCubeMap:{uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:g(),fragmentShader:w()},sdfIcons:{uniforms:{atlasSize:{value:new n.Vector2},sdfAtlas:{value:null},depthTex:{value:null},globalOpacity:{value:1},cameraPos:{value:new n.Vector3},pixelRatio:{value:1},screenSize:{value:new n.Vector2},fadeMaxDepth:{value:100}},vertexShader:k(),fragmentShader:T()}};var D=i(2593);const N={0:[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],1:[0,0,0,0,0,0,0,3e-6,229e-6,.005977,.060598,.24173,.382925,.24173,.060598,.005977,229e-6,3e-6,0,0,0,0,0,0,0],2:[0,0,1e-6,1e-5,78e-6,489e-6,.002403,.009245,.027835,.065591,.120978,.174666,.197413,.174666,.120978,.065591,.027835,.009245,.002403,489e-6,78e-6,1e-5,1e-6,0,0],3:[48e-6,169e-6,538e-6,.001532,.003907,.008921,.018247,.033432,.054867,.080658,.106212,.125283,.132372,.125283,.106212,.080658,.054867,.033432,.018247,.008921,.003907,.001532,538e-6,169e-6,48e-6],4:[.001133,.002316,.00445,.008033,.013627,.021724,.032542,.04581,.0606,.075333,.088001,.096603,.099654,.096603,.088001,.075333,.0606,.04581,.032542,.021724,.013627,.008033,.00445,.002316,.001133],5:[.004571,.00723,.010989,.016048,.022521,.03037,.039354,.049003,.058632,.067411,.074476,.079066,.080657,.079066,.074476,.067411,.058632,.049003,.039354,.03037,.022521,.016048,.010989,.00723,.004571],6:[.009379,.012899,.017256,.022453,.028417,.034983,.041888,.048784,.055264,.060893,.065262,.068032,.068981,.068032,.065262,.060893,.055264,.048784,.041888,.034983,.028417,.022453,.017256,.012899,.009379],7:[.014185,.01793,.022207,.02695,.032045,.037335,.042622,.047676,.052254,.056116,.059048,.06088,.061504,.06088,.059048,.056116,.052254,.047676,.042622,.037335,.032045,.02695,.022207,.01793,.014185]};class E{constructor(e){this.threeRenderer=e,this.cachedSize=new n.Vector2,this.renderToCubeMap=(()=>{let e,t,i,a,o,s=!1;const r=.5;return(d,l,c,u,h,m,v,f,g,y,w,b,k,S,T,I)=>{if(this.contextLost)return;s||(t=new n.OrthographicCamera(-.5,r,r,-.5,-200,200),t.position.z=150,e=new n.Scene,e.name="rttCube",e.add(t),i=new n.ShaderMaterial({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:p.A.basicTextured.vertexShader,fragmentShader:p.A.basicTextured.fragmentShader,depthWrite:!1,depthTest:!1,side:n.DoubleSide}),a=new n.PlaneGeometry(1,1),o=new n.Mesh(a,i),o.position.z=0,e.add(o),s=!0);const D=a.getAttribute("uv");D.setUsage(n.DynamicDrawUsage),D.needsUpdate=!0;const N=D.array,E=h/c,P=m/u,_=v/c,C=f/u;N[0]=E,N[1]=P+C,N[2]=E+_,N[3]=P+C,N[4]=E,N[5]=P,N[6]=E+_,N[7]=P;const A=a.getAttribute("position");A.setUsage(n.DynamicDrawUsage),A.needsUpdate=!0;const x=A.array,V=g/l.width-r,M=y/l.height-r,O=w/l.width,L=b/l.height;x[0]=V,x[1]=M+L,x[3]=V+O,x[4]=M+L,x[6]=V,x[7]=M,x[9]=V+O,x[10]=M,i.uniforms.tDiffuse.value=d,i.blending=S||n.NoBlending,i.transparent=!!T,null==I&&(I=1),i.uniforms.alpha.value=I,l.viewport.set(0,0,l.width,l.height);const R=this.threeRenderer.getRenderTarget(),F=this.threeRenderer.autoClear,B=this.threeRenderer.xr.enabled;this.threeRenderer.xr.enabled=!1,this.threeRenderer.autoClear=!1,this.threeRenderer.setRenderTarget(l,k),this.threeRenderer.render(e,t),this.threeRenderer.setRenderTarget(R),this.threeRenderer.autoClear=F,this.threeRenderer.xr.enabled=B}})(),this.copyCubemap=(()=>{let e,t,i,a,o,s=!1;const r=new n.Euler,d=this;return(l,c,u,h,p)=>{if(this.contextLost)return;if(!s){const r=2,d=r/2;t=new n.OrthographicCamera(-d,d,d,-d,0,200),t.position.set(0,0,0),e=new n.Scene,e.name="copyCube",e.add(t),i=new n.ShaderMaterial({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:I.copyCubeMap.vertexShader,fragmentShader:I.copyCubeMap.fragmentShader,depthWrite:!1,depthTest:!1,side:n.DoubleSide}),a=new n.BoxGeometry(r,r,r),o=new n.Mesh(a,i),e.add(o),s=!0}const v=d.threeRenderer.getRenderTarget(),f=d.threeRenderer.autoClear,g=d.threeRenderer.xr.enabled;d.threeRenderer.xr.enabled=!1,d.threeRenderer.autoClear=!1;for(let a=0;a<6;a++)m(a,r),o.rotation.copy(r),o.matrixWorldNeedsUpdate=!0,o.updateMatrixWorld(!0),i.uniforms.tDiffuse.value=l,i.blending=u||n.NoBlending,i.transparent=!!h,null==p&&(p=1),i.uniforms.alpha.value=p,c.viewport.set(0,0,c.width,c.height),d.threeRenderer.setRenderTarget(c,a),d.threeRenderer.render(e,t);d.threeRenderer.setRenderTarget(v),d.threeRenderer.autoClear=f,d.threeRenderer.xr.enabled=g}})(),this.blurCubemap=(()=>{const e=e=>{const t=new n.WebGLCubeRenderTarget(e);return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,{renderTarget:t,cubeCamera:new n.CubeCamera(.1,1e3,t)}};class t extends n.Mesh{}const i=512,a={[i]:e(512)},o=new n.Scene,s=new t(new n.BoxGeometry(1,1,1));o.add(s);const r={};return(t,i,d=3,l=.005)=>{const c=i.renderTarget;a[c.width]||(a[c.width]=e(c.width)),s.material=function(e){if(!r[e]){const t=new n.ShaderMaterial({uniforms:n.UniformsUtils.clone(D.A.blurCube.uniforms),vertexShader:D.A.blurCube.vertexShader,fragmentShader:D.A.blurCube.fragmentShader,side:n.BackSide});t.defines={};const i=N[`${e}`];for(const[e,n]of i.entries())t.defines[`KERNEL_${e+1}`]=0===n||1===n?n.toFixed(1):n;r[e]=t}return r[e]}(d);const u=a[c.width];s.material.uniforms.map.value=t,s.material.uniforms.dir.value.set(l,0),u.cubeCamera.update(this.threeRenderer,o),s.material.uniforms.map.value=u.renderTarget.texture,s.material.uniforms.dir.value.set(0,l),i.update(this.threeRenderer,o)}})();try{const e=this.threeRenderer.getContext();this.contextLost=e.isContextLost(),this._maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._gpuInfo=function(e){try{const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return{vendor:e.getParameter(t.UNMASKED_VENDOR_WEBGL),renderer:e.getParameter(t.UNMASKED_RENDERER_WEBGL)}}catch(e){}return{vendor:"Unknown",renderer:"Unknown"}}(e)}catch(e){throw new v.y("Unable to create a WebGL rendering context")}this.initTexture=this.initTexture.bind(this)}initTexture(e){return this.threeRenderer.initTexture(e)}get maxCubemapSize(){return this._maxCubemapSize}get maxTextureSize(){return this._maxTextureSize}get gpuInfo(){return this._gpuInfo}getSize(){return this.threeRenderer.getSize(this.cachedSize)}getPixelRatio(){return this.threeRenderer.getPixelRatio()}dispose(){this.threeRenderer.dispose()}initSizedTexture2D(e,t){const i=new n.WebGLRenderTarget(e,e,Object.assign({colorSpace:n.SRGBColorSpace},t));return this.threeRenderer.initRenderTarget(i),i.texture}initRenderTargetCube(e,t){const i=new n.WebGLCubeRenderTarget(e,Object.assign({colorSpace:n.SRGBColorSpace,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1},t));return i.texture.image={},i.texture.image.width=e,i.texture.image.height=e,i}uploadTexture2D(e,t,i,a){if(!this.contextLost){const o=new n.Texture;o.image=e,this.threeRenderer.copyTextureToTexture(o,t,null,new n.Vector2(i,a),0)}}fence(e){return new Promise(((t,i)=>{const n=this.contextLost?null:e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);if(null===n)return i();e.flush();const a=()=>{switch(e.getSyncParameter(n,e.SYNC_STATUS)){case e.TIMEOUT_EXPIRED:return void setTimeout(a,0);case e.WAIT_FAILED:return void i();case e.SIGNALED:return e.deleteSync(n),void t();default:return void setTimeout(a,0)}};setTimeout(a,0)}))}}var P=i(84522),_=i(79388),C=i(37458);class A extends n.Mesh{constructor(e){super(new n.PlaneGeometry(2,2,1,1),new n.ShaderMaterial({uniforms:n.UniformsUtils.clone(p.A.screenSpaceColored.uniforms),vertexShader:p.A.screenSpaceColored.vertexShader,fragmentShader:p.A.screenSpaceColored.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1})),this._opacity=1,this.material.uniforms.color.value=(new n.Color).setHex(e),this.renderOrder=C.X.colorOverlay,this.name="ScreenOverlayMesh"}set opacity(e){this.visible=e>0,this._opacity=e,this.material.uniforms.opacity.value=e}get opacity(){return this._opacity}dispose(){this.material.dispose(),this.geometry.dispose()}}class x{constructor(e,t){this.scene=e,this.cameraData=t}init(){this.blackoutOverlayMesh=new A(0)}dispose(){this.blackoutOverlayMesh.dispose()}render(e){this.blackoutOverlayMesh.opacity=this.cameraData.transition.blackoutProgress.value}activate(e){this.scene.addChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}deactivate(e){this.scene.removeChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}}var V=i(35568),M=i(16964);const O=i.p+"images/atlas.png",L=111,R=200,F={arrows:{bl:[0,.43999999999999995],tr:[.6486486486486487,1]},"position-3d-horizontal":{bl:[0,0],tr:[1,.44]}},B=(new n.Quaternion).identity();class U extends n.ShaderMaterial{constructor(e){const t={FADE_WIDTH:.8.toFixed(3)},i=n.UniformsUtils.clone(I.sdfIcons.uniforms);e&&(t.FADE_DEPTH=e.fadeDepth.toFixed(3),i.depthTex.value=e.fadeDepthTexture.texture),super({fragmentShader:I.sdfIcons.fragmentShader,vertexShader:I.sdfIcons.vertexShader,uniforms:i,defines:t,name:"HandleMaterial",transparent:!0,side:n.FrontSide})}}const $=new Float32Array([-.5,0,-.5,.5,0,-.5,.5,0,.5,-.5,0,.5]),j=[0,1,2,0,2,3];class G extends M.l{constructor(e,t,i,a=100){const o=new n.InstancedBufferGeometry;o.setAttribute("position",new n.Float32BufferAttribute($,3)),o.setIndex(j),super(a,o,new U(i)),this.cameraPose=e,this.distanceBehindDepthMesh=t,this.raycastInstance=(()=>{const e=new n.Vector3,t=new n.Vector3,i=new n.Vector3,a=new n.Quaternion,o=new n.Vector3,s=new n.Vector2;return(r,d,l,c)=>{const{bl:u,tr:h}=F[d],m=z(u,h,s);for(const s of this.getIndices(r)){o.set(this.centerPosition.getX(s),this.centerPosition.getY(s),this.centerPosition.getZ(s)),a.set(this.rotationQuat.getX(s),this.rotationQuat.getY(s),this.rotationQuat.getZ(s),this.rotationQuat.getW(s));const d=this.scaleFactor.getX(s);for(let s=0;s<2;s++){const u=j[3*s],h=j[3*s+1],p=j[3*s+2];e.set($[3*u],$[3*u+1],$[3*u+2]),t.set($[3*h],$[3*h+1],$[3*h+2]),i.set($[3*p],$[3*p+1],$[3*p+2]),H(e,o,a,m,d),H(t,o,a,m,d),H(i,o,a,m,d);const v=l.ray.intersectTriangle(e,t,i,!1,new n.Vector3);if(v){if(!(null!=this.fadeDepth&&this.distanceBehindDepthMesh(v)>this.fadeDepth+.8))return void c.push({point:v,normal:q(e,t,i,l.ray),distance:v.distanceTo(l.ray.origin),object:r})}}}}})(),this.fadeDepth=(null==i?void 0:i.fadeDepth)||null,this.centerPosition=new n.InstancedBufferAttribute(new Float32Array(3*this.capacityForAllInstances),3),this.geometry.setAttribute("centerPosition",this.centerPosition),this.rotationQuat=new n.InstancedBufferAttribute(new Float32Array(4*this.capacityForAllInstances),4),this.geometry.setAttribute("rotationQuat",this.rotationQuat),this.scaleFactor=new n.InstancedBufferAttribute(new Float32Array(this.capacityForAllInstances),1),this.geometry.setAttribute("scaleFactor",this.scaleFactor),this.blTrUvs=new n.InstancedBufferAttribute(new Float32Array(4*this.capacityForAllInstances),4),this.geometry.setAttribute("blTrUvs",this.blTrUvs),this.innerColor=new n.InstancedBufferAttribute(new Float32Array(3*this.capacityForAllInstances),3),this.geometry.setAttribute("innerColor",this.innerColor),this.outlineInfo=new n.InstancedBufferAttribute(new Float32Array(4*this.capacityForAllInstances),4),this.geometry.setAttribute("outlineInfo",this.outlineInfo),this.opacityAttr=new n.InstancedBufferAttribute(new Float32Array(this.capacityForAllInstances),1),this.geometry.setAttribute("opacityAttr",this.opacityAttr),this.visible=!1,this.material.uniforms.atlasSize.value.set(L,R),this.onBeforeRender=e=>{e.getSize(this.material.uniforms.screenSize.value),this.material.uniforms.pixelRatio.value=e.getPixelRatio(),this.material.uniforms.cameraPos.value.copy(this.cameraPose.position)}}setAtlasTexture(e){this.material.uniforms.sdfAtlas.value=e,this.visible=!0}setGlobalOpacity(e){this.material.uniforms.globalOpacity.value=e}createIcon(e,t){this.allocInstance(t),this.setIconName(e,t),this.setRotationForInstance(t,B)}setIconName(e,t){const{bl:i,tr:n}=F[e];for(const e of this.getIndices(t))this.blTrUvs.setXYZW(e,i[0],i[1],n[0],n[1]);this.blTrUvs.needsUpdate=!0}removeIcon(e){this.removeInstance(e)}setPositionForInstance(e,t){for(const i of this.getIndices(e))this.centerPosition.setXYZ(i,t.x,t.y,t.z);this.centerPosition.needsUpdate=!0}setRotationForInstance(e,t){for(const i of this.getIndices(e))this.rotationQuat.setXYZW(i,t.x,t.y,t.z,t.w);this.rotationQuat.needsUpdate=!0}setScaleForInstance(e,t){for(const i of this.getIndices(e))this.scaleFactor.setX(i,t);this.scaleFactor.needsUpdate=!0}setInnerColorForInstance(e,t){for(const i of this.getIndices(e))this.innerColor.setXYZ(i,t.r,t.g,t.b);this.innerColor.needsUpdate=!0}setOutlineForInstance(e,t,i){for(const n of this.getIndices(e))this.outlineInfo.setXYZW(n,t.r,t.g,t.b,i);this.outlineInfo.needsUpdate=!0}setOpacityForInstance(e,t){for(const i of this.getIndices(e))this.opacityAttr.setX(i,t);this.opacityAttr.needsUpdate=!0}}const z=(e,t,i)=>(i.set(t[0]-e[0],t[1]-e[1]),i.x*=L,i.y*=R,i.multiplyScalar(.001),i),H=(e,t,i,n,a)=>(e.x*=n.x,e.z*=n.y,e.multiplyScalar(a),e.applyQuaternion(i),e.add(t),e),q=(()=>{const e=new n.Vector3,t=new n.Vector3;return(i,n,a,o)=>{e.subVectors(i,n),t.subVectors(i,a);const s=e.cross(t).normalize();return s.dot(o.direction)>0&&s.multiplyScalar(-1),s.clone()}})();var W=i(32024),K=i(71687);const X=3686400;class Y extends a.nV{constructor(){super(...arguments),this.name="webgl-renderer",this.sdfIconAtlas=null,this.atlasQueue=[],this.onContextLost=e=>{o.Vy.for(this).info(e),this._cwfRenderer.contextLost=!0,this.engine.broadcast(new _.ul(e)),e.preventDefault()},this.onContextRestored=e=>{var t;o.Vy.for(this).info(e),this._cwfRenderer.contextLost=!1,this.engine.broadcast(new _.aF(e)),null===(t=this.canvas.parentNode)||void 0===t||t.insertBefore(this.canvas,this.canvas)},this.getPixelRatioFor=(e,t)=>{const i=window.devicePixelRatio||1;return e*t*i<=X?i:1}}async init(e,t){if(!("WebGLRenderingContext"in window))throw new v.s("WebGL not supported");this.canvas=e.canvas,this.engine=t;const h=(await t.getModuleBySymbol(K.Qm)).viewportManager;let m;try{const t={canvas:this.canvas,antialias:e.antialias,alpha:!0,stencil:!0,powerPreference:"high-performance"};m=new n.WebGLRenderer(t),m.autoClear=!1,m.xr.enabled=!0}catch(e){if((0,o.w2)())return o.Vy.for(this).error("Bot detected, using mock renderer"),void await this.mockBotRenderer(h);throw new v.y("Unable to create a WebGL rendering context")}m.setOpaqueSort(this.painterSortStable),this.patchGLContext(m.getContext()),(0,W.S)(O,n.LinearSRGBColorSpace).then((e=>{this.sdfIconAtlas=e;for(const t of this.atlasQueue)t.setAtlasTexture(e);this.atlasQueue=[]})),this._cwfRenderer=new E(m),this._threeRenderer=m,[this.cameraData,this.settingsData]=await Promise.all([t.market.waitForData(r.M),t.market.waitForData(l.o)]);const p=new n.Scene;if(p.name="main",t.diContainer.bindConstant("ThreeScene",p),this.scene=new V.A(p,m,this.cameraData,h,t),e.useEffectComposer){const[e,t]=await Promise.all([i.e(1662).then(i.bind(i,42562)),i.e(1662).then(i.bind(i,65804))]),a=this.threeRenderer.getSize(new n.Vector2),o=new n.WebGLRenderTarget(a.x,a.y,{stencilBuffer:!0});this.scene.effectComposer=new e.EffectComposer(this.threeRenderer,o),this.scene.effectComposer.addPass(new t.RenderPass(this.scene.scene,this.scene.cameraRig.camera))}t.addComponent(this,this.scene),t.addComponent(this,new x(this.scene,this.cameraData));const f=await t.market.waitForData(s.p);this.setSize(f.width,f.height),this.bindings.push(t.subscribe(a.hB,(e=>this.setSize(e.width,e.height))),t.commandBinder.addBinding(P.R,(async e=>(0,d.bz)(this.cameraData,e.worldPosition).screenPosition)),new a.wo(this.canvas,"webglcontextlost",this.onContextLost),new a.wo(this.canvas,"webglcontextrestored",this.onContextRestored)),this.webGlMemoryTracker=m.getContext().getExtension("GMAN_webgl_memory"),this.webGlMemoryTracker?this.webGlMemoryTracker.setAllowUnknownTextures(!0):o.Vy.for(this).warn("Unable to find WebGL memory tracker!"),t.broadcast(new c.sb(u.D.WebGLRenderer))}dispose(e){super.dispose(e),this.threeRenderer.dispose()}isHighPerformanceMobileGPU(){return e=this._cwfRenderer.gpuInfo,/Apple A(9|1\d)/.test(e.renderer)||/Adreno \(TM\) (512|530|540|[6-9]\d\d)/.test(e.renderer)||/Mali-G(7[1-9]|[8-9]\d)/.test(e.renderer);var e}createInstancedSDFIconBuffer(e,t){const i=new G(this.cameraData.pose,e,t);return null==this.sdfIconAtlas?this.atlasQueue.push(i):i.setAtlasTexture(this.sdfIconAtlas),i}patchGLContext(e){if(function(e){let t=!1;if("undefined"!=typeof OffscreenCanvas){const i=new OffscreenCanvas(1,1);if(i.getContext("2d")){const n=e.createTexture();try{e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i)}catch(e){t=!0}finally{e.bindTexture(e.TEXTURE_2D,null),e.deleteTexture(n)}}}return t}(e)){o.Vy.for(this).warn("OffscreenCanvas unsupported as texImage2D source, applying workaround");let t=null;const i=e.texImage2D;e.texImage2D=function(...n){var a;const o=n[5];o&&o instanceof OffscreenCanvas?(t=t||document.createElement("canvas"),t.width=o.width,t.height=o.height,null===(a=t.getContext("2d"))||void 0===a||a.drawImage(o,0,0),n[5]=t,i.call(e,...n),t.width=t.height=1):i.call(e,...n)}}}get gpuInfo(){return this._cwfRenderer.gpuInfo}get maxCubemapSize(){return this._cwfRenderer.maxCubemapSize}get maxTextureSize(){return this._cwfRenderer.maxTextureSize}get maxVaryings(){return this._threeRenderer.capabilities.maxVaryings}getScene(){return this.scene}getCamera(){return this.scene.camera}get cwfRenderer(){return this._cwfRenderer}get threeRenderer(){return this._threeRenderer}async renderOnce(){return this.scene.startRender(!0),this.engine.after(a.Rb.Render).then((()=>this.scene.startRender(!1)))}startRender(e=!0){this.scene.startRender(e),this.engine.broadcast(new _.lo(this._cwfRenderer.getPixelRatio()))}setSize(e,t){const i=this.getPixelRatioFor(e,t);i!==this._cwfRenderer.getPixelRatio()&&(o.Vy.for(this).debug(`Setting pixel ratio to ${i}`),this.engine.broadcast(new _.lo(i))),this.threeRenderer.xr.isPresenting&&o.Vy.for(this).error("setting size while in xr is a no no, it resets the viewport",e,t),this.threeRenderer.setDrawingBufferSize(e,t,i),this.scene.setCameraDirty()}supportsInstancing(){const{threeRenderer:e,settingsData:t}=this;return 1!==t.getOverrideParam("noInstancing",0)&&(e.capabilities.isWebGL2||e.extensions.has("ANGLE_instanced_arrays"))}getCapabilities(){const{capabilities:e,extensions:t}=this.threeRenderer,i=e.isWebGL2;let n=!1;try{n=!!document.createElement("canvas").getContext("webgl2")}catch(e){}return{gl_v2:n,gl_max_textures:e.maxTextures,gl_max_texture_size:e.maxTextureSize,gl_max_cubemap_size:e.maxCubemapSize,gl_instancing:this.supportsInstancing(),gl_oes_texture_float:i||t.has("OES_texture_float"),gl_oes_texture_half_float:i||t.has("OES_texture_half_float"),gl_depth_texture:i||t.has("WEBGL_depth_texture"),gl_draw_buffers:i||t.has("WEBGL_draw_buffers"),gl_oes_fbo_render_mip_map:i||t.has("OES_fbo_render_mipmap"),gl_shader_texture_lod:i||t.has("EXT_shader_texture_lod"),gl_oes_vertex_array_obj:i||t.has("OES_vertex_array_object"),gl_ovr_multi_view:i&&t.has("OVR_multiview2"),gl_color_buffer_float:i&&t.has("EXT_color_buffer_float"),gl_astc_supported:t.has("WEBGL_compressed_texture_astc"),gl_etc1_supported:t.has("WEBGL_compressed_texture_etc1"),gl_etc2_supported:t.has("WEBGL_compressed_texture_etc"),gl_dxt_supported:t.has("WEBGL_compressed_texture_s3tc"),gl_bptc_supported:t.has("EXT_texture_compression_bptc"),gl_pvrtc_supported:t.has("WEBGL_compressed_texture_pvrtc")||t.has("WEBKIT_WEBGL_compressed_texture_pvrtc")}}estimatedGPUMemoryAllocated(){if(this.webGlMemoryTracker){return this.webGlMemoryTracker.getMemoryInfo().memory.total}return-1}painterSortStable(e,t){if(e.groupOrder!==t.groupOrder)return e.groupOrder-t.groupOrder;if(e.renderOrder!==t.renderOrder)return e.renderOrder-t.renderOrder;if(e.program!==t.program)return e.program.id-t.program.id;if(e.material.id!==t.material.id)return e.material.id-t.material.id;if(e.object.getSortKey&&t.object.getSortKey){const i=e.object.getSortKey()-t.object.getSortKey();if(0!==i)return i}return e.z!==t.z?e.z-t.z:e.id-t.id}async mockBotRenderer(e){this._cwfRenderer={initRenderTargetCube:()=>({width:512,height:512}),initSizedTexture2D:()=>({width:512,height:512}),getPixelRatio:()=>window.innerWidth/window.innerHeight,getSize:()=>new n.Vector2(window.innerWidth,window.innerHeight),gpuInfo:{vendor:"bot",renderer:"bot"},maxCubemapSize:1024,maxTextureSize:1024,renderToCubeMap:()=>{},uploadTexture2D:()=>{}},this._threeRenderer={capabilities:{maxVaryings:16,maxTextures:8,maxTextureSize:1024,maxCubemapSize:1024,isWebGL2:!1},extensions:{has:()=>!1},setAnimationLoop:e=>{setInterval(e,16)},xr:{enabled:!1}},this.scene=new V.A(new n.Scene,this._threeRenderer,new r.M(window.innerWidth,window.innerHeight),e,this.engine),this.settingsData=new l.o}}},31285:(e,t,i)=>{"use strict";i.d(t,{A:()=>a});var n=i(77201);class a extends n.QB{constructor(e){super(),this.zoomLevel=e}}},52947:(e,t,i)=>{"use strict";i.d(t,{Ay:()=>o,F7:()=>r,cF:()=>s});var n=i(68909);class a{constructor(e,t){this.raycast=(()=>{const e=new n.Vector3,t=new n.Box3;return(i,n,o,d)=>{const l=t.copy(this.bounds).expandByScalar(n);if(i.ray.intersectsBox(l))for(const t of this.children)if(t instanceof a)t.raycast(i,n,o,d);else if(t instanceof s){if(!1===(null==d?void 0:d(t)))continue;const a=e,s=i.ray.distanceSqToSegment(t.start,t.end,void 0,e),r=Math.sqrt(s);r<n&&o.push({distance:i.ray.origin.distanceTo(a),object:t,distanceToRay:r,point:a.clone(),isLineOctreeIntersection:!0})}else if(t instanceof r){if(!1===(null==d?void 0:d(t)))continue;const e=i.ray.distanceToPoint(t);e<n&&o.push({distance:i.ray.origin.distanceTo(t),object:t,distanceToRay:e,point:t.clone(),isLineOctreeIntersection:!0})}}})(),this.level=t,this.bounds=e.clone(),this.clear()}clear(){this.childNodes=[],this.children=[]}add(e){let t=!1;const i=e instanceof n.Line3?[e.start,e.end]:[e];if(this.level<4){0===this.childNodes.length&&this.buildChildNodes();for(const n of this.childNodes)i.every((e=>n.bounds.containsPoint(e)))&&(t=!0,n.add(e))}t||this.children.push(e)}remove(e){const t=e instanceof n.Line3?[e.start,e.end]:[e];for(let i=0;i<this.children.length;i++){const n=this.children[i];if(n instanceof a){if(t.every((e=>n.bounds.containsPoint(e)))&&n.remove(e))return!0}else if(n===e)return this.children.splice(i,1),!0}return!1}buildChildNodes(){const e=this.bounds.max.clone().sub(this.bounds.min).clone().multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let o=0;o<2;o++){const s=this.bounds.min.x+e.x*o,r=s+e.x,d=this.bounds.min.y+e.y*t,l=d+e.y,c=this.bounds.min.z+e.z*i,u=c+e.z,h=new n.Box3(new n.Vector3(s,d,c),new n.Vector3(r,l,u)),m=new a(h,this.level+1);this.childNodes.push(m),this.children.push(m)}}spherecast(e,t){if(e.intersectsBox(this.bounds))for(const i of this.children)if(i instanceof a)i.spherecast(e,t);else if(i instanceof s){const a=i.closestPointToPoint(e.center,!0,new n.Vector3);a.distanceTo(e.center)<e.radius&&t.push(new r(a))}else i instanceof n.Vector3&&i.distanceTo(e.center)<e.radius&&t.push(i)}traverse(e){for(const t of this.children)t instanceof a?t.traverse(e):e(t)}}class o{constructor(e){this.pointCount=0,this.lineCount=0,this.root=new a(e,0)}add(e){e instanceof n.Line3?this.lineCount++:e instanceof n.Vector3&&this.pointCount++,this.root.add(e)}remove(e){e instanceof s?this.lineCount--:e instanceof r&&this.pointCount--,this.root.remove(e)}clear(){this.root.clear(),this.pointCount=0,this.lineCount=0}traverse(e){this.root.traverse(e)}raycast(e,t,i){const n=[];return this.root.raycast(e,t,n,i),n}}class s extends n.Line3{constructor(e,t){super(e,t),this.start=e,this.end=t,this.isSnapLine3=!0}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}clone(){return new s(this.start,this.end)}}class r extends n.Vector3{constructor(e){super(),this.point=e,this.isSnapVector3=!0,super.copy(e)}copy(e){return this.point.copy(e.point),this}clone(){return new r(this.point)}}},8032:(e,t,i)=>{"use strict";i.d(t,{c:()=>n});class n{constructor(){this.activePromise=Promise.resolve(new a)}async lock(){const e=new Promise((async e=>{(await this.activePromise).onUnlock((()=>e(new a)))})),t=this.activePromise;return this.activePromise=e,t}}class a{onUnlock(e){this.unlockCB=e}unlock(){this.unlockCB()}}},83375:(e,t,i)=>{"use strict";var n;i.d(t,{h:()=>n}),function(e){function t(e){return e.split(".").reduce(((e,t)=>{const i=parseInt(t,10);return isNaN(i)||e.push(i),e}),[])}function i(e,i){const n=t(e),a=t(i);for(let e=0;e<n.length;e++){if(e>=a.length)return 1;if(n[e]!==a[e])return n[e]>a[e]?1:-1}return a.length>n.length?-1:0}e.parse=t,e.gt=function(e,t){return 1===i(e,t)},e.gte=function(e,t){const n=i(e,t);return 0===n||1===n},e.lt=function(e,t){return-1===i(e,t)},e.eq=function(e,t){return 0===i(e,t)},e.compare=i}(n||(n={}))},8454:e=>{e.exports="precision highp float;precision highp int;vec3 closestPointToRay(vec3 point,vec3 origin,vec3 direction){vec3 d=point-origin;float D=dot(d,direction);return origin+D*direction;}vec3 rayIntersectsSphere(vec3 origin,float radius,vec3 rayOrigin,vec3 rayDirection){vec3 chordPoint=closestPointToRay(origin,rayOrigin,rayDirection);float D1=length(rayOrigin-chordPoint);float D=length(chordPoint-origin);float D2=sqrt(radius*radius-D*D);return rayOrigin+(D1+D2)*rayDirection;}varying vec3 vWorldPos;uniform float alpha;uniform samplerCube tDiffuse;void main(){vec4 texColor=textureCube(tDiffuse,vWorldPos);gl_FragColor=linearToOutputTexel(vec4(texColor.rgb,texColor.a*alpha));}"},27104:e=>{e.exports="precision highp float;precision highp int;varying vec3 vWorldPos;void main(){vWorldPos=vec3(-position.x,-position.y,position.z);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},40368:e=>{e.exports="precision highp float;uniform sampler2D sdfAtlas;uniform float globalOpacity;uniform vec2 atlasSize;varying vec2 vUv;varying vec3 vInnerColor;varying vec4 vOutlineInfo;varying float vOpacity;varying vec3 vWorldPos;\n#ifdef FADE_DEPTH\nuniform vec3 cameraPos;uniform vec2 screenSize;uniform float pixelRatio;\n#endif\n#ifdef FADE_DEPTH\nuniform sampler2D depthTex;uniform float fadeMaxDepth;float sample_depth(){vec2 frameBufferSize=screenSize*pixelRatio;vec2 screenUv=gl_FragCoord.xy/frameBufferSize;vec2 onePx=1./frameBufferSize;float nearestDepth=texture2D(depthTex,screenUv).r*fadeMaxDepth;return nearestDepth;}float calcDepthFadeOpacity(float currDepth){float nearestDepth=sample_depth();float behindDepth=max(currDepth-nearestDepth,0.);float depthFadeStartDist=FADE_DEPTH;float depthFadeEndDist=FADE_DEPTH+FADE_WIDTH;float depthFadeT=clamp((behindDepth-depthFadeStartDist)/(depthFadeEndDist-depthFadeStartDist),0.,1.);float depthFadeOpacity=1.-mix(0.,1.,depthFadeT);return depthFadeOpacity;}\n#endif\nfloat signedDist(){return texture2D(sdfAtlas,vUv).r;}void main(){float signedDist=signedDist();const float sdfCutoff=0.75;const float maxOutlineHalfWidth=0.25;float metersPerPx=length(fwidth(vWorldPos));const float baseAAWidth=8.;float aaWidth=baseAAWidth*metersPerPx;float outlinePct=vOutlineInfo.a;float threshold=sdfCutoff-mix(0.,maxOutlineHalfWidth,outlinePct);float aaLow=threshold-aaWidth;float aaHigh=threshold+aaWidth;float aaAlpha=smoothstep(aaLow,aaHigh,signedDist);float outlineStartThreshold=sdfCutoff+mix(0.,maxOutlineHalfWidth,outlinePct);float outlineAALow=outlineStartThreshold-aaWidth;float outlineAAHigh=outlineStartThreshold+aaWidth;float outlineTransitionAlpha=smoothstep(outlineAALow,outlineAAHigh,signedDist);vec3 fillColor=mix(vOutlineInfo.xyz,vInnerColor,outlineTransitionAlpha);float depthFadeOpacity=1.;\n#ifdef FADE_DEPTH\nfloat distanceFromCamera=length(cameraPos-vWorldPos);depthFadeOpacity=calcDepthFadeOpacity(distanceFromCamera);\n#endif\nfloat finalOpacity=aaAlpha*depthFadeOpacity*vOpacity*globalOpacity;if(finalOpacity<0.01){discard;}vec4 outputColor=linearToOutputTexel(vec4(fillColor,1.));gl_FragColor=vec4(outputColor.xyz,finalOpacity);}"},9786:e=>{e.exports="precision highp float;uniform vec2 atlasSize;attribute vec3 centerPosition;attribute vec4 rotationQuat;attribute float scaleFactor;attribute vec4 blTrUvs;attribute vec3 innerColor;attribute vec4 outlineInfo;attribute float opacityAttr;varying vec2 vUv;varying vec3 vInnerColor;varying vec4 vOutlineInfo;varying float vOpacity;varying vec3 vWorldPos;vec3 applyQuaternion(vec3 v,vec4 q){vec3 t=2.*cross(q.xyz,v);vec3 r=v+q.w*t+cross(q.xyz,t);return r;}void main(){vec2 bl=blTrUvs.xy;vec2 tr=blTrUvs.zw;vec2 localUv=position.xz+vec2(0.5,0.5);float u=mix(bl.x,tr.x,localUv.x);float v=mix(bl.y,tr.y,localUv.y);vUv=vec2(u,v);vec2 size=(tr-bl)*atlasSize/1000.;vInnerColor=innerColor;vOutlineInfo=outlineInfo;vOpacity=opacityAttr;vec3 scaledQuadPosition=position*vec3(size.x,1.,size.y)*scaleFactor;vec3 rotatedQuadPosition=applyQuaternion(scaledQuadPosition,rotationQuat);vec3 worldPos=rotatedQuadPosition+centerPosition;vWorldPos=worldPos;gl_Position=projectionMatrix*modelViewMatrix*vec4(worldPos,1.);}"}}]);